#!/usr/bin/env node

/**
 * Claude Code Zen - Working Binary Distribution
 * Uses esbuild-compiled ES modules (no NCC bundling issues)
 */

const { join } = require('path');
const { spawn } = require('child_process');
const { existsSync } = require('fs');

const binDir = __dirname;
const workingDir = join(binDir, 'working');
const mainScript = join(workingDir, 'claude-zen.js');

// Pass all arguments to the main script
const args = process.argv.slice(2);

// Ensure working directory exists
if (!existsSync(workingDir)) {
  console.error('❌ Working directory not found. Please run: npm run binary:build');
  process.exit(1);
}

// Set environment variables for WASM modules
process.env.CLAUDE_ZEN_BUNDLE_MODE = 'true';
process.env.CLAUDE_ZEN_WASM_PATH = join(workingDir, 'wasm');

console.log('✅ Starting Claude Code Zen (Working Build)...');

// Launch the main application
const child = spawn('node', [mainScript, ...args], {
  stdio: 'inherit',
  cwd: process.cwd(),
  env: { ...process.env }
});

child.on('exit', (code) => {
  process.exit(code || 0);
});

child.on('error', (error) => {
  console.error('❌ Failed to start Claude Code Zen:', error.message);
  process.exit(1);
});