<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Monitor Panel Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #f0f6fc;
            padding: 20px;
            margin: 0;
        }
        
        /* Performance Panel Styles */
        .performance-panel {
            padding: 20px;
        }
        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #30363d;
        }
        .performance-header h3 {
            margin: 0;
            color: #58a6ff;
            font-size: 1.5rem;
        }
        .performance-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 16px;
            border-radius: 6px;
            border: 1px solid #30363d;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #21262d;
            color: #f0f6fc;
            text-decoration: none;
        }
        .btn:hover {
            background: #30363d;
        }
        
        /* Performance Overview */
        .performance-overview {
            margin-bottom: 30px;
        }
        .perf-metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .perf-metric-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
        }
        .perf-metric-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .perf-metric-header h4 {
            margin: 0;
            color: #f0f6fc;
            font-size: 1rem;
        }
        .perf-icon {
            font-size: 1.2rem;
        }
        .perf-metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 5px;
        }
        .perf-metric-value.large {
            font-size: 2.5rem;
        }
        .perf-metric-label {
            color: #8b949e;
            font-size: 14px;
        }
        .perf-progress-container {
            position: relative;
            margin-bottom: 10px;
        }
        .perf-progress-bar {
            width: 100%;
            height: 12px;
            background: #21262d;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #30363d;
        }
        .perf-progress-fill {
            height: 100%;
            background: #238636;
            transition: width 0.8s ease;
            border-radius: 5px;
        }
        .perf-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: 600;
            color: #f0f6fc;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        
        /* Charts */
        .performance-charts {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
        }
        .chart-container h4 {
            margin: 0 0 20px 0;
            color: #58a6ff;
            font-size: 1.1rem;
        }
        .chart-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #30363d;
        }
        .chart-tab {
            padding: 8px 16px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #8b949e;
        }
        .chart-tab.active {
            background: #58a6ff;
            color: white;
            border-color: #58a6ff;
        }
        .metrics-sidebar {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
        }
        .metrics-sidebar h4 {
            margin: 0 0 20px 0;
            color: #58a6ff;
            font-size: 1.1rem;
        }
        .live-metrics {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .live-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #30363d;
        }
        .live-metric:last-child {
            border-bottom: none;
        }
        .live-metric .metric-label {
            color: #8b949e;
            font-size: 13px;
        }
        .live-metric .metric-value {
            font-weight: 600;
            font-family: 'SF Mono', Consolas, monospace;
            color: #58a6ff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="performance-panel">
        <!-- Performance Header -->
        <div class="performance-header">
            <h3>📊 System Performance Monitor</h3>
            <div class="performance-controls">
                <button class="btn" onclick="refreshPerformanceMetrics()" title="Refresh metrics">
                    <span class="icon">🔄</span>
                    Refresh
                </button>
                <button class="btn" onclick="exportPerformanceReport()" title="Export performance data">
                    <span class="icon">📊</span>
                    Export
                </button>
                <button class="btn" onclick="toggleRealTimeMonitoring()" title="Toggle real-time monitoring">
                    <span class="icon">⚡</span>
                    <span id="realtime-status">Real-time</span>
                </button>
            </div>
        </div>

        <!-- System Overview -->
        <div class="performance-overview">
            <div class="perf-metric-grid">
                <div class="perf-metric-card">
                    <div class="perf-metric-header">
                        <span class="perf-icon">⚡</span>
                        <h4>System Uptime</h4>
                    </div>
                    <div class="perf-metric-value large" id="uptime">2h 34m 15s</div>
                    <div class="perf-metric-label">Running continuously</div>
                </div>

                <div class="perf-metric-card">
                    <div class="perf-metric-header">
                        <span class="perf-icon">💾</span>
                        <h4>Memory Usage</h4>
                    </div>
                    <div class="perf-progress-container">
                        <div class="perf-progress-bar">
                            <div class="perf-progress-fill" id="memory-progress" style="width: 45%; background-color: #238636"></div>
                        </div>
                        <div class="perf-progress-text">45%</div>
                    </div>
                    <div class="perf-metric-details">
                        <span>Used: 125.6 MB</span>
                        <span>Total: 279.4 MB</span>
                    </div>
                </div>

                <div class="perf-metric-card">
                    <div class="perf-metric-header">
                        <span class="perf-icon">🔥</span>
                        <h4>CPU Usage</h4>
                    </div>
                    <div id="cpu-usage-container">
                        <div class="perf-metric-value large" id="cpu-percentage">23.4%</div>
                        <div class="perf-metric-label">Current load</div>
                        <div class="perf-progress-bar">
                            <div class="perf-progress-fill" id="cpu-progress-bar" style="width: 23%; background-color: #238636"></div>
                        </div>
                    </div>
                </div>

                <div class="perf-metric-card">
                    <div class="perf-metric-header">
                        <span class="perf-icon">📈</span>
                        <h4>Event Loop Lag</h4>
                    </div>
                    <div id="event-loop-container">
                        <div class="perf-metric-value large" id="event-loop-lag">1.2ms</div>
                        <div class="perf-metric-label">Milliseconds</div>
                        <div class="perf-metric-status good" id="event-loop-status">Excellent</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Charts -->
        <div class="performance-charts">
            <div class="chart-container">
                <h4>📈 Real-time System Metrics</h4>
                <div class="chart-tabs">
                    <button class="chart-tab active" onclick="switchChart('system')">System</button>
                    <button class="chart-tab" onclick="switchChart('memory')">Memory</button>
                    <button class="chart-tab" onclick="switchChart('llm')">LLM</button>
                    <button class="chart-tab" onclick="switchChart('network')">Network</button>
                </div>
                <div class="chart-content">
                    <canvas id="performance-chart" width="800" height="300"></canvas>
                </div>
            </div>

            <div class="metrics-sidebar">
                <h4>📊 Live Metrics</h4>
                <div class="live-metrics">
                    <div class="live-metric">
                        <span class="metric-label">Requests/sec:</span>
                        <span class="metric-value" id="requests-per-sec">47.3</span>
                    </div>
                    <div class="live-metric">
                        <span class="metric-label">Active connections:</span>
                        <span class="metric-value" id="active-connections">12</span>
                    </div>
                    <div class="live-metric">
                        <span class="metric-label">Error rate:</span>
                        <span class="metric-value" id="error-rate">0.1%</span>
                    </div>
                    <div class="live-metric">
                        <span class="metric-label">Cache hit ratio:</span>
                        <span class="metric-value" id="cache-hit-ratio">94.2%</span>
                    </div>
                    <div class="live-metric">
                        <span class="metric-label">GC pressure:</span>
                        <span class="metric-value" id="gc-pressure">Low</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let performanceChart;
        let realTimeMonitoring = true;

        // Initialize performance chart
        function initializePerformanceChart() {
            const canvas = document.getElementById('performance-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'CPU %',
                            data: [],
                            borderColor: '#58a6ff',
                            backgroundColor: 'rgba(88, 166, 255, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Memory %',
                            data: [],
                            borderColor: '#f85149',
                            backgroundColor: 'rgba(248, 81, 73, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Event Loop Lag (ms)',
                            data: [],
                            borderColor: '#a5a5a5',
                            backgroundColor: 'rgba(165, 165, 165, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time',
                                color: '#8b949e'
                            },
                            ticks: { color: '#8b949e' },
                            grid: { color: '#30363d' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Percentage (%)',
                                color: '#8b949e'
                            },
                            min: 0,
                            max: 100,
                            ticks: { color: '#8b949e' },
                            grid: { color: '#30363d' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Latency (ms)',
                                color: '#8b949e'
                            },
                            grid: {
                                drawOnChartArea: false,
                                color: '#30363d'
                            },
                            min: 0,
                            ticks: { color: '#8b949e' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Real-time System Performance',
                            color: '#f0f6fc'
                        },
                        legend: {
                            display: true,
                            labels: { color: '#8b949e' }
                        }
                    }
                }
            });
        }

        function updatePerformanceData() {
            const now = new Date();
            const timestamp = now.toLocaleTimeString();
            
            // Simulate data
            const cpuUsage = Math.random() * 30 + 10;
            const memoryUsage = Math.random() * 20 + 40;
            const eventLoopLag = Math.random() * 3 + 0.5;
            
            // Update displays
            document.getElementById('cpu-percentage').textContent = cpuUsage.toFixed(1) + '%';
            document.getElementById('memory-progress').style.width = memoryUsage + '%';
            document.getElementById('event-loop-lag').textContent = eventLoopLag.toFixed(1) + 'ms';
            document.getElementById('requests-per-sec').textContent = (Math.random() * 50 + 10).toFixed(1);
            
            // Update chart
            if (performanceChart) {
                performanceChart.data.labels.push(timestamp);
                performanceChart.data.datasets[0].data.push(cpuUsage);
                performanceChart.data.datasets[1].data.push(memoryUsage);
                performanceChart.data.datasets[2].data.push(eventLoopLag);
                
                // Keep only last 20 data points
                if (performanceChart.data.labels.length > 20) {
                    performanceChart.data.labels.shift();
                    performanceChart.data.datasets.forEach(dataset => dataset.data.shift());
                }
                
                performanceChart.update('none');
            }
        }

        function switchChart(type) {
            document.querySelectorAll('.chart-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            console.log('Switched to chart type:', type);
        }

        function refreshPerformanceMetrics() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="icon">⏳</span> Refreshing...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                updatePerformanceData();
            }, 1000);
        }

        function toggleRealTimeMonitoring() {
            realTimeMonitoring = !realTimeMonitoring;
            const statusElement = document.getElementById('realtime-status');
            if (statusElement) {
                statusElement.textContent = realTimeMonitoring ? 'Real-time' : 'Paused';
            }
        }

        function exportPerformanceReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                performance: {
                    cpu: document.getElementById('cpu-percentage').textContent,
                    memory: document.getElementById('memory-progress').style.width,
                    eventLoop: document.getElementById('event-loop-lag').textContent,
                    uptime: document.getElementById('uptime').textContent
                }
            };
            
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Performance Monitor Panel Test initialized');
            initializePerformanceChart();
            
            // Start real-time updates
            setInterval(updatePerformanceData, 2000);
        });
    </script>
</body>
</html>