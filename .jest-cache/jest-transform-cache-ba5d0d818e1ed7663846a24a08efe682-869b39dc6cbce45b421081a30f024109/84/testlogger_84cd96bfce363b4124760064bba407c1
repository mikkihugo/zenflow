01cabee730c7988e54129fd71548a6ff
/**
 * Test Logger - Specialized logging for test environments
 *
 * Provides structured logging for both London and Classical TDD approaches
 */
export class TestLogger {
    logs = [];
    testName;
    silent = false;
    constructor(testName, silent = false) {
        this.testName = testName;
        this.silent = silent;
    }
    /**
     * Log a debug message
     */
    debug(message, context) {
        this.log('debug', message, context);
    }
    /**
     * Log an info message
     */
    info(message, context) {
        this.log('info', message, context);
    }
    /**
     * Log a warning message
     */
    warn(message, context) {
        this.log('warn', message, context);
    }
    /**
     * Log an error message
     */
    error(message, context) {
        this.log('error', message, context);
    }
    /**
     * Log test interactions (London School)
     */
    logInteraction(component, method, args, result) {
        this.log('debug', `Interaction: ${component}.${method}`, {
            component,
            method,
            args,
            result,
            category: 'interaction'
        });
    }
    /**
     * Log state changes (Classical School)
     */
    logStateChange(component, before, after, operation) {
        this.log('debug', `State change in ${component}`, {
            component,
            before,
            after,
            operation,
            category: 'state-change'
        });
    }
    /**
     * Log performance metrics
     */
    logPerformance(operation, duration, context) {
        this.log('info', `Performance: ${operation} took ${duration}ms`, {
            operation,
            duration,
            category: 'performance',
            ...context
        });
    }
    /**
     * Log assertion results
     */
    logAssertion(description, passed, expected, actual) {
        const level = passed ? 'info' : 'error';
        this.log(level, `Assertion: ${description} - ${passed ? 'PASSED' : 'FAILED'}`, {
            description,
            passed,
            expected,
            actual,
            category: 'assertion'
        });
    }
    /**
     * Get all logs
     */
    getLogs() {
        return [...this.logs];
    }
    /**
     * Get logs by level
     */
    getLogsByLevel(level) {
        return this.logs.filter(log => log.level === level);
    }
    /**
     * Get logs by category
     */
    getLogsByCategory(category) {
        return this.logs.filter(log => log.context?.category === category);
    }
    /**
     * Clear all logs
     */
    clearLogs() {
        this.logs = [];
    }
    /**
     * Export logs as string
     */
    exportLogs(format = 'text') {
        if (format === 'json') {
            return JSON.stringify(this.logs, null, 2);
        }
        return this.logs.map(log => {
            const timestamp = new Date(log.timestamp).toISOString();
            const context = log.context ? ` | ${JSON.stringify(log.context)}` : '';
            return `[${timestamp}] ${log.level.toUpperCase()}: ${log.message}${context}`;
        }).join('\n');
    }
    /**
     * Create a child logger for a specific component/test
     */
    createChild(name) {
        const child = new TestLogger(`${this.testName ? `${this.testName}.` : ''}${name}`, this.silent);
        // Share the log storage
        child.logs = this.logs;
        return child;
    }
    log(level, message, context) {
        const entry = {
            level,
            message,
            timestamp: Date.now(),
            context,
            testName: this.testName
        };
        this.logs.push(entry);
        if (!this.silent && process.env.NODE_ENV === 'test') {
            const prefix = this.testName ? `[${this.testName}] ` : '';
            console.log(`${prefix}${level.toUpperCase()}: ${message}`, context || '');
        }
    }
}
// Global test logger instance
export const testLogger = new TestLogger();
// Factory function for creating test-specific loggers
export function createTestLogger(testName, silent) {
    return new TestLogger(testName, silent);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaGVscGVycy90ZXN0LWxvZ2dlci50cyIsIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBV0gsTUFBTSxPQUFPLFVBQVU7SUFDYixJQUFJLEdBQWUsRUFBRSxDQUFDO0lBQ3RCLFFBQVEsQ0FBVTtJQUNsQixNQUFNLEdBQVksS0FBSyxDQUFDO0lBRWhDLFlBQVksUUFBaUIsRUFBRSxTQUFrQixLQUFLO1FBQ3BELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFlLEVBQUUsT0FBNkI7UUFDbEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxPQUFlLEVBQUUsT0FBNkI7UUFDakQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxPQUFlLEVBQUUsT0FBNkI7UUFDakQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFlLEVBQUUsT0FBNkI7UUFDbEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRDs7T0FFRztJQUNILGNBQWMsQ0FBQyxTQUFpQixFQUFFLE1BQWMsRUFBRSxJQUFZLEVBQUUsTUFBWTtRQUMxRSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsU0FBUyxJQUFJLE1BQU0sRUFBRSxFQUFFO1lBQ3ZE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QUFDO0FBRTNDLHNEQUFzRDtBQUN0RCxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsUUFBZ0IsRUFBRSxNQUFnQjtJQUNqRSxPQUFPLElBQUksVUFBVSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUMxQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL21odWdvL2NvZGUvY2xhdWRlLWNvZGUtZmxvdy9zcmMvX190ZXN0c19fL2hlbHBlcnMvdGVzdC1sb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0IExvZ2dlciAtIFNwZWNpYWxpemVkIGxvZ2dpbmcgZm9yIHRlc3QgZW52aXJvbm1lbnRzXG4gKiBcbiAqIFByb3ZpZGVzIHN0cnVjdHVyZWQgbG9nZ2luZyBmb3IgYm90aCBMb25kb24gYW5kIENsYXNzaWNhbCBUREQgYXBwcm9hY2hlc1xuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nRW50cnkge1xuICBsZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICB0ZXN0TmFtZT86IHN0cmluZztcbiAgY2F0ZWdvcnk/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBUZXN0TG9nZ2VyIHtcbiAgcHJpdmF0ZSBsb2dzOiBMb2dFbnRyeVtdID0gW107XG4gIHByaXZhdGUgdGVzdE5hbWU/OiBzdHJpbmc7XG4gIHByaXZhdGUgc2lsZW50OiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IodGVzdE5hbWU/OiBzdHJpbmcsIHNpbGVudDogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgdGhpcy50ZXN0TmFtZSA9IHRlc3ROYW1lO1xuICAgIHRoaXMuc2lsZW50ID0gc2lsZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBhIGRlYnVnIG1lc3NhZ2VcbiAgICovXG4gIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcbiAgICB0aGlzLmxvZygnZGVidWcnLCBtZXNzYWdlLCBjb250ZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgYW4gaW5mbyBtZXNzYWdlXG4gICAqL1xuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcbiAgICB0aGlzLmxvZygnaW5mbycsIG1lc3NhZ2UsIGNvbnRleHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBhIHdhcm5pbmcgbWVzc2FnZVxuICAgKi9cbiAgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogdm9pZCB7XG4gICAgdGhpcy5sb2coJ3dhcm4nLCBtZXNzYWdlLCBjb250ZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgYW4gZXJyb3IgbWVzc2FnZVxuICAgKi9cbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xuICAgIHRoaXMubG9nKCdlcnJvcicsIG1lc3NhZ2UsIGNvbnRleHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyB0ZXN0IGludGVyYWN0aW9ucyAoTG9uZG9uIFNjaG9vbClcbiAgICovXG4gIGxvZ0ludGVyYWN0aW9uKGNvbXBvbmVudDogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgYXJncz86IGFueVtdLCByZXN1bHQ/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZygnZGVidWcnLCBgSW50ZXJhY3Rpb246ICR7Y29tcG9uZW50fS4ke21ldGhvZH1gLCB7XG4gICAgICBjb21wb25lbnQsXG4gICAgICBtZXRob2QsXG4gICAgICBhcmdzLFxuICAgICAgcmVzdWx0LFxuICAgICAgY2F0ZWdvcnk6ICdpbnRlcmFjdGlvbidcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgc3RhdGUgY2hhbmdlcyAoQ2xhc3NpY2FsIFNjaG9vbClcbiAgICovXG4gIGxvZ1N0YXRlQ2hhbmdlKGNvbXBvbmVudDogc3RyaW5nLCBiZWZvcmU6IGFueSwgYWZ0ZXI6IGFueSwgb3BlcmF0aW9uPzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5sb2coJ2RlYnVnJywgYFN0YXRlIGNoYW5nZSBpbiAke2NvbXBvbmVudH1gLCB7XG4gICAgICBjb21wb25lbnQsXG4gICAgICBiZWZvcmUsXG4gICAgICBhZnRlcixcbiAgICAgIG9wZXJhdGlvbixcbiAgICAgIGNhdGVnb3J5OiAnc3RhdGUtY2hhbmdlJ1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBsb2dQZXJmb3JtYW5jZShvcGVyYXRpb246IHN0cmluZywgZHVyYXRpb246IG51bWJlciwgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcbiAgICB0aGlzLmxvZygnaW5mbycsIGBQZXJmb3JtYW5jZTogJHtvcGVyYXRpb259IHRvb2sgJHtkdXJhdGlvbn1tc2AsIHtcbiAgICAgIG9wZXJhdGlvbixcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgY2F0ZWdvcnk6ICdwZXJmb3JtYW5jZScsXG4gICAgICAuLi5jb250ZXh0XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTG9nIGFzc2VydGlvbiByZXN1bHRzXG4gICAqL1xuICBsb2dBc3NlcnRpb24oZGVzY3JpcHRpb246IHN0cmluZywgcGFzc2VkOiBib29sZWFuLCBleHBlY3RlZD86IGFueSwgYWN0dWFsPzogYW55KTogdm9pZCB7XG4gICAgY29uc3QgbGV2ZWwgPSBwYXNzZWQgPyAnaW5mbycgOiAnZXJyb3InO1xuICAgIHRoaXMubG9nKGxldmVsLCBgQXNzZXJ0aW9uOiAke2Rlc2NyaXB0aW9ufSAtICR7cGFzc2VkID8gJ1BBU1NFRCcgOiAnRkFJTEVEJ31gLCB7XG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHBhc3NlZCxcbiAgICAgIGV4cGVjdGVkLFxuICAgICAgYWN0dWFsLFxuICAgICAgY2F0ZWdvcnk6ICdhc3NlcnRpb24nXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBsb2dzXG4gICAqL1xuICBnZXRMb2dzKCk6IExvZ0VudHJ5W10ge1xuICAgIHJldHVybiBbLi4udGhpcy5sb2dzXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbG9ncyBieSBsZXZlbFxuICAgKi9cbiAgZ2V0TG9nc0J5TGV2ZWwobGV2ZWw6IExvZ0VudHJ5WydsZXZlbCddKTogTG9nRW50cnlbXSB7XG4gICAgcmV0dXJuIHRoaXMubG9ncy5maWx0ZXIobG9nID0+IGxvZy5sZXZlbCA9PT0gbGV2ZWwpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBsb2dzIGJ5IGNhdGVnb3J5XG4gICAqL1xuICBnZXRMb2dzQnlDYXRlZ29yeShjYXRlZ29yeTogc3RyaW5nKTogTG9nRW50cnlbXSB7XG4gICAgcmV0dXJuIHRoaXMubG9ncy5maWx0ZXIobG9nID0+IGxvZy5jb250ZXh0Py5jYXRlZ29yeSA9PT0gY2F0ZWdvcnkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBsb2dzXG4gICAqL1xuICBjbGVhckxvZ3MoKTogdm9pZCB7XG4gICAgdGhpcy5sb2dzID0gW107XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGxvZ3MgYXMgc3RyaW5nXG4gICAqL1xuICBleHBvcnRMb2dzKGZvcm1hdDogJ3RleHQnIHwgJ2pzb24nID0gJ3RleHQnKTogc3RyaW5nIHtcbiAgICBpZiAoZm9ybWF0ID09PSAnanNvbicpIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLmxvZ3MsIG51bGwsIDIpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmxvZ3MubWFwKGxvZyA9PiB7XG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZShsb2cudGltZXN0YW1wKS50b0lTT1N0cmluZygpO1xuICAgICAgY29uc3QgY29udGV4dCA9IGxvZy5jb250ZXh0ID8gYCB8ICR7SlNPTi5zdHJpbmdpZnkobG9nLmNvbnRleHQpfWAgOiAnJztcbiAgICAgIHJldHVybiBgWyR7dGltZXN0YW1wfV0gJHtsb2cubGV2ZWwudG9VcHBlckNhc2UoKX06ICR7bG9nLm1lc3NhZ2V9JHtjb250ZXh0fWA7XG4gICAgfSkuam9pbignXFxuJyk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY2hpbGQgbG9nZ2VyIGZvciBhIHNwZWNpZmljIGNvbXBvbmVudC90ZXN0XG4gICAqL1xuICBjcmVhdGVDaGlsZChuYW1lOiBzdHJpbmcpOiBUZXN0TG9nZ2VyIHtcbiAgICBjb25zdCBjaGlsZCA9IG5ldyBUZXN0TG9nZ2VyKGAke3RoaXMudGVzdE5hbWUgPyBgJHt0aGlzLnRlc3ROYW1lfS5gIDogJyd9JHtuYW1lfWAsIHRoaXMuc2lsZW50KTtcbiAgICAvLyBTaGFyZSB0aGUgbG9nIHN0b3JhZ2VcbiAgICBjaGlsZC5sb2dzID0gdGhpcy5sb2dzO1xuICAgIHJldHVybiBjaGlsZDtcbiAgfVxuXG4gIHByaXZhdGUgbG9nKGxldmVsOiBMb2dFbnRyeVsnbGV2ZWwnXSwgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xuICAgIGNvbnN0IGVudHJ5OiBMb2dFbnRyeSA9IHtcbiAgICAgIGxldmVsLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGNvbnRleHQsXG4gICAgICB0ZXN0TmFtZTogdGhpcy50ZXN0TmFtZVxuICAgIH07XG5cbiAgICB0aGlzLmxvZ3MucHVzaChlbnRyeSk7XG5cbiAgICBpZiAoIXRoaXMuc2lsZW50ICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcpIHtcbiAgICAgIGNvbnN0IHByZWZpeCA9IHRoaXMudGVzdE5hbWUgPyBgWyR7dGhpcy50ZXN0TmFtZX1dIGAgOiAnJztcbiAgICAgIGNvbnNvbGUubG9nKGAke3ByZWZpeH0ke2xldmVsLnRvVXBwZXJDYXNlKCl9OiAke21lc3NhZ2V9YCwgY29udGV4dCB8fCAnJyk7XG4gICAgfVxuICB9XG59XG5cbi8vIEdsb2JhbCB0ZXN0IGxvZ2dlciBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHRlc3RMb2dnZXIgPSBuZXcgVGVzdExvZ2dlcigpO1xuXG4vLyBGYWN0b3J5IGZ1bmN0aW9uIGZvciBjcmVhdGluZyB0ZXN0LXNwZWNpZmljIGxvZ2dlcnNcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUZXN0TG9nZ2VyKHRlc3ROYW1lOiBzdHJpbmcsIHNpbGVudD86IGJvb2xlYW4pOiBUZXN0TG9nZ2VyIHtcbiAgcmV0dXJuIG5ldyBUZXN0TG9nZ2VyKHRlc3ROYW1lLCBzaWxlbnQpO1xufSJdLCJ2ZXJzaW9uIjozfQ==