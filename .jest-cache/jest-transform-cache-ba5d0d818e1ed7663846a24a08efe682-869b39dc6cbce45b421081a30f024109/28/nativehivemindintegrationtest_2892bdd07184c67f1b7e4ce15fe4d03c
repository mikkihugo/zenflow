1fd0ab5e4d337a20ca42e6a0c1e10be6
/**
 * Native Hive Mind Integration Tests
 *
 * Comprehensive testing of the MaestroSwarmCoordinator and specs-driven
 * swarm topology to ensure proper integration with native hive mind.
 */
import { describe, beforeAll, afterAll, beforeEach, afterEach, it, expect, jest } from '@jest/globals';
import { EventBus } from '../../core/event-bus.js';
import { Logger } from '../../core/logger.js';
import { MaestroSwarmCoordinator } from '../maestro-swarm-coordinator.js';
import { join } from 'path';
import { tmpdir } from 'os';
import { mkdtemp, rm, access } from 'fs/promises';
describe('Native Hive Mind Integration Tests', () => {
    let swarmCoordinator;
    let eventBus;
    let logger;
    let tempDir;
    let config;
    beforeAll(async () => {
        // Setup test environment
        tempDir = await mkdtemp(join(tmpdir(), 'maestro-test-'));
        // Initialize core components
        eventBus = new EventBus();
        logger = new Logger({ level: 'debug' });
        // Configure test swarm
        config = {
            hiveMindConfig: {
                name: 'test-maestro-specs-swarm',
                topology: 'specs-driven',
                queenMode: 'strategic',
                maxAgents: 8,
                consensusThreshold: 0.66,
                memoryTTL: 60000, // 1 minute for testing
                autoSpawn: true,
                enableConsensus: true,
                enableMemory: true,
                enableCommunication: true
            },
            enableConsensusValidation: true,
            enableLivingDocumentation: true,
            enableSteeringIntegration: true,
            specsDirectory: join(tempDir, 'specs'),
            steeringDirectory: join(tempDir, 'steering')
        };
    });
    afterAll(async () => {
        // Cleanup
        if (swarmCoordinator) {
            await swarmCoordinator.shutdown();
        }
        await rm(tempDir, { recursive: true, force: true });
    });
    beforeEach(async () => {
        // Create fresh coordinator for each test
        swarmCoordinator = new MaestroSwarmCoordinator(config, eventBus, logger);
    });
    afterEach(async () => {
        if (swarmCoordinator) {
            await swarmCoordinator.shutdown();
        }
    });
    describe('Swarm Initialization', () => {
        it('should initialize native hive mind with specs-driven topology', async () => {
            const swarmId = await swarmCoordinator.initialize();
            expect(swarmId).toBeDefined();
            expect(typeof swarmId).toBe('string');
            expect(swarmId).toMatch(/^swarm_/);
        });
        it('should spawn 8 specialized agents with correct types', async () => {
            await swarmCoordinator.initialize();
            // Verify swarm status contains all expected agent types
            const hiveMind = swarmCoordinator.hiveMind;
            const agents = hiveMind.agents;
            expect(agents.size).toBe(8);
            // Check for specs-driven agent types
            const agentTypes = Array.from(agents.values()).map((agent) => agent.type);
            expect(agentTypes).toContain('requirements_analyst');
            expect(agentTypes).toContain('design_architect');
            expect(agentTypes).toContain('task_planner');
            expect(agentTypes).toContain('implementation_coder');
            expect(agentTypes).toContain('quality_reviewer');
            expect(agentTypes).toContain('steering_documenter');
            // Check agent counts
            expect(agentTypes.filter(t => t === 'requirements_analyst')).toHaveLength(1);
            expect(agentTypes.filter(t => t === 'design_architect')).toHaveLength(2);
            expect(agentTypes.filter(t => t === 'task_planner')).toHaveLength(1);
            expect(agentTypes.filter(t => t === 'implementation_coder')).toHaveLength(2);
            expect(agentTypes.filter(t => t === 'quality_reviewer')).toHaveLength(1);
            expect(agentTypes.filter(t => t === 'steering_documenter')).toHaveLength(1);
        });
        it('should initialize steering documents in swarm memory', async () => {
            await swarmCoordinator.initialize();
            const hiveMind = swarmCoordinator.hiveMind;
            // Check that default steering documents are initialized
            const productSteering = await hiveMind.memory.retrieve('steering/product');
            const techSteering = await hiveMind.memory.retrieve('steering/tech');
            const workflowSteering = await hiveMind.memory.retrieve('steering/workflow');
            expect(productSteering).toBeDefined();
            expect(productSteering.domain).toBe('product');
            expect(techSteering).toBeDefined();
            expect(techSteering.domain).toBe('tech');
            expect(workflowSteering).toBeDefined();
            expect(workflowSteering.domain).toBe('workflow');
        });
    });
    describe('Specs-Driven Workflow', () => {
        beforeEach(async () => {
            await swarmCoordinator.initialize();
        });
        it('should create specification using requirements_analyst agent', async () => {
            const featureName = 'test-auth-feature';
            const initialRequest = 'Create user authentication system with JWT tokens';
            await swarmCoordinator.createSpec(featureName, initialRequest);
            // Verify workflow state
            const workflowState = swarmCoordinator.getWorkflowState(featureName);
            expect(workflowState).toBeDefined();
            expect(workflowState.featureName).toBe(featureName);
            expect(workflowState.currentPhase).toBe('Requirements Clarification');
            expect(workflowState.status).toBe('running');
            // Verify requirements file was created
            const requirementsPath = join(config.specsDirectory, featureName, 'requirements.md');
            await expect(access(requirementsPath)).resolves.not.toThrow();
        }, 30000);
        it('should generate design using parallel design_architect agents with consensus', async () => {
            const featureName = 'test-design-feature';
            // First create spec
            await swarmCoordinator.createSpec(featureName, 'Test feature for design generation');
            // Then generate design
            await swarmCoordinator.generateDesign(featureName);
            // Verify workflow progression
            const workflowState = swarmCoordinator.getWorkflowState(featureName);
            expect(workflowState.currentPhase).toBe('Research & Design');
            expect(workflowState.history).toHaveLength(2);
            expect(workflowState.history[1].phase).toBe('Research & Design');
            expect(workflowState.history[1].status).toBe('completed');
            // Verify design file was created
            const designPath = join(config.specsDirectory, featureName, 'design.md');
            await expect(access(designPath)).resolves.not.toThrow();
        }, 60000);
        it('should generate tasks using task_planner agent', async () => {
            const featureName = 'test-tasks-feature';
            // Setup: create spec and design
            await swarmCoordinator.createSpec(featureName, 'Test feature for task generation');
            await swarmCoordinator.generateDesign(featureName);
            // Generate tasks
            await swarmCoordinator.generateTasks(featureName);
            // Verify workflow progression
            const workflowState = swarmCoordinator.getWorkflowState(featureName);
            expect(workflowState.currentPhase).toBe('Implementation Planning');
            // Verify tasks file was created
            const tasksPath = join(config.specsDirectory, featureName, 'tasks.md');
            await expect(access(tasksPath)).resolves.not.toThrow();
        }, 90000);
        it('should implement tasks using implementation_coder agents', async () => {
            const featureName = 'test-implementation-feature';
            // Setup complete workflow
            await swarmCoordinator.createSpec(featureName, 'Test feature for implementation');
            await swarmCoordinator.generateDesign(featureName);
            await swarmCoordinator.generateTasks(featureName);
            // Implement first task
            await swarmCoordinator.implementTask(featureName, 1);
            // Verify workflow state
            const workflowState = swarmCoordinator.getWorkflowState(featureName);
            expect(workflowState.currentPhase).toBe('Task Execution');
            expect(workflowState.currentTaskIndex).toBe(1);
        }, 120000);
    });
    describe('Consensus Validation', () => {
        beforeEach(async () => {
            await swarmCoordinator.initialize();
        });
        it('should use consensus for phase approval when enabled', async () => {
            const featureName = 'test-consensus-feature';
            await swarmCoordinator.createSpec(featureName, 'Test consensus validation');
            // Mock consensus engine for testing
            const hiveMind = swarmCoordinator.hiveMind;
            const consensusEngine = hiveMind.consensus;
            jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal-id');
            jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({
                status: 'achieved',
                currentRatio: 0.75
            });
            await swarmCoordinator.approvePhase(featureName);
            expect(consensusEngine.createProposal).toHaveBeenCalled();
            expect(consensusEngine.getProposalStatus).toHaveBeenCalled();
        });
        it('should handle consensus failure gracefully', async () => {
            const featureName = 'test-consensus-failure';
            await swarmCoordinator.createSpec(featureName, 'Test consensus failure handling');
            // Mock consensus failure
            const hiveMind = swarmCoordinator.hiveMind;
            const consensusEngine = hiveMind.consensus;
            jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal-id');
            jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({
                status: 'failed',
                currentRatio: 0.4
            });
            await expect(swarmCoordinator.approvePhase(featureName))
                .rejects.toThrow('Phase approval consensus failed');
        });
    });
    describe('Steering Integration', () => {
        beforeEach(async () => {
            await swarmCoordinator.initialize();
        });
        it('should create steering documents in swarm memory', async () => {
            const domain = 'custom-steering';
            const content = 'Custom steering guidelines for testing';
            await swarmCoordinator.createSteeringDocument(domain, content);
            const hiveMind = swarmCoordinator.hiveMind;
            const storedDoc = await hiveMind.memory.retrieve(`steering/${domain}`);
            expect(storedDoc).toBeDefined();
            expect(storedDoc.content).toBe(content);
            expect(storedDoc.domain).toBe(domain);
            expect(storedDoc.maintainer).toBe('steering_documenter');
        });
        it('should broadcast steering updates to all agents', async () => {
            const domain = 'broadcast-test';
            const content = 'Test broadcast content';
            const hiveMind = swarmCoordinator.hiveMind;
            const broadcastSpy = jest.spyOn(hiveMind.communication, 'broadcast');
            await swarmCoordinator.createSteeringDocument(domain, content);
            expect(broadcastSpy).toHaveBeenCalledWith({
                type: 'steering_update',
                domain,
                content: expect.stringContaining('Test broadcast content')
            });
        });
        it('should retrieve steering context for agents', async () => {
            await swarmCoordinator.createSteeringDocument('test-context', 'Context for testing');
            const steeringContext = await swarmCoordinator.getSteeringContext();
            expect(steeringContext).toContain('test-context');
            expect(steeringContext).toContain('Context for testing');
        });
    });
    describe('Performance and Error Handling', () => {
        beforeEach(async () => {
            await swarmCoordinator.initialize();
        });
        it('should handle agent spawning limits gracefully', async () => {
            // Test with reduced agent limit
            const limitedConfig = {
                ...config,
                hiveMindConfig: {
                    ...config.hiveMindConfig,
                    maxAgents: 4
                }
            };
            const limitedCoordinator = new MaestroSwarmCoordinator(limitedConfig, eventBus, logger);
            await limitedCoordinator.initialize();
            const hiveMind = limitedCoordinator.hiveMind;
            expect(hiveMind.agents.size).toBeLessThanOrEqual(4);
            await limitedCoordinator.shutdown();
        });
        it('should timeout on task completion properly', async () => {
            const featureName = 'timeout-test';
            // Mock task that never completes
            const hiveMind = swarmCoordinator.hiveMind;
            jest.spyOn(hiveMind, 'getTask').mockResolvedValue({
                id: 'test-task',
                status: 'in_progress',
                result: null
            });
            await expect(swarmCoordinator.waitForTaskCompletion('test-task', 1000)).rejects.toThrow('Task timeout');
        });
        it('should handle swarm shutdown gracefully', async () => {
            const hiveMind = swarmCoordinator.hiveMind;
            const shutdownSpy = jest.spyOn(hiveMind, 'shutdown');
            await swarmCoordinator.shutdown();
            expect(shutdownSpy).toHaveBeenCalled();
        });
    });
    describe('Event Integration', () => {
        beforeEach(async () => {
            await swarmCoordinator.initialize();
        });
        it('should emit maestro events through event bus', async () => {
            const specCreatedSpy = jest.fn();
            eventBus.on('maestro:spec_created', specCreatedSpy);
            await swarmCoordinator.createSpec('event-test', 'Test event emission');
            expect(specCreatedSpy).toHaveBeenCalledWith({
                featureName: 'event-test'
            });
        });
        it('should handle event-driven workflow progression', async () => {
            const phaseApprovedSpy = jest.fn();
            eventBus.on('maestro:phase_approved', phaseApprovedSpy);
            const featureName = 'workflow-events';
            await swarmCoordinator.createSpec(featureName, 'Test workflow events');
            // Mock consensus for approval
            const hiveMind = swarmCoordinator.hiveMind;
            const consensusEngine = hiveMind.consensus;
            jest.spyOn(consensusEngine, 'createProposal').mockResolvedValue('test-proposal');
            jest.spyOn(consensusEngine, 'getProposalStatus').mockResolvedValue({
                status: 'achieved',
                currentRatio: 0.8
            });
            await swarmCoordinator.approvePhase(featureName);
            expect(phaseApprovedSpy).toHaveBeenCalledWith({
                featureName,
                nextPhase: 'Research & Design'
            });
        });
    });
});
/**
 * Performance Benchmarks
 *
 * These tests measure performance improvements from native hive mind integration
 */
describe('Performance Benchmarks', () => {
    let coordinator;
    let eventBus;
    let logger;
    let tempDir;
    beforeAll(async () => {
        tempDir = await mkdtemp(join(tmpdir(), 'maestro-perf-'));
        eventBus = new EventBus();
        logger = new Logger({ level: 'warn' }); // Reduce logging for performance tests
        const config = {
            hiveMindConfig: {
                name: 'perf-test-swarm',
                topology: 'specs-driven',
                queenMode: 'strategic',
                maxAgents: 8,
                consensusThreshold: 0.66,
                memoryTTL: 300000,
                autoSpawn: true,
                enableConsensus: false, // Disable for pure performance testing
                enableMemory: true,
                enableCommunication: true
            },
            enableConsensusValidation: false,
            enableLivingDocumentation: true,
            enableSteeringIntegration: true,
            specsDirectory: join(tempDir, 'specs'),
            steeringDirectory: join(tempDir, 'steering')
        };
        coordinator = new MaestroSwarmCoordinator(config, eventBus, logger);
        await coordinator.initialize();
    });
    afterAll(async () => {
        await coordinator.shutdown();
        await rm(tempDir, { recursive: true, force: true });
    });
    it('should initialize swarm within performance target (< 5 seconds)', async () => {
        const startTime = Date.now();
        const testCoordinator = new MaestroSwarmCoordinator(coordinator.config, eventBus, logger);
        await testCoordinator.initialize();
        const duration = Date.now() - startTime;
        expect(duration).toBeLessThan(5000);
        await testCoordinator.shutdown();
    });
    it('should create specs within performance target (< 2 minutes)', async () => {
        const startTime = Date.now();
        await coordinator.createSpec('perf-test-spec', 'Performance test specification');
        const duration = Date.now() - startTime;
        expect(duration).toBeLessThan(120000); // 2 minutes
    });
    it('should handle multiple concurrent spec creations efficiently', async () => {
        const startTime = Date.now();
        const concurrentSpecs = 3;
        const promises = Array.from({ length: concurrentSpecs }, (_, i) => coordinator.createSpec(`concurrent-spec-${i}`, `Concurrent test spec ${i}`));
        await Promise.all(promises);
        const duration = Date.now() - startTime;
        const avgTimePerSpec = duration / concurrentSpecs;
        // Should be more efficient than sequential execution
        expect(avgTimePerSpec).toBeLessThan(90000); // < 1.5 minutes per spec on average
    }, 300000);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9tYWVzdHJvL3Rlc3RzL25hdGl2ZS1oaXZlLW1pbmQtaW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUVILE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZHLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUMsT0FBTyxFQUFFLHVCQUF1QixFQUFzQixNQUFNLGlDQUFpQyxDQUFDO0FBRTlGLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLElBQUksQ0FBQztBQUM1QixPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFbEQsUUFBUSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtJQUNsRCxJQUFJLGdCQUF5QyxDQUFDO0lBQzlDLElBQUksUUFBa0IsQ0FBQztJQUN2QixJQUFJLE1BQWMsQ0FBQztJQUNuQixJQUFJLE9BQWUsQ0FBQztJQUNwQixJQUFJLE1BQTBCLENBQUM7SUFFL0IsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLHlCQUF5QjtRQUN6QixPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFFekQsNkJBQTZCO1FBQzdCLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQzFCLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBRXhDLHVC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VUFBVSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsRUFBRSx3QkFBd0IsQ0FBQyxFQUFFLENBQUMsQ0FDNUUsQ0FBQztRQUVGLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU1QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDO1FBQ3hDLE1BQU0sY0FBYyxHQUFHLFFBQVEsR0FBRyxlQUFlLENBQUM7UUFFbEQscURBQXFEO1FBQ3JELE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxvQ0FBb0M7SUFDbEYsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ2IsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9tYWVzdHJvL3Rlc3RzL25hdGl2ZS1oaXZlLW1pbmQtaW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE5hdGl2ZSBIaXZlIE1pbmQgSW50ZWdyYXRpb24gVGVzdHNcbiAqIFxuICogQ29tcHJlaGVuc2l2ZSB0ZXN0aW5nIG9mIHRoZSBNYWVzdHJvU3dhcm1Db29yZGluYXRvciBhbmQgc3BlY3MtZHJpdmVuXG4gKiBzd2FybSB0b3BvbG9neSB0byBlbnN1cmUgcHJvcGVyIGludGVncmF0aW9uIHdpdGggbmF0aXZlIGhpdmUgbWluZC5cbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgYmVmb3JlQWxsLCBhZnRlckFsbCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoLCBpdCwgZXhwZWN0LCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtYnVzLmpzJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uLy4uL2NvcmUvbG9nZ2VyLmpzJztcbmltcG9ydCB7IE1hZXN0cm9Td2FybUNvb3JkaW5hdG9yLCBNYWVzdHJvU3dhcm1Db25maWcgfSBmcm9tICcuLi9tYWVzdHJvLXN3YXJtLWNvb3JkaW5hdG9yLmpzJztcbmltcG9ydCB7IEhpdmVNaW5kQ29uZmlnIH0gZnJvbSAnLi4vLi4vaGl2ZS1taW5kL3R5cGVzLmpzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHRtcGRpciB9IGZyb20gJ29zJztcbmltcG9ydCB7IG1rZHRlbXAsIHJtLCBhY2Nlc3MgfSBmcm9tICdmcy9wcm9taXNlcyc7XG5cbmRlc2NyaWJlKCdOYXRpdmUgSGl2ZSBNaW5kIEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgc3dhcm1Db29yZGluYXRvcjogTWFlc3Ryb1N3YXJtQ29vcmRpbmF0b3I7XG4gIGxldCBldmVudEJ1czogRXZlbnRCdXM7XG4gIGxldCBsb2dnZXI6IExvZ2dlcjtcbiAgbGV0IHRlbXBEaXI6IHN0cmluZztcbiAgbGV0IGNvbmZpZzogTWFlc3Ryb1N3YXJtQ29uZmlnO1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gU2V0dXAgdGVzdCBlbnZpcm9ubWVudFxuICAgIHRlbXBEaXIgPSBhd2FpdCBta2R0ZW1wKGpvaW4odG1wZGlyKCksICdtYWVzdHJvLXRlc3QtJykpO1xuICAgIFxuICAgIC8vIEluaXRpYWxpemUgY29yZSBjb21wb25lbnRzXG4gICAgZXZlbnRCdXMgPSBuZXcgRXZlbnRCdXMoKTtcbiAgICBsb2dnZXIgPSBuZXcgTG9nZ2VyKHsgbGV2ZWw6ICdkZWJ1ZycgfSk7XG4gICAgXG4gICAgLy8gQ29uZmlndXJlIHRlc3Qgc3dhcm1cbiAgICBjb25maWcgPSB7XG4gICAgICBoaXZlTWluZENvbmZpZzoge1xuICAgICAgICBuYW1lOiAndGVzdC1tYWVzdHJvLXNwZWNzLXN3YXJtJyxcbiAgICAgICAgdG9wb2xvZ3k6ICdzcGVjcy1kcml2ZW4nLFxuICAgICAgICBxdWVlbk1vZGU6ICdzdHJhdGVnaWMnLFxuICAgICAgICBtYXhBZ2VudHM6IDgsXG4gICAgICAgIGNvbnNlbnN1c1RocmVzaG9sZDogMC42NixcbiAgICAgICAgbWVtb3J5VFRMOiA2MDAwMCwgLy8gMSBtaW51dGUgZm9yIHRlc3RpbmdcbiAgICAgICAgYXV0b1NwYXduOiB0cnVlLFxuICAgICAgICBlbmFibGVDb25zZW5zdXM6IHRydWUsXG4gICAgICAgIGVuYWJsZU1lbW9yeTogdHJ1ZSxcbiAgICAgICAgZW5hYmxlQ29tbXVuaWNhdGlvbjogdHJ1ZVxuICAgICAgfSxcbiAgICAgIGVuYWJsZUNvbnNlbnN1c1ZhbGlkYXRpb246IHRydWUsXG4gICAgICBlbmFibGVMaXZpbmdEb2N1bWVudGF0aW9uOiB0cnVlLFxuICAgICAgZW5hYmxlU3RlZXJpbmdJbnRlZ3JhdGlvbjogdHJ1ZSxcbiAgICAgIHNwZWNzRGlyZWN0b3J5OiBqb2luKHRlbXBEaXIsICdzcGVjcycpLFxuICAgICAgc3RlZXJpbmdEaXJlY3Rvcnk6IGpvaW4odGVtcERpciwgJ3N0ZWVyaW5nJylcbiAgICB9O1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW51cFxuICAgIGlmIChzd2FybUNvb3JkaW5hdG9yKSB7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLnNodXRkb3duKCk7XG4gICAgfVxuICAgIGF3YWl0IHJtKHRlbXBEaXIsIHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9KTtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIGZyZXNoIGNvb3JkaW5hdG9yIGZvciBlYWNoIHRlc3RcbiAgICBzd2FybUNvb3JkaW5hdG9yID0gbmV3IE1hZXN0cm9Td2FybUNvb3JkaW5hdG9yKGNvbmZpZywgZXZlbnRCdXMsIGxvZ2dlcik7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgaWYgKHN3YXJtQ29vcmRpbmF0b3IpIHtcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3Iuc2h1dGRvd24oKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTd2FybSBJbml0aWFsaXphdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgbmF0aXZlIGhpdmUgbWluZCB3aXRoIHNwZWNzLWRyaXZlbiB0b3BvbG9neScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN3YXJtSWQgPSBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN3YXJtSWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHN3YXJtSWQpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgZXhwZWN0KHN3YXJtSWQpLnRvTWF0Y2goL15zd2FybV8vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3Bhd24gOCBzcGVjaWFsaXplZCBhZ2VudHMgd2l0aCBjb3JyZWN0IHR5cGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSBzd2FybSBzdGF0dXMgY29udGFpbnMgYWxsIGV4cGVjdGVkIGFnZW50IHR5cGVzXG4gICAgICBjb25zdCBoaXZlTWluZCA9IChzd2FybUNvb3JkaW5hdG9yIGFzIGFueSkuaGl2ZU1pbmQ7XG4gICAgICBjb25zdCBhZ2VudHMgPSBoaXZlTWluZC5hZ2VudHM7XG4gICAgICBcbiAgICAgIGV4cGVjdChhZ2VudHMuc2l6ZSkudG9CZSg4KTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNzLWRyaXZlbiBhZ2VudCB0eXBlc1xuICAgICAgY29uc3QgYWdlbnRUeXBlcyA9IEFycmF5LmZyb20oYWdlbnRzLnZhbHVlcygpKS5tYXAoKGFnZW50OiBhbnkpID0+IGFnZW50LnR5cGUpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMpLnRvQ29udGFpbigncmVxdWlyZW1lbnRzX2FuYWx5c3QnKTtcbiAgICAgIGV4cGVjdChhZ2VudFR5cGVzKS50b0NvbnRhaW4oJ2Rlc2lnbl9hcmNoaXRlY3QnKTtcbiAgICAgIGV4cGVjdChhZ2VudFR5cGVzKS50b0NvbnRhaW4oJ3Rhc2tfcGxhbm5lcicpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMpLnRvQ29udGFpbignaW1wbGVtZW50YXRpb25fY29kZXInKTtcbiAgICAgIGV4cGVjdChhZ2VudFR5cGVzKS50b0NvbnRhaW4oJ3F1YWxpdHlfcmV2aWV3ZXInKTtcbiAgICAgIGV4cGVjdChhZ2VudFR5cGVzKS50b0NvbnRhaW4oJ3N0ZWVyaW5nX2RvY3VtZW50ZXInKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgYWdlbnQgY291bnRzXG4gICAgICBleHBlY3QoYWdlbnRUeXBlcy5maWx0ZXIodCA9PiB0ID09PSAncmVxdWlyZW1lbnRzX2FuYWx5c3QnKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMuZmlsdGVyKHQgPT4gdCA9PT0gJ2Rlc2lnbl9hcmNoaXRlY3QnKSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMuZmlsdGVyKHQgPT4gdCA9PT0gJ3Rhc2tfcGxhbm5lcicpKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoYWdlbnRUeXBlcy5maWx0ZXIodCA9PiB0ID09PSAnaW1wbGVtZW50YXRpb25fY29kZXInKSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMuZmlsdGVyKHQgPT4gdCA9PT0gJ3F1YWxpdHlfcmV2aWV3ZXInKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KGFnZW50VHlwZXMuZmlsdGVyKHQgPT4gdCA9PT0gJ3N0ZWVyaW5nX2RvY3VtZW50ZXInKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHN0ZWVyaW5nIGRvY3VtZW50cyBpbiBzd2FybSBtZW1vcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGl2ZU1pbmQgPSAoc3dhcm1Db29yZGluYXRvciBhcyBhbnkpLmhpdmVNaW5kO1xuICAgICAgXG4gICAgICAvLyBDaGVjayB0aGF0IGRlZmF1bHQgc3RlZXJpbmcgZG9jdW1lbnRzIGFyZSBpbml0aWFsaXplZFxuICAgICAgY29uc3QgcHJvZHVjdFN0ZWVyaW5nID0gYXdhaXQgaGl2ZU1pbmQubWVtb3J5LnJldHJpZXZlKCdzdGVlcmluZy9wcm9kdWN0Jyk7XG4gICAgICBjb25zdCB0ZWNoU3RlZXJpbmcgPSBhd2FpdCBoaXZlTWluZC5tZW1vcnkucmV0cmlldmUoJ3N0ZWVyaW5nL3RlY2gnKTtcbiAgICAgIGNvbnN0IHdvcmtmbG93U3RlZXJpbmcgPSBhd2FpdCBoaXZlTWluZC5tZW1vcnkucmV0cmlldmUoJ3N0ZWVyaW5nL3dvcmtmbG93Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwcm9kdWN0U3RlZXJpbmcpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocHJvZHVjdFN0ZWVyaW5nLmRvbWFpbikudG9CZSgncHJvZHVjdCcpO1xuICAgICAgZXhwZWN0KHRlY2hTdGVlcmluZykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZWNoU3RlZXJpbmcuZG9tYWluKS50b0JlKCd0ZWNoJyk7XG4gICAgICBleHBlY3Qod29ya2Zsb3dTdGVlcmluZykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh3b3JrZmxvd1N0ZWVyaW5nLmRvbWFpbikudG9CZSgnd29ya2Zsb3cnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NwZWNzLURyaXZlbiBXb3JrZmxvdycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3BlY2lmaWNhdGlvbiB1c2luZyByZXF1aXJlbWVudHNfYW5hbHlzdCBhZ2VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZlYXR1cmVOYW1lID0gJ3Rlc3QtYXV0aC1mZWF0dXJlJztcbiAgICAgIGNvbnN0IGluaXRpYWxSZXF1ZXN0ID0gJ0NyZWF0ZSB1c2VyIGF1dGhlbnRpY2F0aW9uIHN5c3RlbSB3aXRoIEpXVCB0b2tlbnMnO1xuICAgICAgXG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmNyZWF0ZVNwZWMoZmVhdHVyZU5hbWUsIGluaXRpYWxSZXF1ZXN0KTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHdvcmtmbG93IHN0YXRlXG4gICAgICBjb25zdCB3b3JrZmxvd1N0YXRlID0gc3dhcm1Db29yZGluYXRvci5nZXRXb3JrZmxvd1N0YXRlKGZlYXR1cmVOYW1lKTtcbiAgICAgIGV4cGVjdCh3b3JrZmxvd1N0YXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHdvcmtmbG93U3RhdGUhLmZlYXR1cmVOYW1lKS50b0JlKGZlYXR1cmVOYW1lKTtcbiAgICAgIGV4cGVjdCh3b3JrZmxvd1N0YXRlIS5jdXJyZW50UGhhc2UpLnRvQmUoJ1JlcXVpcmVtZW50cyBDbGFyaWZpY2F0aW9uJyk7XG4gICAgICBleHBlY3Qod29ya2Zsb3dTdGF0ZSEuc3RhdHVzKS50b0JlKCdydW5uaW5nJyk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSByZXF1aXJlbWVudHMgZmlsZSB3YXMgY3JlYXRlZFxuICAgICAgY29uc3QgcmVxdWlyZW1lbnRzUGF0aCA9IGpvaW4oY29uZmlnLnNwZWNzRGlyZWN0b3J5LCBmZWF0dXJlTmFtZSwgJ3JlcXVpcmVtZW50cy5tZCcpO1xuICAgICAgYXdhaXQgZXhwZWN0KGFjY2VzcyhyZXF1aXJlbWVudHNQYXRoKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9LCAzMDAwMCk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGRlc2lnbiB1c2luZyBwYXJhbGxlbCBkZXNpZ25fYXJjaGl0ZWN0IGFnZW50cyB3aXRoIGNvbnNlbnN1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZlYXR1cmVOYW1lID0gJ3Rlc3QtZGVzaWduLWZlYXR1cmUnO1xuICAgICAgXG4gICAgICAvLyBGaXJzdCBjcmVhdGUgc3BlY1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5jcmVhdGVTcGVjKGZlYXR1cmVOYW1lLCAnVGVzdCBmZWF0dXJlIGZvciBkZXNpZ24gZ2VuZXJhdGlvbicpO1xuICAgICAgXG4gICAgICAvLyBUaGVuIGdlbmVyYXRlIGRlc2lnblxuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5nZW5lcmF0ZURlc2lnbihmZWF0dXJlTmFtZSk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSB3b3JrZmxvdyBwcm9ncmVzc2lvblxuICAgICAgY29uc3Qgd29ya2Zsb3dTdGF0ZSA9IHN3YXJtQ29vcmRpbmF0b3IuZ2V0V29ya2Zsb3dTdGF0ZShmZWF0dXJlTmFtZSk7XG4gICAgICBleHBlY3Qod29ya2Zsb3dTdGF0ZSEuY3VycmVudFBoYXNlKS50b0JlKCdSZXNlYXJjaCAmIERlc2lnbicpO1xuICAgICAgZXhwZWN0KHdvcmtmbG93U3RhdGUhLmhpc3RvcnkpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdCh3b3JrZmxvd1N0YXRlIS5oaXN0b3J5WzFdLnBoYXNlKS50b0JlKCdSZXNlYXJjaCAmIERlc2lnbicpO1xuICAgICAgZXhwZWN0KHdvcmtmbG93U3RhdGUhLmhpc3RvcnlbMV0uc3RhdHVzKS50b0JlKCdjb21wbGV0ZWQnKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGRlc2lnbiBmaWxlIHdhcyBjcmVhdGVkXG4gICAgICBjb25zdCBkZXNpZ25QYXRoID0gam9pbihjb25maWcuc3BlY3NEaXJlY3RvcnksIGZlYXR1cmVOYW1lLCAnZGVzaWduLm1kJyk7XG4gICAgICBhd2FpdCBleHBlY3QoYWNjZXNzKGRlc2lnblBhdGgpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0sIDYwMDAwKTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgdGFza3MgdXNpbmcgdGFza19wbGFubmVyIGFnZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmVhdHVyZU5hbWUgPSAndGVzdC10YXNrcy1mZWF0dXJlJztcbiAgICAgIFxuICAgICAgLy8gU2V0dXA6IGNyZWF0ZSBzcGVjIGFuZCBkZXNpZ25cbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuY3JlYXRlU3BlYyhmZWF0dXJlTmFtZSwgJ1Rlc3QgZmVhdHVyZSBmb3IgdGFzayBnZW5lcmF0aW9uJyk7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmdlbmVyYXRlRGVzaWduKGZlYXR1cmVOYW1lKTtcbiAgICAgIFxuICAgICAgLy8gR2VuZXJhdGUgdGFza3NcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuZ2VuZXJhdGVUYXNrcyhmZWF0dXJlTmFtZSk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSB3b3JrZmxvdyBwcm9ncmVzc2lvblxuICAgICAgY29uc3Qgd29ya2Zsb3dTdGF0ZSA9IHN3YXJtQ29vcmRpbmF0b3IuZ2V0V29ya2Zsb3dTdGF0ZShmZWF0dXJlTmFtZSk7XG4gICAgICBleHBlY3Qod29ya2Zsb3dTdGF0ZSEuY3VycmVudFBoYXNlKS50b0JlKCdJbXBsZW1lbnRhdGlvbiBQbGFubmluZycpO1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgdGFza3MgZmlsZSB3YXMgY3JlYXRlZFxuICAgICAgY29uc3QgdGFza3NQYXRoID0gam9pbihjb25maWcuc3BlY3NEaXJlY3RvcnksIGZlYXR1cmVOYW1lLCAndGFza3MubWQnKTtcbiAgICAgIGF3YWl0IGV4cGVjdChhY2Nlc3ModGFza3NQYXRoKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9LCA5MDAwMCk7XG5cbiAgICBpdCgnc2hvdWxkIGltcGxlbWVudCB0YXNrcyB1c2luZyBpbXBsZW1lbnRhdGlvbl9jb2RlciBhZ2VudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmZWF0dXJlTmFtZSA9ICd0ZXN0LWltcGxlbWVudGF0aW9uLWZlYXR1cmUnO1xuICAgICAgXG4gICAgICAvLyBTZXR1cCBjb21wbGV0ZSB3b3JrZmxvd1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5jcmVhdGVTcGVjKGZlYXR1cmVOYW1lLCAnVGVzdCBmZWF0dXJlIGZvciBpbXBsZW1lbnRhdGlvbicpO1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5nZW5lcmF0ZURlc2lnbihmZWF0dXJlTmFtZSk7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmdlbmVyYXRlVGFza3MoZmVhdHVyZU5hbWUpO1xuICAgICAgXG4gICAgICAvLyBJbXBsZW1lbnQgZmlyc3QgdGFza1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5pbXBsZW1lbnRUYXNrKGZlYXR1cmVOYW1lLCAxKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHdvcmtmbG93IHN0YXRlXG4gICAgICBjb25zdCB3b3JrZmxvd1N0YXRlID0gc3dhcm1Db29yZGluYXRvci5nZXRXb3JrZmxvd1N0YXRlKGZlYXR1cmVOYW1lKTtcbiAgICAgIGV4cGVjdCh3b3JrZmxvd1N0YXRlIS5jdXJyZW50UGhhc2UpLnRvQmUoJ1Rhc2sgRXhlY3V0aW9uJyk7XG4gICAgICBleHBlY3Qod29ya2Zsb3dTdGF0ZSEuY3VycmVudFRhc2tJbmRleCkudG9CZSgxKTtcbiAgICB9LCAxMjAwMDApO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uc2Vuc3VzIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGNvbnNlbnN1cyBmb3IgcGhhc2UgYXBwcm92YWwgd2hlbiBlbmFibGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmVhdHVyZU5hbWUgPSAndGVzdC1jb25zZW5zdXMtZmVhdHVyZSc7XG4gICAgICBcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuY3JlYXRlU3BlYyhmZWF0dXJlTmFtZSwgJ1Rlc3QgY29uc2Vuc3VzIHZhbGlkYXRpb24nKTtcbiAgICAgIFxuICAgICAgLy8gTW9jayBjb25zZW5zdXMgZW5naW5lIGZvciB0ZXN0aW5nXG4gICAgICBjb25zdCBoaXZlTWluZCA9IChzd2FybUNvb3JkaW5hdG9yIGFzIGFueSkuaGl2ZU1pbmQ7XG4gICAgICBjb25zdCBjb25zZW5zdXNFbmdpbmUgPSBoaXZlTWluZC5jb25zZW5zdXM7XG4gICAgICBcbiAgICAgIGplc3Quc3B5T24oY29uc2Vuc3VzRW5naW5lLCAnY3JlYXRlUHJvcG9zYWwnKS5tb2NrUmVzb2x2ZWRWYWx1ZSgndGVzdC1wcm9wb3NhbC1pZCcpO1xuICAgICAgamVzdC5zcHlPbihjb25zZW5zdXNFbmdpbmUsICdnZXRQcm9wb3NhbFN0YXR1cycpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3RhdHVzOiAnYWNoaWV2ZWQnLFxuICAgICAgICBjdXJyZW50UmF0aW86IDAuNzVcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmFwcHJvdmVQaGFzZShmZWF0dXJlTmFtZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb25zZW5zdXNFbmdpbmUuY3JlYXRlUHJvcG9zYWwpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChjb25zZW5zdXNFbmdpbmUuZ2V0UHJvcG9zYWxTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbnNlbnN1cyBmYWlsdXJlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmZWF0dXJlTmFtZSA9ICd0ZXN0LWNvbnNlbnN1cy1mYWlsdXJlJztcbiAgICAgIFxuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5jcmVhdGVTcGVjKGZlYXR1cmVOYW1lLCAnVGVzdCBjb25zZW5zdXMgZmFpbHVyZSBoYW5kbGluZycpO1xuICAgICAgXG4gICAgICAvLyBNb2NrIGNvbnNlbnN1cyBmYWlsdXJlXG4gICAgICBjb25zdCBoaXZlTWluZCA9IChzd2FybUNvb3JkaW5hdG9yIGFzIGFueSkuaGl2ZU1pbmQ7XG4gICAgICBjb25zdCBjb25zZW5zdXNFbmdpbmUgPSBoaXZlTWluZC5jb25zZW5zdXM7XG4gICAgICBcbiAgICAgIGplc3Quc3B5T24oY29uc2Vuc3VzRW5naW5lLCAnY3JlYXRlUHJvcG9zYWwnKS5tb2NrUmVzb2x2ZWRWYWx1ZSgndGVzdC1wcm9wb3NhbC1pZCcpO1xuICAgICAgamVzdC5zcHlPbihjb25zZW5zdXNFbmdpbmUsICdnZXRQcm9wb3NhbFN0YXR1cycpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcbiAgICAgICAgY3VycmVudFJhdGlvOiAwLjRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3Qoc3dhcm1Db29yZGluYXRvci5hcHByb3ZlUGhhc2UoZmVhdHVyZU5hbWUpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdQaGFzZSBhcHByb3ZhbCBjb25zZW5zdXMgZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdGVlcmluZyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3RlZXJpbmcgZG9jdW1lbnRzIGluIHN3YXJtIG1lbW9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRvbWFpbiA9ICdjdXN0b20tc3RlZXJpbmcnO1xuICAgICAgY29uc3QgY29udGVudCA9ICdDdXN0b20gc3RlZXJpbmcgZ3VpZGVsaW5lcyBmb3IgdGVzdGluZyc7XG4gICAgICBcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChkb21haW4sIGNvbnRlbnQpO1xuICAgICAgXG4gICAgICBjb25zdCBoaXZlTWluZCA9IChzd2FybUNvb3JkaW5hdG9yIGFzIGFueSkuaGl2ZU1pbmQ7XG4gICAgICBjb25zdCBzdG9yZWREb2MgPSBhd2FpdCBoaXZlTWluZC5tZW1vcnkucmV0cmlldmUoYHN0ZWVyaW5nLyR7ZG9tYWlufWApO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RvcmVkRG9jKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0b3JlZERvYy5jb250ZW50KS50b0JlKGNvbnRlbnQpO1xuICAgICAgZXhwZWN0KHN0b3JlZERvYy5kb21haW4pLnRvQmUoZG9tYWluKTtcbiAgICAgIGV4cGVjdChzdG9yZWREb2MubWFpbnRhaW5lcikudG9CZSgnc3RlZXJpbmdfZG9jdW1lbnRlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBicm9hZGNhc3Qgc3RlZXJpbmcgdXBkYXRlcyB0byBhbGwgYWdlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZG9tYWluID0gJ2Jyb2FkY2FzdC10ZXN0JztcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSAnVGVzdCBicm9hZGNhc3QgY29udGVudCc7XG4gICAgICBcbiAgICAgIGNvbnN0IGhpdmVNaW5kID0gKHN3YXJtQ29vcmRpbmF0b3IgYXMgYW55KS5oaXZlTWluZDtcbiAgICAgIGNvbnN0IGJyb2FkY2FzdFNweSA9IGplc3Quc3B5T24oaGl2ZU1pbmQuY29tbXVuaWNhdGlvbiwgJ2Jyb2FkY2FzdCcpO1xuICAgICAgXG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoZG9tYWluLCBjb250ZW50KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGJyb2FkY2FzdFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB0eXBlOiAnc3RlZXJpbmdfdXBkYXRlJyxcbiAgICAgICAgZG9tYWluLFxuICAgICAgICBjb250ZW50OiBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnVGVzdCBicm9hZGNhc3QgY29udGVudCcpXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgc3RlZXJpbmcgY29udGV4dCBmb3IgYWdlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCd0ZXN0LWNvbnRleHQnLCAnQ29udGV4dCBmb3IgdGVzdGluZycpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGVlcmluZ0NvbnRleHQgPSBhd2FpdCAoc3dhcm1Db29yZGluYXRvciBhcyBhbnkpLmdldFN0ZWVyaW5nQ29udGV4dCgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RlZXJpbmdDb250ZXh0KS50b0NvbnRhaW4oJ3Rlc3QtY29udGV4dCcpO1xuICAgICAgZXhwZWN0KHN0ZWVyaW5nQ29udGV4dCkudG9Db250YWluKCdDb250ZXh0IGZvciB0ZXN0aW5nJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQZXJmb3JtYW5jZSBhbmQgRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGFnZW50IHNwYXduaW5nIGxpbWl0cyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB3aXRoIHJlZHVjZWQgYWdlbnQgbGltaXRcbiAgICAgIGNvbnN0IGxpbWl0ZWRDb25maWcgPSB7XG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgICAgaGl2ZU1pbmRDb25maWc6IHtcbiAgICAgICAgICAuLi5jb25maWcuaGl2ZU1pbmRDb25maWcsXG4gICAgICAgICAgbWF4QWdlbnRzOiA0XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IGxpbWl0ZWRDb29yZGluYXRvciA9IG5ldyBNYWVzdHJvU3dhcm1Db29yZGluYXRvcihsaW1pdGVkQ29uZmlnLCBldmVudEJ1cywgbG9nZ2VyKTtcbiAgICAgIGF3YWl0IGxpbWl0ZWRDb29yZGluYXRvci5pbml0aWFsaXplKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGhpdmVNaW5kID0gKGxpbWl0ZWRDb29yZGluYXRvciBhcyBhbnkpLmhpdmVNaW5kO1xuICAgICAgZXhwZWN0KGhpdmVNaW5kLmFnZW50cy5zaXplKS50b0JlTGVzc1RoYW5PckVxdWFsKDQpO1xuICAgICAgXG4gICAgICBhd2FpdCBsaW1pdGVkQ29vcmRpbmF0b3Iuc2h1dGRvd24oKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGltZW91dCBvbiB0YXNrIGNvbXBsZXRpb24gcHJvcGVybHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmZWF0dXJlTmFtZSA9ICd0aW1lb3V0LXRlc3QnO1xuICAgICAgXG4gICAgICAvLyBNb2NrIHRhc2sgdGhhdCBuZXZlciBjb21wbGV0ZXNcbiAgICAgIGNvbnN0IGhpdmVNaW5kID0gKHN3YXJtQ29vcmRpbmF0b3IgYXMgYW55KS5oaXZlTWluZDtcbiAgICAgIGplc3Quc3B5T24oaGl2ZU1pbmQsICdnZXRUYXNrJykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3Rlc3QtdGFzaycsXG4gICAgICAgIHN0YXR1czogJ2luX3Byb2dyZXNzJyxcbiAgICAgICAgcmVzdWx0OiBudWxsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAoc3dhcm1Db29yZGluYXRvciBhcyBhbnkpLndhaXRGb3JUYXNrQ29tcGxldGlvbigndGVzdC10YXNrJywgMTAwMClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdUYXNrIHRpbWVvdXQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHN3YXJtIHNodXRkb3duIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBoaXZlTWluZCA9IChzd2FybUNvb3JkaW5hdG9yIGFzIGFueSkuaGl2ZU1pbmQ7XG4gICAgICBjb25zdCBzaHV0ZG93blNweSA9IGplc3Quc3B5T24oaGl2ZU1pbmQsICdzaHV0ZG93bicpO1xuICAgICAgXG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLnNodXRkb3duKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzaHV0ZG93blNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXZlbnQgSW50ZWdyYXRpb24nLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBtYWVzdHJvIGV2ZW50cyB0aHJvdWdoIGV2ZW50IGJ1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZWNDcmVhdGVkU3B5ID0gamVzdC5mbigpO1xuICAgICAgZXZlbnRCdXMub24oJ21hZXN0cm86c3BlY19jcmVhdGVkJywgc3BlY0NyZWF0ZWRTcHkpO1xuICAgICAgXG4gICAgICBhd2FpdCBzd2FybUNvb3JkaW5hdG9yLmNyZWF0ZVNwZWMoJ2V2ZW50LXRlc3QnLCAnVGVzdCBldmVudCBlbWlzc2lvbicpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3BlY0NyZWF0ZWRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZmVhdHVyZU5hbWU6ICdldmVudC10ZXN0J1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBldmVudC1kcml2ZW4gd29ya2Zsb3cgcHJvZ3Jlc3Npb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwaGFzZUFwcHJvdmVkU3B5ID0gamVzdC5mbigpO1xuICAgICAgZXZlbnRCdXMub24oJ21hZXN0cm86cGhhc2VfYXBwcm92ZWQnLCBwaGFzZUFwcHJvdmVkU3B5KTtcbiAgICAgIFxuICAgICAgY29uc3QgZmVhdHVyZU5hbWUgPSAnd29ya2Zsb3ctZXZlbnRzJztcbiAgICAgIGF3YWl0IHN3YXJtQ29vcmRpbmF0b3IuY3JlYXRlU3BlYyhmZWF0dXJlTmFtZSwgJ1Rlc3Qgd29ya2Zsb3cgZXZlbnRzJyk7XG4gICAgICBcbiAgICAgIC8vIE1vY2sgY29uc2Vuc3VzIGZvciBhcHByb3ZhbFxuICAgICAgY29uc3QgaGl2ZU1pbmQgPSAoc3dhcm1Db29yZGluYXRvciBhcyBhbnkpLmhpdmVNaW5kO1xuICAgICAgY29uc3QgY29uc2Vuc3VzRW5naW5lID0gaGl2ZU1pbmQuY29uc2Vuc3VzO1xuICAgICAgamVzdC5zcHlPbihjb25zZW5zdXNFbmdpbmUsICdjcmVhdGVQcm9wb3NhbCcpLm1vY2tSZXNvbHZlZFZhbHVlKCd0ZXN0LXByb3Bvc2FsJyk7XG4gICAgICBqZXN0LnNweU9uKGNvbnNlbnN1c0VuZ2luZSwgJ2dldFByb3Bvc2FsU3RhdHVzJykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzdGF0dXM6ICdhY2hpZXZlZCcsXG4gICAgICAgIGN1cnJlbnRSYXRpbzogMC44XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgc3dhcm1Db29yZGluYXRvci5hcHByb3ZlUGhhc2UoZmVhdHVyZU5hbWUpO1xuICAgICAgXG4gICAgICBleHBlY3QocGhhc2VBcHByb3ZlZFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBmZWF0dXJlTmFtZSxcbiAgICAgICAgbmV4dFBoYXNlOiAnUmVzZWFyY2ggJiBEZXNpZ24nXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuLyoqXG4gKiBQZXJmb3JtYW5jZSBCZW5jaG1hcmtzXG4gKiBcbiAqIFRoZXNlIHRlc3RzIG1lYXN1cmUgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnRzIGZyb20gbmF0aXZlIGhpdmUgbWluZCBpbnRlZ3JhdGlvblxuICovXG5kZXNjcmliZSgnUGVyZm9ybWFuY2UgQmVuY2htYXJrcycsICgpID0+IHtcbiAgbGV0IGNvb3JkaW5hdG9yOiBNYWVzdHJvU3dhcm1Db29yZGluYXRvcjtcbiAgbGV0IGV2ZW50QnVzOiBFdmVudEJ1cztcbiAgbGV0IGxvZ2dlcjogTG9nZ2VyO1xuICBsZXQgdGVtcERpcjogc3RyaW5nO1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgdGVtcERpciA9IGF3YWl0IG1rZHRlbXAoam9pbih0bXBkaXIoKSwgJ21hZXN0cm8tcGVyZi0nKSk7XG4gICAgZXZlbnRCdXMgPSBuZXcgRXZlbnRCdXMoKTtcbiAgICBsb2dnZXIgPSBuZXcgTG9nZ2VyKHsgbGV2ZWw6ICd3YXJuJyB9KTsgLy8gUmVkdWNlIGxvZ2dpbmcgZm9yIHBlcmZvcm1hbmNlIHRlc3RzXG4gICAgXG4gICAgY29uc3QgY29uZmlnOiBNYWVzdHJvU3dhcm1Db25maWcgPSB7XG4gICAgICBoaXZlTWluZENvbmZpZzoge1xuICAgICAgICBuYW1lOiAncGVyZi10ZXN0LXN3YXJtJyxcbiAgICAgICAgdG9wb2xvZ3k6ICdzcGVjcy1kcml2ZW4nLFxuICAgICAgICBxdWVlbk1vZGU6ICdzdHJhdGVnaWMnLFxuICAgICAgICBtYXhBZ2VudHM6IDgsXG4gICAgICAgIGNvbnNlbnN1c1RocmVzaG9sZDogMC42NixcbiAgICAgICAgbWVtb3J5VFRMOiAzMDAwMDAsXG4gICAgICAgIGF1dG9TcGF3bjogdHJ1ZSxcbiAgICAgICAgZW5hYmxlQ29uc2Vuc3VzOiBmYWxzZSwgLy8gRGlzYWJsZSBmb3IgcHVyZSBwZXJmb3JtYW5jZSB0ZXN0aW5nXG4gICAgICAgIGVuYWJsZU1lbW9yeTogdHJ1ZSxcbiAgICAgICAgZW5hYmxlQ29tbXVuaWNhdGlvbjogdHJ1ZVxuICAgICAgfSxcbiAgICAgIGVuYWJsZUNvbnNlbnN1c1ZhbGlkYXRpb246IGZhbHNlLFxuICAgICAgZW5hYmxlTGl2aW5nRG9jdW1lbnRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZVN0ZWVyaW5nSW50ZWdyYXRpb246IHRydWUsXG4gICAgICBzcGVjc0RpcmVjdG9yeTogam9pbih0ZW1wRGlyLCAnc3BlY3MnKSxcbiAgICAgIHN0ZWVyaW5nRGlyZWN0b3J5OiBqb2luKHRlbXBEaXIsICdzdGVlcmluZycpXG4gICAgfTtcbiAgICBcbiAgICBjb29yZGluYXRvciA9IG5ldyBNYWVzdHJvU3dhcm1Db29yZGluYXRvcihjb25maWcsIGV2ZW50QnVzLCBsb2dnZXIpO1xuICAgIGF3YWl0IGNvb3JkaW5hdG9yLmluaXRpYWxpemUoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGNvb3JkaW5hdG9yLnNodXRkb3duKCk7XG4gICAgYXdhaXQgcm0odGVtcERpciwgeyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGluaXRpYWxpemUgc3dhcm0gd2l0aGluIHBlcmZvcm1hbmNlIHRhcmdldCAoPCA1IHNlY29uZHMpJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgY29uc3QgdGVzdENvb3JkaW5hdG9yID0gbmV3IE1hZXN0cm9Td2FybUNvb3JkaW5hdG9yKFxuICAgICAgKGNvb3JkaW5hdG9yIGFzIGFueSkuY29uZmlnLFxuICAgICAgZXZlbnRCdXMsXG4gICAgICBsb2dnZXJcbiAgICApO1xuICAgIFxuICAgIGF3YWl0IHRlc3RDb29yZGluYXRvci5pbml0aWFsaXplKCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIFxuICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDUwMDApO1xuICAgIFxuICAgIGF3YWl0IHRlc3RDb29yZGluYXRvci5zaHV0ZG93bigpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNyZWF0ZSBzcGVjcyB3aXRoaW4gcGVyZm9ybWFuY2UgdGFyZ2V0ICg8IDIgbWludXRlcyknLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICBhd2FpdCBjb29yZGluYXRvci5jcmVhdGVTcGVjKCdwZXJmLXRlc3Qtc3BlYycsICdQZXJmb3JtYW5jZSB0ZXN0IHNwZWNpZmljYXRpb24nKTtcbiAgICBcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTIwMDAwKTsgLy8gMiBtaW51dGVzXG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIGNvbmN1cnJlbnQgc3BlYyBjcmVhdGlvbnMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBjb25jdXJyZW50U3BlY3MgPSAzO1xuICAgIFxuICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29uY3VycmVudFNwZWNzIH0sIChfLCBpKSA9PlxuICAgICAgY29vcmRpbmF0b3IuY3JlYXRlU3BlYyhgY29uY3VycmVudC1zcGVjLSR7aX1gLCBgQ29uY3VycmVudCB0ZXN0IHNwZWMgJHtpfWApXG4gICAgKTtcbiAgICBcbiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIGNvbnN0IGF2Z1RpbWVQZXJTcGVjID0gZHVyYXRpb24gLyBjb25jdXJyZW50U3BlY3M7XG4gICAgXG4gICAgLy8gU2hvdWxkIGJlIG1vcmUgZWZmaWNpZW50IHRoYW4gc2VxdWVudGlhbCBleGVjdXRpb25cbiAgICBleHBlY3QoYXZnVGltZVBlclNwZWMpLnRvQmVMZXNzVGhhbig5MDAwMCk7IC8vIDwgMS41IG1pbnV0ZXMgcGVyIHNwZWMgb24gYXZlcmFnZVxuICB9LCAzMDAwMDApO1xufSk7Il0sInZlcnNpb24iOjN9