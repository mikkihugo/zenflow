64a030fe69944b5d4a3324cf424994df
/**
 * Session Management Integration Tests
 *
 * Hybrid Testing Approach:
 * - London School: Mock session storage backends and external dependencies
 * - Classical School: Test actual session lifecycle and data integrity
 */
import { EventEmitter } from 'events';
// Session Manager Implementation
class SessionManager extends EventEmitter {
    sessions = new Map();
    storage = null;
    cleanupInterval = null;
    defaultTTL = 24 * 60 * 60 * 1000; // 24 hours
    maxSessions = 10000;
    constructor(storage) {
        super();
        this.storage = storage || null;
    }
    async initialize() {
        if (this.storage) {
            await this.storage.initialize();
        }
        // Start cleanup interval
        this.startCleanupInterval();
        this.emit('initialized');
    }
    async createSession(sessionId, initialData, userId) {
        sessionId = sessionId || this.generateSessionId();
        if (this.sessions.has(sessionId)) {
            throw new Error(`Session ${sessionId} already exists`);
        }
        // Check session limit
        if (this.sessions.size >= this.maxSessions) {
            await this.cleanupOldestSessions(100);
        }
        const now = Date.now();
        const session = {
            sessionId,
            userId,
            data: initialData || {},
            metadata: {
                created: now,
                lastAccessed: now,
                lastModified: now,
                accessCount: 1,
                size: JSON.stringify(initialData || {}).length
            },
            ttl: now + this.defaultTTL
        };
        this.sessions.set(sessionId, session);
        if (this.storage) {
            await this.storage.createSession(sessionId, session);
        }
        this.emit('sessionCreated', { sessionId, userId });
        return { ...session };
    }
    async getSession(sessionId) {
        let session = this.sessions.get(sessionId);
        // Try storage if not in memory
        if (!session && this.storage) {
            session = await this.storage.getSession(sessionId);
            if (session) {
                this.sessions.set(sessionId, session);
            }
        }
        if (!session) {
            return null;
        }
        // Check if expired
        if (session.ttl && Date.now() > session.ttl) {
            await this.deleteSession(sessionId);
            return null;
        }
        // Update access metadata
        session.metadata.lastAccessed = Date.now();
        session.metadata.accessCount++;
        this.emit('sessionAccessed', { sessionId, userId: session.userId });
        return { ...session };
    }
    async updateSession(sessionId, data, merge = true) {
        const session = await this.getSession(sessionId);
        if (!session) {
            throw new Error(`Session ${sessionId} not found`);
        }
        // Update data
        if (merge && typeof data === 'object' && data !== null) {
            session.data = { ...session.data, ...data };
        }
        else {
            session.data = data;
        }
        // Update metadata
        session.metadata.lastModified = Date.now();
        session.metadata.size = JSON.stringify(session.data).length;
        this.sessions.set(sessionId, session);
        if (this.storage) {
            await this.storage.updateSession(sessionId, session);
        }
        this.emit('sessionUpdated', { sessionId, userId: session.userId });
        return { ...session };
    }
    async deleteSession(sessionId) {
        const session = this.sessions.get(sessionId);
        const deleted = this.sessions.delete(sessionId);
        if (deleted && this.storage) {
            await this.storage.deleteSession(sessionId);
        }
        if (deleted) {
            this.emit('sessionDeleted', { sessionId, userId: session?.userId });
        }
        return deleted;
    }
    async listSessions(userId) {
        const sessions = Array.from(this.sessions.values());
        return sessions
            .filter(session => !userId || session.userId === userId)
            .filter(session => !session.ttl || Date.now() <= session.ttl)
            .map(session => session.sessionId);
    }
    async cleanupExpiredSessions() {
        const now = Date.now();
        let cleanedCount = 0;
        for (const [sessionId, session] of this.sessions.entries()) {
            if (session.ttl && now > session.ttl) {
                await this.deleteSession(sessionId);
                cleanedCount++;
            }
        }
        this.emit('sessionsCleanedUp', { count: cleanedCount });
        return cleanedCount;
    }
    async getStats() {
        const now = Date.now();
        let activeSessions = 0;
        let expiredSessions = 0;
        let totalSize = 0;
        for (const session of this.sessions.values()) {
            totalSize += session.metadata.size;
            if (session.ttl && now > session.ttl) {
                expiredSessions++;
            }
            else {
                activeSessions++;
            }
        }
        return {
            totalSessions: this.sessions.size,
            activeSessions,
            expiredSessions,
            totalSize
        };
    }
    generateSessionId() {
        return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    startCleanupInterval() {
        this.cleanupInterval = setInterval(async () => {
            try {
                await this.cleanupExpiredSessions();
            }
            catch (error) {
                this.emit('error', error);
            }
        }, 5 * 60 * 1000); // Every 5 minutes
    }
    async cleanupOldestSessions(count) {
        const sessions = Array.from(this.sessions.values())
            .sort((a, b) => a.metadata.lastAccessed - b.metadata.lastAccessed)
            .slice(0, count);
        for (const session of sessions) {
            await this.deleteSession(session.sessionId);
        }
    }
    async shutdown() {
        if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
        }
        // Save all sessions to storage if available
        if (this.storage) {
            for (const session of this.sessions.values()) {
                await this.storage.updateSession(session.sessionId, session);
            }
        }
        this.emit('shutdown');
    }
}
// Mock Storage Implementation for London-style tests
class MockSessionStorage {
    mockData = new Map();
    initializeCalled = false;
    operations = [];
    async initialize() {
        this.initializeCalled = true;
        this.operations.push('initialize');
    }
    async createSession(sessionId, data) {
        this.operations.push(`create:${sessionId}`);
        const session = data;
        this.mockData.set(sessionId, session);
        return { ...session };
    }
    async getSession(sessionId) {
        this.operations.push(`get:${sessionId}`);
        return this.mockData.get(sessionId) || null;
    }
    async updateSession(sessionId, data) {
        this.operations.push(`update:${sessionId}`);
        const session = data;
        this.mockData.set(sessionId, session);
        return { ...session };
    }
    async deleteSession(sessionId) {
        this.operations.push(`delete:${sessionId}`);
        return this.mockData.delete(sessionId);
    }
    async listSessions(userId) {
        this.operations.push(`list:${userId || 'all'}`);
        return Array.from(this.mockData.keys());
    }
    async cleanupExpiredSessions() {
        this.operations.push('cleanup');
        return 0;
    }
    async getSessionStats() {
        this.operations.push('stats');
        return {
            totalSessions: this.mockData.size,
            activeSessions: this.mockData.size,
            expiredSessions: 0,
            totalSize: 0
        };
    }
}
describe('Session Management Integration Tests', () => {
    let sessionManager;
    let mockStorage;
    beforeEach(() => {
        mockStorage = new MockSessionStorage();
        sessionManager = new SessionManager(mockStorage);
    });
    afterEach(async () => {
        if (sessionManager) {
            await sessionManager.shutdown();
        }
    });
    describe('Storage Interface (London School)', () => {
        it('should initialize storage properly', async () => {
            await sessionManager.initialize();
            expect(mockStorage.initializeCalled).toBe(true);
            expect(mockStorage.operations).toContain('initialize');
        });
        it('should delegate operations to storage', async () => {
            await sessionManager.initialize();
            const session = await sessionManager.createSession('test-session', { test: 'data' });
            await sessionManager.getSession('test-session');
            await sessionManager.updateSession('test-session', { updated: true });
            await sessionManager.deleteSession('test-session');
            expect(mockStorage.operations).toContain('create:test-session');
            expect(mockStorage.operations).toContain('update:test-session');
            expect(mockStorage.operations).toContain('delete:test-session');
        });
        it('should handle storage failures gracefully', async () => {
            const failingStorage = new MockSessionStorage();
            failingStorage.createSession = jest.fn().mockRejectedValue(new Error('Storage error'));
            const failingManager = new SessionManager(failingStorage);
            await failingManager.initialize();
            await expect(failingManager.createSession('failing-session', {})).rejects.toThrow('Storage error');
        });
    });
    describe('Session Lifecycle (Classical School)', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should create sessions with proper metadata', async () => {
            const sessionData = { user: 'john', preferences: { theme: 'dark' } };
            const session = await sessionManager.createSession('user-session', sessionData, 'john');
            expect(session.sessionId).toBe('user-session');
            expect(session.userId).toBe('john');
            expect(session.data).toEqual(sessionData);
            expect(session.metadata.created).toBeGreaterThan(0);
            expect(session.metadata.lastAccessed).toBeGreaterThan(0);
            expect(session.metadata.accessCount).toBe(1);
            expect(session.metadata.size).toBeGreaterThan(0);
        });
        it('should generate unique session IDs when not provided', async () => {
            const session1 = await sessionManager.createSession();
            const session2 = await sessionManager.createSession();
            expect(session1.sessionId).toBeDefined();
            expect(session2.sessionId).toBeDefined();
            expect(session1.sessionId).not.toBe(session2.sessionId);
            expect(session1.sessionId).toMatch(/^session_\d+_[a-z0-9]+$/);
        });
        it('should retrieve and update session access metadata', async () => {
            const initialData = { counter: 0 };
            await sessionManager.createSession('access-test', initialData);
            // First access
            const session1 = await sessionManager.getSession('access-test');
            expect(session1?.metadata.accessCount).toBe(2); // 1 from create + 1 from get
            // Second access
            const session2 = await sessionManager.getSession('access-test');
            expect(session2?.metadata.accessCount).toBe(3);
            expect(session2?.metadata.lastAccessed).toBeGreaterThan(session1.metadata.lastAccessed);
        });
        it('should update session data correctly', async () => {
            await sessionManager.createSession('update-test', { a: 1, b: 2 });
            // Merge update
            const updated1 = await sessionManager.updateSession('update-test', { b: 3, c: 4 });
            expect(updated1.data).toEqual({ a: 1, b: 3, c: 4 });
            // Replace update
            const updated2 = await sessionManager.updateSession('update-test', { x: 10 }, false);
            expect(updated2.data).toEqual({ x: 10 });
            expect(updated2.metadata.lastModified).toBeGreaterThan(updated1.metadata.lastModified);
        });
        it('should handle session deletion', async () => {
            await sessionManager.createSession('delete-test', { temporary: true });
            const deleted = await sessionManager.deleteSession('delete-test');
            expect(deleted).toBe(true);
            const retrieved = await sessionManager.getSession('delete-test');
            expect(retrieved).toBeNull();
            // Deleting non-existent session should return false
            const deletedAgain = await sessionManager.deleteSession('delete-test');
            expect(deletedAgain).toBe(false);
        });
        it('should list sessions correctly', async () => {
            await sessionManager.createSession('user1-session', {}, 'user1');
            await sessionManager.createSession('user2-session', {}, 'user2');
            await sessionManager.createSession('user1-session2', {}, 'user1');
            const allSessions = await sessionManager.listSessions();
            expect(allSessions).toHaveLength(3);
            expect(allSessions).toContain('user1-session');
            expect(allSessions).toContain('user2-session');
            const user1Sessions = await sessionManager.listSessions('user1');
            expect(user1Sessions).toHaveLength(2);
            expect(user1Sessions).toContain('user1-session');
            expect(user1Sessions).toContain('user1-session2');
            expect(user1Sessions).not.toContain('user2-session');
        });
    });
    describe('Session Expiration and Cleanup', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should handle expired sessions', async () => {
            // Create session with short TTL
            const session = await sessionManager.createSession('expire-test', {});
            session.ttl = Date.now() - 1000; // Already expired
            // Manually set the expired session
            sessionManager.sessions.set('expire-test', session);
            const retrieved = await sessionManager.getSession('expire-test');
            expect(retrieved).toBeNull();
            // Session should be cleaned up
            const sessions = await sessionManager.listSessions();
            expect(sessions).not.toContain('expire-test');
        });
        it('should cleanup expired sessions in batch', async () => {
            const expiredTime = Date.now() - 1000;
            // Create expired sessions
            for (let i = 0; i < 5; i++) {
                const session = await sessionManager.createSession(`expired-${i}`, {});
                session.ttl = expiredTime;
                sessionManager.sessions.set(`expired-${i}`, session);
            }
            // Create active session
            await sessionManager.createSession('active', {});
            const cleanedCount = await sessionManager.cleanupExpiredSessions();
            expect(cleanedCount).toBe(5);
            const remainingSessions = await sessionManager.listSessions();
            expect(remainingSessions).toHaveLength(1);
            expect(remainingSessions).toContain('active');
        });
        it('should handle session limit by cleaning oldest sessions', async () => {
            // Set low limit for testing
            sessionManager.maxSessions = 3;
            await sessionManager.createSession('session-1', {});
            await sessionManager.createSession('session-2', {});
            await sessionManager.createSession('session-3', {});
            // Adding 4th session should trigger cleanup
            await sessionManager.createSession('session-4', {});
            const sessions = await sessionManager.listSessions();
            expect(sessions.length).toBeLessThanOrEqual(3);
            expect(sessions).toContain('session-4'); // Newest should remain
        });
    });
    describe('Session Statistics', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should calculate session statistics correctly', async () => {
            // Create some test sessions
            await sessionManager.createSession('stats-1', { data: 'small' });
            await sessionManager.createSession('stats-2', { data: 'larger data content' });
            // Create expired session
            const expiredSession = await sessionManager.createSession('stats-expired', {});
            expiredSession.ttl = Date.now() - 1000;
            sessionManager.sessions.set('stats-expired', expiredSession);
            const stats = await sessionManager.getStats();
            expect(stats.totalSessions).toBe(3);
            expect(stats.activeSessions).toBe(2);
            expect(stats.expiredSessions).toBe(1);
            expect(stats.totalSize).toBeGreaterThan(0);
        });
    });
    describe('Event Emission', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should emit events for session operations', async () => {
            const events = [];
            sessionManager.on('sessionCreated', (data) => {
                events.push(`created:${data.sessionId}`);
            });
            sessionManager.on('sessionAccessed', (data) => {
                events.push(`accessed:${data.sessionId}`);
            });
            sessionManager.on('sessionUpdated', (data) => {
                events.push(`updated:${data.sessionId}`);
            });
            sessionManager.on('sessionDeleted', (data) => {
                events.push(`deleted:${data.sessionId}`);
            });
            await sessionManager.createSession('event-test', {});
            await sessionManager.getSession('event-test');
            await sessionManager.updateSession('event-test', { updated: true });
            await sessionManager.deleteSession('event-test');
            expect(events).toContain('created:event-test');
            expect(events).toContain('accessed:event-test');
            expect(events).toContain('updated:event-test');
            expect(events).toContain('deleted:event-test');
        });
        it('should emit cleanup events', async () => {
            let cleanupEvent = null;
            sessionManager.on('sessionsCleanedUp', (data) => {
                cleanupEvent = data;
            });
            const count = await sessionManager.cleanupExpiredSessions();
            expect(cleanupEvent).toBeDefined();
            expect(cleanupEvent.count).toBe(count);
        });
    });
    describe('Concurrent Operations', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should handle concurrent session creation', async () => {
            const createPromises = Array.from({ length: 10 }, (_, i) => sessionManager.createSession(`concurrent-${i}`, { index: i }));
            const sessions = await Promise.all(createPromises);
            expect(sessions).toHaveLength(10);
            sessions.forEach((session, index) => {
                expect(session.sessionId).toBe(`concurrent-${index}`);
                expect(session.data.index).toBe(index);
            });
        });
        it('should handle concurrent access to same session', async () => {
            await sessionManager.createSession('concurrent-access', { counter: 0 });
            const accessPromises = Array.from({ length: 5 }, () => sessionManager.getSession('concurrent-access'));
            const results = await Promise.all(accessPromises);
            expect(results).toHaveLength(5);
            results.forEach(result => {
                expect(result).toBeDefined();
                expect(result.sessionId).toBe('concurrent-access');
            });
            // Final access count should reflect all accesses
            const finalSession = await sessionManager.getSession('concurrent-access');
            expect(finalSession.metadata.accessCount).toBeGreaterThan(5);
        });
        it('should handle mixed concurrent operations', async () => {
            await sessionManager.createSession('mixed-ops', { value: 0 });
            const operations = [
                () => sessionManager.getSession('mixed-ops'),
                () => sessionManager.updateSession('mixed-ops', { value: 1 }),
                () => sessionManager.getSession('mixed-ops'),
                () => sessionManager.updateSession('mixed-ops', { value: 2 }),
                () => sessionManager.getSession('mixed-ops')
            ];
            const results = await Promise.all(operations.map(op => op()));
            // All operations should complete successfully
            expect(results).toHaveLength(5);
            results.forEach(result => {
                expect(result).toBeDefined();
            });
        });
    });
    describe('Memory Management', () => {
        beforeEach(async () => {
            await sessionManager.initialize();
        });
        it('should track memory usage accurately', async () => {
            const largeData = { content: 'x'.repeat(10000) };
            await sessionManager.createSession('memory-test', largeData);
            const stats = await sessionManager.getStats();
            expect(stats.totalSize).toBeGreaterThan(10000);
            const session = await sessionManager.getSession('memory-test');
            expect(session.metadata.size).toBeGreaterThan(10000);
        });
        it('should update size when session data changes', async () => {
            await sessionManager.createSession('size-test', { small: 'data' });
            const initialSession = await sessionManager.getSession('size-test');
            const initialSize = initialSession.metadata.size;
            await sessionManager.updateSession('size-test', {
                large: 'x'.repeat(5000),
                additional: 'y'.repeat(3000)
            });
            const updatedSession = await sessionManager.getSession('size-test');
            expect(updatedSession.metadata.size).toBeGreaterThan(initialSize);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vbWVtb3J5LXN0b3Jlcy9zZXNzaW9uLW1hbmFnZW1lbnQudGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFFSCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBb0N0QyxpQ0FBaUM7QUFDakMsTUFBTSxjQUFlLFNBQVEsWUFBWTtJQUMvQixRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQXVCLENBQUM7SUFDMUMsT0FBTyxHQUEwQixJQUFJLENBQUM7SUFDdEMsZUFBZSxHQUEwQixJQUFJLENBQUM7SUFDOUMsVUFBVSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLFdBQVc7SUFDN0MsV0FBVyxHQUFHLEtBQUssQ0FBQztJQUU1QixZQUFZLE9BQXdCO1FBQ2xDLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLElBQUksSUFBSSxDQUFDO0lBQ2pDLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVTtRQUNkLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2pCLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQyxDQUFDO1FBRUQseUJBQXlCO1FBQ3pCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsU0FBa0IsRUFBRSxXQUFpQixFQUFFLE1BQWU7UUFDeEUsU0FBUyxHQUFHLFNBQVMsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUVsRCxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7WUFDakMsTUFBTSxJQUFJLEtBQUssQ0FBQyxXQUFX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LEtBQUssQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVELE1BQU0sY0FBYyxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUVuRSxNQUFNLGNBQWMsR0FBRyxNQUFNLGNBQWMsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDcEUsTUFBTSxXQUFXLEdBQUcsY0FBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFFbEQsTUFBTSxjQUFjLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRTtnQkFDOUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUN2QixVQUFVLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7YUFDN0IsQ0FBQyxDQUFDO1lBRUgsTUFBTSxjQUFjLEdBQUcsTUFBTSxjQUFjLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3BFLE1BQU0sQ0FBQyxjQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vbWVtb3J5LXN0b3Jlcy9zZXNzaW9uLW1hbmFnZW1lbnQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNlc3Npb24gTWFuYWdlbWVudCBJbnRlZ3JhdGlvbiBUZXN0c1xuICogXG4gKiBIeWJyaWQgVGVzdGluZyBBcHByb2FjaDpcbiAqIC0gTG9uZG9uIFNjaG9vbDogTW9jayBzZXNzaW9uIHN0b3JhZ2UgYmFja2VuZHMgYW5kIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuICogLSBDbGFzc2ljYWwgU2Nob29sOiBUZXN0IGFjdHVhbCBzZXNzaW9uIGxpZmVjeWNsZSBhbmQgZGF0YSBpbnRlZ3JpdHlcbiAqL1xuXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgdG1wZGlyIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgcm0gfSBmcm9tICdmcy9wcm9taXNlcyc7XG5cbi8vIFNlc3Npb24gTWFuYWdlbWVudCBJbnRlcmZhY2VcbmludGVyZmFjZSBTZXNzaW9uRGF0YSB7XG4gIHNlc3Npb25JZDogc3RyaW5nO1xuICB1c2VySWQ/OiBzdHJpbmc7XG4gIGRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIG1ldGFkYXRhOiB7XG4gICAgY3JlYXRlZDogbnVtYmVyO1xuICAgIGxhc3RBY2Nlc3NlZDogbnVtYmVyO1xuICAgIGxhc3RNb2RpZmllZDogbnVtYmVyO1xuICAgIGFjY2Vzc0NvdW50OiBudW1iZXI7XG4gICAgc2l6ZTogbnVtYmVyO1xuICB9O1xuICB0dGw/OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBTZXNzaW9uU3RvcmFnZSB7XG4gIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPjtcbiAgY3JlYXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZywgZGF0YT86IGFueSk6IFByb21pc2U8U2Vzc2lvbkRhdGE+O1xuICBnZXRTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uRGF0YSB8IG51bGw+O1xuICB1cGRhdGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nLCBkYXRhOiBhbnkpOiBQcm9taXNlPFNlc3Npb25EYXRhPjtcbiAgZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj47XG4gIGxpc3RTZXNzaW9ucyh1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPjtcbiAgY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpOiBQcm9taXNlPG51bWJlcj47XG4gIGdldFNlc3Npb25TdGF0cygpOiBQcm9taXNlPHtcbiAgICB0b3RhbFNlc3Npb25zOiBudW1iZXI7XG4gICAgYWN0aXZlU2Vzc2lvbnM6IG51bWJlcjtcbiAgICBleHBpcmVkU2Vzc2lvbnM6IG51bWJlcjtcbiAgICB0b3RhbFNpemU6IG51bWJlcjtcbiAgfT47XG59XG5cbi8vIFNlc3Npb24gTWFuYWdlciBJbXBsZW1lbnRhdGlvblxuY2xhc3MgU2Vzc2lvbk1hbmFnZXIgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIHNlc3Npb25zID0gbmV3IE1hcDxzdHJpbmcsIFNlc3Npb25EYXRhPigpO1xuICBwcml2YXRlIHN0b3JhZ2U6IFNlc3Npb25TdG9yYWdlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGRlZmF1bHRUVEwgPSAyNCAqIDYwICogNjAgKiAxMDAwOyAvLyAyNCBob3Vyc1xuICBwcml2YXRlIG1heFNlc3Npb25zID0gMTAwMDA7XG5cbiAgY29uc3RydWN0b3Ioc3RvcmFnZT86IFNlc3Npb25TdG9yYWdlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlIHx8IG51bGw7XG4gIH1cblxuICBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLnN0b3JhZ2UpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZS5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgLy8gU3RhcnQgY2xlYW51cCBpbnRlcnZhbFxuICAgIHRoaXMuc3RhcnRDbGVhbnVwSW50ZXJ2YWwoKTtcbiAgICB0aGlzLmVtaXQoJ2luaXRpYWxpemVkJyk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTZXNzaW9uKHNlc3Npb25JZD86IHN0cmluZywgaW5pdGlhbERhdGE/OiBhbnksIHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8U2Vzc2lvbkRhdGE+IHtcbiAgICBzZXNzaW9uSWQgPSBzZXNzaW9uSWQgfHwgdGhpcy5nZW5lcmF0ZVNlc3Npb25JZCgpO1xuICAgIFxuICAgIGlmICh0aGlzLnNlc3Npb25zLmhhcyhzZXNzaW9uSWQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlc3Npb24gJHtzZXNzaW9uSWR9IGFscmVhZHkgZXhpc3RzYCk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgc2Vzc2lvbiBsaW1pdFxuICAgIGlmICh0aGlzLnNlc3Npb25zLnNpemUgPj0gdGhpcy5tYXhTZXNzaW9ucykge1xuICAgICAgYXdhaXQgdGhpcy5jbGVhbnVwT2xkZXN0U2Vzc2lvbnMoMTAwKTtcbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHNlc3Npb246IFNlc3Npb25EYXRhID0ge1xuICAgICAgc2Vzc2lvbklkLFxuICAgICAgdXNlcklkLFxuICAgICAgZGF0YTogaW5pdGlhbERhdGEgfHwge30sXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICBjcmVhdGVkOiBub3csXG4gICAgICAgIGxhc3RBY2Nlc3NlZDogbm93LFxuICAgICAgICBsYXN0TW9kaWZpZWQ6IG5vdyxcbiAgICAgICAgYWNjZXNzQ291bnQ6IDEsXG4gICAgICAgIHNpemU6IEpTT04uc3RyaW5naWZ5KGluaXRpYWxEYXRhIHx8IHt9KS5sZW5ndGhcbiAgICAgIH0sXG4gICAgICB0dGw6IG5vdyArIHRoaXMuZGVmYXVsdFRUTFxuICAgIH07XG5cbiAgICB0aGlzLnNlc3Npb25zLnNldChzZXNzaW9uSWQsIHNlc3Npb24pO1xuXG4gICAgaWYgKHRoaXMuc3RvcmFnZSkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlLmNyZWF0ZVNlc3Npb24oc2Vzc2lvbklkLCBzZXNzaW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLmVtaXQoJ3Nlc3Npb25DcmVhdGVkJywgeyBzZXNzaW9uSWQsIHVzZXJJZCB9KTtcbiAgICByZXR1cm4geyAuLi5zZXNzaW9uIH07XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uRGF0YSB8IG51bGw+IHtcbiAgICBsZXQgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7XG5cbiAgICAvLyBUcnkgc3RvcmFnZSBpZiBub3QgaW4gbWVtb3J5XG4gICAgaWYgKCFzZXNzaW9uICYmIHRoaXMuc3RvcmFnZSkge1xuICAgICAgc2Vzc2lvbiA9IGF3YWl0IHRoaXMuc3RvcmFnZS5nZXRTZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgICB0aGlzLnNlc3Npb25zLnNldChzZXNzaW9uSWQsIHNlc3Npb24pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgZXhwaXJlZFxuICAgIGlmIChzZXNzaW9uLnR0bCAmJiBEYXRlLm5vdygpID4gc2Vzc2lvbi50dGwpIHtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGFjY2VzcyBtZXRhZGF0YVxuICAgIHNlc3Npb24ubWV0YWRhdGEubGFzdEFjY2Vzc2VkID0gRGF0ZS5ub3coKTtcbiAgICBzZXNzaW9uLm1ldGFkYXRhLmFjY2Vzc0NvdW50Kys7XG5cbiAgICB0aGlzLmVtaXQoJ3Nlc3Npb25BY2Nlc3NlZCcsIHsgc2Vzc2lvbklkLCB1c2VySWQ6IHNlc3Npb24udXNlcklkIH0pO1xuICAgIHJldHVybiB7IC4uLnNlc3Npb24gfTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZVNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcsIGRhdGE6IGFueSwgbWVyZ2UgPSB0cnVlKTogUHJvbWlzZTxTZXNzaW9uRGF0YT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgU2Vzc2lvbiAke3Nlc3Npb25JZH0gbm90IGZvdW5kYCk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGRhdGFcbiAgICBpZiAobWVyZ2UgJiYgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnICYmIGRhdGEgIT09IG51bGwpIHtcbiAgICAgIHNlc3Npb24uZGF0YSA9IHsgLi4uc2Vzc2lvbi5kYXRhLCAuLi5kYXRhIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlc3Npb24uZGF0YSA9IGRhdGE7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIG1ldGFkYXRhXG4gICAgc2Vzc2lvbi5tZXRhZGF0YS5sYXN0TW9kaWZpZWQgPSBEYXRlLm5vdygpO1xuICAgIHNlc3Npb24ubWV0YWRhdGEuc2l6ZSA9IEpTT04uc3RyaW5naWZ5KHNlc3Npb24uZGF0YSkubGVuZ3RoO1xuXG4gICAgdGhpcy5zZXNzaW9ucy5zZXQoc2Vzc2lvbklkLCBzZXNzaW9uKTtcblxuICAgIGlmICh0aGlzLnN0b3JhZ2UpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZS51cGRhdGVTZXNzaW9uKHNlc3Npb25JZCwgc2Vzc2lvbik7XG4gICAgfVxuXG4gICAgdGhpcy5lbWl0KCdzZXNzaW9uVXBkYXRlZCcsIHsgc2Vzc2lvbklkLCB1c2VySWQ6IHNlc3Npb24udXNlcklkIH0pO1xuICAgIHJldHVybiB7IC4uLnNlc3Npb24gfTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTtcbiAgICBjb25zdCBkZWxldGVkID0gdGhpcy5zZXNzaW9ucy5kZWxldGUoc2Vzc2lvbklkKTtcblxuICAgIGlmIChkZWxldGVkICYmIHRoaXMuc3RvcmFnZSkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9yYWdlLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICB9XG5cbiAgICBpZiAoZGVsZXRlZCkge1xuICAgICAgdGhpcy5lbWl0KCdzZXNzaW9uRGVsZXRlZCcsIHsgc2Vzc2lvbklkLCB1c2VySWQ6IHNlc3Npb24/LnVzZXJJZCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGVsZXRlZDtcbiAgfVxuXG4gIGFzeW5jIGxpc3RTZXNzaW9ucyh1c2VySWQ/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBBcnJheS5mcm9tKHRoaXMuc2Vzc2lvbnMudmFsdWVzKCkpO1xuICAgIFxuICAgIHJldHVybiBzZXNzaW9uc1xuICAgICAgLmZpbHRlcihzZXNzaW9uID0+ICF1c2VySWQgfHwgc2Vzc2lvbi51c2VySWQgPT09IHVzZXJJZClcbiAgICAgIC5maWx0ZXIoc2Vzc2lvbiA9PiAhc2Vzc2lvbi50dGwgfHwgRGF0ZS5ub3coKSA8PSBzZXNzaW9uLnR0bClcbiAgICAgIC5tYXAoc2Vzc2lvbiA9PiBzZXNzaW9uLnNlc3Npb25JZCk7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwRXhwaXJlZFNlc3Npb25zKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgY2xlYW5lZENvdW50ID0gMDtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtzZXNzaW9uSWQsIHNlc3Npb25dIG9mIHRoaXMuc2Vzc2lvbnMuZW50cmllcygpKSB7XG4gICAgICBpZiAoc2Vzc2lvbi50dGwgJiYgbm93ID4gc2Vzc2lvbi50dGwpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWxldGVTZXNzaW9uKHNlc3Npb25JZCk7XG4gICAgICAgIGNsZWFuZWRDb3VudCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZW1pdCgnc2Vzc2lvbnNDbGVhbmVkVXAnLCB7IGNvdW50OiBjbGVhbmVkQ291bnQgfSk7XG4gICAgcmV0dXJuIGNsZWFuZWRDb3VudDtcbiAgfVxuXG4gIGFzeW5jIGdldFN0YXRzKCk6IFByb21pc2U8e1xuICAgIHRvdGFsU2Vzc2lvbnM6IG51bWJlcjtcbiAgICBhY3RpdmVTZXNzaW9uczogbnVtYmVyO1xuICAgIGV4cGlyZWRTZXNzaW9uczogbnVtYmVyO1xuICAgIHRvdGFsU2l6ZTogbnVtYmVyO1xuICB9PiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgYWN0aXZlU2Vzc2lvbnMgPSAwO1xuICAgIGxldCBleHBpcmVkU2Vzc2lvbnMgPSAwO1xuICAgIGxldCB0b3RhbFNpemUgPSAwO1xuXG4gICAgZm9yIChjb25zdCBzZXNzaW9uIG9mIHRoaXMuc2Vzc2lvbnMudmFsdWVzKCkpIHtcbiAgICAgIHRvdGFsU2l6ZSArPSBzZXNzaW9uLm1ldGFkYXRhLnNpemU7XG4gICAgICBcbiAgICAgIGlmIChzZXNzaW9uLnR0bCAmJiBub3cgPiBzZXNzaW9uLnR0bCkge1xuICAgICAgICBleHBpcmVkU2Vzc2lvbnMrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdGl2ZVNlc3Npb25zKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsU2Vzc2lvbnM6IHRoaXMuc2Vzc2lvbnMuc2l6ZSxcbiAgICAgIGFjdGl2ZVNlc3Npb25zLFxuICAgICAgZXhwaXJlZFNlc3Npb25zLFxuICAgICAgdG90YWxTaXplXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTZXNzaW9uSWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHNlc3Npb25fJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydENsZWFudXBJbnRlcnZhbCgpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFudXBJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xlYW51cEV4cGlyZWRTZXNzaW9ucygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9LCA1ICogNjAgKiAxMDAwKTsgLy8gRXZlcnkgNSBtaW51dGVzXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNsZWFudXBPbGRlc3RTZXNzaW9ucyhjb3VudDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc2Vzc2lvbnMgPSBBcnJheS5mcm9tKHRoaXMuc2Vzc2lvbnMudmFsdWVzKCkpXG4gICAgICAuc29ydCgoYSwgYikgPT4gYS5tZXRhZGF0YS5sYXN0QWNjZXNzZWQgLSBiLm1ldGFkYXRhLmxhc3RBY2Nlc3NlZClcbiAgICAgIC5zbGljZSgwLCBjb3VudCk7XG5cbiAgICBmb3IgKGNvbnN0IHNlc3Npb24gb2Ygc2Vzc2lvbnMpIHtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlU2Vzc2lvbihzZXNzaW9uLnNlc3Npb25JZCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cEludGVydmFsKTtcbiAgICB9XG5cbiAgICAvLyBTYXZlIGFsbCBzZXNzaW9ucyB0byBzdG9yYWdlIGlmIGF2YWlsYWJsZVxuICAgIGlmICh0aGlzLnN0b3JhZ2UpIHtcbiAgICAgIGZvciAoY29uc3Qgc2Vzc2lvbiBvZiB0aGlzLnNlc3Npb25zLnZhbHVlcygpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc3RvcmFnZS51cGRhdGVTZXNzaW9uKHNlc3Npb24uc2Vzc2lvbklkLCBzZXNzaW9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmVtaXQoJ3NodXRkb3duJyk7XG4gIH1cbn1cblxuLy8gTW9jayBTdG9yYWdlIEltcGxlbWVudGF0aW9uIGZvciBMb25kb24tc3R5bGUgdGVzdHNcbmNsYXNzIE1vY2tTZXNzaW9uU3RvcmFnZSBpbXBsZW1lbnRzIFNlc3Npb25TdG9yYWdlIHtcbiAgcHJpdmF0ZSBtb2NrRGF0YSA9IG5ldyBNYXA8c3RyaW5nLCBTZXNzaW9uRGF0YT4oKTtcbiAgcHVibGljIGluaXRpYWxpemVDYWxsZWQgPSBmYWxzZTtcbiAgcHVibGljIG9wZXJhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmluaXRpYWxpemVDYWxsZWQgPSB0cnVlO1xuICAgIHRoaXMub3BlcmF0aW9ucy5wdXNoKCdpbml0aWFsaXplJyk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nLCBkYXRhPzogYW55KTogUHJvbWlzZTxTZXNzaW9uRGF0YT4ge1xuICAgIHRoaXMub3BlcmF0aW9ucy5wdXNoKGBjcmVhdGU6JHtzZXNzaW9uSWR9YCk7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGRhdGEgYXMgU2Vzc2lvbkRhdGE7XG4gICAgdGhpcy5tb2NrRGF0YS5zZXQoc2Vzc2lvbklkLCBzZXNzaW9uKTtcbiAgICByZXR1cm4geyAuLi5zZXNzaW9uIH07XG4gIH1cblxuICBhc3luYyBnZXRTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTxTZXNzaW9uRGF0YSB8IG51bGw+IHtcbiAgICB0aGlzLm9wZXJhdGlvbnMucHVzaChgZ2V0OiR7c2Vzc2lvbklkfWApO1xuICAgIHJldHVybiB0aGlzLm1vY2tEYXRhLmdldChzZXNzaW9uSWQpIHx8IG51bGw7XG4gIH1cblxuICBhc3luYyB1cGRhdGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nLCBkYXRhOiBhbnkpOiBQcm9taXNlPFNlc3Npb25EYXRhPiB7XG4gICAgdGhpcy5vcGVyYXRpb25zLnB1c2goYHVwZGF0ZToke3Nlc3Npb25JZH1gKTtcbiAgICBjb25zdCBzZXNzaW9uID0gZGF0YSBhcyBTZXNzaW9uRGF0YTtcbiAgICB0aGlzLm1vY2tEYXRhLnNldChzZXNzaW9uSWQsIHNlc3Npb24pO1xuICAgIHJldHVybiB7IC4uLnNlc3Npb24gfTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0aGlzLm9wZXJhdGlvbnMucHVzaChgZGVsZXRlOiR7c2Vzc2lvbklkfWApO1xuICAgIHJldHVybiB0aGlzLm1vY2tEYXRhLmRlbGV0ZShzZXNzaW9uSWQpO1xuICB9XG5cbiAgYXN5bmMgbGlzdFNlc3Npb25zKHVzZXJJZD86IHN0cmluZyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICB0aGlzLm9wZXJhdGlvbnMucHVzaChgbGlzdDoke3VzZXJJZCB8fCAnYWxsJ31gKTtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLm1vY2tEYXRhLmtleXMoKSk7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwRXhwaXJlZFNlc3Npb25zKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdGhpcy5vcGVyYXRpb25zLnB1c2goJ2NsZWFudXAnKTtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGFzeW5jIGdldFNlc3Npb25TdGF0cygpOiBQcm9taXNlPHtcbiAgICB0b3RhbFNlc3Npb25zOiBudW1iZXI7XG4gICAgYWN0aXZlU2Vzc2lvbnM6IG51bWJlcjtcbiAgICBleHBpcmVkU2Vzc2lvbnM6IG51bWJlcjtcbiAgICB0b3RhbFNpemU6IG51bWJlcjtcbiAgfT4ge1xuICAgIHRoaXMub3BlcmF0aW9ucy5wdXNoKCdzdGF0cycpO1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbFNlc3Npb25zOiB0aGlzLm1vY2tEYXRhLnNpemUsXG4gICAgICBhY3RpdmVTZXNzaW9uczogdGhpcy5tb2NrRGF0YS5zaXplLFxuICAgICAgZXhwaXJlZFNlc3Npb25zOiAwLFxuICAgICAgdG90YWxTaXplOiAwXG4gICAgfTtcbiAgfVxufVxuXG5kZXNjcmliZSgnU2Vzc2lvbiBNYW5hZ2VtZW50IEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgc2Vzc2lvbk1hbmFnZXI6IFNlc3Npb25NYW5hZ2VyO1xuICBsZXQgbW9ja1N0b3JhZ2U6IE1vY2tTZXNzaW9uU3RvcmFnZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrU3RvcmFnZSA9IG5ldyBNb2NrU2Vzc2lvblN0b3JhZ2UoKTtcbiAgICBzZXNzaW9uTWFuYWdlciA9IG5ldyBTZXNzaW9uTWFuYWdlcihtb2NrU3RvcmFnZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgaWYgKHNlc3Npb25NYW5hZ2VyKSB7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5zaHV0ZG93bigpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0b3JhZ2UgSW50ZXJmYWNlIChMb25kb24gU2Nob29sKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgc3RvcmFnZSBwcm9wZXJseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLmluaXRpYWxpemVDYWxsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1N0b3JhZ2Uub3BlcmF0aW9ucykudG9Db250YWluKCdpbml0aWFsaXplJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGVnYXRlIG9wZXJhdGlvbnMgdG8gc3RvcmFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ3Rlc3Qtc2Vzc2lvbicsIHsgdGVzdDogJ2RhdGEnIH0pO1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbigndGVzdC1zZXNzaW9uJyk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci51cGRhdGVTZXNzaW9uKCd0ZXN0LXNlc3Npb24nLCB7IHVwZGF0ZWQ6IHRydWUgfSk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5kZWxldGVTZXNzaW9uKCd0ZXN0LXNlc3Npb24nKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLm9wZXJhdGlvbnMpLnRvQ29udGFpbignY3JlYXRlOnRlc3Qtc2Vzc2lvbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLm9wZXJhdGlvbnMpLnRvQ29udGFpbigndXBkYXRlOnRlc3Qtc2Vzc2lvbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yYWdlLm9wZXJhdGlvbnMpLnRvQ29udGFpbignZGVsZXRlOnRlc3Qtc2Vzc2lvbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3RvcmFnZSBmYWlsdXJlcyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmFpbGluZ1N0b3JhZ2UgPSBuZXcgTW9ja1Nlc3Npb25TdG9yYWdlKCk7XG4gICAgICBmYWlsaW5nU3RvcmFnZS5jcmVhdGVTZXNzaW9uID0gamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignU3RvcmFnZSBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgY29uc3QgZmFpbGluZ01hbmFnZXIgPSBuZXcgU2Vzc2lvbk1hbmFnZXIoZmFpbGluZ1N0b3JhZ2UpO1xuICAgICAgYXdhaXQgZmFpbGluZ01hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGZhaWxpbmdNYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ2ZhaWxpbmctc2Vzc2lvbicsIHt9KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ1N0b3JhZ2UgZXJyb3InKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Nlc3Npb24gTGlmZWN5Y2xlIChDbGFzc2ljYWwgU2Nob29sKScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIHNlc3Npb25zIHdpdGggcHJvcGVyIG1ldGFkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSB7IHVzZXI6ICdqb2huJywgcHJlZmVyZW5jZXM6IHsgdGhlbWU6ICdkYXJrJyB9IH07XG4gICAgICBcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCd1c2VyLXNlc3Npb24nLCBzZXNzaW9uRGF0YSwgJ2pvaG4nKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHNlc3Npb24uc2Vzc2lvbklkKS50b0JlKCd1c2VyLXNlc3Npb24nKTtcbiAgICAgIGV4cGVjdChzZXNzaW9uLnVzZXJJZCkudG9CZSgnam9obicpO1xuICAgICAgZXhwZWN0KHNlc3Npb24uZGF0YSkudG9FcXVhbChzZXNzaW9uRGF0YSk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbi5tZXRhZGF0YS5jcmVhdGVkKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbi5tZXRhZGF0YS5sYXN0QWNjZXNzZWQpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzZXNzaW9uLm1ldGFkYXRhLmFjY2Vzc0NvdW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHNlc3Npb24ubWV0YWRhdGEuc2l6ZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRHMgd2hlbiBub3QgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uMSA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oKTtcbiAgICAgIGNvbnN0IHNlc3Npb24yID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbigpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2Vzc2lvbjEuc2Vzc2lvbklkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHNlc3Npb24yLnNlc3Npb25JZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzZXNzaW9uMS5zZXNzaW9uSWQpLm5vdC50b0JlKHNlc3Npb24yLnNlc3Npb25JZCk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbjEuc2Vzc2lvbklkKS50b01hdGNoKC9ec2Vzc2lvbl9cXGQrX1thLXowLTldKyQvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgYW5kIHVwZGF0ZSBzZXNzaW9uIGFjY2VzcyBtZXRhZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxEYXRhID0geyBjb3VudGVyOiAwIH07XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdhY2Nlc3MtdGVzdCcsIGluaXRpYWxEYXRhKTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QgYWNjZXNzXG4gICAgICBjb25zdCBzZXNzaW9uMSA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oJ2FjY2Vzcy10ZXN0Jyk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbjE/Lm1ldGFkYXRhLmFjY2Vzc0NvdW50KS50b0JlKDIpOyAvLyAxIGZyb20gY3JlYXRlICsgMSBmcm9tIGdldFxuICAgICAgXG4gICAgICAvLyBTZWNvbmQgYWNjZXNzXG4gICAgICBjb25zdCBzZXNzaW9uMiA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oJ2FjY2Vzcy10ZXN0Jyk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbjI/Lm1ldGFkYXRhLmFjY2Vzc0NvdW50KS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHNlc3Npb24yPy5tZXRhZGF0YS5sYXN0QWNjZXNzZWQpLnRvQmVHcmVhdGVyVGhhbihzZXNzaW9uMSEubWV0YWRhdGEubGFzdEFjY2Vzc2VkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHNlc3Npb24gZGF0YSBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCd1cGRhdGUtdGVzdCcsIHsgYTogMSwgYjogMiB9KTtcbiAgICAgIFxuICAgICAgLy8gTWVyZ2UgdXBkYXRlXG4gICAgICBjb25zdCB1cGRhdGVkMSA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLnVwZGF0ZVNlc3Npb24oJ3VwZGF0ZS10ZXN0JywgeyBiOiAzLCBjOiA0IH0pO1xuICAgICAgZXhwZWN0KHVwZGF0ZWQxLmRhdGEpLnRvRXF1YWwoeyBhOiAxLCBiOiAzLCBjOiA0IH0pO1xuICAgICAgXG4gICAgICAvLyBSZXBsYWNlIHVwZGF0ZVxuICAgICAgY29uc3QgdXBkYXRlZDIgPSBhd2FpdCBzZXNzaW9uTWFuYWdlci51cGRhdGVTZXNzaW9uKCd1cGRhdGUtdGVzdCcsIHsgeDogMTAgfSwgZmFsc2UpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWQyLmRhdGEpLnRvRXF1YWwoeyB4OiAxMCB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHVwZGF0ZWQyLm1ldGFkYXRhLmxhc3RNb2RpZmllZCkudG9CZUdyZWF0ZXJUaGFuKHVwZGF0ZWQxLm1ldGFkYXRhLmxhc3RNb2RpZmllZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXNzaW9uIGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbignZGVsZXRlLXRlc3QnLCB7IHRlbXBvcmFyeTogdHJ1ZSB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgZGVsZXRlZCA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmRlbGV0ZVNlc3Npb24oJ2RlbGV0ZS10ZXN0Jyk7XG4gICAgICBleHBlY3QoZGVsZXRlZCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmV0cmlldmVkID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbignZGVsZXRlLXRlc3QnKTtcbiAgICAgIGV4cGVjdChyZXRyaWV2ZWQpLnRvQmVOdWxsKCk7XG4gICAgICBcbiAgICAgIC8vIERlbGV0aW5nIG5vbi1leGlzdGVudCBzZXNzaW9uIHNob3VsZCByZXR1cm4gZmFsc2VcbiAgICAgIGNvbnN0IGRlbGV0ZWRBZ2FpbiA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmRlbGV0ZVNlc3Npb24oJ2RlbGV0ZS10ZXN0Jyk7XG4gICAgICBleHBlY3QoZGVsZXRlZEFnYWluKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbGlzdCBzZXNzaW9ucyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCd1c2VyMS1zZXNzaW9uJywge30sICd1c2VyMScpO1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbigndXNlcjItc2Vzc2lvbicsIHt9LCAndXNlcjInKTtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ3VzZXIxLXNlc3Npb24yJywge30sICd1c2VyMScpO1xuICAgICAgXG4gICAgICBjb25zdCBhbGxTZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmxpc3RTZXNzaW9ucygpO1xuICAgICAgZXhwZWN0KGFsbFNlc3Npb25zKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QoYWxsU2Vzc2lvbnMpLnRvQ29udGFpbigndXNlcjEtc2Vzc2lvbicpO1xuICAgICAgZXhwZWN0KGFsbFNlc3Npb25zKS50b0NvbnRhaW4oJ3VzZXIyLXNlc3Npb24nKTtcbiAgICAgIFxuICAgICAgY29uc3QgdXNlcjFTZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmxpc3RTZXNzaW9ucygndXNlcjEnKTtcbiAgICAgIGV4cGVjdCh1c2VyMVNlc3Npb25zKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QodXNlcjFTZXNzaW9ucykudG9Db250YWluKCd1c2VyMS1zZXNzaW9uJyk7XG4gICAgICBleHBlY3QodXNlcjFTZXNzaW9ucykudG9Db250YWluKCd1c2VyMS1zZXNzaW9uMicpO1xuICAgICAgZXhwZWN0KHVzZXIxU2Vzc2lvbnMpLm5vdC50b0NvbnRhaW4oJ3VzZXIyLXNlc3Npb24nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Nlc3Npb24gRXhwaXJhdGlvbiBhbmQgQ2xlYW51cCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4cGlyZWQgc2Vzc2lvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgc2Vzc2lvbiB3aXRoIHNob3J0IFRUTFxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ2V4cGlyZS10ZXN0Jywge30pO1xuICAgICAgc2Vzc2lvbi50dGwgPSBEYXRlLm5vdygpIC0gMTAwMDsgLy8gQWxyZWFkeSBleHBpcmVkXG4gICAgICBcbiAgICAgIC8vIE1hbnVhbGx5IHNldCB0aGUgZXhwaXJlZCBzZXNzaW9uXG4gICAgICAoc2Vzc2lvbk1hbmFnZXIgYXMgYW55KS5zZXNzaW9ucy5zZXQoJ2V4cGlyZS10ZXN0Jywgc2Vzc2lvbik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJldHJpZXZlZCA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oJ2V4cGlyZS10ZXN0Jyk7XG4gICAgICBleHBlY3QocmV0cmlldmVkKS50b0JlTnVsbCgpO1xuICAgICAgXG4gICAgICAvLyBTZXNzaW9uIHNob3VsZCBiZSBjbGVhbmVkIHVwXG4gICAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmxpc3RTZXNzaW9ucygpO1xuICAgICAgZXhwZWN0KHNlc3Npb25zKS5ub3QudG9Db250YWluKCdleHBpcmUtdGVzdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjbGVhbnVwIGV4cGlyZWQgc2Vzc2lvbnMgaW4gYmF0Y2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVkVGltZSA9IERhdGUubm93KCkgLSAxMDAwO1xuICAgICAgXG4gICAgICAvLyBDcmVhdGUgZXhwaXJlZCBzZXNzaW9uc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oYGV4cGlyZWQtJHtpfWAsIHt9KTtcbiAgICAgICAgc2Vzc2lvbi50dGwgPSBleHBpcmVkVGltZTtcbiAgICAgICAgKHNlc3Npb25NYW5hZ2VyIGFzIGFueSkuc2Vzc2lvbnMuc2V0KGBleHBpcmVkLSR7aX1gLCBzZXNzaW9uKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGFjdGl2ZSBzZXNzaW9uXG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdhY3RpdmUnLCB7fSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNsZWFuZWRDb3VudCA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNsZWFudXBFeHBpcmVkU2Vzc2lvbnMoKTtcbiAgICAgIGV4cGVjdChjbGVhbmVkQ291bnQpLnRvQmUoNSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlbWFpbmluZ1Nlc3Npb25zID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIubGlzdFNlc3Npb25zKCk7XG4gICAgICBleHBlY3QocmVtYWluaW5nU2Vzc2lvbnMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZW1haW5pbmdTZXNzaW9ucykudG9Db250YWluKCdhY3RpdmUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNlc3Npb24gbGltaXQgYnkgY2xlYW5pbmcgb2xkZXN0IHNlc3Npb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0IGxvdyBsaW1pdCBmb3IgdGVzdGluZ1xuICAgICAgKHNlc3Npb25NYW5hZ2VyIGFzIGFueSkubWF4U2Vzc2lvbnMgPSAzO1xuICAgICAgXG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzZXNzaW9uLTEnLCB7fSk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzZXNzaW9uLTInLCB7fSk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzZXNzaW9uLTMnLCB7fSk7XG4gICAgICBcbiAgICAgIC8vIEFkZGluZyA0dGggc2Vzc2lvbiBzaG91bGQgdHJpZ2dlciBjbGVhbnVwXG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzZXNzaW9uLTQnLCB7fSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNlc3Npb25zID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIubGlzdFNlc3Npb25zKCk7XG4gICAgICBleHBlY3Qoc2Vzc2lvbnMubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKDMpO1xuICAgICAgZXhwZWN0KHNlc3Npb25zKS50b0NvbnRhaW4oJ3Nlc3Npb24tNCcpOyAvLyBOZXdlc3Qgc2hvdWxkIHJlbWFpblxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2Vzc2lvbiBTdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc2Vzc2lvbiBzdGF0aXN0aWNzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBzb21lIHRlc3Qgc2Vzc2lvbnNcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ3N0YXRzLTEnLCB7IGRhdGE6ICdzbWFsbCcgfSk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzdGF0cy0yJywgeyBkYXRhOiAnbGFyZ2VyIGRhdGEgY29udGVudCcgfSk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBleHBpcmVkIHNlc3Npb25cbiAgICAgIGNvbnN0IGV4cGlyZWRTZXNzaW9uID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbignc3RhdHMtZXhwaXJlZCcsIHt9KTtcbiAgICAgIGV4cGlyZWRTZXNzaW9uLnR0bCA9IERhdGUubm93KCkgLSAxMDAwO1xuICAgICAgKHNlc3Npb25NYW5hZ2VyIGFzIGFueSkuc2Vzc2lvbnMuc2V0KCdzdGF0cy1leHBpcmVkJywgZXhwaXJlZFNlc3Npb24pO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmdldFN0YXRzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFNlc3Npb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmFjdGl2ZVNlc3Npb25zKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmV4cGlyZWRTZXNzaW9ucykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFNpemUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0V2ZW50IEVtaXNzaW9uJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IGV2ZW50cyBmb3Igc2Vzc2lvbiBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgXG4gICAgICBzZXNzaW9uTWFuYWdlci5vbignc2Vzc2lvbkNyZWF0ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICBldmVudHMucHVzaChgY3JlYXRlZDoke2RhdGEuc2Vzc2lvbklkfWApO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHNlc3Npb25NYW5hZ2VyLm9uKCdzZXNzaW9uQWNjZXNzZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICBldmVudHMucHVzaChgYWNjZXNzZWQ6JHtkYXRhLnNlc3Npb25JZH1gKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBzZXNzaW9uTWFuYWdlci5vbignc2Vzc2lvblVwZGF0ZWQnLCAoZGF0YSkgPT4ge1xuICAgICAgICBldmVudHMucHVzaChgdXBkYXRlZDoke2RhdGEuc2Vzc2lvbklkfWApO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHNlc3Npb25NYW5hZ2VyLm9uKCdzZXNzaW9uRGVsZXRlZCcsIChkYXRhKSA9PiB7XG4gICAgICAgIGV2ZW50cy5wdXNoKGBkZWxldGVkOiR7ZGF0YS5zZXNzaW9uSWR9YCk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbignZXZlbnQtdGVzdCcsIHt9KTtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oJ2V2ZW50LXRlc3QnKTtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLnVwZGF0ZVNlc3Npb24oJ2V2ZW50LXRlc3QnLCB7IHVwZGF0ZWQ6IHRydWUgfSk7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5kZWxldGVTZXNzaW9uKCdldmVudC10ZXN0Jyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChldmVudHMpLnRvQ29udGFpbignY3JlYXRlZDpldmVudC10ZXN0Jyk7XG4gICAgICBleHBlY3QoZXZlbnRzKS50b0NvbnRhaW4oJ2FjY2Vzc2VkOmV2ZW50LXRlc3QnKTtcbiAgICAgIGV4cGVjdChldmVudHMpLnRvQ29udGFpbigndXBkYXRlZDpldmVudC10ZXN0Jyk7XG4gICAgICBleHBlY3QoZXZlbnRzKS50b0NvbnRhaW4oJ2RlbGV0ZWQ6ZXZlbnQtdGVzdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IGNsZWFudXAgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGNsZWFudXBFdmVudDogYW55ID0gbnVsbDtcbiAgICAgIFxuICAgICAgc2Vzc2lvbk1hbmFnZXIub24oJ3Nlc3Npb25zQ2xlYW5lZFVwJywgKGRhdGEpID0+IHtcbiAgICAgICAgY2xlYW51cEV2ZW50ID0gZGF0YTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNsZWFudXBFeHBpcmVkU2Vzc2lvbnMoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGNsZWFudXBFdmVudCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChjbGVhbnVwRXZlbnQuY291bnQpLnRvQmUoY291bnQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29uY3VycmVudCBPcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBzZXNzaW9uIGNyZWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlUHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgaSkgPT5cbiAgICAgICAgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbihgY29uY3VycmVudC0ke2l9YCwgeyBpbmRleDogaSB9KVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCBQcm9taXNlLmFsbChjcmVhdGVQcm9taXNlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzZXNzaW9ucykudG9IYXZlTGVuZ3RoKDEwKTtcbiAgICAgIHNlc3Npb25zLmZvckVhY2goKHNlc3Npb24sIGluZGV4KSA9PiB7XG4gICAgICAgIGV4cGVjdChzZXNzaW9uLnNlc3Npb25JZCkudG9CZShgY29uY3VycmVudC0ke2luZGV4fWApO1xuICAgICAgICBleHBlY3Qoc2Vzc2lvbi5kYXRhLmluZGV4KS50b0JlKGluZGV4KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBhY2Nlc3MgdG8gc2FtZSBzZXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc2Vzc2lvbk1hbmFnZXIuY3JlYXRlU2Vzc2lvbignY29uY3VycmVudC1hY2Nlc3MnLCB7IGNvdW50ZXI6IDAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGFjY2Vzc1Byb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogNSB9LCAoKSA9PlxuICAgICAgICBzZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uKCdjb25jdXJyZW50LWFjY2VzcycpXG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoYWNjZXNzUHJvbWlzZXMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDUpO1xuICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQhLnNlc3Npb25JZCkudG9CZSgnY29uY3VycmVudC1hY2Nlc3MnKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBGaW5hbCBhY2Nlc3MgY291bnQgc2hvdWxkIHJlZmxlY3QgYWxsIGFjY2Vzc2VzXG4gICAgICBjb25zdCBmaW5hbFNlc3Npb24gPSBhd2FpdCBzZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uKCdjb25jdXJyZW50LWFjY2VzcycpO1xuICAgICAgZXhwZWN0KGZpbmFsU2Vzc2lvbiEubWV0YWRhdGEuYWNjZXNzQ291bnQpLnRvQmVHcmVhdGVyVGhhbig1KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1peGVkIGNvbmN1cnJlbnQgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oJ21peGVkLW9wcycsIHsgdmFsdWU6IDAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSBbXG4gICAgICAgICgpID0+IHNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oJ21peGVkLW9wcycpLFxuICAgICAgICAoKSA9PiBzZXNzaW9uTWFuYWdlci51cGRhdGVTZXNzaW9uKCdtaXhlZC1vcHMnLCB7IHZhbHVlOiAxIH0pLFxuICAgICAgICAoKSA9PiBzZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uKCdtaXhlZC1vcHMnKSxcbiAgICAgICAgKCkgPT4gc2Vzc2lvbk1hbmFnZXIudXBkYXRlU2Vzc2lvbignbWl4ZWQtb3BzJywgeyB2YWx1ZTogMiB9KSxcbiAgICAgICAgKCkgPT4gc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbignbWl4ZWQtb3BzJylcbiAgICAgIF07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChvcGVyYXRpb25zLm1hcChvcCA9PiBvcCgpKSk7XG4gICAgICBcbiAgICAgIC8vIEFsbCBvcGVyYXRpb25zIHNob3VsZCBjb21wbGV0ZSBzdWNjZXNzZnVsbHlcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoNSk7XG4gICAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTWVtb3J5IE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRyYWNrIG1lbW9yeSB1c2FnZSBhY2N1cmF0ZWx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbGFyZ2VEYXRhID0geyBjb250ZW50OiAneCcucmVwZWF0KDEwMDAwKSB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdtZW1vcnktdGVzdCcsIGxhcmdlRGF0YSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFNpemUpLnRvQmVHcmVhdGVyVGhhbigxMDAwMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uKCdtZW1vcnktdGVzdCcpO1xuICAgICAgZXhwZWN0KHNlc3Npb24hLm1ldGFkYXRhLnNpemUpLnRvQmVHcmVhdGVyVGhhbigxMDAwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBzaXplIHdoZW4gc2Vzc2lvbiBkYXRhIGNoYW5nZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKCdzaXplLXRlc3QnLCB7IHNtYWxsOiAnZGF0YScgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGluaXRpYWxTZXNzaW9uID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbignc2l6ZS10ZXN0Jyk7XG4gICAgICBjb25zdCBpbml0aWFsU2l6ZSA9IGluaXRpYWxTZXNzaW9uIS5tZXRhZGF0YS5zaXplO1xuICAgICAgXG4gICAgICBhd2FpdCBzZXNzaW9uTWFuYWdlci51cGRhdGVTZXNzaW9uKCdzaXplLXRlc3QnLCB7IFxuICAgICAgICBsYXJnZTogJ3gnLnJlcGVhdCg1MDAwKSxcbiAgICAgICAgYWRkaXRpb25hbDogJ3knLnJlcGVhdCgzMDAwKVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWRTZXNzaW9uID0gYXdhaXQgc2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbignc2l6ZS10ZXN0Jyk7XG4gICAgICBleHBlY3QodXBkYXRlZFNlc3Npb24hLm1ldGFkYXRhLnNpemUpLnRvQmVHcmVhdGVyVGhhbihpbml0aWFsU2l6ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9