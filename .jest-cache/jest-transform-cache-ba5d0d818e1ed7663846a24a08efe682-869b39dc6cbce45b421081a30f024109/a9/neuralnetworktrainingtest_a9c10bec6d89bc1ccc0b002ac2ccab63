e091914733bae7626876f462e738dcb9
/**
 * Classical TDD (Detroit School) - Neural Network Training Tests
 *
 * Focus: Test actual results and mathematical correctness
 * No mocks - verify real computations
 */
import { describe, it, expect } from '@jest/globals';
// Example neural network implementation (would be imported from actual code)
class NeuralNetwork {
    layers;
    weights;
    biases;
    constructor(layers) {
        this.layers = layers;
        this.initializeWeights();
    }
    initializeWeights() {
        this.weights = [];
        this.biases = [];
        for (let i = 1; i < this.layers.length; i++) {
            const layerWeights = [];
            const layerBiases = [];
            for (let j = 0; j < this.layers[i]; j++) {
                const neuronWeights = [];
                for (let k = 0; k < this.layers[i - 1]; k++) {
                    // Xavier initialization
                    const limit = Math.sqrt(6 / (this.layers[i - 1] + this.layers[i]));
                    neuronWeights.push((Math.random() * 2 - 1) * limit);
                }
                layerWeights.push(neuronWeights);
                layerBiases.push(0);
            }
            this.weights.push(layerWeights);
            this.biases.push(layerBiases);
        }
    }
    sigmoid(x) {
        return 1 / (1 + Math.exp(-x));
    }
    sigmoidDerivative(x) {
        return x * (1 - x);
    }
    predict(inputs) {
        let activation = inputs;
        for (let i = 0; i < this.weights.length; i++) {
            const newActivation = [];
            for (let j = 0; j < this.weights[i].length; j++) {
                let sum = this.biases[i][j];
                for (let k = 0; k < activation.length; k++) {
                    sum += activation[k] * this.weights[i][j][k];
                }
                newActivation.push(this.sigmoid(sum));
            }
            activation = newActivation;
        }
        return activation;
    }
    train(data, options) {
        const learningRate = options.learningRate || 0.5;
        let finalError = 0;
        for (let epoch = 0; epoch < options.epochs; epoch++) {
            let epochError = 0;
            for (const sample of data) {
                // Forward pass
                const activations = [sample.input];
                let activation = sample.input;
                for (let i = 0; i < this.weights.length; i++) {
                    const newActivation = [];
                    for (let j = 0; j < this.weights[i].length; j++) {
                        let sum = this.biases[i][j];
                        for (let k = 0; k < activation.length; k++) {
                            sum += activation[k] * this.weights[i][j][k];
                        }
                        newActivation.push(this.sigmoid(sum));
                    }
                    activation = newActivation;
                    activations.push(activation);
                }
                // Calculate error
                const output = activations[activations.length - 1];
                const errors = [];
                let error = output.map((o, i) => sample.output[i] - o);
                errors.unshift(error);
                epochError += error.reduce((sum, e) => sum + Math.abs(e), 0) / error.length;
                // Backpropagation
                for (let i = this.weights.length - 1; i > 0; i--) {
                    const newError = [];
                    for (let j = 0; j < this.weights[i - 1].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < this.weights[i].length; k++) {
                            sum += error[k] * this.weights[i][k][j];
                        }
                        newError.push(sum);
                    }
                    error = newError;
                    errors.unshift(error);
                }
                // Update weights and biases
                for (let i = 0; i < this.weights.length; i++) {
                    for (let j = 0; j < this.weights[i].length; j++) {
                        const delta = errors[i + 1][j] * this.sigmoidDerivative(activations[i + 1][j]);
                        for (let k = 0; k < this.weights[i][j].length; k++) {
                            this.weights[i][j][k] += learningRate * delta * activations[i][k];
                        }
                        this.biases[i][j] += learningRate * delta;
                    }
                }
            }
            finalError = epochError / data.length;
        }
        return { finalError };
    }
}
describe('Neural Network Training - Classical TDD', () => {
    describe('XOR Problem', () => {
        it('should learn XOR function with sufficient accuracy', () => {
            // Arrange
            const network = new NeuralNetwork([2, 4, 1]);
            const xorData = [
                { input: [0, 0], output: [0] },
                { input: [0, 1], output: [1] },
                { input: [1, 0], output: [1] },
                { input: [1, 1], output: [0] }
            ];
            // Act
            const result = network.train(xorData, { epochs: 5000, learningRate: 0.5 });
            // Assert - Test actual results
            expect(network.predict([0, 0])[0]).toBeCloseTo(0, 1);
            expect(network.predict([0, 1])[0]).toBeCloseTo(1, 1);
            expect(network.predict([1, 0])[0]).toBeCloseTo(1, 1);
            expect(network.predict([1, 1])[0]).toBeCloseTo(0, 1);
            expect(result.finalError).toBeLessThan(0.1);
        });
        it('should converge faster with higher learning rate', () => {
            // Test algorithm behavior, not mocks
            const network1 = new NeuralNetwork([2, 4, 1]);
            const network2 = new NeuralNetwork([2, 4, 1]);
            const xorData = [
                { input: [0, 0], output: [0] },
                { input: [0, 1], output: [1] },
                { input: [1, 0], output: [1] },
                { input: [1, 1], output: [0] }
            ];
            const result1 = network1.train(xorData, { epochs: 1000, learningRate: 0.1 });
            const result2 = network2.train(xorData, { epochs: 1000, learningRate: 0.8 });
            // Higher learning rate should achieve lower error in same epochs
            expect(result2.finalError).toBeLessThan(result1.finalError);
        });
    });
    describe('Linear Separability', () => {
        it('should learn AND function easily', () => {
            const network = new NeuralNetwork([2, 2, 1]);
            const andData = [
                { input: [0, 0], output: [0] },
                { input: [0, 1], output: [0] },
                { input: [1, 0], output: [0] },
                { input: [1, 1], output: [1] }
            ];
            const result = network.train(andData, { epochs: 1000 });
            // AND is linearly separable, should converge quickly
            expect(network.predict([0, 0])[0]).toBeCloseTo(0, 1);
            expect(network.predict([1, 1])[0]).toBeCloseTo(1, 1);
            expect(result.finalError).toBeLessThan(0.05);
        });
    });
    describe('Multi-class Classification', () => {
        it('should classify 3 distinct patterns', () => {
            const network = new NeuralNetwork([2, 5, 3]);
            const patterns = [
                { input: [0.1, 0.1], output: [1, 0, 0] }, // Class A
                { input: [0.9, 0.1], output: [0, 1, 0] }, // Class B
                { input: [0.5, 0.9], output: [0, 0, 1] }, // Class C
            ];
            network.train(patterns, { epochs: 2000 });
            // Test classification accuracy
            const predictA = network.predict([0.1, 0.1]);
            const predictB = network.predict([0.9, 0.1]);
            const predictC = network.predict([0.5, 0.9]);
            // Class A should have highest activation in first output
            expect(predictA[0]).toBeGreaterThan(predictA[1]);
            expect(predictA[0]).toBeGreaterThan(predictA[2]);
            // Class B should have highest activation in second output
            expect(predictB[1]).toBeGreaterThan(predictB[0]);
            expect(predictB[1]).toBeGreaterThan(predictB[2]);
            // Class C should have highest activation in third output
            expect(predictC[2]).toBeGreaterThan(predictC[0]);
            expect(predictC[2]).toBeGreaterThan(predictC[1]);
        });
    });
    describe('Gradient Descent Properties', () => {
        it('should reduce error monotonically with sufficient small learning rate', () => {
            const network = new NeuralNetwork([2, 3, 1]);
            const data = [
                { input: [0.2, 0.3], output: [0.5] },
                { input: [0.4, 0.6], output: [0.8] },
                { input: [0.7, 0.2], output: [0.3] }
            ];
            const errors = [];
            // Track error over epochs
            for (let i = 0; i < 10; i++) {
                const result = network.train(data, { epochs: 100, learningRate: 0.1 });
                errors.push(result.finalError);
            }
            // Error should generally decrease (allowing for small fluctuations)
            let decreasing = 0;
            for (let i = 1; i < errors.length; i++) {
                if (errors[i] <= errors[i - 1])
                    decreasing++;
            }
            expect(decreasing).toBeGreaterThan(errors.length * 0.7); // 70% should be decreasing
        });
    });
});
/**
 * Classical TDD Principles Demonstrated:
 *
 * 1. No mocks - testing actual neural network behavior
 * 2. Focus on mathematical correctness and convergence
 * 3. Test algorithm properties (gradient descent, separability)
 * 4. Verify computation results, not interactions
 * 5. Performance and accuracy are the key metrics
 *
 * This is ideal for:
 * - Neural network algorithms
 * - Mathematical computations
 * - Data transformations
 * - Performance-critical code
 */ 
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vdW5pdC9jbGFzc2ljYWwvbmV1cmFsLWFsZ29yaXRobXMvbmV1cmFsLW5ldHdvcmstdHJhaW5pbmcudGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQUVILE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBYyxNQUFNLGVBQWUsQ0FBQztBQUVqRSw2RUFBNkU7QUFDN0UsTUFBTSxhQUFhO0lBSUc7SUFIWixPQUFPLENBQWU7SUFDdEIsTUFBTSxDQUFhO0lBRTNCLFlBQW9CLE1BQWdCO1FBQWhCLFdBQU0sR0FBTixNQUFNLENBQVU7UUFDbEMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDM0IsQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUVqQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUM1QyxNQUFNLFlBQVksR0FBZSxFQUFFLENBQUM7WUFDcEMsTUFBTSxXQUFXLEdBQWEsRUFBRSxDQUFDO1lBRWpDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3hDLE1BQU0sYUFBYSxHQUFhLEVBQUUsQ0FBQztnQkFDbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQzVDLHdCQUF3QjtvQkFDeEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUks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RCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQywyQkFBMkI7UUFDdEYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUg7Ozs7Ozs7Ozs7Ozs7O0dBY0ciLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vdW5pdC9jbGFzc2ljYWwvbmV1cmFsLWFsZ29yaXRobXMvbmV1cmFsLW5ldHdvcmstdHJhaW5pbmcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENsYXNzaWNhbCBUREQgKERldHJvaXQgU2Nob29sKSAtIE5ldXJhbCBOZXR3b3JrIFRyYWluaW5nIFRlc3RzXG4gKiBcbiAqIEZvY3VzOiBUZXN0IGFjdHVhbCByZXN1bHRzIGFuZCBtYXRoZW1hdGljYWwgY29ycmVjdG5lc3NcbiAqIE5vIG1vY2tzIC0gdmVyaWZ5IHJlYWwgY29tcHV0YXRpb25zXG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8gRXhhbXBsZSBuZXVyYWwgbmV0d29yayBpbXBsZW1lbnRhdGlvbiAod291bGQgYmUgaW1wb3J0ZWQgZnJvbSBhY3R1YWwgY29kZSlcbmNsYXNzIE5ldXJhbE5ldHdvcmsge1xuICBwcml2YXRlIHdlaWdodHM6IG51bWJlcltdW11bXTtcbiAgcHJpdmF0ZSBiaWFzZXM6IG51bWJlcltdW107XG4gIFxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxheWVyczogbnVtYmVyW10pIHtcbiAgICB0aGlzLmluaXRpYWxpemVXZWlnaHRzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVXZWlnaHRzKCkge1xuICAgIHRoaXMud2VpZ2h0cyA9IFtdO1xuICAgIHRoaXMuYmlhc2VzID0gW107XG4gICAgXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbGF5ZXJXZWlnaHRzOiBudW1iZXJbXVtdID0gW107XG4gICAgICBjb25zdCBsYXllckJpYXNlczogbnVtYmVyW10gPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmxheWVyc1tpXTsgaisrKSB7XG4gICAgICAgIGNvbnN0IG5ldXJvbldlaWdodHM6IG51bWJlcltdID0gW107XG4gICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdGhpcy5sYXllcnNbaSAtIDFdOyBrKyspIHtcbiAgICAgICAgICAvLyBYYXZpZXIgaW5pdGlhbGl6YXRpb25cbiAgICAgICAgICBjb25zdCBsaW1pdCA9IE1hdGguc3FydCg2IC8gKHRoaXMubGF5ZXJzW2kgLSAxXSArIHRoaXMubGF5ZXJzW2ldKSk7XG4gICAgICAgICAgbmV1cm9uV2VpZ2h0cy5wdXNoKChNYXRoLnJhbmRvbSgpICogMiAtIDEpICogbGltaXQpO1xuICAgICAgICB9XG4gICAgICAgIGxheWVyV2VpZ2h0cy5wdXNoKG5ldXJvbldlaWdodHMpO1xuICAgICAgICBsYXllckJpYXNlcy5wdXNoKDApO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLndlaWdodHMucHVzaChsYXllcldlaWdodHMpO1xuICAgICAgdGhpcy5iaWFzZXMucHVzaChsYXllckJpYXNlcyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaWdtb2lkKHg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIDEgLyAoMSArIE1hdGguZXhwKC14KSk7XG4gIH1cblxuICBwcml2YXRlIHNpZ21vaWREZXJpdmF0aXZlKHg6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIHggKiAoMSAtIHgpO1xuICB9XG5cbiAgcHJlZGljdChpbnB1dHM6IG51bWJlcltdKTogbnVtYmVyW10ge1xuICAgIGxldCBhY3RpdmF0aW9uID0gaW5wdXRzO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53ZWlnaHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBuZXdBY3RpdmF0aW9uOiBudW1iZXJbXSA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMud2VpZ2h0c1tpXS5sZW5ndGg7IGorKykge1xuICAgICAgICBsZXQgc3VtID0gdGhpcy5iaWFzZXNbaV1bal07XG4gICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYWN0aXZhdGlvbi5sZW5ndGg7IGsrKykge1xuICAgICAgICAgIHN1bSArPSBhY3RpdmF0aW9uW2tdICogdGhpcy53ZWlnaHRzW2ldW2pdW2tdO1xuICAgICAgICB9XG4gICAgICAgIG5ld0FjdGl2YXRpb24ucHVzaCh0aGlzLnNpZ21vaWQoc3VtKSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGFjdGl2YXRpb24gPSBuZXdBY3RpdmF0aW9uO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYWN0aXZhdGlvbjtcbiAgfVxuXG4gIHRyYWluKGRhdGE6IEFycmF5PHtpbnB1dDogbnVtYmVyW10sIG91dHB1dDogbnVtYmVyW119Piwgb3B0aW9uczoge2Vwb2NoczogbnVtYmVyLCBsZWFybmluZ1JhdGU/OiBudW1iZXJ9KSB7XG4gICAgY29uc3QgbGVhcm5pbmdSYXRlID0gb3B0aW9ucy5sZWFybmluZ1JhdGUgfHwgMC41O1xuICAgIGxldCBmaW5hbEVycm9yID0gMDtcbiAgICBcbiAgICBmb3IgKGxldCBlcG9jaCA9IDA7IGVwb2NoIDwgb3B0aW9ucy5lcG9jaHM7IGVwb2NoKyspIHtcbiAgICAgIGxldCBlcG9jaEVycm9yID0gMDtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBzYW1wbGUgb2YgZGF0YSkge1xuICAgICAgICAvLyBGb3J3YXJkIHBhc3NcbiAgICAgICAgY29uc3QgYWN0aXZhdGlvbnM6IG51bWJlcltdW10gPSBbc2FtcGxlLmlucHV0XTtcbiAgICAgICAgbGV0IGFjdGl2YXRpb24gPSBzYW1wbGUuaW5wdXQ7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMud2VpZ2h0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IG5ld0FjdGl2YXRpb246IG51bWJlcltdID0gW107XG4gICAgICAgICAgXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLndlaWdodHNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGxldCBzdW0gPSB0aGlzLmJpYXNlc1tpXVtqXTtcbiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYWN0aXZhdGlvbi5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgICBzdW0gKz0gYWN0aXZhdGlvbltrXSAqIHRoaXMud2VpZ2h0c1tpXVtqXVtrXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld0FjdGl2YXRpb24ucHVzaCh0aGlzLnNpZ21vaWQoc3VtKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGFjdGl2YXRpb24gPSBuZXdBY3RpdmF0aW9uO1xuICAgICAgICAgIGFjdGl2YXRpb25zLnB1c2goYWN0aXZhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENhbGN1bGF0ZSBlcnJvclxuICAgICAgICBjb25zdCBvdXRwdXQgPSBhY3RpdmF0aW9uc1thY3RpdmF0aW9ucy5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgZXJyb3JzOiBudW1iZXJbXVtdID0gW107XG4gICAgICAgIGxldCBlcnJvciA9IG91dHB1dC5tYXAoKG8sIGkpID0+IHNhbXBsZS5vdXRwdXRbaV0gLSBvKTtcbiAgICAgICAgZXJyb3JzLnVuc2hpZnQoZXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgZXBvY2hFcnJvciArPSBlcnJvci5yZWR1Y2UoKHN1bSwgZSkgPT4gc3VtICsgTWF0aC5hYnMoZSksIDApIC8gZXJyb3IubGVuZ3RoO1xuICAgICAgICBcbiAgICAgICAgLy8gQmFja3Byb3BhZ2F0aW9uXG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLndlaWdodHMubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xuICAgICAgICAgIGNvbnN0IG5ld0Vycm9yOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICAgIFxuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy53ZWlnaHRzW2kgLSAxXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgbGV0IHN1bSA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRoaXMud2VpZ2h0c1tpXS5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgICBzdW0gKz0gZXJyb3Jba10gKiB0aGlzLndlaWdodHNbaV1ba11bal07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdFcnJvci5wdXNoKHN1bSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGVycm9yID0gbmV3RXJyb3I7XG4gICAgICAgICAgZXJyb3JzLnVuc2hpZnQoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgd2VpZ2h0cyBhbmQgYmlhc2VzXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy53ZWlnaHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLndlaWdodHNbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZXJyb3JzW2kgKyAxXVtqXSAqIHRoaXMuc2lnbW9pZERlcml2YXRpdmUoYWN0aXZhdGlvbnNbaSArIDFdW2pdKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLndlaWdodHNbaV1bal0ubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgdGhpcy53ZWlnaHRzW2ldW2pdW2tdICs9IGxlYXJuaW5nUmF0ZSAqIGRlbHRhICogYWN0aXZhdGlvbnNbaV1ba107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMuYmlhc2VzW2ldW2pdICs9IGxlYXJuaW5nUmF0ZSAqIGRlbHRhO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBmaW5hbEVycm9yID0gZXBvY2hFcnJvciAvIGRhdGEubGVuZ3RoO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBmaW5hbEVycm9yIH07XG4gIH1cbn1cblxuZGVzY3JpYmUoJ05ldXJhbCBOZXR3b3JrIFRyYWluaW5nIC0gQ2xhc3NpY2FsIFRERCcsICgpID0+IHtcbiAgZGVzY3JpYmUoJ1hPUiBQcm9ibGVtJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbGVhcm4gWE9SIGZ1bmN0aW9uIHdpdGggc3VmZmljaWVudCBhY2N1cmFjeScsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG5ldHdvcmsgPSBuZXcgTmV1cmFsTmV0d29yayhbMiwgNCwgMV0pO1xuICAgICAgY29uc3QgeG9yRGF0YSA9IFtcbiAgICAgICAgeyBpbnB1dDogWzAsIDBdLCBvdXRwdXQ6IFswXSB9LFxuICAgICAgICB7IGlucHV0OiBbMCwgMV0sIG91dHB1dDogWzFdIH0sXG4gICAgICAgIHsgaW5wdXQ6IFsxLCAwXSwgb3V0cHV0OiBbMV0gfSxcbiAgICAgICAgeyBpbnB1dDogWzEsIDFdLCBvdXRwdXQ6IFswXSB9XG4gICAgICBdO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldHdvcmsudHJhaW4oeG9yRGF0YSwgeyBlcG9jaHM6IDUwMDAsIGxlYXJuaW5nUmF0ZTogMC41IH0pO1xuXG4gICAgICAvLyBBc3NlcnQgLSBUZXN0IGFjdHVhbCByZXN1bHRzXG4gICAgICBleHBlY3QobmV0d29yay5wcmVkaWN0KFswLCAwXSlbMF0pLnRvQmVDbG9zZVRvKDAsIDEpO1xuICAgICAgZXhwZWN0KG5ldHdvcmsucHJlZGljdChbMCwgMV0pWzBdKS50b0JlQ2xvc2VUbygxLCAxKTtcbiAgICAgIGV4cGVjdChuZXR3b3JrLnByZWRpY3QoWzEsIDBdKVswXSkudG9CZUNsb3NlVG8oMSwgMSk7XG4gICAgICBleHBlY3QobmV0d29yay5wcmVkaWN0KFsxLCAxXSlbMF0pLnRvQmVDbG9zZVRvKDAsIDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maW5hbEVycm9yKS50b0JlTGVzc1RoYW4oMC4xKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29udmVyZ2UgZmFzdGVyIHdpdGggaGlnaGVyIGxlYXJuaW5nIHJhdGUnLCAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGFsZ29yaXRobSBiZWhhdmlvciwgbm90IG1vY2tzXG4gICAgICBjb25zdCBuZXR3b3JrMSA9IG5ldyBOZXVyYWxOZXR3b3JrKFsyLCA0LCAxXSk7XG4gICAgICBjb25zdCBuZXR3b3JrMiA9IG5ldyBOZXVyYWxOZXR3b3JrKFsyLCA0LCAxXSk7XG4gICAgICBjb25zdCB4b3JEYXRhID0gW1xuICAgICAgICB7IGlucHV0OiBbMCwgMF0sIG91dHB1dDogWzBdIH0sXG4gICAgICAgIHsgaW5wdXQ6IFswLCAxXSwgb3V0cHV0OiBbMV0gfSxcbiAgICAgICAgeyBpbnB1dDogWzEsIDBdLCBvdXRwdXQ6IFsxXSB9LFxuICAgICAgICB7IGlucHV0OiBbMSwgMV0sIG91dHB1dDogWzBdIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBuZXR3b3JrMS50cmFpbih4b3JEYXRhLCB7IGVwb2NoczogMTAwMCwgbGVhcm5pbmdSYXRlOiAwLjEgfSk7XG4gICAgICBjb25zdCByZXN1bHQyID0gbmV0d29yazIudHJhaW4oeG9yRGF0YSwgeyBlcG9jaHM6IDEwMDAsIGxlYXJuaW5nUmF0ZTogMC44IH0pO1xuXG4gICAgICAvLyBIaWdoZXIgbGVhcm5pbmcgcmF0ZSBzaG91bGQgYWNoaWV2ZSBsb3dlciBlcnJvciBpbiBzYW1lIGVwb2Noc1xuICAgICAgZXhwZWN0KHJlc3VsdDIuZmluYWxFcnJvcikudG9CZUxlc3NUaGFuKHJlc3VsdDEuZmluYWxFcnJvcik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdMaW5lYXIgU2VwYXJhYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbGVhcm4gQU5EIGZ1bmN0aW9uIGVhc2lseScsICgpID0+IHtcbiAgICAgIGNvbnN0IG5ldHdvcmsgPSBuZXcgTmV1cmFsTmV0d29yayhbMiwgMiwgMV0pO1xuICAgICAgY29uc3QgYW5kRGF0YSA9IFtcbiAgICAgICAgeyBpbnB1dDogWzAsIDBdLCBvdXRwdXQ6IFswXSB9LFxuICAgICAgICB7IGlucHV0OiBbMCwgMV0sIG91dHB1dDogWzBdIH0sXG4gICAgICAgIHsgaW5wdXQ6IFsxLCAwXSwgb3V0cHV0OiBbMF0gfSxcbiAgICAgICAgeyBpbnB1dDogWzEsIDFdLCBvdXRwdXQ6IFsxXSB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBuZXR3b3JrLnRyYWluKGFuZERhdGEsIHsgZXBvY2hzOiAxMDAwIH0pO1xuXG4gICAgICAvLyBBTkQgaXMgbGluZWFybHkgc2VwYXJhYmxlLCBzaG91bGQgY29udmVyZ2UgcXVpY2tseVxuICAgICAgZXhwZWN0KG5ldHdvcmsucHJlZGljdChbMCwgMF0pWzBdKS50b0JlQ2xvc2VUbygwLCAxKTtcbiAgICAgIGV4cGVjdChuZXR3b3JrLnByZWRpY3QoWzEsIDFdKVswXSkudG9CZUNsb3NlVG8oMSwgMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpbmFsRXJyb3IpLnRvQmVMZXNzVGhhbigwLjA1KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ011bHRpLWNsYXNzIENsYXNzaWZpY2F0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2xhc3NpZnkgMyBkaXN0aW5jdCBwYXR0ZXJucycsICgpID0+IHtcbiAgICAgIGNvbnN0IG5ldHdvcmsgPSBuZXcgTmV1cmFsTmV0d29yayhbMiwgNSwgM10pO1xuICAgICAgY29uc3QgcGF0dGVybnMgPSBbXG4gICAgICAgIHsgaW5wdXQ6IFswLjEsIDAuMV0sIG91dHB1dDogWzEsIDAsIDBdIH0sIC8vIENsYXNzIEFcbiAgICAgICAgeyBpbnB1dDogWzAuOSwgMC4xXSwgb3V0cHV0OiBbMCwgMSwgMF0gfSwgLy8gQ2xhc3MgQlxuICAgICAgICB7IGlucHV0OiBbMC41LCAwLjldLCBvdXRwdXQ6IFswLCAwLCAxXSB9LCAvLyBDbGFzcyBDXG4gICAgICBdO1xuXG4gICAgICBuZXR3b3JrLnRyYWluKHBhdHRlcm5zLCB7IGVwb2NoczogMjAwMCB9KTtcblxuICAgICAgLy8gVGVzdCBjbGFzc2lmaWNhdGlvbiBhY2N1cmFjeVxuICAgICAgY29uc3QgcHJlZGljdEEgPSBuZXR3b3JrLnByZWRpY3QoWzAuMSwgMC4xXSk7XG4gICAgICBjb25zdCBwcmVkaWN0QiA9IG5ldHdvcmsucHJlZGljdChbMC45LCAwLjFdKTtcbiAgICAgIGNvbnN0IHByZWRpY3RDID0gbmV0d29yay5wcmVkaWN0KFswLjUsIDAuOV0pO1xuXG4gICAgICAvLyBDbGFzcyBBIHNob3VsZCBoYXZlIGhpZ2hlc3QgYWN0aXZhdGlvbiBpbiBmaXJzdCBvdXRwdXRcbiAgICAgIGV4cGVjdChwcmVkaWN0QVswXSkudG9CZUdyZWF0ZXJUaGFuKHByZWRpY3RBWzFdKTtcbiAgICAgIGV4cGVjdChwcmVkaWN0QVswXSkudG9CZUdyZWF0ZXJUaGFuKHByZWRpY3RBWzJdKTtcblxuICAgICAgLy8gQ2xhc3MgQiBzaG91bGQgaGF2ZSBoaWdoZXN0IGFjdGl2YXRpb24gaW4gc2Vjb25kIG91dHB1dFxuICAgICAgZXhwZWN0KHByZWRpY3RCWzFdKS50b0JlR3JlYXRlclRoYW4ocHJlZGljdEJbMF0pO1xuICAgICAgZXhwZWN0KHByZWRpY3RCWzFdKS50b0JlR3JlYXRlclRoYW4ocHJlZGljdEJbMl0pO1xuXG4gICAgICAvLyBDbGFzcyBDIHNob3VsZCBoYXZlIGhpZ2hlc3QgYWN0aXZhdGlvbiBpbiB0aGlyZCBvdXRwdXRcbiAgICAgIGV4cGVjdChwcmVkaWN0Q1syXSkudG9CZUdyZWF0ZXJUaGFuKHByZWRpY3RDWzBdKTtcbiAgICAgIGV4cGVjdChwcmVkaWN0Q1syXSkudG9CZUdyZWF0ZXJUaGFuKHByZWRpY3RDWzFdKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dyYWRpZW50IERlc2NlbnQgUHJvcGVydGllcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZHVjZSBlcnJvciBtb25vdG9uaWNhbGx5IHdpdGggc3VmZmljaWVudCBzbWFsbCBsZWFybmluZyByYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgbmV0d29yayA9IG5ldyBOZXVyYWxOZXR3b3JrKFsyLCAzLCAxXSk7XG4gICAgICBjb25zdCBkYXRhID0gW1xuICAgICAgICB7IGlucHV0OiBbMC4yLCAwLjNdLCBvdXRwdXQ6IFswLjVdIH0sXG4gICAgICAgIHsgaW5wdXQ6IFswLjQsIDAuNl0sIG91dHB1dDogWzAuOF0gfSxcbiAgICAgICAgeyBpbnB1dDogWzAuNywgMC4yXSwgb3V0cHV0OiBbMC4zXSB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCBlcnJvcnM6IG51bWJlcltdID0gW107XG4gICAgICBcbiAgICAgIC8vIFRyYWNrIGVycm9yIG92ZXIgZXBvY2hzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV0d29yay50cmFpbihkYXRhLCB7IGVwb2NoczogMTAwLCBsZWFybmluZ1JhdGU6IDAuMSB9KTtcbiAgICAgICAgZXJyb3JzLnB1c2gocmVzdWx0LmZpbmFsRXJyb3IpO1xuICAgICAgfVxuXG4gICAgICAvLyBFcnJvciBzaG91bGQgZ2VuZXJhbGx5IGRlY3JlYXNlIChhbGxvd2luZyBmb3Igc21hbGwgZmx1Y3R1YXRpb25zKVxuICAgICAgbGV0IGRlY3JlYXNpbmcgPSAwO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBlcnJvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGVycm9yc1tpXSA8PSBlcnJvcnNbaSAtIDFdKSBkZWNyZWFzaW5nKys7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGV4cGVjdChkZWNyZWFzaW5nKS50b0JlR3JlYXRlclRoYW4oZXJyb3JzLmxlbmd0aCAqIDAuNyk7IC8vIDcwJSBzaG91bGQgYmUgZGVjcmVhc2luZ1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG4vKipcbiAqIENsYXNzaWNhbCBUREQgUHJpbmNpcGxlcyBEZW1vbnN0cmF0ZWQ6XG4gKiBcbiAqIDEuIE5vIG1vY2tzIC0gdGVzdGluZyBhY3R1YWwgbmV1cmFsIG5ldHdvcmsgYmVoYXZpb3JcbiAqIDIuIEZvY3VzIG9uIG1hdGhlbWF0aWNhbCBjb3JyZWN0bmVzcyBhbmQgY29udmVyZ2VuY2VcbiAqIDMuIFRlc3QgYWxnb3JpdGhtIHByb3BlcnRpZXMgKGdyYWRpZW50IGRlc2NlbnQsIHNlcGFyYWJpbGl0eSlcbiAqIDQuIFZlcmlmeSBjb21wdXRhdGlvbiByZXN1bHRzLCBub3QgaW50ZXJhY3Rpb25zXG4gKiA1LiBQZXJmb3JtYW5jZSBhbmQgYWNjdXJhY3kgYXJlIHRoZSBrZXkgbWV0cmljc1xuICogXG4gKiBUaGlzIGlzIGlkZWFsIGZvcjpcbiAqIC0gTmV1cmFsIG5ldHdvcmsgYWxnb3JpdGhtc1xuICogLSBNYXRoZW1hdGljYWwgY29tcHV0YXRpb25zXG4gKiAtIERhdGEgdHJhbnNmb3JtYXRpb25zXG4gKiAtIFBlcmZvcm1hbmNlLWNyaXRpY2FsIGNvZGVcbiAqLyJdLCJ2ZXJzaW9uIjozfQ==