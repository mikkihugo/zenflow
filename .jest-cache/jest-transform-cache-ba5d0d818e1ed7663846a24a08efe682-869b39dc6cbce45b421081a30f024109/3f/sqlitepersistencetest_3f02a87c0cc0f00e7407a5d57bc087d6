2431c1190e1a0993c28d9f11b5168732
/**
 * SQLite Persistence Integration Tests
 *
 * Hybrid Testing Approach:
 * - London School: Mock connections and external dependencies
 * - Classical School: Test actual data operations and persistence
 */
import { Database } from 'sqlite3';
import { tmpdir } from 'os';
import { join } from 'path';
import { unlink, access } from 'fs/promises';
import { constants } from 'fs';
// SQLite Store Implementation to test
class SQLiteMemoryStore {
    db = null;
    dbPath;
    isInitialized = false;
    constructor(dbPath) {
        this.dbPath = dbPath;
    }
    async initialize() {
        return new Promise((resolve, reject) => {
            this.db = new Database(this.dbPath, (err) => {
                if (err) {
                    reject(err);
                    return;
                }
                this.isInitialized = true;
                this.createTables().then(resolve).catch(reject);
            });
        });
    }
    async createTables() {
        const queries = [
            `CREATE TABLE IF NOT EXISTS sessions (
        id TEXT PRIMARY KEY,
        data TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL
      )`,
            `CREATE INDEX IF NOT EXISTS idx_sessions_created ON sessions(created_at)`,
            `CREATE INDEX IF NOT EXISTS idx_sessions_updated ON sessions(updated_at)`
        ];
        for (const query of queries) {
            await this.run(query);
        }
    }
    async store(sessionId, data, metadata) {
        if (!this.isInitialized)
            throw new Error('Database not initialized');
        const now = Date.now();
        await this.run(`INSERT OR REPLACE INTO sessions (id, data, metadata, created_at, updated_at) 
       VALUES (?, ?, ?, ?, ?)`, [sessionId, JSON.stringify(data), JSON.stringify(metadata || {}), now, now]);
    }
    async retrieve(sessionId) {
        if (!this.isInitialized)
            throw new Error('Database not initialized');
        return this.get('SELECT data, metadata FROM sessions WHERE id = ?', [sessionId]);
    }
    async listSessions() {
        if (!this.isInitialized)
            throw new Error('Database not initialized');
        const rows = await this.all('SELECT id FROM sessions ORDER BY updated_at DESC');
        return rows.map((row) => row.id);
    }
    async deleteSession(sessionId) {
        if (!this.isInitialized)
            throw new Error('Database not initialized');
        const result = await this.run('DELETE FROM sessions WHERE id = ?', [sessionId]);
        return result.changes > 0;
    }
    async getStats() {
        if (!this.isInitialized)
            throw new Error('Database not initialized');
        const result = await this.get('SELECT COUNT(*) as count, SUM(LENGTH(data)) as size FROM sessions');
        return {
            totalSessions: result.count || 0,
            totalSize: result.size || 0
        };
    }
    run(query, params = []) {
        return new Promise((resolve, reject) => {
            this.db.run(query, params, function (err) {
                if (err)
                    reject(err);
                else
                    resolve({ changes: this.changes, lastID: this.lastID });
            });
        });
    }
    get(query, params = []) {
        return new Promise((resolve, reject) => {
            this.db.get(query, params, (err, row) => {
                if (err)
                    reject(err);
                else
                    resolve(row);
            });
        });
    }
    all(query, params = []) {
        return new Promise((resolve, reject) => {
            this.db.all(query, params, (err, rows) => {
                if (err)
                    reject(err);
                else
                    resolve(rows);
            });
        });
    }
    async close() {
        if (this.db) {
            return new Promise((resolve, reject) => {
                this.db.close((err) => {
                    if (err)
                        reject(err);
                    else {
                        this.isInitialized = false;
                        resolve();
                    }
                });
            });
        }
    }
}
describe('SQLite Persistence Integration Tests', () => {
    let store;
    let dbPath;
    let mockConnection;
    beforeEach(() => {
        // Create temporary database path for classical tests
        dbPath = join(tmpdir(), `test-sqlite-${Date.now()}.db`);
        // Create mock connection for London-style tests
        mockConnection = {
            isOpen: true,
            query: jest.fn(),
            run: jest.fn(),
            close: jest.fn(),
            beginTransaction: jest.fn(),
            commit: jest.fn(),
            rollback: jest.fn()
        };
    });
    afterEach(async () => {
        if (store) {
            await store.close();
        }
        // Clean up test database file
        try {
            await access(dbPath, constants.F_OK);
            await unlink(dbPath);
        }
        catch {
            // File doesn't exist, ignore
        }
    });
    describe('Connection Management (London School)', () => {
        it('should handle connection initialization gracefully', async () => {
            const mockDb = {
                connect: jest.fn().mockResolvedValue(mockConnection),
                close: jest.fn().mockResolvedValue(undefined)
            };
            mockConnection.run.mockResolvedValue({ changes: 0 });
            // Test the connection flow without actual database
            expect(mockDb.connect).toHaveBeenCalledTimes(0);
            await mockDb.connect();
            expect(mockDb.connect).toHaveBeenCalledTimes(1);
            expect(mockConnection.isOpen).toBe(true);
        });
        it('should handle connection failures appropriately', async () => {
            const mockDb = {
                connect: jest.fn().mockRejectedValue(new Error('Connection failed'))
            };
            await expect(mockDb.connect()).rejects.toThrow('Connection failed');
        });
        it('should mock query execution properly', async () => {
            mockConnection.query.mockResolvedValue([
                { id: 'session1', data: '{"test": true}' }
            ]);
            const result = await mockConnection.query('SELECT * FROM sessions');
            expect(result).toHaveLength(1);
            expect(result[0].id).toBe('session1');
            expect(mockConnection.query).toHaveBeenCalledWith('SELECT * FROM sessions');
        });
        it('should handle transaction mocking', async () => {
            mockConnection.beginTransaction.mockResolvedValue(undefined);
            mockConnection.commit.mockResolvedValue(undefined);
            mockConnection.rollback.mockResolvedValue(undefined);
            await mockConnection.beginTransaction();
            await mockConnection.commit();
            expect(mockConnection.beginTransaction).toHaveBeenCalledTimes(1);
            expect(mockConnection.commit).toHaveBeenCalledTimes(1);
            expect(mockConnection.rollback).toHaveBeenCalledTimes(0);
        });
    });
    describe('Data Operations (Classical School)', () => {
        beforeEach(async () => {
            store = new SQLiteMemoryStore(dbPath);
            await store.initialize();
        });
        it('should create tables on initialization', async () => {
            // This is tested implicitly by successful initialization
            const stats = await store.getStats();
            expect(stats.totalSessions).toBe(0);
            expect(stats.totalSize).toBe(0);
        });
        it('should store and retrieve session data', async () => {
            const sessionId = 'test-session-1';
            const testData = { message: 'Hello World', timestamp: Date.now() };
            const metadata = { source: 'test', version: '1.0' };
            await store.store(sessionId, testData, metadata);
            const retrieved = await store.retrieve(sessionId);
            expect(retrieved).toBeDefined();
            expect(JSON.parse(retrieved.data)).toEqual(testData);
            expect(JSON.parse(retrieved.metadata)).toEqual(metadata);
        });
        it('should handle complex data structures', async () => {
            const sessionId = 'complex-session';
            const complexData = {
                nested: {
                    array: [1, 2, 3, { deep: 'value' }],
                    map: new Map([['key1', 'value1'], ['key2', 'value2']]),
                    date: new Date().toISOString(),
                    buffer: Buffer.from('test data').toString('base64')
                },
                functions: null, // Functions can't be serialized
                undefined: null, // Undefined becomes null
                symbols: null // Symbols can't be serialized
            };
            await store.store(sessionId, complexData);
            const retrieved = await store.retrieve(sessionId);
            const parsedData = JSON.parse(retrieved.data);
            expect(parsedData.nested.array).toEqual([1, 2, 3, { deep: 'value' }]);
            expect(parsedData.nested.date).toBe(complexData.nested.date);
            expect(parsedData.nested.buffer).toBe(complexData.nested.buffer);
        });
        it('should list sessions in correct order', async () => {
            const sessions = ['session-1', 'session-2', 'session-3'];
            for (let i = 0; i < sessions.length; i++) {
                await store.store(sessions[i], { index: i });
                // Small delay to ensure different timestamps
                await new Promise(resolve => setTimeout(resolve, 10));
            }
            const listed = await store.listSessions();
            expect(listed).toHaveLength(3);
            // Should be in reverse order (most recent first)
            expect(listed).toEqual(['session-3', 'session-2', 'session-1']);
        });
        it('should delete sessions correctly', async () => {
            const sessionId = 'delete-test';
            await store.store(sessionId, { test: 'data' });
            const deleted = await store.deleteSession(sessionId);
            expect(deleted).toBe(true);
            const retrieved = await store.retrieve(sessionId);
            expect(retrieved).toBeUndefined();
            // Deleting non-existent session should return false
            const deletedAgain = await store.deleteSession(sessionId);
            expect(deletedAgain).toBe(false);
        });
        it('should calculate statistics accurately', async () => {
            const testData = { message: 'Test data for statistics' };
            await store.store('stats-1', testData);
            await store.store('stats-2', { ...testData, extra: 'more data' });
            const stats = await store.getStats();
            expect(stats.totalSessions).toBe(2);
            expect(stats.totalSize).toBeGreaterThan(0);
            // Size should be reasonable (JSON stringified data)
            expect(stats.totalSize).toBeLessThan(1000); // Sanity check
        });
        it('should handle large datasets efficiently', async () => {
            const startTime = Date.now();
            const largeDataSet = Array.from({ length: 1000 }, (_, i) => ({
                id: i,
                data: `Large data chunk ${i}`.repeat(10),
                timestamp: Date.now() + i
            }));
            for (let i = 0; i < 100; i++) {
                await store.store(`large-session-${i}`, largeDataSet);
            }
            const endTime = Date.now();
            const duration = endTime - startTime;
            // Should complete within reasonable time (adjust based on performance requirements)
            expect(duration).toBeLessThan(5000); // 5 seconds max
            const stats = await store.getStats();
            expect(stats.totalSessions).toBe(100);
        });
        it('should maintain data integrity across operations', async () => {
            const originalData = {
                critical: 'important data',
                timestamp: Date.now(),
                nested: { values: [1, 2, 3, 4, 5] }
            };
            await store.store('integrity-test', originalData);
            // Retrieve multiple times to ensure consistency
            for (let i = 0; i < 10; i++) {
                const retrieved = await store.retrieve('integrity-test');
                const parsed = JSON.parse(retrieved.data);
                expect(parsed).toEqual(originalData);
            }
        });
    });
    describe('Session Management', () => {
        beforeEach(async () => {
            store = new SQLiteMemoryStore(dbPath);
            await store.initialize();
        });
        it('should handle concurrent session operations', async () => {
            const concurrentOperations = Array.from({ length: 10 }, async (_, i) => {
                const sessionId = `concurrent-${i}`;
                const data = { index: i, timestamp: Date.now() };
                await store.store(sessionId, data);
                return store.retrieve(sessionId);
            });
            const results = await Promise.all(concurrentOperations);
            expect(results).toHaveLength(10);
            results.forEach((result, index) => {
                expect(result).toBeDefined();
                const parsed = JSON.parse(result.data);
                expect(parsed.index).toBe(index);
            });
        });
        it('should handle session updates correctly', async () => {
            const sessionId = 'update-test';
            const initialData = { version: 1, content: 'initial' };
            const updatedData = { version: 2, content: 'updated', extra: 'field' };
            await store.store(sessionId, initialData);
            await store.store(sessionId, updatedData);
            const retrieved = await store.retrieve(sessionId);
            const parsed = JSON.parse(retrieved.data);
            expect(parsed).toEqual(updatedData);
            expect(parsed.version).toBe(2);
            expect(parsed.extra).toBe('field');
        });
    });
    describe('Error Handling', () => {
        it('should throw error when not initialized', async () => {
            const uninitializedStore = new SQLiteMemoryStore(dbPath);
            await expect(uninitializedStore.store('test', {})).rejects.toThrow('Database not initialized');
            await expect(uninitializedStore.retrieve('test')).rejects.toThrow('Database not initialized');
            await expect(uninitializedStore.listSessions()).rejects.toThrow('Database not initialized');
        });
        it('should handle invalid database paths gracefully', async () => {
            const invalidStore = new SQLiteMemoryStore('/invalid/path/database.db');
            await expect(invalidStore.initialize()).rejects.toThrow();
        });
        it('should handle corrupted data gracefully', async () => {
            await store.initialize();
            // Store valid data first
            await store.store('test-session', { valid: 'data' });
            // The store should handle JSON parsing errors gracefully
            // This would require modifying the store to handle parse errors
            const retrieved = await store.retrieve('test-session');
            expect(retrieved).toBeDefined();
        });
    });
    describe('Performance Benchmarks', () => {
        beforeEach(async () => {
            store = new SQLiteMemoryStore(dbPath);
            await store.initialize();
        });
        it('should benchmark write operations', async () => {
            const iterations = 1000;
            const testData = { benchmark: 'write test', data: 'x'.repeat(1000) };
            const startTime = process.hrtime.bigint();
            for (let i = 0; i < iterations; i++) {
                await store.store(`benchmark-write-${i}`, testData);
            }
            const endTime = process.hrtime.bigint();
            const durationMs = Number(endTime - startTime) / 1_000_000;
            const operationsPerSecond = (iterations / durationMs) * 1000;
            console.log(`Write performance: ${operationsPerSecond.toFixed(0)} ops/sec`);
            // Should handle at least 100 writes per second
            expect(operationsPerSecond).toBeGreaterThan(100);
        });
        it('should benchmark read operations', async () => {
            const iterations = 100;
            const testData = { benchmark: 'read test', data: 'y'.repeat(1000) };
            // Pre-populate data
            for (let i = 0; i < iterations; i++) {
                await store.store(`benchmark-read-${i}`, testData);
            }
            const startTime = process.hrtime.bigint();
            for (let i = 0; i < iterations; i++) {
                await store.retrieve(`benchmark-read-${i}`);
            }
            const endTime = process.hrtime.bigint();
            const durationMs = Number(endTime - startTime) / 1_000_000;
            const operationsPerSecond = (iterations / durationMs) * 1000;
            console.log(`Read performance: ${operationsPerSecond.toFixed(0)} ops/sec`);
            // Should handle at least 200 reads per second
            expect(operationsPerSecond).toBeGreaterThan(200);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vbWVtb3J5LXN0b3Jlcy9zcWxpdGUtcGVyc2lzdGVuY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFFSCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRW5DLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDNUIsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBYS9CLHNDQUFzQztBQUN0QyxNQUFNLGlCQUFpQjtJQUNiLEVBQUUsR0FBb0IsSUFBSSxDQUFDO0lBQzNCLE1BQU0sQ0FBUztJQUNmLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFFOUIsWUFBWSxNQUFjO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVTtRQUNkLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7WUFDckMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQzFDLElBQUksR0FBRyxFQUFFLENBQUM7b0JBQ1IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNaLE9BQU87Z0JBQ1QsQ0FBQztnQkFDRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztnQkFDMUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbEQsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENB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RSxDQUFDO1lBRXBFLG9CQUFvQjtZQUNwQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3BDLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDckQsQ0FBQztZQUVELE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFFMUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLEtBQUssQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDOUMsQ0FBQztZQUVELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUMsR0FBRyxTQUFTLENBQUM7WUFDM0QsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsR0FBRyxJQUFJLENBQUM7WUFFN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUUzRSw4Q0FBOEM7WUFDOUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9taHVnby9jb2RlL2NsYXVkZS1jb2RlLWZsb3cvc3JjL19fdGVzdHNfXy9pbnRlZ3JhdGlvbi9tZW1vcnktc3RvcmVzL3NxbGl0ZS1wZXJzaXN0ZW5jZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU1FMaXRlIFBlcnNpc3RlbmNlIEludGVncmF0aW9uIFRlc3RzXG4gKiBcbiAqIEh5YnJpZCBUZXN0aW5nIEFwcHJvYWNoOlxuICogLSBMb25kb24gU2Nob29sOiBNb2NrIGNvbm5lY3Rpb25zIGFuZCBleHRlcm5hbCBkZXBlbmRlbmNpZXNcbiAqIC0gQ2xhc3NpY2FsIFNjaG9vbDogVGVzdCBhY3R1YWwgZGF0YSBvcGVyYXRpb25zIGFuZCBwZXJzaXN0ZW5jZVxuICovXG5cbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnc3FsaXRlMyc7XG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJztcbmltcG9ydCB7IHRtcGRpciB9IGZyb20gJ29zJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHVubGluaywgYWNjZXNzIH0gZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgY29uc3RhbnRzIH0gZnJvbSAnZnMnO1xuXG4vLyBNb2NrIFNRTGl0ZSBjb25uZWN0aW9uIGludGVyZmFjZVxuaW50ZXJmYWNlIE1vY2tTUUxpdGVDb25uZWN0aW9uIHtcbiAgaXNPcGVuOiBib29sZWFuO1xuICBxdWVyeTogamVzdC5Nb2NrO1xuICBydW46IGplc3QuTW9jaztcbiAgY2xvc2U6IGplc3QuTW9jaztcbiAgYmVnaW5UcmFuc2FjdGlvbjogamVzdC5Nb2NrO1xuICBjb21taXQ6IGplc3QuTW9jaztcbiAgcm9sbGJhY2s6IGplc3QuTW9jaztcbn1cblxuLy8gU1FMaXRlIFN0b3JlIEltcGxlbWVudGF0aW9uIHRvIHRlc3RcbmNsYXNzIFNRTGl0ZU1lbW9yeVN0b3JlIHtcbiAgcHJpdmF0ZSBkYjogRGF0YWJhc2UgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkYlBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBpc0luaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoZGJQYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLmRiUGF0aCA9IGRiUGF0aDtcbiAgfVxuXG4gIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuZGIgPSBuZXcgRGF0YWJhc2UodGhpcy5kYlBhdGgsIChlcnIpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmNyZWF0ZVRhYmxlcygpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVqZWN0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVUYWJsZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcXVlcmllcyA9IFtcbiAgICAgIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzZXNzaW9ucyAoXG4gICAgICAgIGlkIFRFWFQgUFJJTUFSWSBLRVksXG4gICAgICAgIGRhdGEgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgbWV0YWRhdGEgVEVYVCxcbiAgICAgICAgY3JlYXRlZF9hdCBJTlRFR0VSIE5PVCBOVUxMLFxuICAgICAgICB1cGRhdGVkX2F0IElOVEVHRVIgTk9UIE5VTExcbiAgICAgIClgLFxuICAgICAgYENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9zZXNzaW9uc19jcmVhdGVkIE9OIHNlc3Npb25zKGNyZWF0ZWRfYXQpYCxcbiAgICAgIGBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfc2Vzc2lvbnNfdXBkYXRlZCBPTiBzZXNzaW9ucyh1cGRhdGVkX2F0KWBcbiAgICBdO1xuXG4gICAgZm9yIChjb25zdCBxdWVyeSBvZiBxdWVyaWVzKSB7XG4gICAgICBhd2FpdCB0aGlzLnJ1bihxdWVyeSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RvcmUoc2Vzc2lvbklkOiBzdHJpbmcsIGRhdGE6IGFueSwgbWV0YWRhdGE/OiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICBcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGF3YWl0IHRoaXMucnVuKFxuICAgICAgYElOU0VSVCBPUiBSRVBMQUNFIElOVE8gc2Vzc2lvbnMgKGlkLCBkYXRhLCBtZXRhZGF0YSwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdCkgXG4gICAgICAgVkFMVUVTICg/LCA/LCA/LCA/LCA/KWAsXG4gICAgICBbc2Vzc2lvbklkLCBKU09OLnN0cmluZ2lmeShkYXRhKSwgSlNPTi5zdHJpbmdpZnkobWV0YWRhdGEgfHwge30pLCBub3csIG5vd11cbiAgICApO1xuICB9XG5cbiAgYXN5bmMgcmV0cmlldmUoc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIFxuICAgIHJldHVybiB0aGlzLmdldChcbiAgICAgICdTRUxFQ1QgZGF0YSwgbWV0YWRhdGEgRlJPTSBzZXNzaW9ucyBXSEVSRSBpZCA9ID8nLFxuICAgICAgW3Nlc3Npb25JZF1cbiAgICApO1xuICB9XG5cbiAgYXN5bmMgbGlzdFNlc3Npb25zKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICBcbiAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5hbGwoJ1NFTEVDVCBpZCBGUk9NIHNlc3Npb25zIE9SREVSIEJZIHVwZGF0ZWRfYXQgREVTQycpO1xuICAgIHJldHVybiByb3dzLm1hcCgocm93OiBhbnkpID0+IHJvdy5pZCk7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF0aGlzLmlzSW5pdGlhbGl6ZWQpIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugbm90IGluaXRpYWxpemVkJyk7XG4gICAgXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5ydW4oJ0RFTEVURSBGUk9NIHNlc3Npb25zIFdIRVJFIGlkID0gPycsIFtzZXNzaW9uSWRdKTtcbiAgICByZXR1cm4gcmVzdWx0LmNoYW5nZXMgPiAwO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3RhdHMoKTogUHJvbWlzZTx7IHRvdGFsU2Vzc2lvbnM6IG51bWJlcjsgdG90YWxTaXplOiBudW1iZXIgfT4ge1xuICAgIGlmICghdGhpcy5pc0luaXRpYWxpemVkKSB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2V0KFxuICAgICAgJ1NFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCwgU1VNKExFTkdUSChkYXRhKSkgYXMgc2l6ZSBGUk9NIHNlc3Npb25zJ1xuICAgICk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsU2Vzc2lvbnM6IHJlc3VsdC5jb3VudCB8fCAwLFxuICAgICAgdG90YWxTaXplOiByZXN1bHQuc2l6ZSB8fCAwXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgcnVuKHF1ZXJ5OiBzdHJpbmcsIHBhcmFtczogYW55W10gPSBbXSk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuZGIhLnJ1bihxdWVyeSwgcGFyYW1zLCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICAgIGVsc2UgcmVzb2x2ZSh7IGNoYW5nZXM6IHRoaXMuY2hhbmdlcywgbGFzdElEOiB0aGlzLmxhc3RJRCB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQocXVlcnk6IHN0cmluZywgcGFyYW1zOiBhbnlbXSA9IFtdKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5kYiEuZ2V0KHF1ZXJ5LCBwYXJhbXMsIChlcnIsIHJvdykgPT4ge1xuICAgICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTtcbiAgICAgICAgZWxzZSByZXNvbHZlKHJvdyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWxsKHF1ZXJ5OiBzdHJpbmcsIHBhcmFtczogYW55W10gPSBbXSk6IFByb21pc2U8YW55W10+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5kYiEuYWxsKHF1ZXJ5LCBwYXJhbXMsIChlcnIsIHJvd3MpID0+IHtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICAgIGVsc2UgcmVzb2x2ZShyb3dzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY2xvc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuZGIpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHRoaXMuZGIhLmNsb3NlKChlcnIpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTtcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cblxuZGVzY3JpYmUoJ1NRTGl0ZSBQZXJzaXN0ZW5jZSBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHN0b3JlOiBTUUxpdGVNZW1vcnlTdG9yZTtcbiAgbGV0IGRiUGF0aDogc3RyaW5nO1xuICBsZXQgbW9ja0Nvbm5lY3Rpb246IE1vY2tTUUxpdGVDb25uZWN0aW9uO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgZGF0YWJhc2UgcGF0aCBmb3IgY2xhc3NpY2FsIHRlc3RzXG4gICAgZGJQYXRoID0gam9pbih0bXBkaXIoKSwgYHRlc3Qtc3FsaXRlLSR7RGF0ZS5ub3coKX0uZGJgKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgbW9jayBjb25uZWN0aW9uIGZvciBMb25kb24tc3R5bGUgdGVzdHNcbiAgICBtb2NrQ29ubmVjdGlvbiA9IHtcbiAgICAgIGlzT3BlbjogdHJ1ZSxcbiAgICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgICBydW46IGplc3QuZm4oKSxcbiAgICAgIGNsb3NlOiBqZXN0LmZuKCksXG4gICAgICBiZWdpblRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgICBjb21taXQ6IGplc3QuZm4oKSxcbiAgICAgIHJvbGxiYWNrOiBqZXN0LmZuKClcbiAgICB9O1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGlmIChzdG9yZSkge1xuICAgICAgYXdhaXQgc3RvcmUuY2xvc2UoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhYmFzZSBmaWxlXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFjY2VzcyhkYlBhdGgsIGNvbnN0YW50cy5GX09LKTtcbiAgICAgIGF3YWl0IHVubGluayhkYlBhdGgpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gRmlsZSBkb2Vzbid0IGV4aXN0LCBpZ25vcmVcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25uZWN0aW9uIE1hbmFnZW1lbnQgKExvbmRvbiBTY2hvb2wpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbm5lY3Rpb24gaW5pdGlhbGl6YXRpb24gZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYiA9IHtcbiAgICAgICAgY29ubmVjdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25uZWN0aW9uKSxcbiAgICAgICAgY2xvc2U6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpXG4gICAgICB9O1xuXG4gICAgICBtb2NrQ29ubmVjdGlvbi5ydW4ubW9ja1Jlc29sdmVkVmFsdWUoeyBjaGFuZ2VzOiAwIH0pO1xuXG4gICAgICAvLyBUZXN0IHRoZSBjb25uZWN0aW9uIGZsb3cgd2l0aG91dCBhY3R1YWwgZGF0YWJhc2VcbiAgICAgIGV4cGVjdChtb2NrRGIuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDApO1xuICAgICAgYXdhaXQgbW9ja0RiLmNvbm5lY3QoKTtcbiAgICAgIGV4cGVjdChtb2NrRGIuY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tDb25uZWN0aW9uLmlzT3BlbikudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbm5lY3Rpb24gZmFpbHVyZXMgYXBwcm9wcmlhdGVseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tEYiA9IHtcbiAgICAgICAgY29ubmVjdDogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQ29ubmVjdGlvbiBmYWlsZWQnKSlcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChtb2NrRGIuY29ubmVjdCgpKS5yZWplY3RzLnRvVGhyb3coJ0Nvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1vY2sgcXVlcnkgZXhlY3V0aW9uIHByb3Blcmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0Nvbm5lY3Rpb24ucXVlcnkubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICB7IGlkOiAnc2Vzc2lvbjEnLCBkYXRhOiAne1widGVzdFwiOiB0cnVlfScgfVxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tDb25uZWN0aW9uLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIHNlc3Npb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmlkKS50b0JlKCdzZXNzaW9uMScpO1xuICAgICAgZXhwZWN0KG1vY2tDb25uZWN0aW9uLnF1ZXJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnU0VMRUNUICogRlJPTSBzZXNzaW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdHJhbnNhY3Rpb24gbW9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDb25uZWN0aW9uLmJlZ2luVHJhbnNhY3Rpb24ubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgIG1vY2tDb25uZWN0aW9uLmNvbW1pdC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgbW9ja0Nvbm5lY3Rpb24ucm9sbGJhY2subW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgYXdhaXQgbW9ja0Nvbm5lY3Rpb24uYmVnaW5UcmFuc2FjdGlvbigpO1xuICAgICAgYXdhaXQgbW9ja0Nvbm5lY3Rpb24uY29tbWl0KCk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ29ubmVjdGlvbi5iZWdpblRyYW5zYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja0Nvbm5lY3Rpb24uY29tbWl0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja0Nvbm5lY3Rpb24ucm9sbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGEgT3BlcmF0aW9ucyAoQ2xhc3NpY2FsIFNjaG9vbCknLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBzdG9yZSA9IG5ldyBTUUxpdGVNZW1vcnlTdG9yZShkYlBhdGgpO1xuICAgICAgYXdhaXQgc3RvcmUuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdGFibGVzIG9uIGluaXRpYWxpemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyBpcyB0ZXN0ZWQgaW1wbGljaXRseSBieSBzdWNjZXNzZnVsIGluaXRpYWxpemF0aW9uXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHN0b3JlLmdldFN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxTZXNzaW9ucykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFNpemUpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN0b3JlIGFuZCByZXRyaWV2ZSBzZXNzaW9uIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSAndGVzdC1zZXNzaW9uLTEnO1xuICAgICAgY29uc3QgdGVzdERhdGEgPSB7IG1lc3NhZ2U6ICdIZWxsbyBXb3JsZCcsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9O1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSB7IHNvdXJjZTogJ3Rlc3QnLCB2ZXJzaW9uOiAnMS4wJyB9O1xuXG4gICAgICBhd2FpdCBzdG9yZS5zdG9yZShzZXNzaW9uSWQsIHRlc3REYXRhLCBtZXRhZGF0YSk7XG4gICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCBzdG9yZS5yZXRyaWV2ZShzZXNzaW9uSWQpO1xuXG4gICAgICBleHBlY3QocmV0cmlldmVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEpTT04ucGFyc2UocmV0cmlldmVkLmRhdGEpKS50b0VxdWFsKHRlc3REYXRhKTtcbiAgICAgIGV4cGVjdChKU09OLnBhcnNlKHJldHJpZXZlZC5tZXRhZGF0YSkpLnRvRXF1YWwobWV0YWRhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBkYXRhIHN0cnVjdHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSAnY29tcGxleC1zZXNzaW9uJztcbiAgICAgIGNvbnN0IGNvbXBsZXhEYXRhID0ge1xuICAgICAgICBuZXN0ZWQ6IHtcbiAgICAgICAgICBhcnJheTogWzEsIDIsIDMsIHsgZGVlcDogJ3ZhbHVlJyB9XSxcbiAgICAgICAgICBtYXA6IG5ldyBNYXAoW1sna2V5MScsICd2YWx1ZTEnXSwgWydrZXkyJywgJ3ZhbHVlMiddXSksXG4gICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGJ1ZmZlcjogQnVmZmVyLmZyb20oJ3Rlc3QgZGF0YScpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbnM6IG51bGwsIC8vIEZ1bmN0aW9ucyBjYW4ndCBiZSBzZXJpYWxpemVkXG4gICAgICAgIHVuZGVmaW5lZDogbnVsbCwgLy8gVW5kZWZpbmVkIGJlY29tZXMgbnVsbFxuICAgICAgICBzeW1ib2xzOiBudWxsIC8vIFN5bWJvbHMgY2FuJ3QgYmUgc2VyaWFsaXplZFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgc3RvcmUuc3RvcmUoc2Vzc2lvbklkLCBjb21wbGV4RGF0YSk7XG4gICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCBzdG9yZS5yZXRyaWV2ZShzZXNzaW9uSWQpO1xuICAgICAgY29uc3QgcGFyc2VkRGF0YSA9IEpTT04ucGFyc2UocmV0cmlldmVkLmRhdGEpO1xuXG4gICAgICBleHBlY3QocGFyc2VkRGF0YS5uZXN0ZWQuYXJyYXkpLnRvRXF1YWwoWzEsIDIsIDMsIHsgZGVlcDogJ3ZhbHVlJyB9XSk7XG4gICAgICBleHBlY3QocGFyc2VkRGF0YS5uZXN0ZWQuZGF0ZSkudG9CZShjb21wbGV4RGF0YS5uZXN0ZWQuZGF0ZSk7XG4gICAgICBleHBlY3QocGFyc2VkRGF0YS5uZXN0ZWQuYnVmZmVyKS50b0JlKGNvbXBsZXhEYXRhLm5lc3RlZC5idWZmZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsaXN0IHNlc3Npb25zIGluIGNvcnJlY3Qgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzZXNzaW9ucyA9IFsnc2Vzc2lvbi0xJywgJ3Nlc3Npb24tMicsICdzZXNzaW9uLTMnXTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXNzaW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBhd2FpdCBzdG9yZS5zdG9yZShzZXNzaW9uc1tpXSwgeyBpbmRleDogaSB9KTtcbiAgICAgICAgLy8gU21hbGwgZGVsYXkgdG8gZW5zdXJlIGRpZmZlcmVudCB0aW1lc3RhbXBzXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMCkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBsaXN0ZWQgPSBhd2FpdCBzdG9yZS5saXN0U2Vzc2lvbnMoKTtcbiAgICAgIGV4cGVjdChsaXN0ZWQpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIC8vIFNob3VsZCBiZSBpbiByZXZlcnNlIG9yZGVyIChtb3N0IHJlY2VudCBmaXJzdClcbiAgICAgIGV4cGVjdChsaXN0ZWQpLnRvRXF1YWwoWydzZXNzaW9uLTMnLCAnc2Vzc2lvbi0yJywgJ3Nlc3Npb24tMSddKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIHNlc3Npb25zIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlc3Npb25JZCA9ICdkZWxldGUtdGVzdCc7XG4gICAgICBhd2FpdCBzdG9yZS5zdG9yZShzZXNzaW9uSWQsIHsgdGVzdDogJ2RhdGEnIH0pO1xuXG4gICAgICBjb25zdCBkZWxldGVkID0gYXdhaXQgc3RvcmUuZGVsZXRlU2Vzc2lvbihzZXNzaW9uSWQpO1xuICAgICAgZXhwZWN0KGRlbGV0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IHJldHJpZXZlZCA9IGF3YWl0IHN0b3JlLnJldHJpZXZlKHNlc3Npb25JZCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkKS50b0JlVW5kZWZpbmVkKCk7XG5cbiAgICAgIC8vIERlbGV0aW5nIG5vbi1leGlzdGVudCBzZXNzaW9uIHNob3VsZCByZXR1cm4gZmFsc2VcbiAgICAgIGNvbnN0IGRlbGV0ZWRBZ2FpbiA9IGF3YWl0IHN0b3JlLmRlbGV0ZVNlc3Npb24oc2Vzc2lvbklkKTtcbiAgICAgIGV4cGVjdChkZWxldGVkQWdhaW4pLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc3RhdGlzdGljcyBhY2N1cmF0ZWx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdERhdGEgPSB7IG1lc3NhZ2U6ICdUZXN0IGRhdGEgZm9yIHN0YXRpc3RpY3MnIH07XG4gICAgICBcbiAgICAgIGF3YWl0IHN0b3JlLnN0b3JlKCdzdGF0cy0xJywgdGVzdERhdGEpO1xuICAgICAgYXdhaXQgc3RvcmUuc3RvcmUoJ3N0YXRzLTInLCB7IC4uLnRlc3REYXRhLCBleHRyYTogJ21vcmUgZGF0YScgfSk7XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgc3RvcmUuZ2V0U3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbFNlc3Npb25zKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsU2l6ZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgXG4gICAgICAvLyBTaXplIHNob3VsZCBiZSByZWFzb25hYmxlIChKU09OIHN0cmluZ2lmaWVkIGRhdGEpXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxTaXplKS50b0JlTGVzc1RoYW4oMTAwMCk7IC8vIFNhbml0eSBjaGVja1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbGFyZ2UgZGF0YXNldHMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgbGFyZ2VEYXRhU2V0ID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwMCB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGksXG4gICAgICAgIGRhdGE6IGBMYXJnZSBkYXRhIGNodW5rICR7aX1gLnJlcGVhdCgxMCksXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSArIGlcbiAgICAgIH0pKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDA7IGkrKykge1xuICAgICAgICBhd2FpdCBzdG9yZS5zdG9yZShgbGFyZ2Utc2Vzc2lvbi0ke2l9YCwgbGFyZ2VEYXRhU2V0KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gcmVhc29uYWJsZSB0aW1lIChhZGp1c3QgYmFzZWQgb24gcGVyZm9ybWFuY2UgcmVxdWlyZW1lbnRzKVxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oNTAwMCk7IC8vIDUgc2Vjb25kcyBtYXhcblxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBzdG9yZS5nZXRTdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsU2Vzc2lvbnMpLnRvQmUoMTAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gZGF0YSBpbnRlZ3JpdHkgYWNyb3NzIG9wZXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvcmlnaW5hbERhdGEgPSB7XG4gICAgICAgIGNyaXRpY2FsOiAnaW1wb3J0YW50IGRhdGEnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIG5lc3RlZDogeyB2YWx1ZXM6IFsxLCAyLCAzLCA0LCA1XSB9XG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBzdG9yZS5zdG9yZSgnaW50ZWdyaXR5LXRlc3QnLCBvcmlnaW5hbERhdGEpO1xuICAgICAgXG4gICAgICAvLyBSZXRyaWV2ZSBtdWx0aXBsZSB0aW1lcyB0byBlbnN1cmUgY29uc2lzdGVuY3lcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCBzdG9yZS5yZXRyaWV2ZSgnaW50ZWdyaXR5LXRlc3QnKTtcbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyZXRyaWV2ZWQuZGF0YSk7XG4gICAgICAgIGV4cGVjdChwYXJzZWQpLnRvRXF1YWwob3JpZ2luYWxEYXRhKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Nlc3Npb24gTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIHN0b3JlID0gbmV3IFNRTGl0ZU1lbW9yeVN0b3JlKGRiUGF0aCk7XG4gICAgICBhd2FpdCBzdG9yZS5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25jdXJyZW50IHNlc3Npb24gb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmN1cnJlbnRPcGVyYXRpb25zID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgYXN5bmMgKF8sIGkpID0+IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gYGNvbmN1cnJlbnQtJHtpfWA7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7IGluZGV4OiBpLCB0aW1lc3RhbXA6IERhdGUubm93KCkgfTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHN0b3JlLnN0b3JlKHNlc3Npb25JZCwgZGF0YSk7XG4gICAgICAgIHJldHVybiBzdG9yZS5yZXRyaWV2ZShzZXNzaW9uSWQpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChjb25jdXJyZW50T3BlcmF0aW9ucyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHRzKS50b0hhdmVMZW5ndGgoMTApO1xuICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQsIGluZGV4KSA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UocmVzdWx0LmRhdGEpO1xuICAgICAgICBleHBlY3QocGFyc2VkLmluZGV4KS50b0JlKGluZGV4KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2Vzc2lvbiB1cGRhdGVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNlc3Npb25JZCA9ICd1cGRhdGUtdGVzdCc7XG4gICAgICBjb25zdCBpbml0aWFsRGF0YSA9IHsgdmVyc2lvbjogMSwgY29udGVudDogJ2luaXRpYWwnIH07XG4gICAgICBjb25zdCB1cGRhdGVkRGF0YSA9IHsgdmVyc2lvbjogMiwgY29udGVudDogJ3VwZGF0ZWQnLCBleHRyYTogJ2ZpZWxkJyB9O1xuXG4gICAgICBhd2FpdCBzdG9yZS5zdG9yZShzZXNzaW9uSWQsIGluaXRpYWxEYXRhKTtcbiAgICAgIGF3YWl0IHN0b3JlLnN0b3JlKHNlc3Npb25JZCwgdXBkYXRlZERhdGEpO1xuXG4gICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCBzdG9yZS5yZXRyaWV2ZShzZXNzaW9uSWQpO1xuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyZXRyaWV2ZWQuZGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChwYXJzZWQpLnRvRXF1YWwodXBkYXRlZERhdGEpO1xuICAgICAgZXhwZWN0KHBhcnNlZC52ZXJzaW9uKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHBhcnNlZC5leHRyYSkudG9CZSgnZmllbGQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBub3QgaW5pdGlhbGl6ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1bmluaXRpYWxpemVkU3RvcmUgPSBuZXcgU1FMaXRlTWVtb3J5U3RvcmUoZGJQYXRoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHVuaW5pdGlhbGl6ZWRTdG9yZS5zdG9yZSgndGVzdCcsIHt9KSkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh1bmluaXRpYWxpemVkU3RvcmUucmV0cmlldmUoJ3Rlc3QnKSkucmVqZWN0cy50b1Rocm93KCdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIGF3YWl0IGV4cGVjdCh1bmluaXRpYWxpemVkU3RvcmUubGlzdFNlc3Npb25zKCkpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2Ugbm90IGluaXRpYWxpemVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGRhdGFiYXNlIHBhdGhzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkU3RvcmUgPSBuZXcgU1FMaXRlTWVtb3J5U3RvcmUoJy9pbnZhbGlkL3BhdGgvZGF0YWJhc2UuZGInKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KGludmFsaWRTdG9yZS5pbml0aWFsaXplKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29ycnVwdGVkIGRhdGEgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHN0b3JlLmluaXRpYWxpemUoKTtcbiAgICAgIFxuICAgICAgLy8gU3RvcmUgdmFsaWQgZGF0YSBmaXJzdFxuICAgICAgYXdhaXQgc3RvcmUuc3RvcmUoJ3Rlc3Qtc2Vzc2lvbicsIHsgdmFsaWQ6ICdkYXRhJyB9KTtcbiAgICAgIFxuICAgICAgLy8gVGhlIHN0b3JlIHNob3VsZCBoYW5kbGUgSlNPTiBwYXJzaW5nIGVycm9ycyBncmFjZWZ1bGx5XG4gICAgICAvLyBUaGlzIHdvdWxkIHJlcXVpcmUgbW9kaWZ5aW5nIHRoZSBzdG9yZSB0byBoYW5kbGUgcGFyc2UgZXJyb3JzXG4gICAgICBjb25zdCByZXRyaWV2ZWQgPSBhd2FpdCBzdG9yZS5yZXRyaWV2ZSgndGVzdC1zZXNzaW9uJyk7XG4gICAgICBleHBlY3QocmV0cmlldmVkKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgQmVuY2htYXJrcycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIHN0b3JlID0gbmV3IFNRTGl0ZU1lbW9yeVN0b3JlKGRiUGF0aCk7XG4gICAgICBhd2FpdCBzdG9yZS5pbml0aWFsaXplKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlbmNobWFyayB3cml0ZSBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXRlcmF0aW9ucyA9IDEwMDA7XG4gICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgYmVuY2htYXJrOiAnd3JpdGUgdGVzdCcsIGRhdGE6ICd4Jy5yZXBlYXQoMTAwMCkgfTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7XG4gICAgICAgIGF3YWl0IHN0b3JlLnN0b3JlKGBiZW5jaG1hcmstd3JpdGUtJHtpfWAsIHRlc3REYXRhKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZW5kVGltZSA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICAgICAgY29uc3QgZHVyYXRpb25NcyA9IE51bWJlcihlbmRUaW1lIC0gc3RhcnRUaW1lKSAvIDFfMDAwXzAwMDtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnNQZXJTZWNvbmQgPSAoaXRlcmF0aW9ucyAvIGR1cmF0aW9uTXMpICogMTAwMDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYFdyaXRlIHBlcmZvcm1hbmNlOiAke29wZXJhdGlvbnNQZXJTZWNvbmQudG9GaXhlZCgwKX0gb3BzL3NlY2ApO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgaGFuZGxlIGF0IGxlYXN0IDEwMCB3cml0ZXMgcGVyIHNlY29uZFxuICAgICAgZXhwZWN0KG9wZXJhdGlvbnNQZXJTZWNvbmQpLnRvQmVHcmVhdGVyVGhhbigxMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZW5jaG1hcmsgcmVhZCBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaXRlcmF0aW9ucyA9IDEwMDtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0geyBiZW5jaG1hcms6ICdyZWFkIHRlc3QnLCBkYXRhOiAneScucmVwZWF0KDEwMDApIH07XG4gICAgICBcbiAgICAgIC8vIFByZS1wb3B1bGF0ZSBkYXRhXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKykge1xuICAgICAgICBhd2FpdCBzdG9yZS5zdG9yZShgYmVuY2htYXJrLXJlYWQtJHtpfWAsIHRlc3REYXRhKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvY2Vzcy5ocnRpbWUuYmlnaW50KCk7XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7XG4gICAgICAgIGF3YWl0IHN0b3JlLnJldHJpZXZlKGBiZW5jaG1hcmstcmVhZC0ke2l9YCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uTXMgPSBOdW1iZXIoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxXzAwMF8wMDA7XG4gICAgICBjb25zdCBvcGVyYXRpb25zUGVyU2Vjb25kID0gKGl0ZXJhdGlvbnMgLyBkdXJhdGlvbk1zKSAqIDEwMDA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBSZWFkIHBlcmZvcm1hbmNlOiAke29wZXJhdGlvbnNQZXJTZWNvbmQudG9GaXhlZCgwKX0gb3BzL3NlY2ApO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgaGFuZGxlIGF0IGxlYXN0IDIwMCByZWFkcyBwZXIgc2Vjb25kXG4gICAgICBleHBlY3Qob3BlcmF0aW9uc1BlclNlY29uZCkudG9CZUdyZWF0ZXJUaGFuKDIwMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9