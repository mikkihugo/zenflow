51cbec465c4071ae035b4e47daac7d4d
/**
 * Integration Tests for Maestro Steering Document Workflow
 * Tests the complete steering document workflow with real file system operations
 */
import { MaestroOrchestrator } from '../../../maestro/maestro-orchestrator.js';
import { readFile, writeFile, mkdir, rmdir } from 'fs/promises';
import { join } from 'path';
import { existsSync } from 'fs';
import { tmpdir } from 'os';
describe('Maestro Steering Workflow Integration', () => {
    let maestroOrchestrator;
    let testDirectory;
    let mockConfig;
    let mockEventBus;
    let mockLogger;
    let mockMemoryManager;
    let mockAgentManager;
    let mockMainOrchestrator;
    beforeAll(async () => {
        // Create temporary test directory
        testDirectory = join(tmpdir(), `maestro-steering-test-${Date.now()}`);
        await mkdir(testDirectory, { recursive: true });
    });
    afterAll(async () => {
        // Cleanup test directory
        try {
            if (existsSync(testDirectory)) {
                await rmdir(testDirectory, { recursive: true });
            }
        }
        catch (error) {
            console.warn(`Warning: Failed to cleanup test directory: ${error}`);
        }
    });
    beforeEach(async () => {
        // Setup mocks
        mockConfig = { environment: 'test' };
        mockEventBus = {
            emit: jest.fn(),
            on: jest.fn()
        };
        mockLogger = {
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
            debug: jest.fn()
        };
        mockMemoryManager = {
            get: jest.fn(),
            set: jest.fn(),
            delete: jest.fn()
        };
        mockAgentManager = {
            createAgent: jest.fn().mockResolvedValue('agent-123'),
            startAgent: jest.fn(),
            stopAgent: jest.fn()
        };
        mockMainOrchestrator = {
            assignTask: jest.fn().mockResolvedValue({ success: true })
        };
        // Create orchestrator instance with test directory
        maestroOrchestrator = new MaestroOrchestrator(mockConfig, mockEventBus, mockLogger, mockMemoryManager, mockAgentManager, mockMainOrchestrator, {
            enableHiveMind: false,
            steeringDirectory: join(testDirectory, 'steering')
        });
    });
    describe('complete steering document workflow', () => {
        it('should create multiple steering documents for complete project setup', async () => {
            const domains = ['product', 'tech', 'structure', 'security'];
            const contents = [
                'Product vision and user experience guidelines',
                'Technology standards and development practices',
                'Project organization and file structure',
                'Security guidelines and best practices'
            ];
            // Create all steering documents
            for (let i = 0; i < domains.length; i++) {
                await maestroOrchestrator.createSteeringDocument(domains[i], contents[i]);
            }
            // Verify all files were created
            for (const domain of domains) {
                const filePath = join(testDirectory, 'steering', `${domain}.md`);
                expect(existsSync(filePath)).toBe(true);
                const content = await readFile(filePath, 'utf8');
                expect(content).toContain(`# ${domain.charAt(0).toUpperCase() + domain.slice(1)} Steering Document`);
                expect(content).toContain('## Guidelines');
            }
        });
        it('should integrate steering context with spec creation', async () => {
            // First create steering documents
            await maestroOrchestrator.createSteeringDocument('product', 'User-centered design principles');
            await maestroOrchestrator.createSteeringDocument('tech', 'Clean architecture standards');
            // Then create a spec (simulated)
            const featureName = 'user-authentication';
            const specDirectory = join(testDirectory, 'specs', featureName);
            await mkdir(specDirectory, { recursive: true });
            // Get steering context
            const steeringContext = await maestroOrchestrator.getSteeringContext('developer');
            // Create requirements with steering context
            const requirementsContent = `# Requirements for ${featureName}

## High-Level Request
Implement secure user authentication system

## Steering Context Applied
${steeringContext}

## User Stories
- As a user, I want secure authentication, so that my data is protected

## Acceptance Criteria
- [ ] Follows product steering guidelines
- [ ] Meets technical architecture standards
- [ ] Implements security best practices

*Generated with Steering Document Context*
`;
            await writeFile(join(specDirectory, 'requirements.md'), requirementsContent, 'utf8');
            // Verify steering context integration
            const generatedContent = await readFile(join(specDirectory, 'requirements.md'), 'utf8');
            expect(generatedContent).toContain('Steering Context Applied');
        });
        it('should handle steering document updates and versioning', async () => {
            const domain = 'versioning-test';
            const originalContent = 'Original guidelines v1';
            const updatedContent = 'Updated guidelines v2 with new standards';
            // Create initial steering document
            await maestroOrchestrator.createSteeringDocument(domain, originalContent);
            const filePath = join(testDirectory, 'steering', `${domain}.md`);
            const initialContent = await readFile(filePath, 'utf8');
            expect(initialContent).toContain(originalContent);
            // Update steering document
            await maestroOrchestrator.createSteeringDocument(domain, updatedContent);
            const updatedFileContent = await readFile(filePath, 'utf8');
            expect(updatedFileContent).toContain(updatedContent);
            expect(updatedFileContent).not.toContain(originalContent);
        });
    });
    describe('steering document validation and quality', () => {
        it('should create steering documents with consistent structure', async () => {
            const testDomains = [
                { domain: 'consistency-product', content: 'Product consistency guidelines' },
                { domain: 'consistency-tech', content: 'Technical consistency guidelines' },
                { domain: 'consistency-custom', content: 'Custom domain consistency guidelines' }
            ];
            for (const testCase of testDomains) {
                await maestroOrchestrator.createSteeringDocument(testCase.domain, testCase.content);
                const filePath = join(testDirectory, 'steering', `${testCase.domain}.md`);
                const content = await readFile(filePath, 'utf8');
                // Validate consistent structure
                expect(content).toMatch(/^# .+ Steering Document$/m);
                expect(content).toContain('## Guidelines');
                expect(content).toContain(testCase.content);
                expect(content.length).toBeGreaterThan(200); // Minimum content length
            }
        });
        it('should create domain-specific content for different steering types', async () => {
            const domainSpecificTests = [
                {
                    domain: 'api-design',
                    content: 'RESTful API design standards',
                    expectedKeywords: ['API', 'REST', 'endpoint']
                },
                {
                    domain: 'testing',
                    content: 'Comprehensive testing strategies',
                    expectedKeywords: ['test', 'coverage', 'automation']
                },
                {
                    domain: 'deployment',
                    content: 'CI/CD and deployment practices',
                    expectedKeywords: ['deployment', 'CI/CD', 'pipeline']
                }
            ];
            for (const test of domainSpecificTests) {
                await maestroOrchestrator.createSteeringDocument(test.domain, test.content);
                const filePath = join(testDirectory, 'steering', `${test.domain}.md`);
                const content = await readFile(filePath, 'utf8');
                // Verify domain-specific content
                expect(content).toContain(test.content);
                // Check for domain-specific keywords in generated content
                const contentLower = content.toLowerCase();
                const domainKeywordsFound = test.expectedKeywords.some(keyword => contentLower.includes(keyword.toLowerCase()));
                expect(domainKeywordsFound).toBe(true);
            }
        });
        it('should maintain proper markdown formatting', async () => {
            await maestroOrchestrator.createSteeringDocument('markdown-test', 'Testing markdown formatting');
            const filePath = join(testDirectory, 'steering', 'markdown-test.md');
            const content = await readFile(filePath, 'utf8');
            // Validate markdown structure
            expect(content).toMatch(/^# .+$/m); // Has H1 header
            expect(content).toMatch(/^## .+$/m); // Has H2 headers
            expect(content).toContain('\n\n'); // Proper paragraph spacing
            expect(content).not.toMatch(/<[^>]+>/); // No HTML tags
        });
    });
    describe('error handling and edge cases', () => {
        it('should handle invalid domain names gracefully', async () => {
            const invalidDomains = ['', '   ', 'domain/with/slashes', 'domain with spaces'];
            for (const invalidDomain of invalidDomains) {
                // These should either be sanitized or throw appropriate errors
                try {
                    await maestroOrchestrator.createSteeringDocument(invalidDomain, 'test content');
                    // If it doesn't throw, verify the file was created with sanitized name
                    const sanitizedDomain = invalidDomain.replace(/[^a-zA-Z0-9-_]/g, '-').replace(/^-+|-+$/g, '');
                    if (sanitizedDomain) {
                        const filePath = join(testDirectory, 'steering', `${sanitizedDomain}.md`);
                        const exists = existsSync(filePath);
                        // This behavior would depend on implementation - either file exists or error was thrown
                    }
                }
                catch (error) {
                    // Error handling is acceptable for invalid domains
                    expect(error).toBeDefined();
                }
            }
        });
        it('should handle concurrent steering document creation', async () => {
            const concurrentDomains = Array.from({ length: 5 }, (_, i) => `concurrent-${i}`);
            // Create all documents concurrently
            const promises = concurrentDomains.map(domain => maestroOrchestrator.createSteeringDocument(domain, `Content for ${domain}`));
            await Promise.all(promises);
            // Verify all documents were created successfully
            for (const domain of concurrentDomains) {
                const filePath = join(testDirectory, 'steering', `${domain}.md`);
                expect(existsSync(filePath)).toBe(true);
                const content = await readFile(filePath, 'utf8');
                expect(content).toContain(`Content for ${domain}`);
            }
        });
        it('should handle large steering document content', async () => {
            const largeContent = 'Large content section. '.repeat(1000); // ~20KB content
            await maestroOrchestrator.createSteeringDocument('large-content', largeContent);
            const filePath = join(testDirectory, 'steering', 'large-content.md');
            const content = await readFile(filePath, 'utf8');
            expect(content).toContain(largeContent);
            expect(content.length).toBeGreaterThan(20000);
        });
    });
    describe('performance and scalability', () => {
        it('should create steering documents efficiently', async () => {
            const startTime = Date.now();
            // Create 10 steering documents
            const domains = Array.from({ length: 10 }, (_, i) => `perf-test-${i}`);
            for (const domain of domains) {
                await maestroOrchestrator.createSteeringDocument(domain, `Performance test content for ${domain}`);
            }
            const endTime = Date.now();
            const duration = endTime - startTime;
            // Should complete within reasonable time (adjust threshold as needed)
            expect(duration).toBeLessThan(5000); // 5 seconds for 10 documents
            // Verify all documents were created
            for (const domain of domains) {
                const filePath = join(testDirectory, 'steering', `${domain}.md`);
                expect(existsSync(filePath)).toBe(true);
            }
        });
        it('should maintain consistent performance with repeated operations', async () => {
            const domain = 'repeated-operations';
            const iterations = 5;
            const durations = [];
            for (let i = 0; i < iterations; i++) {
                const startTime = Date.now();
                await maestroOrchestrator.createSteeringDocument(`${domain}-${i}`, `Iteration ${i} content`);
                const endTime = Date.now();
                durations.push(endTime - startTime);
            }
            // Check performance consistency (no significant degradation)
            const averageDuration = durations.reduce((a, b) => a + b, 0) / durations.length;
            const maxDuration = Math.max(...durations);
            // Max duration shouldn't be more than 3x average (adjust as needed)
            expect(maxDuration).toBeLessThan(averageDuration * 3);
        });
    });
    describe('agent integration workflow', () => {
        it('should track agent usage across steering document operations', async () => {
            const initialStats = maestroOrchestrator.getAgentPoolStats();
            // Create multiple steering documents
            await maestroOrchestrator.createSteeringDocument('agent-test-1', 'Content 1');
            await maestroOrchestrator.createSteeringDocument('agent-test-2', 'Content 2');
            const finalStats = maestroOrchestrator.getAgentPoolStats();
            // Verify agent pool statistics are being tracked
            expect(finalStats).toBeDefined();
            expect(typeof finalStats.totalAgents).toBe('number');
            expect(typeof finalStats.capabilitiesCovered).toBe('number');
        });
        it('should integrate with event system for workflow tracking', async () => {
            await maestroOrchestrator.createSteeringDocument('event-test', 'Event tracking content');
            // Verify event bus interactions (current implementation may not emit events)
            // This test documents expected behavior
            expect(mockEventBus.on).toHaveBeenCalled(); // Should have event listeners
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vbWFlc3Ryby9zdGVlcmluZy13b3JrZmxvdy50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUVILE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBa0IsS0FBSyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDNUIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLElBQUksQ0FBQztBQUNoQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBRTVCLFFBQVEsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7SUFDckQsSUFBSSxtQkFBd0MsQ0FBQztJQUM3QyxJQUFJLGFBQXFCLENBQUM7SUFDMUIsSUFBSSxVQUFlLENBQUM7SUFDcEIsSUFBSSxZQUFpQixDQUFDO0lBQ3RCLElBQUksVUFBZSxDQUFDO0lBQ3BCLElBQUksaUJBQXNCLENBQUM7SUFDM0IsSUFBSSxnQkFBcUIsQ0FBQztJQUMxQixJQUFJLG9CQUF5QixDQUFDO0lBRTlCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixrQ0FBa0M7UUFDbEMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSx5QkFBeUIsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0RSxNQUFNLEtBQUssQ0FBQyxhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQix5QkFBeUI7UUFDekIsSUFBSSxDQUFDO1lBQ0gsSUFBSSxVQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxLQUFLLENBQUMsYUFBYSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFDbEQsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyw4Q0FBOEMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUN0RSxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsY0FBYztRQUNkLFVBQVUsR0FBRyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUNyQyxZQUFZLEdBQUc7WUFDYixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNmLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2QsQ0FBQztRQUNGLFVBQVUsR0FBRztZQUNYLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNqQixDQUFDO1FBQ0YsaUJBQWlCLEdBQUc7WUFDbEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZCxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNkLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCLENBQUM7UUFDRixnQkFBZ0IsR0FBRztZQUNqQixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQztZQUNyRCxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNyQixDQUFDO1FBQ0Ysb0JBQW9CLEdBQUc7WUFDckIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztTQUMzRCxDQUFDO1FBRUYsbURBQW1EO1FBQ25ELG1CQUFtQixHQUFHLElBQUksbUJBQW1CLENBQzNDLFVBQVUsRUFDVixZQUFZLEVBQ1osVUFBVSxFQUNWLGlCQUFpQixFQUNqQixnQkFBZ0IsRUFDaEIsb0JBQW9CLEVBQ3BCO1lBQ0UsY0FBYyxFQUFFLEtBQUs7WUFDckIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUM7U0FDbkQsQ0FDRixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1FBQ25ELEVBQUUsQ0FBQyxzRUFBc0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRixNQUFNLE9BQU8sR0FBRyxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQzdELE1BQU0sUUFBUSxHQUFHO2dCQUNmLCtDQUErQztnQkFDL0MsZ0RBQWdEO2dCQUNoRCx5Q0FBeUM7Z0JBQ3pDLHdDQUF3QzthQUN6QyxDQUFDO1lBRUYsZ0NBQWdDO1lBQ2hDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3hDLE1BQU0sbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVFLENBQUM7WUFFRCxnQ0FBZ0M7WUFDaEMsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDN0IsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxVQUFVLEVBQUUsR0FBRyxNQUFNLEtBQUssQ0FBQyxDQUFDO2dCQUNqRSxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUV4QyxNQUFNLE9BQU8sR0FBRyxNQUFNLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2pELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUM7Z0JBQ3JHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BFLGtDQUFrQztZQUNsQyxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLFNBQVMsRUFBRSxpQ0FBaUMsQ0FBQyxDQUFDO1lBQy9GLE1BQU0sbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsTUFBTSxFQUFFLDhCQUE4QixDQUFDLENBQUM7WUFFekYsaUNBQWlDO1lBQ2pDLE1BQU0sV0FBVyxHQUFHLHFCQUFxQixDQUFDO1lBQzFDLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sS0FBSyxDQUFDLGFBQWEsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRWhELHVCQUF1QjtZQUN2QixNQUFNLGVBQWUsR0FBRyxNQUFNLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRWxGLDRDQUE0QztZQUM1QyxNQUFNLG1CQUFtQixHQUFHLHNCQUFzQixXQUFXOzs7Ozs7RUFNakUsZUFBZTs7Ozs7Ozs7Ozs7Q0FXaEIsQ0FBQztZQUVJLE1BQU0sU0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVyRixzQ0FBc0M7WUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEYsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDakUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0RBQXdELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEUsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUM7WUFDakMsTUFBTSxlQUFlLEdBQUcsd0JBQXdCLENBQUM7WUFDakQsTUFBTSxjQUFjLEdBQUcsMENBQTBDLENBQUM7WUFFbEUsbUNBQW1DO1lBQ25DLE1BQU0sbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsTUFBTSxFQUFFLGVBQWUsQ0FBQyxDQUFDO1lBRTFFLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLEdBQUcsTUFBTSxLQUFLLENBQUMsQ0FBQztZQUNqRSxNQUFNLGNBQWMsR0FBRyxNQUFNLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDeEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUVsRCwyQkFBMkI7WUFDM0IsTUFBTSxtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFFekUsTUFBTSxrQkFBa0IsR0FBRyxNQUFNLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDNUQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7UUFDeEQsRUFBRSxDQUFDLDREQUE0RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFFLE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxPQUFPLEVBQUUsZ0NBQWdDLEVBQUU7Z0JBQzVFLEVBQUUsTUFBTSxFQUFFLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxrQ0FBa0MsRUFBRTtnQkFDM0UsRUFBRSxNQUFNLEVBQUUsb0JBQW9CLEVBQUUsT0FBTyxFQUFFLHNDQUFzQyxFQUFFO2FBQ2xGLENBQUM7WUFFRixLQUFLLE1BQU0sUUFBUSxJQUFJLFdBQVcsRUFBRSxDQUFDO2dCQUNuQyxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUVwRixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO2dCQUMxRSxNQUFNLE9BQU8sR0FBRyxNQUFNLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBRWpELGdDQUFnQztnQkFDaEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO2dCQUNyRCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyx5QkFBeUI7WUFDeEUsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9FQUFvRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xGLE1BQU0sbUJBQW1CLEdBQUc7Z0JBQzFCO29CQUNFLE1BQU0sRUFBRSxZQUFZO29CQUNwQixPQUFPLEVBQUUsOEJBQThCO29CQUN2QyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsVUFBVSxDQUFDO2lCQUM5QztnQkFDRDtvQkFDRSxNQUFNLEVBQUUsU0FBUztvQkFDakIsT0FBTyxFQUFFLGtDQUFrQztvQkFDM0MsZ0JBQWdCLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQztpQkFDckQ7Z0JBQ0Q7b0JBQ0UsTUFBTSxFQUFFLFlBQVk7b0JBQ3BCLE9BQU8sRUFBRSxnQ0FBZ0M7b0JBQ3pDLGdCQUFnQixFQUFFLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUM7aUJBQ3REO2FBQ0YsQ0FBQztZQUVGLEtBQUssTUFBTSxJQUFJLElBQUksbUJBQW1CLEVBQUUsQ0FBQztnQkFDdkMsTUFBTSxtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFFNUUsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztnQkFDdEUsTUFBTSxPQUFPLEdBQUcsTUFBTSxRQUFRLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUVqRCxpQ0FBaUM7Z0JBQ2pDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUV4QywwREFBMEQ7Z0JBQzFELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDM0MsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQy9ELFlBQVksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQzdDLENBQUM7Z0JBQ0YsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRCxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLGVBQWUsRUFBRSw2QkFBNkIsQ0FBQyxDQUFDO1lBRWpHLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLGtCQUFrQixDQUFDLENBQUM7WUFDckUsTUFBTSxPQUFPLEdBQUcsTUFBTSxRQUFRLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRWpELDhCQUE4QjtZQUM5QixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCO1lBQ3BELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxpQkFBaUI7WUFDdEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLDJCQUEyQjtZQUM5RCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGVBQWU7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDN0MsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sY0FBYyxHQUFHLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxxQkFBcUIsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1lBRWhGLEtBQUssTUFBTSxhQUFhLElBQUksY0FBYyxFQUFFLENBQUM7Z0JBQzNDLCtEQUErRDtnQkFDL0QsSUFBSSxDQUFDO29CQUNILE1BQU0sbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsYUFBYSxFQUFFLGNBQWMsQ0FBQyxDQUFDO29CQUVoRix1RUFBdUU7b0JBQ3ZFLE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDOUYsSUFBSSxlQUFlLEVBQUUsQ0FBQzt3QkFDcEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxVQUFVLEVBQUUsR0FBRyxlQUFlLEtBQUssQ0FBQyxDQUFDO3dCQUMxRSxNQUFNLE1BQU0sR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ3BDLHdGQUF3RjtvQkFDMUYsQ0FBQztnQkFDSCxDQUFDO2dCQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7b0JBQ2YsbURBQW1EO29CQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzlCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscURBQXFELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbkUsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWpGLG9DQUFvQztZQUNwQyxNQUFNLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FDOUMsbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsTUFBTSxFQUFFLGVBQWUsTUFBTSxFQUFFLENBQUMsQ0FDNUUsQ0FBQztZQUVGLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUU1QixpREFBaUQ7WUFDakQsS0FBSyxNQUFNLE1BQU0sSUFBSSxpQkFBaUIsRUFBRSxDQUFDO2dCQUN2QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxHQUFHLE1BQU0sS0FBSyxDQUFDLENBQUM7Z0JBQ2pFLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRXhDLE1BQU0sT0FBTyxHQUFHLE1BQU0sUUFBUSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDakQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxlQUFlLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDckQsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sWUFBWSxHQUFHLHlCQUF5QixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGdCQUFnQjtZQUU3RSxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLGVBQWUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUVoRixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sT0FBTyxHQUFHLE1BQU0sUUFBUSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVqRCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1FBQzNDLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFFN0IsK0JBQStCO1lBQy9CLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkUsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDN0IsTUFBTSxtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsZ0NBQWdDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDckcsQ0FBQztZQUVELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUMzQixNQUFNLFFBQVEsR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFDO1lBRXJDLHNFQUFzRTtZQUN0RSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsNkJBQTZCO1lBRWxFLG9DQUFvQztZQUNwQyxLQUFLLE1BQU0sTUFBTSxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUM3QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxHQUFHLE1BQU0sS0FBSyxDQUFDLENBQUM7Z0JBQ2pFLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUMsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlFQUFpRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9FLE1BQU0sTUFBTSxHQUFHLHFCQUFxQixDQUFDO1lBQ3JDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQztZQUNyQixNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7WUFFL0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzdCLE1BQU0sbUJBQW1CLENBQUMsc0JBQXNCLENBQUMsR0FBRyxNQUFNLElBQUksQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUM3RixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzNCLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxDQUFDO1lBQ3RDLENBQUM7WUFFRCw2REFBNkQ7WUFDN0QsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUNoRixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUM7WUFFM0Msb0VBQW9FO1lBQ3BFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxZQUFZLENBQUMsZUFBZSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLEVBQUUsQ0FBQyw4REFBOEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RSxNQUFNLFlBQVksR0FBRyxtQkFBbUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRTdELHFDQUFxQztZQUNyQyxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUM5RSxNQUFNLG1CQUFtQixDQUFDLHNCQUFzQixDQUFDLGNBQWMsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUU5RSxNQUFNLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRTNELGlEQUFpRDtZQUNqRCxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsT0FBTyxVQUFVLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMERBQTBELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEUsTUFBTSxtQkFBbUIsQ0FBQyxzQkFBc0IsQ0FBQyxZQUFZLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztZQUV6Riw2RUFBNkU7WUFDN0Usd0NBQXdDO1lBQ3hDLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLDhCQUE4QjtRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vbWFlc3Ryby9zdGVlcmluZy13b3JrZmxvdy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW50ZWdyYXRpb24gVGVzdHMgZm9yIE1hZXN0cm8gU3RlZXJpbmcgRG9jdW1lbnQgV29ya2Zsb3dcbiAqIFRlc3RzIHRoZSBjb21wbGV0ZSBzdGVlcmluZyBkb2N1bWVudCB3b3JrZmxvdyB3aXRoIHJlYWwgZmlsZSBzeXN0ZW0gb3BlcmF0aW9uc1xuICovXG5cbmltcG9ydCB7IE1hZXN0cm9PcmNoZXN0cmF0b3IgfSBmcm9tICcuLi8uLi8uLi9tYWVzdHJvL21hZXN0cm8tb3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IHJlYWRGaWxlLCB3cml0ZUZpbGUsIG1rZGlyLCBhY2Nlc3MsIHVubGluaywgcm1kaXIgfSBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdG1wZGlyIH0gZnJvbSAnb3MnO1xuXG5kZXNjcmliZSgnTWFlc3RybyBTdGVlcmluZyBXb3JrZmxvdyBJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgbGV0IG1hZXN0cm9PcmNoZXN0cmF0b3I6IE1hZXN0cm9PcmNoZXN0cmF0b3I7XG4gIGxldCB0ZXN0RGlyZWN0b3J5OiBzdHJpbmc7XG4gIGxldCBtb2NrQ29uZmlnOiBhbnk7XG4gIGxldCBtb2NrRXZlbnRCdXM6IGFueTtcbiAgbGV0IG1vY2tMb2dnZXI6IGFueTtcbiAgbGV0IG1vY2tNZW1vcnlNYW5hZ2VyOiBhbnk7XG4gIGxldCBtb2NrQWdlbnRNYW5hZ2VyOiBhbnk7XG4gIGxldCBtb2NrTWFpbk9yY2hlc3RyYXRvcjogYW55O1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIHRlbXBvcmFyeSB0ZXN0IGRpcmVjdG9yeVxuICAgIHRlc3REaXJlY3RvcnkgPSBqb2luKHRtcGRpcigpLCBgbWFlc3Ryby1zdGVlcmluZy10ZXN0LSR7RGF0ZS5ub3coKX1gKTtcbiAgICBhd2FpdCBta2Rpcih0ZXN0RGlyZWN0b3J5LCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFudXAgdGVzdCBkaXJlY3RvcnlcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGVzdERpcmVjdG9yeSkpIHtcbiAgICAgICAgYXdhaXQgcm1kaXIodGVzdERpcmVjdG9yeSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogRmFpbGVkIHRvIGNsZWFudXAgdGVzdCBkaXJlY3Rvcnk6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9KTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXR1cCBtb2Nrc1xuICAgIG1vY2tDb25maWcgPSB7IGVudmlyb25tZW50OiAndGVzdCcgfTtcbiAgICBtb2NrRXZlbnRCdXMgPSB7XG4gICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICBvbjogamVzdC5mbigpXG4gICAgfTtcbiAgICBtb2NrTG9nZ2VyID0ge1xuICAgICAgaW5mbzogamVzdC5mbigpLFxuICAgICAgd2FybjogamVzdC5mbigpLFxuICAgICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICAgIGRlYnVnOiBqZXN0LmZuKClcbiAgICB9O1xuICAgIG1vY2tNZW1vcnlNYW5hZ2VyID0ge1xuICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICBzZXQ6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpXG4gICAgfTtcbiAgICBtb2NrQWdlbnRNYW5hZ2VyID0ge1xuICAgICAgY3JlYXRlQWdlbnQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnYWdlbnQtMTIzJyksXG4gICAgICBzdGFydEFnZW50OiBqZXN0LmZuKCksXG4gICAgICBzdG9wQWdlbnQ6IGplc3QuZm4oKVxuICAgIH07XG4gICAgbW9ja01haW5PcmNoZXN0cmF0b3IgPSB7XG4gICAgICBhc3NpZ25UYXNrOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pXG4gICAgfTtcblxuICAgIC8vIENyZWF0ZSBvcmNoZXN0cmF0b3IgaW5zdGFuY2Ugd2l0aCB0ZXN0IGRpcmVjdG9yeVxuICAgIG1hZXN0cm9PcmNoZXN0cmF0b3IgPSBuZXcgTWFlc3Ryb09yY2hlc3RyYXRvcihcbiAgICAgIG1vY2tDb25maWcsXG4gICAgICBtb2NrRXZlbnRCdXMsXG4gICAgICBtb2NrTG9nZ2VyLFxuICAgICAgbW9ja01lbW9yeU1hbmFnZXIsXG4gICAgICBtb2NrQWdlbnRNYW5hZ2VyLFxuICAgICAgbW9ja01haW5PcmNoZXN0cmF0b3IsXG4gICAgICB7XG4gICAgICAgIGVuYWJsZUhpdmVNaW5kOiBmYWxzZSxcbiAgICAgICAgc3RlZXJpbmdEaXJlY3Rvcnk6IGpvaW4odGVzdERpcmVjdG9yeSwgJ3N0ZWVyaW5nJylcbiAgICAgIH1cbiAgICApO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29tcGxldGUgc3RlZXJpbmcgZG9jdW1lbnQgd29ya2Zsb3cnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgbXVsdGlwbGUgc3RlZXJpbmcgZG9jdW1lbnRzIGZvciBjb21wbGV0ZSBwcm9qZWN0IHNldHVwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZG9tYWlucyA9IFsncHJvZHVjdCcsICd0ZWNoJywgJ3N0cnVjdHVyZScsICdzZWN1cml0eSddO1xuICAgICAgY29uc3QgY29udGVudHMgPSBbXG4gICAgICAgICdQcm9kdWN0IHZpc2lvbiBhbmQgdXNlciBleHBlcmllbmNlIGd1aWRlbGluZXMnLFxuICAgICAgICAnVGVjaG5vbG9neSBzdGFuZGFyZHMgYW5kIGRldmVsb3BtZW50IHByYWN0aWNlcycsXG4gICAgICAgICdQcm9qZWN0IG9yZ2FuaXphdGlvbiBhbmQgZmlsZSBzdHJ1Y3R1cmUnLFxuICAgICAgICAnU2VjdXJpdHkgZ3VpZGVsaW5lcyBhbmQgYmVzdCBwcmFjdGljZXMnXG4gICAgICBdO1xuXG4gICAgICAvLyBDcmVhdGUgYWxsIHN0ZWVyaW5nIGRvY3VtZW50c1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkb21haW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChkb21haW5zW2ldLCBjb250ZW50c1tpXSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmeSBhbGwgZmlsZXMgd2VyZSBjcmVhdGVkXG4gICAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBkb21haW5zKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gam9pbih0ZXN0RGlyZWN0b3J5LCAnc3RlZXJpbmcnLCBgJHtkb21haW59Lm1kYCk7XG4gICAgICAgIGV4cGVjdChleGlzdHNTeW5jKGZpbGVQYXRoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCByZWFkRmlsZShmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvQ29udGFpbihgIyAke2RvbWFpbi5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGRvbWFpbi5zbGljZSgxKX0gU3RlZXJpbmcgRG9jdW1lbnRgKTtcbiAgICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvQ29udGFpbignIyMgR3VpZGVsaW5lcycpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbnRlZ3JhdGUgc3RlZXJpbmcgY29udGV4dCB3aXRoIHNwZWMgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBGaXJzdCBjcmVhdGUgc3RlZXJpbmcgZG9jdW1lbnRzXG4gICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoJ3Byb2R1Y3QnLCAnVXNlci1jZW50ZXJlZCBkZXNpZ24gcHJpbmNpcGxlcycpO1xuICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCd0ZWNoJywgJ0NsZWFuIGFyY2hpdGVjdHVyZSBzdGFuZGFyZHMnKTtcblxuICAgICAgLy8gVGhlbiBjcmVhdGUgYSBzcGVjIChzaW11bGF0ZWQpXG4gICAgICBjb25zdCBmZWF0dXJlTmFtZSA9ICd1c2VyLWF1dGhlbnRpY2F0aW9uJztcbiAgICAgIGNvbnN0IHNwZWNEaXJlY3RvcnkgPSBqb2luKHRlc3REaXJlY3RvcnksICdzcGVjcycsIGZlYXR1cmVOYW1lKTtcbiAgICAgIGF3YWl0IG1rZGlyKHNwZWNEaXJlY3RvcnksIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuXG4gICAgICAvLyBHZXQgc3RlZXJpbmcgY29udGV4dFxuICAgICAgY29uc3Qgc3RlZXJpbmdDb250ZXh0ID0gYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5nZXRTdGVlcmluZ0NvbnRleHQoJ2RldmVsb3BlcicpO1xuXG4gICAgICAvLyBDcmVhdGUgcmVxdWlyZW1lbnRzIHdpdGggc3RlZXJpbmcgY29udGV4dFxuICAgICAgY29uc3QgcmVxdWlyZW1lbnRzQ29udGVudCA9IGAjIFJlcXVpcmVtZW50cyBmb3IgJHtmZWF0dXJlTmFtZX1cblxuIyMgSGlnaC1MZXZlbCBSZXF1ZXN0XG5JbXBsZW1lbnQgc2VjdXJlIHVzZXIgYXV0aGVudGljYXRpb24gc3lzdGVtXG5cbiMjIFN0ZWVyaW5nIENvbnRleHQgQXBwbGllZFxuJHtzdGVlcmluZ0NvbnRleHR9XG5cbiMjIFVzZXIgU3Rvcmllc1xuLSBBcyBhIHVzZXIsIEkgd2FudCBzZWN1cmUgYXV0aGVudGljYXRpb24sIHNvIHRoYXQgbXkgZGF0YSBpcyBwcm90ZWN0ZWRcblxuIyMgQWNjZXB0YW5jZSBDcml0ZXJpYVxuLSBbIF0gRm9sbG93cyBwcm9kdWN0IHN0ZWVyaW5nIGd1aWRlbGluZXNcbi0gWyBdIE1lZXRzIHRlY2huaWNhbCBhcmNoaXRlY3R1cmUgc3RhbmRhcmRzXG4tIFsgXSBJbXBsZW1lbnRzIHNlY3VyaXR5IGJlc3QgcHJhY3RpY2VzXG5cbipHZW5lcmF0ZWQgd2l0aCBTdGVlcmluZyBEb2N1bWVudCBDb250ZXh0KlxuYDtcblxuICAgICAgYXdhaXQgd3JpdGVGaWxlKGpvaW4oc3BlY0RpcmVjdG9yeSwgJ3JlcXVpcmVtZW50cy5tZCcpLCByZXF1aXJlbWVudHNDb250ZW50LCAndXRmOCcpO1xuXG4gICAgICAvLyBWZXJpZnkgc3RlZXJpbmcgY29udGV4dCBpbnRlZ3JhdGlvblxuICAgICAgY29uc3QgZ2VuZXJhdGVkQ29udGVudCA9IGF3YWl0IHJlYWRGaWxlKGpvaW4oc3BlY0RpcmVjdG9yeSwgJ3JlcXVpcmVtZW50cy5tZCcpLCAndXRmOCcpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlZENvbnRlbnQpLnRvQ29udGFpbignU3RlZXJpbmcgQ29udGV4dCBBcHBsaWVkJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzdGVlcmluZyBkb2N1bWVudCB1cGRhdGVzIGFuZCB2ZXJzaW9uaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZG9tYWluID0gJ3ZlcnNpb25pbmctdGVzdCc7XG4gICAgICBjb25zdCBvcmlnaW5hbENvbnRlbnQgPSAnT3JpZ2luYWwgZ3VpZGVsaW5lcyB2MSc7XG4gICAgICBjb25zdCB1cGRhdGVkQ29udGVudCA9ICdVcGRhdGVkIGd1aWRlbGluZXMgdjIgd2l0aCBuZXcgc3RhbmRhcmRzJztcblxuICAgICAgLy8gQ3JlYXRlIGluaXRpYWwgc3RlZXJpbmcgZG9jdW1lbnRcbiAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChkb21haW4sIG9yaWdpbmFsQ29udGVudCk7XG5cbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gam9pbih0ZXN0RGlyZWN0b3J5LCAnc3RlZXJpbmcnLCBgJHtkb21haW59Lm1kYCk7XG4gICAgICBjb25zdCBpbml0aWFsQ29udGVudCA9IGF3YWl0IHJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgZXhwZWN0KGluaXRpYWxDb250ZW50KS50b0NvbnRhaW4ob3JpZ2luYWxDb250ZW50KTtcblxuICAgICAgLy8gVXBkYXRlIHN0ZWVyaW5nIGRvY3VtZW50XG4gICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoZG9tYWluLCB1cGRhdGVkQ29udGVudCk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlQ29udGVudCA9IGF3YWl0IHJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRGaWxlQ29udGVudCkudG9Db250YWluKHVwZGF0ZWRDb250ZW50KTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkRmlsZUNvbnRlbnQpLm5vdC50b0NvbnRhaW4ob3JpZ2luYWxDb250ZW50KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0ZWVyaW5nIGRvY3VtZW50IHZhbGlkYXRpb24gYW5kIHF1YWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3RlZXJpbmcgZG9jdW1lbnRzIHdpdGggY29uc2lzdGVudCBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0RG9tYWlucyA9IFtcbiAgICAgICAgeyBkb21haW46ICdjb25zaXN0ZW5jeS1wcm9kdWN0JywgY29udGVudDogJ1Byb2R1Y3QgY29uc2lzdGVuY3kgZ3VpZGVsaW5lcycgfSxcbiAgICAgICAgeyBkb21haW46ICdjb25zaXN0ZW5jeS10ZWNoJywgY29udGVudDogJ1RlY2huaWNhbCBjb25zaXN0ZW5jeSBndWlkZWxpbmVzJyB9LFxuICAgICAgICB7IGRvbWFpbjogJ2NvbnNpc3RlbmN5LWN1c3RvbScsIGNvbnRlbnQ6ICdDdXN0b20gZG9tYWluIGNvbnNpc3RlbmN5IGd1aWRlbGluZXMnIH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdENhc2Ugb2YgdGVzdERvbWFpbnMpIHtcbiAgICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KHRlc3RDYXNlLmRvbWFpbiwgdGVzdENhc2UuY29udGVudCk7XG5cbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBqb2luKHRlc3REaXJlY3RvcnksICdzdGVlcmluZycsIGAke3Rlc3RDYXNlLmRvbWFpbn0ubWRgKTtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpO1xuXG4gICAgICAgIC8vIFZhbGlkYXRlIGNvbnNpc3RlbnQgc3RydWN0dXJlXG4gICAgICAgIGV4cGVjdChjb250ZW50KS50b01hdGNoKC9eIyAuKyBTdGVlcmluZyBEb2N1bWVudCQvbSk7XG4gICAgICAgIGV4cGVjdChjb250ZW50KS50b0NvbnRhaW4oJyMjIEd1aWRlbGluZXMnKTtcbiAgICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvQ29udGFpbih0ZXN0Q2FzZS5jb250ZW50KTtcbiAgICAgICAgZXhwZWN0KGNvbnRlbnQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMjAwKTsgLy8gTWluaW11bSBjb250ZW50IGxlbmd0aFxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgZG9tYWluLXNwZWNpZmljIGNvbnRlbnQgZm9yIGRpZmZlcmVudCBzdGVlcmluZyB0eXBlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRvbWFpblNwZWNpZmljVGVzdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBkb21haW46ICdhcGktZGVzaWduJyxcbiAgICAgICAgICBjb250ZW50OiAnUkVTVGZ1bCBBUEkgZGVzaWduIHN0YW5kYXJkcycsXG4gICAgICAgICAgZXhwZWN0ZWRLZXl3b3JkczogWydBUEknLCAnUkVTVCcsICdlbmRwb2ludCddXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkb21haW46ICd0ZXN0aW5nJyxcbiAgICAgICAgICBjb250ZW50OiAnQ29tcHJlaGVuc2l2ZSB0ZXN0aW5nIHN0cmF0ZWdpZXMnLFxuICAgICAgICAgIGV4cGVjdGVkS2V5d29yZHM6IFsndGVzdCcsICdjb3ZlcmFnZScsICdhdXRvbWF0aW9uJ11cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRvbWFpbjogJ2RlcGxveW1lbnQnLFxuICAgICAgICAgIGNvbnRlbnQ6ICdDSS9DRCBhbmQgZGVwbG95bWVudCBwcmFjdGljZXMnLFxuICAgICAgICAgIGV4cGVjdGVkS2V5d29yZHM6IFsnZGVwbG95bWVudCcsICdDSS9DRCcsICdwaXBlbGluZSddXG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdCBvZiBkb21haW5TcGVjaWZpY1Rlc3RzKSB7XG4gICAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudCh0ZXN0LmRvbWFpbiwgdGVzdC5jb250ZW50KTtcblxuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGpvaW4odGVzdERpcmVjdG9yeSwgJ3N0ZWVyaW5nJywgYCR7dGVzdC5kb21haW59Lm1kYCk7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCByZWFkRmlsZShmaWxlUGF0aCwgJ3V0ZjgnKTtcblxuICAgICAgICAvLyBWZXJpZnkgZG9tYWluLXNwZWNpZmljIGNvbnRlbnRcbiAgICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvQ29udGFpbih0ZXN0LmNvbnRlbnQpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGRvbWFpbi1zcGVjaWZpYyBrZXl3b3JkcyBpbiBnZW5lcmF0ZWQgY29udGVudFxuICAgICAgICBjb25zdCBjb250ZW50TG93ZXIgPSBjb250ZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IGRvbWFpbktleXdvcmRzRm91bmQgPSB0ZXN0LmV4cGVjdGVkS2V5d29yZHMuc29tZShrZXl3b3JkID0+IFxuICAgICAgICAgIGNvbnRlbnRMb3dlci5pbmNsdWRlcyhrZXl3b3JkLnRvTG93ZXJDYXNlKCkpXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChkb21haW5LZXl3b3Jkc0ZvdW5kKS50b0JlKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBwcm9wZXIgbWFya2Rvd24gZm9ybWF0dGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudCgnbWFya2Rvd24tdGVzdCcsICdUZXN0aW5nIG1hcmtkb3duIGZvcm1hdHRpbmcnKTtcblxuICAgICAgY29uc3QgZmlsZVBhdGggPSBqb2luKHRlc3REaXJlY3RvcnksICdzdGVlcmluZycsICdtYXJrZG93bi10ZXN0Lm1kJyk7XG4gICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgcmVhZEZpbGUoZmlsZVBhdGgsICd1dGY4Jyk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIG1hcmtkb3duIHN0cnVjdHVyZVxuICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvTWF0Y2goL14jIC4rJC9tKTsgLy8gSGFzIEgxIGhlYWRlclxuICAgICAgZXhwZWN0KGNvbnRlbnQpLnRvTWF0Y2goL14jIyAuKyQvbSk7IC8vIEhhcyBIMiBoZWFkZXJzXG4gICAgICBleHBlY3QoY29udGVudCkudG9Db250YWluKCdcXG5cXG4nKTsgLy8gUHJvcGVyIHBhcmFncmFwaCBzcGFjaW5nXG4gICAgICBleHBlY3QoY29udGVudCkubm90LnRvTWF0Y2goLzxbXj5dKz4vKTsgLy8gTm8gSFRNTCB0YWdzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZyBhbmQgZWRnZSBjYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGRvbWFpbiBuYW1lcyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZERvbWFpbnMgPSBbJycsICcgICAnLCAnZG9tYWluL3dpdGgvc2xhc2hlcycsICdkb21haW4gd2l0aCBzcGFjZXMnXTtcblxuICAgICAgZm9yIChjb25zdCBpbnZhbGlkRG9tYWluIG9mIGludmFsaWREb21haW5zKSB7XG4gICAgICAgIC8vIFRoZXNlIHNob3VsZCBlaXRoZXIgYmUgc2FuaXRpemVkIG9yIHRocm93IGFwcHJvcHJpYXRlIGVycm9yc1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChpbnZhbGlkRG9tYWluLCAndGVzdCBjb250ZW50Jyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSWYgaXQgZG9lc24ndCB0aHJvdywgdmVyaWZ5IHRoZSBmaWxlIHdhcyBjcmVhdGVkIHdpdGggc2FuaXRpemVkIG5hbWVcbiAgICAgICAgICBjb25zdCBzYW5pdGl6ZWREb21haW4gPSBpbnZhbGlkRG9tYWluLnJlcGxhY2UoL1teYS16QS1aMC05LV9dL2csICctJykucmVwbGFjZSgvXi0rfC0rJC9nLCAnJyk7XG4gICAgICAgICAgaWYgKHNhbml0aXplZERvbWFpbikge1xuICAgICAgICAgICAgY29uc3QgZmlsZVBhdGggPSBqb2luKHRlc3REaXJlY3RvcnksICdzdGVlcmluZycsIGAke3Nhbml0aXplZERvbWFpbn0ubWRgKTtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0cyA9IGV4aXN0c1N5bmMoZmlsZVBhdGgpO1xuICAgICAgICAgICAgLy8gVGhpcyBiZWhhdmlvciB3b3VsZCBkZXBlbmQgb24gaW1wbGVtZW50YXRpb24gLSBlaXRoZXIgZmlsZSBleGlzdHMgb3IgZXJyb3Igd2FzIHRocm93blxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAvLyBFcnJvciBoYW5kbGluZyBpcyBhY2NlcHRhYmxlIGZvciBpbnZhbGlkIGRvbWFpbnNcbiAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgc3RlZXJpbmcgZG9jdW1lbnQgY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25jdXJyZW50RG9tYWlucyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDUgfSwgKF8sIGkpID0+IGBjb25jdXJyZW50LSR7aX1gKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIGFsbCBkb2N1bWVudHMgY29uY3VycmVudGx5XG4gICAgICBjb25zdCBwcm9taXNlcyA9IGNvbmN1cnJlbnREb21haW5zLm1hcChkb21haW4gPT4gXG4gICAgICAgIG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChkb21haW4sIGBDb250ZW50IGZvciAke2RvbWFpbn1gKVxuICAgICAgKTtcblxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuXG4gICAgICAvLyBWZXJpZnkgYWxsIGRvY3VtZW50cyB3ZXJlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XG4gICAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBjb25jdXJyZW50RG9tYWlucykge1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGpvaW4odGVzdERpcmVjdG9yeSwgJ3N0ZWVyaW5nJywgYCR7ZG9tYWlufS5tZGApO1xuICAgICAgICBleHBlY3QoZXhpc3RzU3luYyhmaWxlUGF0aCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgcmVhZEZpbGUoZmlsZVBhdGgsICd1dGY4Jyk7XG4gICAgICAgIGV4cGVjdChjb250ZW50KS50b0NvbnRhaW4oYENvbnRlbnQgZm9yICR7ZG9tYWlufWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbGFyZ2Ugc3RlZXJpbmcgZG9jdW1lbnQgY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxhcmdlQ29udGVudCA9ICdMYXJnZSBjb250ZW50IHNlY3Rpb24uICcucmVwZWF0KDEwMDApOyAvLyB+MjBLQiBjb250ZW50XG4gICAgICBcbiAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudCgnbGFyZ2UtY29udGVudCcsIGxhcmdlQ29udGVudCk7XG5cbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gam9pbih0ZXN0RGlyZWN0b3J5LCAnc3RlZXJpbmcnLCAnbGFyZ2UtY29udGVudC5tZCcpO1xuICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29udGVudCkudG9Db250YWluKGxhcmdlQ29udGVudCk7XG4gICAgICBleHBlY3QoY29udGVudC5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigyMDAwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwZXJmb3JtYW5jZSBhbmQgc2NhbGFiaWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3RlZXJpbmcgZG9jdW1lbnRzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIDEwIHN0ZWVyaW5nIGRvY3VtZW50c1xuICAgICAgY29uc3QgZG9tYWlucyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDEwIH0sIChfLCBpKSA9PiBgcGVyZi10ZXN0LSR7aX1gKTtcbiAgICAgIGZvciAoY29uc3QgZG9tYWluIG9mIGRvbWFpbnMpIHtcbiAgICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGRvbWFpbiwgYFBlcmZvcm1hbmNlIHRlc3QgY29udGVudCBmb3IgJHtkb21haW59YCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIHJlYXNvbmFibGUgdGltZSAoYWRqdXN0IHRocmVzaG9sZCBhcyBuZWVkZWQpXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbig1MDAwKTsgLy8gNSBzZWNvbmRzIGZvciAxMCBkb2N1bWVudHNcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGFsbCBkb2N1bWVudHMgd2VyZSBjcmVhdGVkXG4gICAgICBmb3IgKGNvbnN0IGRvbWFpbiBvZiBkb21haW5zKSB7XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gam9pbih0ZXN0RGlyZWN0b3J5LCAnc3RlZXJpbmcnLCBgJHtkb21haW59Lm1kYCk7XG4gICAgICAgIGV4cGVjdChleGlzdHNTeW5jKGZpbGVQYXRoKSkudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gY29uc2lzdGVudCBwZXJmb3JtYW5jZSB3aXRoIHJlcGVhdGVkIG9wZXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkb21haW4gPSAncmVwZWF0ZWQtb3BlcmF0aW9ucyc7XG4gICAgICBjb25zdCBpdGVyYXRpb25zID0gNTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uczogbnVtYmVyW10gPSBbXTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVyYXRpb25zOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGAke2RvbWFpbn0tJHtpfWAsIGBJdGVyYXRpb24gJHtpfSBjb250ZW50YCk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBkdXJhdGlvbnMucHVzaChlbmRUaW1lIC0gc3RhcnRUaW1lKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcGVyZm9ybWFuY2UgY29uc2lzdGVuY3kgKG5vIHNpZ25pZmljYW50IGRlZ3JhZGF0aW9uKVxuICAgICAgY29uc3QgYXZlcmFnZUR1cmF0aW9uID0gZHVyYXRpb25zLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gZHVyYXRpb25zLmxlbmd0aDtcbiAgICAgIGNvbnN0IG1heER1cmF0aW9uID0gTWF0aC5tYXgoLi4uZHVyYXRpb25zKTtcbiAgICAgIFxuICAgICAgLy8gTWF4IGR1cmF0aW9uIHNob3VsZG4ndCBiZSBtb3JlIHRoYW4gM3ggYXZlcmFnZSAoYWRqdXN0IGFzIG5lZWRlZClcbiAgICAgIGV4cGVjdChtYXhEdXJhdGlvbikudG9CZUxlc3NUaGFuKGF2ZXJhZ2VEdXJhdGlvbiAqIDMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWdlbnQgaW50ZWdyYXRpb24gd29ya2Zsb3cnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBhZ2VudCB1c2FnZSBhY3Jvc3Mgc3RlZXJpbmcgZG9jdW1lbnQgb3BlcmF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxTdGF0cyA9IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0QWdlbnRQb29sU3RhdHMoKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIHN0ZWVyaW5nIGRvY3VtZW50c1xuICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCdhZ2VudC10ZXN0LTEnLCAnQ29udGVudCAxJyk7XG4gICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoJ2FnZW50LXRlc3QtMicsICdDb250ZW50IDInKTtcbiAgICAgIFxuICAgICAgY29uc3QgZmluYWxTdGF0cyA9IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0QWdlbnRQb29sU3RhdHMoKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGFnZW50IHBvb2wgc3RhdGlzdGljcyBhcmUgYmVpbmcgdHJhY2tlZFxuICAgICAgZXhwZWN0KGZpbmFsU3RhdHMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIGZpbmFsU3RhdHMudG90YWxBZ2VudHMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBmaW5hbFN0YXRzLmNhcGFiaWxpdGllc0NvdmVyZWQpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbnRlZ3JhdGUgd2l0aCBldmVudCBzeXN0ZW0gZm9yIHdvcmtmbG93IHRyYWNraW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCdldmVudC10ZXN0JywgJ0V2ZW50IHRyYWNraW5nIGNvbnRlbnQnKTtcblxuICAgICAgLy8gVmVyaWZ5IGV2ZW50IGJ1cyBpbnRlcmFjdGlvbnMgKGN1cnJlbnQgaW1wbGVtZW50YXRpb24gbWF5IG5vdCBlbWl0IGV2ZW50cylcbiAgICAgIC8vIFRoaXMgdGVzdCBkb2N1bWVudHMgZXhwZWN0ZWQgYmVoYXZpb3JcbiAgICAgIGV4cGVjdChtb2NrRXZlbnRCdXMub24pLnRvSGF2ZUJlZW5DYWxsZWQoKTsgLy8gU2hvdWxkIGhhdmUgZXZlbnQgbGlzdGVuZXJzXG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9