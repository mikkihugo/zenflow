31d268f0ebf879f05971033c6aa8d0f2
/**
 * Claude-Zen Web â†” MCP Integration Layer - London School TDD Tests
 *
 * Testing the integration layer that bridges Web API and MCP server using London School principles:
 * - Outside-in development from user API requests to MCP protocol
 * - Mock-driven contracts for seamless component bridging
 * - Behavior verification for request/response transformation
 * - Focus on protocol translation and error handling
 */
import { jest, describe, it, expect, beforeEach, afterEach } from '@jest/globals';
// === MOCK DEPENDENCIES (London School Contract Definition) ===
// Mock Web API Server - HTTP request handling contract
const mockWebApiServer = {
    get: jest.fn(),
    post: jest.fn(),
    put: jest.fn(),
    delete: jest.fn(),
    use: jest.fn(),
    listen: jest.fn(),
    close: jest.fn(),
};
// Mock MCP Server - Protocol communication contract
const mockMcpServer = {
    call: jest.fn(),
    listTools: jest.fn(),
    getCapabilities: jest.fn(),
    notify: jest.fn(),
};
// Mock Request Transformer - HTTP to MCP transformation contract
const mockRequestTransformer = {
    httpToMcp: jest.fn(),
    mcpToHttp: jest.fn(),
    validateHttpRequest: jest.fn(),
    validateMcpResponse: jest.fn(),
};
// Mock Response Formatter - Response standardization contract
const mockResponseFormatter = {
    formatSuccess: jest.fn(),
    formatError: jest.fn(),
    formatStream: jest.fn(),
    addMetadata: jest.fn(),
};
// Mock Error Handler - Error transformation contract
const mockErrorHandler = {
    handleMcpError: jest.fn(),
    handleHttpError: jest.fn(),
    createErrorResponse: jest.fn(),
    logError: jest.fn(),
};
// Mock Authentication - Security contract
const mockAuthHandler = {
    validateApiKey: jest.fn(),
    checkPermissions: jest.fn(),
    createAuthContext: jest.fn(),
};
describe('Claude-Zen Web â†” MCP Integration Layer - London School TDD', () => {
    // Mock Integration Layer class (based on architectural needs)
    class MockWebMcpIntegrationLayer {
        webServer;
        mcpServer;
        requestTransformer;
        responseFormatter;
        errorHandler;
        authHandler;
        constructor() {
            this.webServer = mockWebApiServer;
            this.mcpServer = mockMcpServer;
            this.requestTransformer = mockRequestTransformer;
            this.responseFormatter = mockResponseFormatter;
            this.errorHandler = mockErrorHandler;
            this.authHandler = mockAuthHandler;
        }
        async initialize(webPort, mcpEndpoint) {
            // Setup web server
            mockWebApiServer.listen.mockResolvedValue(undefined);
            await mockWebApiServer.listen(webPort);
            // Setup routes
            this.setupRoutes();
            return Promise.resolve();
        }
        setupRoutes() {
            // Route: List available tools
            mockWebApiServer.get('/api/tools', async (req, res) => {
                return this.handleToolsList(req, res);
            });
            // Route: Execute tool
            mockWebApiServer.post('/api/tools/:toolName', async (req, res) => {
                return this.handleToolExecution(req, res);
            });
            // Route: Queen task coordination
            mockWebApiServer.post('/api/queens/:queenType/task', async (req, res) => {
                return this.handleQueenTask(req, res);
            });
        }
        async handleToolsList(req, res) {
            try {
                // Authenticate request
                const authContext = await mockAuthHandler.validateApiKey(req.headers.authorization);
                // Get tools from MCP server
                const mcpResponse = await mockMcpServer.listTools();
                // Transform to HTTP response
                const httpResponse = mockRequestTransformer.mcpToHttp(mcpResponse);
                // Format response
                return mockResponseFormatter.formatSuccess(httpResponse);
            }
            catch (error) {
                return mockErrorHandler.handleHttpError(error);
            }
        }
        async handleToolExecution(req, res) {
            try {
                // Validate and transform request
                const isValid = mockRequestTransformer.validateHttpRequest(req);
                if (!isValid) {
                    throw new Error('Invalid request format');
                }
                const mcpRequest = mockRequestTransformer.httpToMcp({
                    method: 'tools/call',
                    params: {
                        name: req.params.toolName,
                        arguments: req.body
                    }
                });
                // Execute via MCP
                const mcpResponse = await mockMcpServer.call(mcpRequest);
                // Transform back to HTTP
                const httpResponse = mockRequestTransformer.mcpToHttp(mcpResponse);
                return mockResponseFormatter.formatSuccess(httpResponse);
            }
            catch (error) {
                const transformedError = mockErrorHandler.handleMcpError(error);
                return mockResponseFormatter.formatError(transformedError);
            }
        }
        async handleQueenTask(req, res) {
            try {
                const queenType = req.params.queenType;
                const task = req.body;
                // Transform to Queen-specific MCP call
                const mcpRequest = mockRequestTransformer.httpToMcp({
                    method: 'tools/call',
                    params: {
                        name: `queen-${queenType}-process`,
                        arguments: {
                            task,
                            queenType,
                            context: req.headers['x-context'] || 'default'
                        }
                    }
                });
                // Execute Queen task via MCP
                const mcpResponse = await mockMcpServer.call(mcpRequest);
                // Format Queen response
                const queenResponse = mockRequestTransformer.mcpToHttp(mcpResponse);
                return mockResponseFormatter.formatSuccess({
                    queenType,
                    taskId: queenResponse.taskId,
                    status: queenResponse.status,
                    result: queenResponse.result
                });
            }
            catch (error) {
                return mockErrorHandler.handleQueenError(error, req.params.queenType);
            }
        }
    }
    describe('ðŸŽ¯ Acceptance Tests - Web to MCP Bridge', () => {
        describe('User Story: API Tool Discovery', () => {
            it('should expose MCP tools through REST API with proper transformation', async () => {
                // Arrange - Mock tool discovery workflow
                mockAuthHandler.validateApiKey.mockResolvedValue({ valid: true, user: 'test-user' });
                mockMcpServer.listTools.mockResolvedValue({
                    jsonrpc: '2.0',
                    id: 1,
                    result: {
                        tools: [
                            { name: 'claude-zen-analyze', description: 'Analyze code architecture' },
                            { name: 'queen-architect-design', description: 'Design system architecture' }
                        ]
                    }
                });
                mockRequestTransformer.mcpToHttp.mockReturnValue({
                    tools: [
                        { name: 'claude-zen-analyze', description: 'Analyze code architecture' },
                        { name: 'queen-architect-design', description: 'Design system architecture' }
                    ]
                });
                mockResponseFormatter.formatSuccess.mockReturnValue({
                    status: 'success',
                    data: {
                        tools: [
                            { name: 'claude-zen-analyze', description: 'Analyze code architecture' },
                            { name: 'queen-architect-design', description: 'Design system architecture' }
                        ]
                    }
                });
                const integrationLayer = new MockWebMcpIntegrationLayer();
                // Act - Request tools list via HTTP API
                const mockReq = {
                    headers: { authorization: 'Bearer test-token' }
                };
                const mockRes = {};
                const response = await integrationLayer.handleToolsList(mockReq, mockRes);
                // Assert - Verify complete transformation chain
                expect(mockAuthHandler.validateApiKey).toHaveBeenCalledWith('Bearer test-token');
                expect(mockMcpServer.listTools).toHaveBeenCalled();
                expect(mockRequestTransformer.mcpToHttp).toHaveBeenCalledWith(expect.objectContaining({
                    result: expect.objectContaining({
                        tools: expect.any(Array)
                    })
                }));
                expect(mockResponseFormatter.formatSuccess).toHaveBeenCalled();
                expect(response.status).toBe('success');
                expect(response.data.tools).toHaveLength(2);
                expect(response.data.tools[0].name).toBe('claude-zen-analyze');
            });
        });
        describe('User Story: Tool Execution via REST API', () => {
            it('should execute MCP tools through HTTP endpoints with parameter transformation', async () => {
                // Arrange - Mock tool execution workflow
                const httpToolRequest = {
                    params: { toolName: 'claude-zen-analyze' },
                    body: {
                        codebase: 'typescript-monorepo',
                        focus: 'architecture'
                    }
                };
                mockRequestTransformer.validateHttpRequest.mockReturnValue(true);
                mockRequestTransformer.httpToMcp.mockReturnValue({
                    method: 'tools/call',
                    params: {
                        name: 'claude-zen-analyze',
                        arguments: {
                            codebase: 'typescript-monorepo',
                            focus: 'architecture'
                        }
                    }
                });
                mockMcpServer.call.mockResolvedValue({
                    jsonrpc: '2.0',
                    id: 1,
                    result: {
                        analysis: 'clean-architecture-detected',
                        recommendations: ['enhance-separation-of-concerns'],
                        confidence: 0.91
                    }
                });
                mockRequestTransformer.mcpToHttp.mockReturnValue({
                    analysis: 'clean-architecture-detected',
                    recommendations: ['enhance-separation-of-concerns'],
                    confidence: 0.91
                });
                mockResponseFormatter.formatSuccess.mockReturnValue({
                    status: 'success',
                    data: {
                        analysis: 'clean-architecture-detected',
                        recommendations: ['enhance-separation-of-concerns'],
                        confidence: 0.91
                    }
                });
                const integrationLayer = new MockWebMcpIntegrationLayer();
                // Act - Execute tool via HTTP
                const response = await integrationLayer.handleToolExecution(httpToolRequest, {});
                // Assert - Verify request/response transformation chain
                expect(mockRequestTransformer.validateHttpRequest).toHaveBeenCalledWith(httpToolRequest);
                expect(mockRequestTransformer.httpToMcp).toHaveBeenCalledWith({
                    method: 'tools/call',
                    params: {
                        name: 'claude-zen-analyze',
                        arguments: {
                            codebase: 'typescript-monorepo',
                            focus: 'architecture'
                        }
                    }
                });
                expect(mockMcpServer.call).toHaveBeenCalled();
                expect(mockRequestTransformer.mcpToHttp).toHaveBeenCalled();
                expect(mockResponseFormatter.formatSuccess).toHaveBeenCalled();
                expect(response.status).toBe('success');
                expect(response.data.analysis).toBe('clean-architecture-detected');
                expect(response.data.confidence).toBe(0.91);
            });
        });
        describe('User Story: Queen Task Coordination via API', () => {
            it('should route Queen tasks through MCP with proper context handling', async () => {
                // Arrange - Mock Queen task coordination
                const queenTaskRequest = {
                    params: { queenType: 'architect' },
                    headers: { 'x-context': 'microservices-project' },
                    body: {
                        task: 'design-api-gateway',
                        requirements: ['scalability', 'security'],
                        deadline: '2024-08-15'
                    }
                };
                mockRequestTransformer.httpToMcp.mockReturnValue({
                    method: 'tools/call',
                    params: {
                        name: 'queen-architect-process',
                        arguments: {
                            task: {
                                task: 'design-api-gateway',
                                requirements: ['scalability', 'security'],
                                deadline: '2024-08-15'
                            },
                            queenType: 'architect',
                            context: 'microservices-project'
                        }
                    }
                });
                mockMcpServer.call.mockResolvedValue({
                    jsonrpc: '2.0',
                    id: 1,
                    result: {
                        taskId: 'queen-arch-task-001',
                        status: 'in-progress',
                        result: {
                            design: 'api-gateway-blueprint',
                            estimated_completion: '2024-08-10'
                        }
                    }
                });
                mockRequestTransformer.mcpToHttp.mockReturnValue({
                    taskId: 'queen-arch-task-001',
                    status: 'in-progress',
                    result: {
                        design: 'api-gateway-blueprint',
                        estimated_completion: '2024-08-10'
                    }
                });
                mockResponseFormatter.formatSuccess.mockReturnValue({
                    status: 'success',
                    data: {
                        queenType: 'architect',
                        taskId: 'queen-arch-task-001',
                        status: 'in-progress',
                        result: {
                            design: 'api-gateway-blueprint',
                            estimated_completion: '2024-08-10'
                        }
                    }
                });
                const integrationLayer = new MockWebMcpIntegrationLayer();
                // Act - Execute Queen task via API
                const response = await integrationLayer.handleQueenTask(queenTaskRequest, {});
                // Assert - Verify Queen coordination workflow
                expect(mockRequestTransformer.httpToMcp).toHaveBeenCalledWith({
                    method: 'tools/call',
                    params: {
                        name: 'queen-architect-process',
                        arguments: {
                            task: queenTaskRequest.body,
                            queenType: 'architect',
                            context: 'microservices-project'
                        }
                    }
                });
                expect(mockMcpServer.call).toHaveBeenCalled();
                expect(mockResponseFormatter.formatSuccess).toHaveBeenCalledWith({
                    queenType: 'architect',
                    taskId: 'queen-arch-task-001',
                    status: 'in-progress',
                    result: expect.any(Object)
                });
                expect(response.data.queenType).toBe('architect');
                expect(response.data.taskId).toBe('queen-arch-task-001');
                expect(response.data.result.design).toBe('api-gateway-blueprint');
            });
        });
    });
    describe('ðŸ”— Contract Verification - Protocol Translation', () => {
        describe('Error Transformation', () => {
            it('should properly transform MCP errors to HTTP error responses', async () => {
                // Arrange - Mock error scenarios
                const mcpError = {
                    jsonrpc: '2.0',
                    id: 1,
                    error: {
                        code: -32602,
                        message: 'Invalid params',
                        data: { param: 'arguments', reason: 'missing required field' }
                    }
                };
                mockRequestTransformer.validateHttpRequest.mockReturnValue(true);
                mockRequestTransformer.httpToMcp.mockReturnValue({
                    method: 'tools/call',
                    params: { name: 'invalid-tool' }
                });
                mockMcpServer.call.mockRejectedValue(mcpError);
                mockErrorHandler.handleMcpError.mockReturnValue({
                    type: 'validation_error',
                    message: 'Invalid request parameters',
                    details: 'missing required field in arguments',
                    code: 400
                });
                mockResponseFormatter.formatError.mockReturnValue({
                    status: 'error',
                    error: {
                        type: 'validation_error',
                        message: 'Invalid request parameters',
                        code: 400
                    }
                });
                const integrationLayer = new MockWebMcpIntegrationLayer();
                // Act - Handle error during tool execution
                const response = await integrationLayer.handleToolExecution({
                    params: { toolName: 'invalid-tool' },
                    body: {}
                }, {});
                // Assert - Verify error transformation chain
                expect(mockMcpServer.call).toHaveBeenCalled();
                expect(mockErrorHandler.handleMcpError).toHaveBeenCalledWith(mcpError);
                expect(mockResponseFormatter.formatError).toHaveBeenCalled();
                expect(response.status).toBe('error');
                expect(response.error.type).toBe('validation_error');
                expect(response.error.code).toBe(400);
            });
        });
    });
    describe('ðŸ§ª London School Patterns - Integration Focus', () => {
        it('should demonstrate protocol bridging through interaction testing', () => {
            // London School: Test HOW protocols communicate, not implementation details
            const mockProtocolBridge = {
                translateRequest: jest.fn(),
                translateResponse: jest.fn(),
                validateTranslation: jest.fn()
            };
            const protocolIntegrator = {
                bridge: (sourceRequest, sourceProtocol, targetProtocol) => {
                    const translated = mockProtocolBridge.translateRequest(sourceRequest, targetProtocol);
                    const isValid = mockProtocolBridge.validateTranslation(sourceRequest, translated);
                    if (!isValid) {
                        throw new Error('Translation validation failed');
                    }
                    return translated;
                }
            };
            // Mock the protocol translation conversation
            mockProtocolBridge.translateRequest.mockReturnValue({ method: 'translated', params: {} });
            mockProtocolBridge.validateTranslation.mockReturnValue(true);
            // Act - Test protocol bridging
            const httpRequest = { endpoint: '/api/test', body: { data: 'test' } };
            const result = protocolIntegrator.bridge(httpRequest, 'HTTP', 'MCP');
            // Assert - Verify protocol interaction
            expect(mockProtocolBridge.translateRequest).toHaveBeenCalledWith(httpRequest, 'MCP');
            expect(mockProtocolBridge.validateTranslation).toHaveBeenCalledWith(httpRequest, result);
            expect(result.method).toBe('translated');
        });
    });
    // Clean test isolation - London School principle
    beforeEach(() => {
        jest.clearAllMocks();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaW50ZWdyYXRpb24vd2ViLW1jcC1pbnRlZ3JhdGlvbi1sb25kb24tdGRkLnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0dBUUc7QUFFSCxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFbEYsZ0VBQWdFO0FBRWhFLHVEQUF1RDtBQUN2RCxNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2QsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNkLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2pCLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2QsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDakIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDakIsQ0FBQztBQUVGLG9EQUFvRDtBQUNwRCxNQUFNLGFBQWEsR0FBRztJQUNwQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNmLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3BCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzFCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ2xCLENBQUM7QUFFRixpRUFBaUU7QUFDakUsTUFBTSxzQkFBc0IsR0FBRztJQUM3QixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNwQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNwQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzlCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFF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O0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL21odWdvL2NvZGUvY2xhdWRlLWNvZGUtZmxvdy9zcmMvX190ZXN0c19fL2ludGVncmF0aW9uL3dlYi1tY3AtaW50ZWdyYXRpb24tbG9uZG9uLXRkZC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2xhdWRlLVplbiBXZWIg4oaUIE1DUCBJbnRlZ3JhdGlvbiBMYXllciAtIExvbmRvbiBTY2hvb2wgVEREIFRlc3RzXG4gKiBcbiAqIFRlc3RpbmcgdGhlIGludGVncmF0aW9uIGxheWVyIHRoYXQgYnJpZGdlcyBXZWIgQVBJIGFuZCBNQ1Agc2VydmVyIHVzaW5nIExvbmRvbiBTY2hvb2wgcHJpbmNpcGxlczpcbiAqIC0gT3V0c2lkZS1pbiBkZXZlbG9wbWVudCBmcm9tIHVzZXIgQVBJIHJlcXVlc3RzIHRvIE1DUCBwcm90b2NvbFxuICogLSBNb2NrLWRyaXZlbiBjb250cmFjdHMgZm9yIHNlYW1sZXNzIGNvbXBvbmVudCBicmlkZ2luZ1xuICogLSBCZWhhdmlvciB2ZXJpZmljYXRpb24gZm9yIHJlcXVlc3QvcmVzcG9uc2UgdHJhbnNmb3JtYXRpb25cbiAqIC0gRm9jdXMgb24gcHJvdG9jb2wgdHJhbnNsYXRpb24gYW5kIGVycm9yIGhhbmRsaW5nXG4gKi9cblxuaW1wb3J0IHsgamVzdCwgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG4vLyA9PT0gTU9DSyBERVBFTkRFTkNJRVMgKExvbmRvbiBTY2hvb2wgQ29udHJhY3QgRGVmaW5pdGlvbikgPT09XG5cbi8vIE1vY2sgV2ViIEFQSSBTZXJ2ZXIgLSBIVFRQIHJlcXVlc3QgaGFuZGxpbmcgY29udHJhY3RcbmNvbnN0IG1vY2tXZWJBcGlTZXJ2ZXIgPSB7XG4gIGdldDogamVzdC5mbigpLFxuICBwb3N0OiBqZXN0LmZuKCksXG4gIHB1dDogamVzdC5mbigpLFxuICBkZWxldGU6IGplc3QuZm4oKSxcbiAgdXNlOiBqZXN0LmZuKCksXG4gIGxpc3RlbjogamVzdC5mbigpLFxuICBjbG9zZTogamVzdC5mbigpLFxufTtcblxuLy8gTW9jayBNQ1AgU2VydmVyIC0gUHJvdG9jb2wgY29tbXVuaWNhdGlvbiBjb250cmFjdFxuY29uc3QgbW9ja01jcFNlcnZlciA9IHtcbiAgY2FsbDogamVzdC5mbigpLFxuICBsaXN0VG9vbHM6IGplc3QuZm4oKSxcbiAgZ2V0Q2FwYWJpbGl0aWVzOiBqZXN0LmZuKCksXG4gIG5vdGlmeTogamVzdC5mbigpLFxufTtcblxuLy8gTW9jayBSZXF1ZXN0IFRyYW5zZm9ybWVyIC0gSFRUUCB0byBNQ1AgdHJhbnNmb3JtYXRpb24gY29udHJhY3RcbmNvbnN0IG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIgPSB7XG4gIGh0dHBUb01jcDogamVzdC5mbigpLFxuICBtY3BUb0h0dHA6IGplc3QuZm4oKSxcbiAgdmFsaWRhdGVIdHRwUmVxdWVzdDogamVzdC5mbigpLFxuICB2YWxpZGF0ZU1jcFJlc3BvbnNlOiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIFJlc3BvbnNlIEZvcm1hdHRlciAtIFJlc3BvbnNlIHN0YW5kYXJkaXphdGlvbiBjb250cmFjdFxuY29uc3QgbW9ja1Jlc3BvbnNlRm9ybWF0dGVyID0ge1xuICBmb3JtYXRTdWNjZXNzOiBqZXN0LmZuKCksXG4gIGZvcm1hdEVycm9yOiBqZXN0LmZuKCksXG4gIGZvcm1hdFN0cmVhbTogamVzdC5mbigpLFxuICBhZGRNZXRhZGF0YTogamVzdC5mbigpLFxufTtcblxuLy8gTW9jayBFcnJvciBIYW5kbGVyIC0gRXJyb3IgdHJhbnNmb3JtYXRpb24gY29udHJhY3RcbmNvbnN0IG1vY2tFcnJvckhhbmRsZXIgPSB7XG4gIGhhbmRsZU1jcEVycm9yOiBqZXN0LmZuKCksXG4gIGhhbmRsZUh0dHBFcnJvcjogamVzdC5mbigpLFxuICBjcmVhdGVFcnJvclJlc3BvbnNlOiBqZXN0LmZuKCksXG4gIGxvZ0Vycm9yOiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIEF1dGhlbnRpY2F0aW9uIC0gU2VjdXJpdHkgY29udHJhY3RcbmNvbnN0IG1vY2tBdXRoSGFuZGxlciA9IHtcbiAgdmFsaWRhdGVBcGlLZXk6IGplc3QuZm4oKSxcbiAgY2hlY2tQZXJtaXNzaW9uczogamVzdC5mbigpLFxuICBjcmVhdGVBdXRoQ29udGV4dDogamVzdC5mbigpLFxufTtcblxuLy8gPT09IENPTlRSQUNUIElOVEVSRkFDRVMgPT09XG5cbmludGVyZmFjZSBJbnRlZ3JhdGlvbkxheWVyQ29udHJhY3Qge1xuICBpbml0aWFsaXplKHdlYlBvcnQ6IG51bWJlciwgbWNwRW5kcG9pbnQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD47XG4gIGJyaWRnZVJlcXVlc3QoaHR0cFJlcXVlc3Q6IGFueSk6IFByb21pc2U8YW55PjtcbiAgc2V0dXBSb3V0ZXMoKTogdm9pZDtcbiAgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuaW50ZXJmYWNlIFJlcXVlc3RUcmFuc2Zvcm1hdGlvbkNvbnRyYWN0IHtcbiAgaHR0cFRvTWNwKGh0dHBSZXF1ZXN0OiBhbnkpOiBhbnk7XG4gIG1jcFRvSHR0cChtY3BSZXNwb25zZTogYW55KTogYW55O1xuICB2YWxpZGF0ZVRyYW5zZm9ybWF0aW9uKG9yaWdpbmFsOiBhbnksIHRyYW5zZm9ybWVkOiBhbnkpOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgRXJyb3JCcmlkZ2luZ0NvbnRyYWN0IHtcbiAgdHJhbnNmb3JtTWNwRXJyb3IobWNwRXJyb3I6IGFueSk6IGFueTtcbiAgdHJhbnNmb3JtSHR0cEVycm9yKGh0dHBFcnJvcjogYW55KTogYW55O1xuICBzaG91bGRSZXRyeShlcnJvcjogYW55KTogYm9vbGVhbjtcbn1cblxuZGVzY3JpYmUoJ0NsYXVkZS1aZW4gV2ViIOKGlCBNQ1AgSW50ZWdyYXRpb24gTGF5ZXIgLSBMb25kb24gU2Nob29sIFRERCcsICgpID0+IHtcbiAgXG4gIC8vIE1vY2sgSW50ZWdyYXRpb24gTGF5ZXIgY2xhc3MgKGJhc2VkIG9uIGFyY2hpdGVjdHVyYWwgbmVlZHMpXG4gIGNsYXNzIE1vY2tXZWJNY3BJbnRlZ3JhdGlvbkxheWVyIHtcbiAgICBwcml2YXRlIHdlYlNlcnZlcjogYW55O1xuICAgIHByaXZhdGUgbWNwU2VydmVyOiBhbnk7XG4gICAgcHJpdmF0ZSByZXF1ZXN0VHJhbnNmb3JtZXI6IGFueTtcbiAgICBwcml2YXRlIHJlc3BvbnNlRm9ybWF0dGVyOiBhbnk7XG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IGFueTtcbiAgICBwcml2YXRlIGF1dGhIYW5kbGVyOiBhbnk7XG4gICAgXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICB0aGlzLndlYlNlcnZlciA9IG1vY2tXZWJBcGlTZXJ2ZXI7XG4gICAgICB0aGlzLm1jcFNlcnZlciA9IG1vY2tNY3BTZXJ2ZXI7XG4gICAgICB0aGlzLnJlcXVlc3RUcmFuc2Zvcm1lciA9IG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXI7XG4gICAgICB0aGlzLnJlc3BvbnNlRm9ybWF0dGVyID0gbW9ja1Jlc3BvbnNlRm9ybWF0dGVyO1xuICAgICAgdGhpcy5lcnJvckhhbmRsZXIgPSBtb2NrRXJyb3JIYW5kbGVyO1xuICAgICAgdGhpcy5hdXRoSGFuZGxlciA9IG1vY2tBdXRoSGFuZGxlcjtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh3ZWJQb3J0OiBudW1iZXIsIG1jcEVuZHBvaW50OiBzdHJpbmcpIHtcbiAgICAgIC8vIFNldHVwIHdlYiBzZXJ2ZXJcbiAgICAgIG1vY2tXZWJBcGlTZXJ2ZXIubGlzdGVuLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBhd2FpdCBtb2NrV2ViQXBpU2VydmVyLmxpc3Rlbih3ZWJQb3J0KTtcbiAgICAgIFxuICAgICAgLy8gU2V0dXAgcm91dGVzXG4gICAgICB0aGlzLnNldHVwUm91dGVzKCk7XG4gICAgICBcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgXG4gICAgc2V0dXBSb3V0ZXMoKSB7XG4gICAgICAvLyBSb3V0ZTogTGlzdCBhdmFpbGFibGUgdG9vbHNcbiAgICAgIG1vY2tXZWJBcGlTZXJ2ZXIuZ2V0KCcvYXBpL3Rvb2xzJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVUb29sc0xpc3QocmVxLCByZXMpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFJvdXRlOiBFeGVjdXRlIHRvb2xcbiAgICAgIG1vY2tXZWJBcGlTZXJ2ZXIucG9zdCgnL2FwaS90b29scy86dG9vbE5hbWUnLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVRvb2xFeGVjdXRpb24ocmVxLCByZXMpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFJvdXRlOiBRdWVlbiB0YXNrIGNvb3JkaW5hdGlvblxuICAgICAgbW9ja1dlYkFwaVNlcnZlci5wb3N0KCcvYXBpL3F1ZWVucy86cXVlZW5UeXBlL3Rhc2snLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVF1ZWVuVGFzayhyZXEsIHJlcyk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgaGFuZGxlVG9vbHNMaXN0KHJlcTogYW55LCByZXM6IGFueSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQXV0aGVudGljYXRlIHJlcXVlc3RcbiAgICAgICAgY29uc3QgYXV0aENvbnRleHQgPSBhd2FpdCBtb2NrQXV0aEhhbmRsZXIudmFsaWRhdGVBcGlLZXkocmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbik7XG4gICAgICAgIFxuICAgICAgICAvLyBHZXQgdG9vbHMgZnJvbSBNQ1Agc2VydmVyXG4gICAgICAgIGNvbnN0IG1jcFJlc3BvbnNlID0gYXdhaXQgbW9ja01jcFNlcnZlci5saXN0VG9vbHMoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRyYW5zZm9ybSB0byBIVFRQIHJlc3BvbnNlXG4gICAgICAgIGNvbnN0IGh0dHBSZXNwb25zZSA9IG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIubWNwVG9IdHRwKG1jcFJlc3BvbnNlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZvcm1hdCByZXNwb25zZVxuICAgICAgICByZXR1cm4gbW9ja1Jlc3BvbnNlRm9ybWF0dGVyLmZvcm1hdFN1Y2Nlc3MoaHR0cFJlc3BvbnNlKTtcbiAgICAgICAgXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbW9ja0Vycm9ySGFuZGxlci5oYW5kbGVIdHRwRXJyb3IoZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBhc3luYyBoYW5kbGVUb29sRXhlY3V0aW9uKHJlcTogYW55LCByZXM6IGFueSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVmFsaWRhdGUgYW5kIHRyYW5zZm9ybSByZXF1ZXN0XG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLnZhbGlkYXRlSHR0cFJlcXVlc3QocmVxKTtcbiAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJlcXVlc3QgZm9ybWF0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG1jcFJlcXVlc3QgPSBtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLmh0dHBUb01jcCh7XG4gICAgICAgICAgbWV0aG9kOiAndG9vbHMvY2FsbCcsXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBuYW1lOiByZXEucGFyYW1zLnRvb2xOYW1lLFxuICAgICAgICAgICAgYXJndW1lbnRzOiByZXEuYm9keVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAvLyBFeGVjdXRlIHZpYSBNQ1BcbiAgICAgICAgY29uc3QgbWNwUmVzcG9uc2UgPSBhd2FpdCBtb2NrTWNwU2VydmVyLmNhbGwobWNwUmVxdWVzdCk7XG4gICAgICAgIFxuICAgICAgICAvLyBUcmFuc2Zvcm0gYmFjayB0byBIVFRQXG4gICAgICAgIGNvbnN0IGh0dHBSZXNwb25zZSA9IG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIubWNwVG9IdHRwKG1jcFJlc3BvbnNlKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBtb2NrUmVzcG9uc2VGb3JtYXR0ZXIuZm9ybWF0U3VjY2VzcyhodHRwUmVzcG9uc2UpO1xuICAgICAgICBcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkRXJyb3IgPSBtb2NrRXJyb3JIYW5kbGVyLmhhbmRsZU1jcEVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuIG1vY2tSZXNwb25zZUZvcm1hdHRlci5mb3JtYXRFcnJvcih0cmFuc2Zvcm1lZEVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgYXN5bmMgaGFuZGxlUXVlZW5UYXNrKHJlcTogYW55LCByZXM6IGFueSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcXVlZW5UeXBlID0gcmVxLnBhcmFtcy5xdWVlblR5cGU7XG4gICAgICAgIGNvbnN0IHRhc2sgPSByZXEuYm9keTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRyYW5zZm9ybSB0byBRdWVlbi1zcGVjaWZpYyBNQ1AgY2FsbFxuICAgICAgICBjb25zdCBtY3BSZXF1ZXN0ID0gbW9ja1JlcXVlc3RUcmFuc2Zvcm1lci5odHRwVG9NY3Aoe1xuICAgICAgICAgIG1ldGhvZDogJ3Rvb2xzL2NhbGwnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgbmFtZTogYHF1ZWVuLSR7cXVlZW5UeXBlfS1wcm9jZXNzYCxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0YXNrLFxuICAgICAgICAgICAgICBxdWVlblR5cGUsXG4gICAgICAgICAgICAgIGNvbnRleHQ6IHJlcS5oZWFkZXJzWyd4LWNvbnRleHQnXSB8fCAnZGVmYXVsdCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gRXhlY3V0ZSBRdWVlbiB0YXNrIHZpYSBNQ1BcbiAgICAgICAgY29uc3QgbWNwUmVzcG9uc2UgPSBhd2FpdCBtb2NrTWNwU2VydmVyLmNhbGwobWNwUmVxdWVzdCk7XG4gICAgICAgIFxuICAgICAgICAvLyBGb3JtYXQgUXVlZW4gcmVzcG9uc2VcbiAgICAgICAgY29uc3QgcXVlZW5SZXNwb25zZSA9IG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIubWNwVG9IdHRwKG1jcFJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIG1vY2tSZXNwb25zZUZvcm1hdHRlci5mb3JtYXRTdWNjZXNzKHtcbiAgICAgICAgICBxdWVlblR5cGUsXG4gICAgICAgICAgdGFza0lkOiBxdWVlblJlc3BvbnNlLnRhc2tJZCxcbiAgICAgICAgICBzdGF0dXM6IHF1ZWVuUmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgIHJlc3VsdDogcXVlZW5SZXNwb25zZS5yZXN1bHRcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG1vY2tFcnJvckhhbmRsZXIuaGFuZGxlUXVlZW5FcnJvcihlcnJvciwgcmVxLnBhcmFtcy5xdWVlblR5cGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGRlc2NyaWJlKCfwn46vIEFjY2VwdGFuY2UgVGVzdHMgLSBXZWIgdG8gTUNQIEJyaWRnZScsICgpID0+IHtcbiAgICBcbiAgICBkZXNjcmliZSgnVXNlciBTdG9yeTogQVBJIFRvb2wgRGlzY292ZXJ5JywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBleHBvc2UgTUNQIHRvb2xzIHRocm91Z2ggUkVTVCBBUEkgd2l0aCBwcm9wZXIgdHJhbnNmb3JtYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2UgLSBNb2NrIHRvb2wgZGlzY292ZXJ5IHdvcmtmbG93XG4gICAgICAgIG1vY2tBdXRoSGFuZGxlci52YWxpZGF0ZUFwaUtleS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHZhbGlkOiB0cnVlLCB1c2VyOiAndGVzdC11c2VyJyB9KTtcbiAgICAgICAgbW9ja01jcFNlcnZlci5saXN0VG9vbHMubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIHJlc3VsdDoge1xuICAgICAgICAgICAgdG9vbHM6IFtcbiAgICAgICAgICAgICAgeyBuYW1lOiAnY2xhdWRlLXplbi1hbmFseXplJywgZGVzY3JpcHRpb246ICdBbmFseXplIGNvZGUgYXJjaGl0ZWN0dXJlJyB9LFxuICAgICAgICAgICAgICB7IG5hbWU6ICdxdWVlbi1hcmNoaXRlY3QtZGVzaWduJywgZGVzY3JpcHRpb246ICdEZXNpZ24gc3lzdGVtIGFyY2hpdGVjdHVyZScgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLm1jcFRvSHR0cC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHRvb2xzOiBbXG4gICAgICAgICAgICB7IG5hbWU6ICdjbGF1ZGUtemVuLWFuYWx5emUnLCBkZXNjcmlwdGlvbjogJ0FuYWx5emUgY29kZSBhcmNoaXRlY3R1cmUnIH0sXG4gICAgICAgICAgICB7IG5hbWU6ICdxdWVlbi1hcmNoaXRlY3QtZGVzaWduJywgZGVzY3JpcHRpb246ICdEZXNpZ24gc3lzdGVtIGFyY2hpdGVjdHVyZScgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrUmVzcG9uc2VGb3JtYXR0ZXIuZm9ybWF0U3VjY2Vzcy5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHRvb2xzOiBbXG4gICAgICAgICAgICAgIHsgbmFtZTogJ2NsYXVkZS16ZW4tYW5hbHl6ZScsIGRlc2NyaXB0aW9uOiAnQW5hbHl6ZSBjb2RlIGFyY2hpdGVjdHVyZScgfSxcbiAgICAgICAgICAgICAgeyBuYW1lOiAncXVlZW4tYXJjaGl0ZWN0LWRlc2lnbicsIGRlc2NyaXB0aW9uOiAnRGVzaWduIHN5c3RlbSBhcmNoaXRlY3R1cmUnIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW50ZWdyYXRpb25MYXllciA9IG5ldyBNb2NrV2ViTWNwSW50ZWdyYXRpb25MYXllcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0IC0gUmVxdWVzdCB0b29scyBsaXN0IHZpYSBIVFRQIEFQSVxuICAgICAgICBjb25zdCBtb2NrUmVxID0geyBcbiAgICAgICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246ICdCZWFyZXIgdGVzdC10b2tlbicgfVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBtb2NrUmVzID0ge307XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGludGVncmF0aW9uTGF5ZXIuaGFuZGxlVG9vbHNMaXN0KG1vY2tSZXEsIG1vY2tSZXMpO1xuICAgICAgICBcbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IGNvbXBsZXRlIHRyYW5zZm9ybWF0aW9uIGNoYWluXG4gICAgICAgIGV4cGVjdChtb2NrQXV0aEhhbmRsZXIudmFsaWRhdGVBcGlLZXkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdCZWFyZXIgdGVzdC10b2tlbicpO1xuICAgICAgICBleHBlY3QobW9ja01jcFNlcnZlci5saXN0VG9vbHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIubWNwVG9IdHRwKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICByZXN1bHQ6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICAgdG9vbHM6IGV4cGVjdC5hbnkoQXJyYXkpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2VGb3JtYXR0ZXIuZm9ybWF0U3VjY2VzcykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgnc3VjY2VzcycpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZGF0YS50b29scykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZGF0YS50b29sc1swXS5uYW1lKS50b0JlKCdjbGF1ZGUtemVuLWFuYWx5emUnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IFRvb2wgRXhlY3V0aW9uIHZpYSBSRVNUIEFQSScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBNQ1AgdG9vbHMgdGhyb3VnaCBIVFRQIGVuZHBvaW50cyB3aXRoIHBhcmFtZXRlciB0cmFuc2Zvcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgdG9vbCBleGVjdXRpb24gd29ya2Zsb3dcbiAgICAgICAgY29uc3QgaHR0cFRvb2xSZXF1ZXN0ID0ge1xuICAgICAgICAgIHBhcmFtczogeyB0b29sTmFtZTogJ2NsYXVkZS16ZW4tYW5hbHl6ZScgfSxcbiAgICAgICAgICBib2R5OiB7IFxuICAgICAgICAgICAgY29kZWJhc2U6ICd0eXBlc2NyaXB0LW1vbm9yZXBvJyxcbiAgICAgICAgICAgIGZvY3VzOiAnYXJjaGl0ZWN0dXJlJ1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIudmFsaWRhdGVIdHRwUmVxdWVzdC5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICAgIG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIuaHR0cFRvTWNwLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgbWV0aG9kOiAndG9vbHMvY2FsbCcsXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBuYW1lOiAnY2xhdWRlLXplbi1hbmFseXplJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICBjb2RlYmFzZTogJ3R5cGVzY3JpcHQtbW9ub3JlcG8nLFxuICAgICAgICAgICAgICBmb2N1czogJ2FyY2hpdGVjdHVyZSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbW9ja01jcFNlcnZlci5jYWxsLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICBpZDogMSxcbiAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgIGFuYWx5c2lzOiAnY2xlYW4tYXJjaGl0ZWN0dXJlLWRldGVjdGVkJyxcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9uczogWydlbmhhbmNlLXNlcGFyYXRpb24tb2YtY29uY2VybnMnXSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTFcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbW9ja1JlcXVlc3RUcmFuc2Zvcm1lci5tY3BUb0h0dHAubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBhbmFseXNpczogJ2NsZWFuLWFyY2hpdGVjdHVyZS1kZXRlY3RlZCcsXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbJ2VuaGFuY2Utc2VwYXJhdGlvbi1vZi1jb25jZXJucyddLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTFcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrUmVzcG9uc2VGb3JtYXR0ZXIuZm9ybWF0U3VjY2Vzcy5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGFuYWx5c2lzOiAnY2xlYW4tYXJjaGl0ZWN0dXJlLWRldGVjdGVkJyxcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9uczogWydlbmhhbmNlLXNlcGFyYXRpb24tb2YtY29uY2VybnMnXSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTFcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW50ZWdyYXRpb25MYXllciA9IG5ldyBNb2NrV2ViTWNwSW50ZWdyYXRpb25MYXllcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0IC0gRXhlY3V0ZSB0b29sIHZpYSBIVFRQXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW50ZWdyYXRpb25MYXllci5oYW5kbGVUb29sRXhlY3V0aW9uKGh0dHBUb29sUmVxdWVzdCwge30pO1xuICAgICAgICBcbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IHJlcXVlc3QvcmVzcG9uc2UgdHJhbnNmb3JtYXRpb24gY2hhaW5cbiAgICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIudmFsaWRhdGVIdHRwUmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoaHR0cFRvb2xSZXF1ZXN0KTtcbiAgICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIuaHR0cFRvTWNwKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgbWV0aG9kOiAndG9vbHMvY2FsbCcsXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBuYW1lOiAnY2xhdWRlLXplbi1hbmFseXplJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICBjb2RlYmFzZTogJ3R5cGVzY3JpcHQtbW9ub3JlcG8nLFxuICAgICAgICAgICAgICBmb2N1czogJ2FyY2hpdGVjdHVyZSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QobW9ja01jcFNlcnZlci5jYWxsKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLm1jcFRvSHR0cCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja1Jlc3BvbnNlRm9ybWF0dGVyLmZvcm1hdFN1Y2Nlc3MpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoJ3N1Y2Nlc3MnKTtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmRhdGEuYW5hbHlzaXMpLnRvQmUoJ2NsZWFuLWFyY2hpdGVjdHVyZS1kZXRlY3RlZCcpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZGF0YS5jb25maWRlbmNlKS50b0JlKDAuOTEpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnVXNlciBTdG9yeTogUXVlZW4gVGFzayBDb29yZGluYXRpb24gdmlhIEFQSScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcm91dGUgUXVlZW4gdGFza3MgdGhyb3VnaCBNQ1Agd2l0aCBwcm9wZXIgY29udGV4dCBoYW5kbGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgUXVlZW4gdGFzayBjb29yZGluYXRpb25cbiAgICAgICAgY29uc3QgcXVlZW5UYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgICBwYXJhbXM6IHsgcXVlZW5UeXBlOiAnYXJjaGl0ZWN0JyB9LFxuICAgICAgICAgIGhlYWRlcnM6IHsgJ3gtY29udGV4dCc6ICdtaWNyb3NlcnZpY2VzLXByb2plY3QnIH0sXG4gICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgdGFzazogJ2Rlc2lnbi1hcGktZ2F0ZXdheScsXG4gICAgICAgICAgICByZXF1aXJlbWVudHM6IFsnc2NhbGFiaWxpdHknLCAnc2VjdXJpdHknXSxcbiAgICAgICAgICAgIGRlYWRsaW5lOiAnMjAyNC0wOC0xNSdcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLmh0dHBUb01jcC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIG1ldGhvZDogJ3Rvb2xzL2NhbGwnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgbmFtZTogJ3F1ZWVuLWFyY2hpdGVjdC1wcm9jZXNzJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0YXNrOiB7XG4gICAgICAgICAgICAgICAgdGFzazogJ2Rlc2lnbi1hcGktZ2F0ZXdheScsXG4gICAgICAgICAgICAgICAgcmVxdWlyZW1lbnRzOiBbJ3NjYWxhYmlsaXR5JywgJ3NlY3VyaXR5J10sXG4gICAgICAgICAgICAgICAgZGVhZGxpbmU6ICcyMDI0LTA4LTE1J1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBxdWVlblR5cGU6ICdhcmNoaXRlY3QnLFxuICAgICAgICAgICAgICBjb250ZXh0OiAnbWljcm9zZXJ2aWNlcy1wcm9qZWN0J1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrTWNwU2VydmVyLmNhbGwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIHJlc3VsdDoge1xuICAgICAgICAgICAgdGFza0lkOiAncXVlZW4tYXJjaC10YXNrLTAwMScsXG4gICAgICAgICAgICBzdGF0dXM6ICdpbi1wcm9ncmVzcycsXG4gICAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgICAgZGVzaWduOiAnYXBpLWdhdGV3YXktYmx1ZXByaW50JyxcbiAgICAgICAgICAgICAgZXN0aW1hdGVkX2NvbXBsZXRpb246ICcyMDI0LTA4LTEwJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLm1jcFRvSHR0cC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHRhc2tJZDogJ3F1ZWVuLWFyY2gtdGFzay0wMDEnLFxuICAgICAgICAgIHN0YXR1czogJ2luLXByb2dyZXNzJyxcbiAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgIGRlc2lnbjogJ2FwaS1nYXRld2F5LWJsdWVwcmludCcsXG4gICAgICAgICAgICBlc3RpbWF0ZWRfY29tcGxldGlvbjogJzIwMjQtMDgtMTAnXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG1vY2tSZXNwb25zZUZvcm1hdHRlci5mb3JtYXRTdWNjZXNzLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcXVlZW5UeXBlOiAnYXJjaGl0ZWN0JyxcbiAgICAgICAgICAgIHRhc2tJZDogJ3F1ZWVuLWFyY2gtdGFzay0wMDEnLFxuICAgICAgICAgICAgc3RhdHVzOiAnaW4tcHJvZ3Jlc3MnLFxuICAgICAgICAgICAgcmVzdWx0OiB7XG4gICAgICAgICAgICAgIGRlc2lnbjogJ2FwaS1nYXRld2F5LWJsdWVwcmludCcsXG4gICAgICAgICAgICAgIGVzdGltYXRlZF9jb21wbGV0aW9uOiAnMjAyNC0wOC0xMCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW50ZWdyYXRpb25MYXllciA9IG5ldyBNb2NrV2ViTWNwSW50ZWdyYXRpb25MYXllcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0IC0gRXhlY3V0ZSBRdWVlbiB0YXNrIHZpYSBBUElcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBpbnRlZ3JhdGlvbkxheWVyLmhhbmRsZVF1ZWVuVGFzayhxdWVlblRhc2tSZXF1ZXN0LCB7fSk7XG4gICAgICAgIFxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgUXVlZW4gY29vcmRpbmF0aW9uIHdvcmtmbG93XG4gICAgICAgIGV4cGVjdChtb2NrUmVxdWVzdFRyYW5zZm9ybWVyLmh0dHBUb01jcCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAgIG1ldGhvZDogJ3Rvb2xzL2NhbGwnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgbmFtZTogJ3F1ZWVuLWFyY2hpdGVjdC1wcm9jZXNzJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0YXNrOiBxdWVlblRhc2tSZXF1ZXN0LmJvZHksXG4gICAgICAgICAgICAgIHF1ZWVuVHlwZTogJ2FyY2hpdGVjdCcsXG4gICAgICAgICAgICAgIGNvbnRleHQ6ICdtaWNyb3NlcnZpY2VzLXByb2plY3QnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tNY3BTZXJ2ZXIuY2FsbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja1Jlc3BvbnNlRm9ybWF0dGVyLmZvcm1hdFN1Y2Nlc3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBxdWVlblR5cGU6ICdhcmNoaXRlY3QnLFxuICAgICAgICAgIHRhc2tJZDogJ3F1ZWVuLWFyY2gtdGFzay0wMDEnLFxuICAgICAgICAgIHN0YXR1czogJ2luLXByb2dyZXNzJyxcbiAgICAgICAgICByZXN1bHQ6IGV4cGVjdC5hbnkoT2JqZWN0KVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5kYXRhLnF1ZWVuVHlwZSkudG9CZSgnYXJjaGl0ZWN0Jyk7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5kYXRhLnRhc2tJZCkudG9CZSgncXVlZW4tYXJjaC10YXNrLTAwMScpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZGF0YS5yZXN1bHQuZGVzaWduKS50b0JlKCdhcGktZ2F0ZXdheS1ibHVlcHJpbnQnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn8J+UlyBDb250cmFjdCBWZXJpZmljYXRpb24gLSBQcm90b2NvbCBUcmFuc2xhdGlvbicsICgpID0+IHtcbiAgICBcbiAgICBkZXNjcmliZSgnRXJyb3IgVHJhbnNmb3JtYXRpb24nLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHByb3Blcmx5IHRyYW5zZm9ybSBNQ1AgZXJyb3JzIHRvIEhUVFAgZXJyb3IgcmVzcG9uc2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBlcnJvciBzY2VuYXJpb3NcbiAgICAgICAgY29uc3QgbWNwRXJyb3IgPSB7XG4gICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6IC0zMjYwMixcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHBhcmFtcycsXG4gICAgICAgICAgICBkYXRhOiB7IHBhcmFtOiAnYXJndW1lbnRzJywgcmVhc29uOiAnbWlzc2luZyByZXF1aXJlZCBmaWVsZCcgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIudmFsaWRhdGVIdHRwUmVxdWVzdC5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICAgIG1vY2tSZXF1ZXN0VHJhbnNmb3JtZXIuaHR0cFRvTWNwLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgbWV0aG9kOiAndG9vbHMvY2FsbCcsXG4gICAgICAgICAgcGFyYW1zOiB7IG5hbWU6ICdpbnZhbGlkLXRvb2wnIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBtb2NrTWNwU2VydmVyLmNhbGwubW9ja1JlamVjdGVkVmFsdWUobWNwRXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgbW9ja0Vycm9ySGFuZGxlci5oYW5kbGVNY3BFcnJvci5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIHR5cGU6ICd2YWxpZGF0aW9uX2Vycm9yJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCByZXF1ZXN0IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGRldGFpbHM6ICdtaXNzaW5nIHJlcXVpcmVkIGZpZWxkIGluIGFyZ3VtZW50cycsXG4gICAgICAgICAgY29kZTogNDAwXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbW9ja1Jlc3BvbnNlRm9ybWF0dGVyLmZvcm1hdEVycm9yLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICB0eXBlOiAndmFsaWRhdGlvbl9lcnJvcicsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCByZXF1ZXN0IHBhcmFtZXRlcnMnLFxuICAgICAgICAgICAgY29kZTogNDAwXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGludGVncmF0aW9uTGF5ZXIgPSBuZXcgTW9ja1dlYk1jcEludGVncmF0aW9uTGF5ZXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFjdCAtIEhhbmRsZSBlcnJvciBkdXJpbmcgdG9vbCBleGVjdXRpb25cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBpbnRlZ3JhdGlvbkxheWVyLmhhbmRsZVRvb2xFeGVjdXRpb24oe1xuICAgICAgICAgIHBhcmFtczogeyB0b29sTmFtZTogJ2ludmFsaWQtdG9vbCcgfSxcbiAgICAgICAgICBib2R5OiB7fVxuICAgICAgICB9LCB7fSk7XG4gICAgICAgIFxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgZXJyb3IgdHJhbnNmb3JtYXRpb24gY2hhaW5cbiAgICAgICAgZXhwZWN0KG1vY2tNY3BTZXJ2ZXIuY2FsbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QobW9ja0Vycm9ySGFuZGxlci5oYW5kbGVNY3BFcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgobWNwRXJyb3IpO1xuICAgICAgICBleHBlY3QobW9ja1Jlc3BvbnNlRm9ybWF0dGVyLmZvcm1hdEVycm9yKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKCdlcnJvcicpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IudHlwZSkudG9CZSgndmFsaWRhdGlvbl9lcnJvcicpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IuY29kZSkudG9CZSg0MDApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfwn6eqIExvbmRvbiBTY2hvb2wgUGF0dGVybnMgLSBJbnRlZ3JhdGlvbiBGb2N1cycsICgpID0+IHtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGRlbW9uc3RyYXRlIHByb3RvY29sIGJyaWRnaW5nIHRocm91Z2ggaW50ZXJhY3Rpb24gdGVzdGluZycsICgpID0+IHtcbiAgICAgIC8vIExvbmRvbiBTY2hvb2w6IFRlc3QgSE9XIHByb3RvY29scyBjb21tdW5pY2F0ZSwgbm90IGltcGxlbWVudGF0aW9uIGRldGFpbHNcbiAgICAgIGNvbnN0IG1vY2tQcm90b2NvbEJyaWRnZSA9IHtcbiAgICAgICAgdHJhbnNsYXRlUmVxdWVzdDogamVzdC5mbigpLFxuICAgICAgICB0cmFuc2xhdGVSZXNwb25zZTogamVzdC5mbigpLFxuICAgICAgICB2YWxpZGF0ZVRyYW5zbGF0aW9uOiBqZXN0LmZuKClcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHByb3RvY29sSW50ZWdyYXRvciA9IHtcbiAgICAgICAgYnJpZGdlOiAoc291cmNlUmVxdWVzdDogYW55LCBzb3VyY2VQcm90b2NvbDogc3RyaW5nLCB0YXJnZXRQcm90b2NvbDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgY29uc3QgdHJhbnNsYXRlZCA9IG1vY2tQcm90b2NvbEJyaWRnZS50cmFuc2xhdGVSZXF1ZXN0KHNvdXJjZVJlcXVlc3QsIHRhcmdldFByb3RvY29sKTtcbiAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gbW9ja1Byb3RvY29sQnJpZGdlLnZhbGlkYXRlVHJhbnNsYXRpb24oc291cmNlUmVxdWVzdCwgdHJhbnNsYXRlZCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyYW5zbGF0aW9uIHZhbGlkYXRpb24gZmFpbGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiB0cmFuc2xhdGVkO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBNb2NrIHRoZSBwcm90b2NvbCB0cmFuc2xhdGlvbiBjb252ZXJzYXRpb25cbiAgICAgIG1vY2tQcm90b2NvbEJyaWRnZS50cmFuc2xhdGVSZXF1ZXN0Lm1vY2tSZXR1cm5WYWx1ZSh7IG1ldGhvZDogJ3RyYW5zbGF0ZWQnLCBwYXJhbXM6IHt9IH0pO1xuICAgICAgbW9ja1Byb3RvY29sQnJpZGdlLnZhbGlkYXRlVHJhbnNsYXRpb24ubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBBY3QgLSBUZXN0IHByb3RvY29sIGJyaWRnaW5nXG4gICAgICBjb25zdCBodHRwUmVxdWVzdCA9IHsgZW5kcG9pbnQ6ICcvYXBpL3Rlc3QnLCBib2R5OiB7IGRhdGE6ICd0ZXN0JyB9IH07XG4gICAgICBjb25zdCByZXN1bHQgPSBwcm90b2NvbEludGVncmF0b3IuYnJpZGdlKGh0dHBSZXF1ZXN0LCAnSFRUUCcsICdNQ1AnKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IHByb3RvY29sIGludGVyYWN0aW9uXG4gICAgICBleHBlY3QobW9ja1Byb3RvY29sQnJpZGdlLnRyYW5zbGF0ZVJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGh0dHBSZXF1ZXN0LCAnTUNQJyk7XG4gICAgICBleHBlY3QobW9ja1Byb3RvY29sQnJpZGdlLnZhbGlkYXRlVHJhbnNsYXRpb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGh0dHBSZXF1ZXN0LCByZXN1bHQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRob2QpLnRvQmUoJ3RyYW5zbGF0ZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gQ2xlYW4gdGVzdCBpc29sYXRpb24gLSBMb25kb24gU2Nob29sIHByaW5jaXBsZVxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG4gIFxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9