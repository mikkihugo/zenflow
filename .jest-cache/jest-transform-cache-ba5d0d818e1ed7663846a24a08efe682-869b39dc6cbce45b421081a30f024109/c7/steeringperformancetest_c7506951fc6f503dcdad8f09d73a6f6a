352ad9358742aff25bfb33273967088a
/**
 * Performance Tests for Maestro Steering Document Operations
 * Tests performance benchmarks and scalability for steering document generation
 */
import { MaestroOrchestrator } from '../../../maestro/maestro-orchestrator.js';
import { mkdir, rmdir } from 'fs/promises';
import { join } from 'path';
import { existsSync } from 'fs';
import { tmpdir } from 'os';
import { performance } from 'perf_hooks';
describe('Maestro Steering Performance Benchmarks', () => {
    let maestroOrchestrator;
    let testDirectory;
    let mockConfig;
    let mockEventBus;
    let mockLogger;
    let mockMemoryManager;
    let mockAgentManager;
    let mockMainOrchestrator;
    beforeAll(async () => {
        testDirectory = join(tmpdir(), `maestro-steering-perf-test-${Date.now()}`);
        await mkdir(testDirectory, { recursive: true });
    });
    afterAll(async () => {
        try {
            if (existsSync(testDirectory)) {
                await rmdir(testDirectory, { recursive: true });
            }
        }
        catch (error) {
            console.warn(`Warning: Failed to cleanup test directory: ${error}`);
        }
    });
    beforeEach(async () => {
        // Setup lightweight mocks for performance testing
        mockConfig = { environment: 'test' };
        mockEventBus = {
            emit: jest.fn(),
            on: jest.fn()
        };
        mockLogger = {
            info: jest.fn(),
            warn: jest.fn(),
            error: jest.fn(),
            debug: jest.fn()
        };
        mockMemoryManager = {
            get: jest.fn().mockResolvedValue(null),
            set: jest.fn().mockResolvedValue(true),
            delete: jest.fn().mockResolvedValue(true)
        };
        mockAgentManager = {
            createAgent: jest.fn().mockResolvedValue('agent-123'),
            startAgent: jest.fn().mockResolvedValue(undefined),
            stopAgent: jest.fn().mockResolvedValue(undefined)
        };
        mockMainOrchestrator = {
            assignTask: jest.fn().mockResolvedValue({ success: true })
        };
        // Create orchestrator with test directory
        maestroOrchestrator = new MaestroOrchestrator(mockConfig, mockEventBus, mockLogger, mockMemoryManager, mockAgentManager, mockMainOrchestrator, {
            enableHiveMind: false,
            steeringDirectory: join(testDirectory, 'steering')
        });
    });
    describe('single document creation performance', () => {
        it('should create steering document within 100ms', async () => {
            const startTime = performance.now();
            await maestroOrchestrator.createSteeringDocument('perf-single', 'Performance test content');
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`Single document creation took: ${duration.toFixed(2)}ms`);
            expect(duration).toBeLessThan(100); // Should complete within 100ms
        });
        it('should maintain consistent performance across document types', async () => {
            const domains = ['product', 'tech', 'structure', 'security', 'custom'];
            const durations = [];
            for (const domain of domains) {
                const startTime = performance.now();
                await maestroOrchestrator.createSteeringDocument(`perf-${domain}`, `Content for ${domain}`);
                const endTime = performance.now();
                durations.push(endTime - startTime);
            }
            const averageDuration = durations.reduce((a, b) => a + b, 0) / durations.length;
            const maxDuration = Math.max(...durations);
            const minDuration = Math.min(...durations);
            console.log(`Performance consistency:
        Average: ${averageDuration.toFixed(2)}ms
        Min: ${minDuration.toFixed(2)}ms
        Max: ${maxDuration.toFixed(2)}ms
        Variance: ${(maxDuration - minDuration).toFixed(2)}ms`);
            // Performance should be consistent (max shouldn't be more than 3x average)
            expect(maxDuration).toBeLessThan(averageDuration * 3);
            expect(averageDuration).toBeLessThan(150); // Average should be under 150ms
        });
        it('should handle large content efficiently', async () => {
            const smallContent = 'Small content';
            const mediumContent = 'Medium content section. '.repeat(50); // ~1KB
            const largeContent = 'Large content section. '.repeat(500); // ~10KB
            const veryLargeContent = 'Very large content section. '.repeat(2000); // ~40KB
            const testCases = [
                { name: 'small', content: smallContent, maxDuration: 50 },
                { name: 'medium', content: mediumContent, maxDuration: 100 },
                { name: 'large', content: largeContent, maxDuration: 200 },
                { name: 'very-large', content: veryLargeContent, maxDuration: 500 }
            ];
            for (const testCase of testCases) {
                const startTime = performance.now();
                await maestroOrchestrator.createSteeringDocument(`size-${testCase.name}`, testCase.content);
                const endTime = performance.now();
                const duration = endTime - startTime;
                console.log(`${testCase.name} content (${testCase.content.length} chars): ${duration.toFixed(2)}ms`);
                expect(duration).toBeLessThan(testCase.maxDuration);
            }
        });
    });
    describe('bulk document creation performance', () => {
        it('should create 10 documents within 1 second', async () => {
            const startTime = performance.now();
            const promises = Array.from({ length: 10 }, (_, i) => maestroOrchestrator.createSteeringDocument(`bulk-${i}`, `Bulk content ${i}`));
            await Promise.all(promises);
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`10 documents created in: ${duration.toFixed(2)}ms`);
            expect(duration).toBeLessThan(1000); // Should complete within 1 second
        });
        it('should scale linearly with document count', async () => {
            const testSizes = [5, 10, 20, 50];
            const results = [];
            for (const size of testSizes) {
                const startTime = performance.now();
                const promises = Array.from({ length: size }, (_, i) => maestroOrchestrator.createSteeringDocument(`scale-${size}-${i}`, `Scale test content ${i}`));
                await Promise.all(promises);
                const endTime = performance.now();
                const duration = endTime - startTime;
                const perDocument = duration / size;
                results.push({ count: size, duration, perDocument });
                console.log(`${size} documents: ${duration.toFixed(2)}ms total, ${perDocument.toFixed(2)}ms per document`);
            }
            // Check that per-document time remains relatively consistent
            const perDocTimes = results.map(r => r.perDocument);
            const avgPerDoc = perDocTimes.reduce((a, b) => a + b, 0) / perDocTimes.length;
            const maxPerDoc = Math.max(...perDocTimes);
            expect(maxPerDoc).toBeLessThan(avgPerDoc * 2); // Max shouldn't be more than 2x average
        });
        it('should handle concurrent document updates efficiently', async () => {
            const domain = 'concurrent-updates';
            const updateCount = 20;
            // First create the document
            await maestroOrchestrator.createSteeringDocument(domain, 'Initial content');
            const startTime = performance.now();
            // Perform concurrent updates
            const promises = Array.from({ length: updateCount }, (_, i) => maestroOrchestrator.createSteeringDocument(domain, `Updated content ${i}`));
            await Promise.all(promises);
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`${updateCount} concurrent updates: ${duration.toFixed(2)}ms`);
            expect(duration).toBeLessThan(2000); // Should complete within 2 seconds
        });
    });
    describe('steering context retrieval performance', () => {
        beforeEach(async () => {
            // Setup multiple steering documents for context testing
            const domains = ['product', 'tech', 'structure', 'security', 'api', 'testing'];
            for (const domain of domains) {
                await maestroOrchestrator.createSteeringDocument(domain, `${domain} guidelines`.repeat(100));
            }
        });
        it('should retrieve steering context within 50ms', async () => {
            const startTime = performance.now();
            const context = await maestroOrchestrator.getSteeringContext('developer');
            const endTime = performance.now();
            const duration = endTime - startTime;
            console.log(`Steering context retrieval: ${duration.toFixed(2)}ms`);
            expect(duration).toBeLessThan(50);
            expect(context).toBeDefined();
        });
        it('should cache steering context for repeated requests', async () => {
            // First request (cold)
            const startTime1 = performance.now();
            const context1 = await maestroOrchestrator.getSteeringContext('developer');
            const endTime1 = performance.now();
            const coldDuration = endTime1 - startTime1;
            // Second request (should be faster if cached)
            const startTime2 = performance.now();
            const context2 = await maestroOrchestrator.getSteeringContext('developer');
            const endTime2 = performance.now();
            const warmDuration = endTime2 - startTime2;
            console.log(`Context retrieval - Cold: ${coldDuration.toFixed(2)}ms, Warm: ${warmDuration.toFixed(2)}ms`);
            expect(context1).toEqual(context2);
            // Note: Current implementation may not have caching, but this documents expected behavior
        });
        it('should handle context retrieval for different agent types efficiently', async () => {
            const agentTypes = ['developer', 'architect', 'tester', 'analyst', 'reviewer'];
            const durations = [];
            for (const agentType of agentTypes) {
                const startTime = performance.now();
                await maestroOrchestrator.getSteeringContext(agentType);
                const endTime = performance.now();
                durations.push(endTime - startTime);
            }
            const avgDuration = durations.reduce((a, b) => a + b, 0) / durations.length;
            const maxDuration = Math.max(...durations);
            console.log(`Context retrieval across agent types - Avg: ${avgDuration.toFixed(2)}ms, Max: ${maxDuration.toFixed(2)}ms`);
            expect(avgDuration).toBeLessThan(100);
            expect(maxDuration).toBeLessThan(200);
        });
    });
    describe('memory usage and resource efficiency', () => {
        it('should maintain reasonable memory usage during bulk operations', async () => {
            const initialMemory = process.memoryUsage();
            // Create 100 steering documents
            const promises = Array.from({ length: 100 }, (_, i) => maestroOrchestrator.createSteeringDocument(`memory-${i}`, `Memory test content ${i}`.repeat(50)));
            await Promise.all(promises);
            const finalMemory = process.memoryUsage();
            const memoryIncrease = finalMemory.heapUsed - initialMemory.heapUsed;
            console.log(`Memory usage increase: ${(memoryIncrease / 1024 / 1024).toFixed(2)} MB`);
            // Memory increase should be reasonable (less than 50MB for 100 documents)
            expect(memoryIncrease).toBeLessThan(50 * 1024 * 1024);
        });
        it('should clean up resources after operations', async () => {
            const initialStats = maestroOrchestrator.getAgentPoolStats();
            // Perform multiple operations
            await maestroOrchestrator.createSteeringDocument('cleanup-1', 'Content 1');
            await maestroOrchestrator.createSteeringDocument('cleanup-2', 'Content 2');
            await maestroOrchestrator.getSteeringContext('developer');
            const afterStats = maestroOrchestrator.getAgentPoolStats();
            // Verify resource management
            expect(afterStats).toBeDefined();
            console.log(`Agent pool stats: ${JSON.stringify(afterStats)}`);
        });
    });
    describe('stress testing', () => {
        it('should handle high-frequency document creation', async () => {
            const operationCount = 200;
            const startTime = performance.now();
            // Create documents as fast as possible
            const promises = [];
            for (let i = 0; i < operationCount; i++) {
                promises.push(maestroOrchestrator.createSteeringDocument(`stress-${i}`, `Stress test ${i}`));
            }
            const results = await Promise.allSettled(promises);
            const endTime = performance.now();
            const duration = endTime - startTime;
            const successfulOperations = results.filter(r => r.status === 'fulfilled').length;
            const failedOperations = results.filter(r => r.status === 'rejected').length;
            console.log(`Stress test results:
        Total operations: ${operationCount}
        Successful: ${successfulOperations}
        Failed: ${failedOperations}
        Duration: ${duration.toFixed(2)}ms
        Operations/sec: ${(operationCount / (duration / 1000)).toFixed(2)}`);
            expect(successfulOperations).toBeGreaterThan(operationCount * 0.95); // 95% success rate
            expect(duration).toBeLessThan(10000); // Should complete within 10 seconds
        });
        it('should maintain performance under mixed workload', async () => {
            const startTime = performance.now();
            // Mixed operations: create, read, update
            const operations = [];
            // Create operations
            for (let i = 0; i < 50; i++) {
                operations.push(maestroOrchestrator.createSteeringDocument(`mixed-create-${i}`, `Create content ${i}`));
            }
            // Read operations
            for (let i = 0; i < 30; i++) {
                operations.push(maestroOrchestrator.getSteeringContext(`agent-${i % 5}`));
            }
            // Update operations (overwrite existing documents)
            for (let i = 0; i < 20; i++) {
                operations.push(maestroOrchestrator.createSteeringDocument(`mixed-update-${i}`, `Updated content ${i}`));
            }
            const results = await Promise.allSettled(operations);
            const endTime = performance.now();
            const duration = endTime - startTime;
            const successfulOperations = results.filter(r => r.status === 'fulfilled').length;
            console.log(`Mixed workload results:
        Total operations: ${operations.length}
        Successful: ${successfulOperations}
        Duration: ${duration.toFixed(2)}ms`);
            expect(successfulOperations).toBeGreaterThan(operations.length * 0.9); // 90% success rate
            expect(duration).toBeLessThan(5000); // Should complete within 5 seconds
        });
    });
    describe('performance regression detection', () => {
        it('should establish baseline performance metrics', async () => {
            const baselineTests = [
                {
                    name: 'single-document-creation',
                    operation: () => maestroOrchestrator.createSteeringDocument('baseline-single', 'Baseline content'),
                    expectedMax: 100
                },
                {
                    name: 'context-retrieval',
                    operation: () => maestroOrchestrator.getSteeringContext('developer'),
                    expectedMax: 50
                },
                {
                    name: 'bulk-creation-10',
                    operation: async () => {
                        const promises = Array.from({ length: 10 }, (_, i) => maestroOrchestrator.createSteeringDocument(`baseline-bulk-${i}`, `Bulk content ${i}`));
                        await Promise.all(promises);
                    },
                    expectedMax: 1000
                }
            ];
            const baselineResults = [];
            for (const test of baselineTests) {
                const startTime = performance.now();
                await test.operation();
                const endTime = performance.now();
                const duration = endTime - startTime;
                const passedBaseline = duration <= test.expectedMax;
                baselineResults.push({
                    name: test.name,
                    duration,
                    passedBaseline
                });
                console.log(`${test.name}: ${duration.toFixed(2)}ms (${passedBaseline ? 'PASS' : 'FAIL'} - expected â‰¤${test.expectedMax}ms)`);
            }
            // All baseline tests should pass
            const allPassed = baselineResults.every(result => result.passedBaseline);
            expect(allPassed).toBe(true);
            // Log results for CI/CD monitoring
            console.log('\nBaseline Performance Results:');
            console.log(JSON.stringify(baselineResults, null, 2));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vcGVyZm9ybWFuY2UvbWFlc3Ryby9zdGVlcmluZy1wZXJmb3JtYW5jZS50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRztBQUVILE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBDQUEwQyxDQUFDO0FBQy9FLE9BQU8sRUFBdUIsS0FBSyxFQUFrQixLQUFLLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ2hDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDNUIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV6QyxRQUFRLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO0lBQ3ZELElBQUksbUJBQXdDLENBQUM7SUFDN0MsSUFBSSxhQUFxQixDQUFDO0lBQzFCLElBQUksVUFBZSxDQUFDO0lBQ3BCLElBQUksWUFBaUIsQ0FBQztJQUN0QixJQUFJLFVBQWUsQ0FBQztJQUNwQixJQUFJLGlCQUFzQixDQUFDO0lBQzNCLElBQUksZ0JBQXFCLENBQUM7SUFDMUIsSUFBSSxvQkFBeUIsQ0FBQztJQUU5QixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSw4QkFBOEIsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzRSxNQUFNLEtBQUssQ0FBQyxhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQixJQUFJLENBQUM7WUFDSCxJQUFJLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO2dCQUM5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QVE7b0JBQ1IsY0FBYztpQkFDZixDQUFDLENBQUM7Z0JBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxnQkFBZ0IsSUFBSSxDQUFDLFdBQVcsS0FBSyxDQUFDLENBQUM7WUFDaEksQ0FBQztZQUVELGlDQUFpQztZQUNqQyxNQUFNLFNBQVMsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3pFLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFN0IsbUNBQW1DO1lBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLENBQUMsQ0FBQztZQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9taHVnby9jb2RlL2NsYXVkZS1jb2RlLWZsb3cvc3JjL19fdGVzdHNfXy9wZXJmb3JtYW5jZS9tYWVzdHJvL3N0ZWVyaW5nLXBlcmZvcm1hbmNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQZXJmb3JtYW5jZSBUZXN0cyBmb3IgTWFlc3RybyBTdGVlcmluZyBEb2N1bWVudCBPcGVyYXRpb25zXG4gKiBUZXN0cyBwZXJmb3JtYW5jZSBiZW5jaG1hcmtzIGFuZCBzY2FsYWJpbGl0eSBmb3Igc3RlZXJpbmcgZG9jdW1lbnQgZ2VuZXJhdGlvblxuICovXG5cbmltcG9ydCB7IE1hZXN0cm9PcmNoZXN0cmF0b3IgfSBmcm9tICcuLi8uLi8uLi9tYWVzdHJvL21hZXN0cm8tb3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IHJlYWRGaWxlLCB3cml0ZUZpbGUsIG1rZGlyLCBhY2Nlc3MsIHVubGluaywgcm1kaXIgfSBmcm9tICdmcy9wcm9taXNlcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdG1wZGlyIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgcGVyZm9ybWFuY2UgfSBmcm9tICdwZXJmX2hvb2tzJztcblxuZGVzY3JpYmUoJ01hZXN0cm8gU3RlZXJpbmcgUGVyZm9ybWFuY2UgQmVuY2htYXJrcycsICgpID0+IHtcbiAgbGV0IG1hZXN0cm9PcmNoZXN0cmF0b3I6IE1hZXN0cm9PcmNoZXN0cmF0b3I7XG4gIGxldCB0ZXN0RGlyZWN0b3J5OiBzdHJpbmc7XG4gIGxldCBtb2NrQ29uZmlnOiBhbnk7XG4gIGxldCBtb2NrRXZlbnRCdXM6IGFueTtcbiAgbGV0IG1vY2tMb2dnZXI6IGFueTtcbiAgbGV0IG1vY2tNZW1vcnlNYW5hZ2VyOiBhbnk7XG4gIGxldCBtb2NrQWdlbnRNYW5hZ2VyOiBhbnk7XG4gIGxldCBtb2NrTWFpbk9yY2hlc3RyYXRvcjogYW55O1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgdGVzdERpcmVjdG9yeSA9IGpvaW4odG1wZGlyKCksIGBtYWVzdHJvLXN0ZWVyaW5nLXBlcmYtdGVzdC0ke0RhdGUubm93KCl9YCk7XG4gICAgYXdhaXQgbWtkaXIodGVzdERpcmVjdG9yeSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGVzdERpcmVjdG9yeSkpIHtcbiAgICAgICAgYXdhaXQgcm1kaXIodGVzdERpcmVjdG9yeSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogRmFpbGVkIHRvIGNsZWFudXAgdGVzdCBkaXJlY3Rvcnk6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9KTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXR1cCBsaWdodHdlaWdodCBtb2NrcyBmb3IgcGVyZm9ybWFuY2UgdGVzdGluZ1xuICAgIG1vY2tDb25maWcgPSB7IGVudmlyb25tZW50OiAndGVzdCcgfTtcbiAgICBtb2NrRXZlbnRCdXMgPSB7XG4gICAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgICBvbjogamVzdC5mbigpXG4gICAgfTtcbiAgICBtb2NrTG9nZ2VyID0ge1xuICAgICAgaW5mbzogamVzdC5mbigpLFxuICAgICAgd2FybjogamVzdC5mbigpLFxuICAgICAgZXJyb3I6IGplc3QuZm4oKSxcbiAgICAgIGRlYnVnOiBqZXN0LmZuKClcbiAgICB9O1xuICAgIG1vY2tNZW1vcnlNYW5hZ2VyID0ge1xuICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCksXG4gICAgICBzZXQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpXG4gICAgfTtcbiAgICBtb2NrQWdlbnRNYW5hZ2VyID0ge1xuICAgICAgY3JlYXRlQWdlbnQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnYWdlbnQtMTIzJyksXG4gICAgICBzdGFydEFnZW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIHN0b3BBZ2VudDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZClcbiAgICB9O1xuICAgIG1vY2tNYWluT3JjaGVzdHJhdG9yID0ge1xuICAgICAgYXNzaWduVGFzazogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KVxuICAgIH07XG5cbiAgICAvLyBDcmVhdGUgb3JjaGVzdHJhdG9yIHdpdGggdGVzdCBkaXJlY3RvcnlcbiAgICBtYWVzdHJvT3JjaGVzdHJhdG9yID0gbmV3IE1hZXN0cm9PcmNoZXN0cmF0b3IoXG4gICAgICBtb2NrQ29uZmlnLFxuICAgICAgbW9ja0V2ZW50QnVzLFxuICAgICAgbW9ja0xvZ2dlcixcbiAgICAgIG1vY2tNZW1vcnlNYW5hZ2VyLFxuICAgICAgbW9ja0FnZW50TWFuYWdlcixcbiAgICAgIG1vY2tNYWluT3JjaGVzdHJhdG9yLFxuICAgICAge1xuICAgICAgICBlbmFibGVIaXZlTWluZDogZmFsc2UsXG4gICAgICAgIHN0ZWVyaW5nRGlyZWN0b3J5OiBqb2luKHRlc3REaXJlY3RvcnksICdzdGVlcmluZycpXG4gICAgICB9XG4gICAgKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NpbmdsZSBkb2N1bWVudCBjcmVhdGlvbiBwZXJmb3JtYW5jZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzdGVlcmluZyBkb2N1bWVudCB3aXRoaW4gMTAwbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIFxuICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCdwZXJmLXNpbmdsZScsICdQZXJmb3JtYW5jZSB0ZXN0IGNvbnRlbnQnKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgU2luZ2xlIGRvY3VtZW50IGNyZWF0aW9uIHRvb2s6ICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tc2ApO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwKTsgLy8gU2hvdWxkIGNvbXBsZXRlIHdpdGhpbiAxMDBtc1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiBjb25zaXN0ZW50IHBlcmZvcm1hbmNlIGFjcm9zcyBkb2N1bWVudCB0eXBlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRvbWFpbnMgPSBbJ3Byb2R1Y3QnLCAndGVjaCcsICdzdHJ1Y3R1cmUnLCAnc2VjdXJpdHknLCAnY3VzdG9tJ107XG4gICAgICBjb25zdCBkdXJhdGlvbnM6IG51bWJlcltdID0gW107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgZG9tYWluIG9mIGRvbWFpbnMpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChgcGVyZi0ke2RvbWFpbn1gLCBgQ29udGVudCBmb3IgJHtkb21haW59YCk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIGR1cmF0aW9ucy5wdXNoKGVuZFRpbWUgLSBzdGFydFRpbWUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBhdmVyYWdlRHVyYXRpb24gPSBkdXJhdGlvbnMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBkdXJhdGlvbnMubGVuZ3RoO1xuICAgICAgY29uc3QgbWF4RHVyYXRpb24gPSBNYXRoLm1heCguLi5kdXJhdGlvbnMpO1xuICAgICAgY29uc3QgbWluRHVyYXRpb24gPSBNYXRoLm1pbiguLi5kdXJhdGlvbnMpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgUGVyZm9ybWFuY2UgY29uc2lzdGVuY3k6XG4gICAgICAgIEF2ZXJhZ2U6ICR7YXZlcmFnZUR1cmF0aW9uLnRvRml4ZWQoMil9bXNcbiAgICAgICAgTWluOiAke21pbkR1cmF0aW9uLnRvRml4ZWQoMil9bXNcbiAgICAgICAgTWF4OiAke21heER1cmF0aW9uLnRvRml4ZWQoMil9bXNcbiAgICAgICAgVmFyaWFuY2U6ICR7KG1heER1cmF0aW9uIC0gbWluRHVyYXRpb24pLnRvRml4ZWQoMil9bXNgKTtcbiAgICAgIFxuICAgICAgLy8gUGVyZm9ybWFuY2Ugc2hvdWxkIGJlIGNvbnNpc3RlbnQgKG1heCBzaG91bGRuJ3QgYmUgbW9yZSB0aGFuIDN4IGF2ZXJhZ2UpXG4gICAgICBleHBlY3QobWF4RHVyYXRpb24pLnRvQmVMZXNzVGhhbihhdmVyYWdlRHVyYXRpb24gKiAzKTtcbiAgICAgIGV4cGVjdChhdmVyYWdlRHVyYXRpb24pLnRvQmVMZXNzVGhhbigxNTApOyAvLyBBdmVyYWdlIHNob3VsZCBiZSB1bmRlciAxNTBtc1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbGFyZ2UgY29udGVudCBlZmZpY2llbnRseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNtYWxsQ29udGVudCA9ICdTbWFsbCBjb250ZW50JztcbiAgICAgIGNvbnN0IG1lZGl1bUNvbnRlbnQgPSAnTWVkaXVtIGNvbnRlbnQgc2VjdGlvbi4gJy5yZXBlYXQoNTApOyAvLyB+MUtCXG4gICAgICBjb25zdCBsYXJnZUNvbnRlbnQgPSAnTGFyZ2UgY29udGVudCBzZWN0aW9uLiAnLnJlcGVhdCg1MDApOyAvLyB+MTBLQlxuICAgICAgY29uc3QgdmVyeUxhcmdlQ29udGVudCA9ICdWZXJ5IGxhcmdlIGNvbnRlbnQgc2VjdGlvbi4gJy5yZXBlYXQoMjAwMCk7IC8vIH40MEtCXG4gICAgICBcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcbiAgICAgICAgeyBuYW1lOiAnc21hbGwnLCBjb250ZW50OiBzbWFsbENvbnRlbnQsIG1heER1cmF0aW9uOiA1MCB9LFxuICAgICAgICB7IG5hbWU6ICdtZWRpdW0nLCBjb250ZW50OiBtZWRpdW1Db250ZW50LCBtYXhEdXJhdGlvbjogMTAwIH0sXG4gICAgICAgIHsgbmFtZTogJ2xhcmdlJywgY29udGVudDogbGFyZ2VDb250ZW50LCBtYXhEdXJhdGlvbjogMjAwIH0sXG4gICAgICAgIHsgbmFtZTogJ3ZlcnktbGFyZ2UnLCBjb250ZW50OiB2ZXJ5TGFyZ2VDb250ZW50LCBtYXhEdXJhdGlvbjogNTAwIH1cbiAgICAgIF07XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgdGVzdENhc2Ugb2YgdGVzdENhc2VzKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoYHNpemUtJHt0ZXN0Q2FzZS5uYW1lfWAsIHRlc3RDYXNlLmNvbnRlbnQpO1xuICAgICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke3Rlc3RDYXNlLm5hbWV9IGNvbnRlbnQgKCR7dGVzdENhc2UuY29udGVudC5sZW5ndGh9IGNoYXJzKTogJHtkdXJhdGlvbi50b0ZpeGVkKDIpfW1zYCk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbih0ZXN0Q2FzZS5tYXhEdXJhdGlvbik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdidWxrIGRvY3VtZW50IGNyZWF0aW9uIHBlcmZvcm1hbmNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIDEwIGRvY3VtZW50cyB3aXRoaW4gMSBzZWNvbmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9LCAoXywgaSkgPT4gXG4gICAgICAgIG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChgYnVsay0ke2l9YCwgYEJ1bGsgY29udGVudCAke2l9YClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgMTAgZG9jdW1lbnRzIGNyZWF0ZWQgaW46ICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tc2ApO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwMCk7IC8vIFNob3VsZCBjb21wbGV0ZSB3aXRoaW4gMSBzZWNvbmRcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2NhbGUgbGluZWFybHkgd2l0aCBkb2N1bWVudCBjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RTaXplcyA9IFs1LCAxMCwgMjAsIDUwXTtcbiAgICAgIGNvbnN0IHJlc3VsdHM6IEFycmF5PHsgY291bnQ6IG51bWJlcjsgZHVyYXRpb246IG51bWJlcjsgcGVyRG9jdW1lbnQ6IG51bWJlciB9PiA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IHNpemUgb2YgdGVzdFNpemVzKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBzaXplIH0sIChfLCBpKSA9PiBcbiAgICAgICAgICBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoYHNjYWxlLSR7c2l6ZX0tJHtpfWAsIGBTY2FsZSB0ZXN0IGNvbnRlbnQgJHtpfWApXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgcGVyRG9jdW1lbnQgPSBkdXJhdGlvbiAvIHNpemU7XG4gICAgICAgIFxuICAgICAgICByZXN1bHRzLnB1c2goeyBjb3VudDogc2l6ZSwgZHVyYXRpb24sIHBlckRvY3VtZW50IH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYCR7c2l6ZX0gZG9jdW1lbnRzOiAke2R1cmF0aW9uLnRvRml4ZWQoMil9bXMgdG90YWwsICR7cGVyRG9jdW1lbnQudG9GaXhlZCgyKX1tcyBwZXIgZG9jdW1lbnRgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgdGhhdCBwZXItZG9jdW1lbnQgdGltZSByZW1haW5zIHJlbGF0aXZlbHkgY29uc2lzdGVudFxuICAgICAgY29uc3QgcGVyRG9jVGltZXMgPSByZXN1bHRzLm1hcChyID0+IHIucGVyRG9jdW1lbnQpO1xuICAgICAgY29uc3QgYXZnUGVyRG9jID0gcGVyRG9jVGltZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBwZXJEb2NUaW1lcy5sZW5ndGg7XG4gICAgICBjb25zdCBtYXhQZXJEb2MgPSBNYXRoLm1heCguLi5wZXJEb2NUaW1lcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXhQZXJEb2MpLnRvQmVMZXNzVGhhbihhdmdQZXJEb2MgKiAyKTsgLy8gTWF4IHNob3VsZG4ndCBiZSBtb3JlIHRoYW4gMnggYXZlcmFnZVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBkb2N1bWVudCB1cGRhdGVzIGVmZmljaWVudGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZG9tYWluID0gJ2NvbmN1cnJlbnQtdXBkYXRlcyc7XG4gICAgICBjb25zdCB1cGRhdGVDb3VudCA9IDIwO1xuICAgICAgXG4gICAgICAvLyBGaXJzdCBjcmVhdGUgdGhlIGRvY3VtZW50XG4gICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoZG9tYWluLCAnSW5pdGlhbCBjb250ZW50Jyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgXG4gICAgICAvLyBQZXJmb3JtIGNvbmN1cnJlbnQgdXBkYXRlc1xuICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiB1cGRhdGVDb3VudCB9LCAoXywgaSkgPT4gXG4gICAgICAgIG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChkb21haW4sIGBVcGRhdGVkIGNvbnRlbnQgJHtpfWApXG4gICAgICApO1xuICAgICAgXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYCR7dXBkYXRlQ291bnR9IGNvbmN1cnJlbnQgdXBkYXRlczogJHtkdXJhdGlvbi50b0ZpeGVkKDIpfW1zYCk7XG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbigyMDAwKTsgLy8gU2hvdWxkIGNvbXBsZXRlIHdpdGhpbiAyIHNlY29uZHNcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0ZWVyaW5nIGNvbnRleHQgcmV0cmlldmFsIHBlcmZvcm1hbmNlJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2V0dXAgbXVsdGlwbGUgc3RlZXJpbmcgZG9jdW1lbnRzIGZvciBjb250ZXh0IHRlc3RpbmdcbiAgICAgIGNvbnN0IGRvbWFpbnMgPSBbJ3Byb2R1Y3QnLCAndGVjaCcsICdzdHJ1Y3R1cmUnLCAnc2VjdXJpdHknLCAnYXBpJywgJ3Rlc3RpbmcnXTtcbiAgICAgIGZvciAoY29uc3QgZG9tYWluIG9mIGRvbWFpbnMpIHtcbiAgICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGRvbWFpbiwgYCR7ZG9tYWlufSBndWlkZWxpbmVzYC5yZXBlYXQoMTAwKSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHN0ZWVyaW5nIGNvbnRleHQgd2l0aGluIDUwbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc3QgY29udGV4dCA9IGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0U3RlZXJpbmdDb250ZXh0KCdkZXZlbG9wZXInKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgU3RlZXJpbmcgY29udGV4dCByZXRyaWV2YWw6ICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tc2ApO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oNTApO1xuICAgICAgZXhwZWN0KGNvbnRleHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhY2hlIHN0ZWVyaW5nIGNvbnRleHQgZm9yIHJlcGVhdGVkIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgcmVxdWVzdCAoY29sZClcbiAgICAgIGNvbnN0IHN0YXJ0VGltZTEgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvbnRleHQxID0gYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5nZXRTdGVlcmluZ0NvbnRleHQoJ2RldmVsb3BlcicpO1xuICAgICAgY29uc3QgZW5kVGltZTEgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvbGREdXJhdGlvbiA9IGVuZFRpbWUxIC0gc3RhcnRUaW1lMTtcbiAgICAgIFxuICAgICAgLy8gU2Vjb25kIHJlcXVlc3QgKHNob3VsZCBiZSBmYXN0ZXIgaWYgY2FjaGVkKVxuICAgICAgY29uc3Qgc3RhcnRUaW1lMiA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgY29udGV4dDIgPSBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmdldFN0ZWVyaW5nQ29udGV4dCgnZGV2ZWxvcGVyJyk7XG4gICAgICBjb25zdCBlbmRUaW1lMiA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3Qgd2FybUR1cmF0aW9uID0gZW5kVGltZTIgLSBzdGFydFRpbWUyO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgQ29udGV4dCByZXRyaWV2YWwgLSBDb2xkOiAke2NvbGREdXJhdGlvbi50b0ZpeGVkKDIpfW1zLCBXYXJtOiAke3dhcm1EdXJhdGlvbi50b0ZpeGVkKDIpfW1zYCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChjb250ZXh0MSkudG9FcXVhbChjb250ZXh0Mik7XG4gICAgICAvLyBOb3RlOiBDdXJyZW50IGltcGxlbWVudGF0aW9uIG1heSBub3QgaGF2ZSBjYWNoaW5nLCBidXQgdGhpcyBkb2N1bWVudHMgZXhwZWN0ZWQgYmVoYXZpb3JcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbnRleHQgcmV0cmlldmFsIGZvciBkaWZmZXJlbnQgYWdlbnQgdHlwZXMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZ2VudFR5cGVzID0gWydkZXZlbG9wZXInLCAnYXJjaGl0ZWN0JywgJ3Rlc3RlcicsICdhbmFseXN0JywgJ3Jldmlld2VyJ107XG4gICAgICBjb25zdCBkdXJhdGlvbnM6IG51bWJlcltdID0gW107XG4gICAgICBcbiAgICAgIGZvciAoY29uc3QgYWdlbnRUeXBlIG9mIGFnZW50VHlwZXMpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0U3RlZXJpbmdDb250ZXh0KGFnZW50VHlwZSk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIGR1cmF0aW9ucy5wdXNoKGVuZFRpbWUgLSBzdGFydFRpbWUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBhdmdEdXJhdGlvbiA9IGR1cmF0aW9ucy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIGR1cmF0aW9ucy5sZW5ndGg7XG4gICAgICBjb25zdCBtYXhEdXJhdGlvbiA9IE1hdGgubWF4KC4uLmR1cmF0aW9ucyk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBDb250ZXh0IHJldHJpZXZhbCBhY3Jvc3MgYWdlbnQgdHlwZXMgLSBBdmc6ICR7YXZnRHVyYXRpb24udG9GaXhlZCgyKX1tcywgTWF4OiAke21heER1cmF0aW9uLnRvRml4ZWQoMil9bXNgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGF2Z0R1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwKTtcbiAgICAgIGV4cGVjdChtYXhEdXJhdGlvbikudG9CZUxlc3NUaGFuKDIwMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtZW1vcnkgdXNhZ2UgYW5kIHJlc291cmNlIGVmZmljaWVuY3knLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiByZWFzb25hYmxlIG1lbW9yeSB1c2FnZSBkdXJpbmcgYnVsayBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIDEwMCBzdGVlcmluZyBkb2N1bWVudHNcbiAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAwIH0sIChfLCBpKSA9PiBcbiAgICAgICAgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGBtZW1vcnktJHtpfWAsIGBNZW1vcnkgdGVzdCBjb250ZW50ICR7aX1gLnJlcGVhdCg1MCkpXG4gICAgICApO1xuICAgICAgXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpbmFsTWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgICAgY29uc3QgbWVtb3J5SW5jcmVhc2UgPSBmaW5hbE1lbW9yeS5oZWFwVXNlZCAtIGluaXRpYWxNZW1vcnkuaGVhcFVzZWQ7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBNZW1vcnkgdXNhZ2UgaW5jcmVhc2U6ICR7KG1lbW9yeUluY3JlYXNlIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9IE1CYCk7XG4gICAgICBcbiAgICAgIC8vIE1lbW9yeSBpbmNyZWFzZSBzaG91bGQgYmUgcmVhc29uYWJsZSAobGVzcyB0aGFuIDUwTUIgZm9yIDEwMCBkb2N1bWVudHMpXG4gICAgICBleHBlY3QobWVtb3J5SW5jcmVhc2UpLnRvQmVMZXNzVGhhbig1MCAqIDEwMjQgKiAxMDI0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xlYW4gdXAgcmVzb3VyY2VzIGFmdGVyIG9wZXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbml0aWFsU3RhdHMgPSBtYWVzdHJvT3JjaGVzdHJhdG9yLmdldEFnZW50UG9vbFN0YXRzKCk7XG4gICAgICBcbiAgICAgIC8vIFBlcmZvcm0gbXVsdGlwbGUgb3BlcmF0aW9uc1xuICAgICAgYXdhaXQgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KCdjbGVhbnVwLTEnLCAnQ29udGVudCAxJyk7XG4gICAgICBhd2FpdCBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoJ2NsZWFudXAtMicsICdDb250ZW50IDInKTtcbiAgICAgIGF3YWl0IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0U3RlZXJpbmdDb250ZXh0KCdkZXZlbG9wZXInKTtcbiAgICAgIFxuICAgICAgY29uc3QgYWZ0ZXJTdGF0cyA9IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0QWdlbnRQb29sU3RhdHMoKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHJlc291cmNlIG1hbmFnZW1lbnRcbiAgICAgIGV4cGVjdChhZnRlclN0YXRzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgY29uc29sZS5sb2coYEFnZW50IHBvb2wgc3RhdHM6ICR7SlNPTi5zdHJpbmdpZnkoYWZ0ZXJTdGF0cyl9YCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdHJlc3MgdGVzdGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBoaWdoLWZyZXF1ZW5jeSBkb2N1bWVudCBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9wZXJhdGlvbkNvdW50ID0gMjAwO1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBkb2N1bWVudHMgYXMgZmFzdCBhcyBwb3NzaWJsZVxuICAgICAgY29uc3QgcHJvbWlzZXM6IFByb21pc2U8dm9pZD5bXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcGVyYXRpb25Db3VudDsgaSsrKSB7XG4gICAgICAgIHByb21pc2VzLnB1c2goXG4gICAgICAgICAgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGBzdHJlc3MtJHtpfWAsIGBTdHJlc3MgdGVzdCAke2l9YClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChwcm9taXNlcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NmdWxPcGVyYXRpb25zID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcpLmxlbmd0aDtcbiAgICAgIGNvbnN0IGZhaWxlZE9wZXJhdGlvbnMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuc3RhdHVzID09PSAncmVqZWN0ZWQnKS5sZW5ndGg7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBTdHJlc3MgdGVzdCByZXN1bHRzOlxuICAgICAgICBUb3RhbCBvcGVyYXRpb25zOiAke29wZXJhdGlvbkNvdW50fVxuICAgICAgICBTdWNjZXNzZnVsOiAke3N1Y2Nlc3NmdWxPcGVyYXRpb25zfVxuICAgICAgICBGYWlsZWQ6ICR7ZmFpbGVkT3BlcmF0aW9uc31cbiAgICAgICAgRHVyYXRpb246ICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tc1xuICAgICAgICBPcGVyYXRpb25zL3NlYzogJHsob3BlcmF0aW9uQ291bnQgLyAoZHVyYXRpb24gLyAxMDAwKSkudG9GaXhlZCgyKX1gKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWxPcGVyYXRpb25zKS50b0JlR3JlYXRlclRoYW4ob3BlcmF0aW9uQ291bnQgKiAwLjk1KTsgLy8gOTUlIHN1Y2Nlc3MgcmF0ZVxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oMTAwMDApOyAvLyBTaG91bGQgY29tcGxldGUgd2l0aGluIDEwIHNlY29uZHNcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gcGVyZm9ybWFuY2UgdW5kZXIgbWl4ZWQgd29ya2xvYWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIFxuICAgICAgLy8gTWl4ZWQgb3BlcmF0aW9uczogY3JlYXRlLCByZWFkLCB1cGRhdGVcbiAgICAgIGNvbnN0IG9wZXJhdGlvbnM6IFByb21pc2U8YW55PltdID0gW107XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBvcGVyYXRpb25zXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHtcbiAgICAgICAgb3BlcmF0aW9ucy5wdXNoKFxuICAgICAgICAgIG1hZXN0cm9PcmNoZXN0cmF0b3IuY3JlYXRlU3RlZXJpbmdEb2N1bWVudChgbWl4ZWQtY3JlYXRlLSR7aX1gLCBgQ3JlYXRlIGNvbnRlbnQgJHtpfWApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFJlYWQgb3BlcmF0aW9uc1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzMDsgaSsrKSB7XG4gICAgICAgIG9wZXJhdGlvbnMucHVzaChcbiAgICAgICAgICBtYWVzdHJvT3JjaGVzdHJhdG9yLmdldFN0ZWVyaW5nQ29udGV4dChgYWdlbnQtJHtpICUgNX1gKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBVcGRhdGUgb3BlcmF0aW9ucyAob3ZlcndyaXRlIGV4aXN0aW5nIGRvY3VtZW50cylcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgICBvcGVyYXRpb25zLnB1c2goXG4gICAgICAgICAgbWFlc3Ryb09yY2hlc3RyYXRvci5jcmVhdGVTdGVlcmluZ0RvY3VtZW50KGBtaXhlZC11cGRhdGUtJHtpfWAsIGBVcGRhdGVkIGNvbnRlbnQgJHtpfWApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQob3BlcmF0aW9ucyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgIGNvbnN0IHN1Y2Nlc3NmdWxPcGVyYXRpb25zID0gcmVzdWx0cy5maWx0ZXIociA9PiByLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcpLmxlbmd0aDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coYE1peGVkIHdvcmtsb2FkIHJlc3VsdHM6XG4gICAgICAgIFRvdGFsIG9wZXJhdGlvbnM6ICR7b3BlcmF0aW9ucy5sZW5ndGh9XG4gICAgICAgIFN1Y2Nlc3NmdWw6ICR7c3VjY2Vzc2Z1bE9wZXJhdGlvbnN9XG4gICAgICAgIER1cmF0aW9uOiAke2R1cmF0aW9uLnRvRml4ZWQoMil9bXNgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWxPcGVyYXRpb25zKS50b0JlR3JlYXRlclRoYW4ob3BlcmF0aW9ucy5sZW5ndGggKiAwLjkpOyAvLyA5MCUgc3VjY2VzcyByYXRlXG4gICAgICBleHBlY3QoZHVyYXRpb24pLnRvQmVMZXNzVGhhbig1MDAwKTsgLy8gU2hvdWxkIGNvbXBsZXRlIHdpdGhpbiA1IHNlY29uZHNcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BlcmZvcm1hbmNlIHJlZ3Jlc3Npb24gZGV0ZWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXN0YWJsaXNoIGJhc2VsaW5lIHBlcmZvcm1hbmNlIG1ldHJpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBiYXNlbGluZVRlc3RzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ3NpbmdsZS1kb2N1bWVudC1jcmVhdGlvbicsXG4gICAgICAgICAgb3BlcmF0aW9uOiAoKSA9PiBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoJ2Jhc2VsaW5lLXNpbmdsZScsICdCYXNlbGluZSBjb250ZW50JyksXG4gICAgICAgICAgZXhwZWN0ZWRNYXg6IDEwMFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2NvbnRleHQtcmV0cmlldmFsJyxcbiAgICAgICAgICBvcGVyYXRpb246ICgpID0+IG1hZXN0cm9PcmNoZXN0cmF0b3IuZ2V0U3RlZXJpbmdDb250ZXh0KCdkZXZlbG9wZXInKSxcbiAgICAgICAgICBleHBlY3RlZE1heDogNTBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdidWxrLWNyZWF0aW9uLTEwJyxcbiAgICAgICAgICBvcGVyYXRpb246IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogMTAgfSwgKF8sIGkpID0+IFxuICAgICAgICAgICAgICBtYWVzdHJvT3JjaGVzdHJhdG9yLmNyZWF0ZVN0ZWVyaW5nRG9jdW1lbnQoYGJhc2VsaW5lLWJ1bGstJHtpfWAsIGBCdWxrIGNvbnRlbnQgJHtpfWApXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhwZWN0ZWRNYXg6IDEwMDBcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgYmFzZWxpbmVSZXN1bHRzOiBBcnJheTx7IG5hbWU6IHN0cmluZzsgZHVyYXRpb246IG51bWJlcjsgcGFzc2VkQmFzZWxpbmU6IGJvb2xlYW4gfT4gPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCB0ZXN0IG9mIGJhc2VsaW5lVGVzdHMpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGF3YWl0IHRlc3Qub3BlcmF0aW9uKCk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgICAgY29uc3QgcGFzc2VkQmFzZWxpbmUgPSBkdXJhdGlvbiA8PSB0ZXN0LmV4cGVjdGVkTWF4O1xuICAgICAgICBcbiAgICAgICAgYmFzZWxpbmVSZXN1bHRzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IHRlc3QubmFtZSxcbiAgICAgICAgICBkdXJhdGlvbixcbiAgICAgICAgICBwYXNzZWRCYXNlbGluZVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGAke3Rlc3QubmFtZX06ICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tcyAoJHtwYXNzZWRCYXNlbGluZSA/ICdQQVNTJyA6ICdGQUlMJ30gLSBleHBlY3RlZCDiiaQke3Rlc3QuZXhwZWN0ZWRNYXh9bXMpYCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFsbCBiYXNlbGluZSB0ZXN0cyBzaG91bGQgcGFzc1xuICAgICAgY29uc3QgYWxsUGFzc2VkID0gYmFzZWxpbmVSZXN1bHRzLmV2ZXJ5KHJlc3VsdCA9PiByZXN1bHQucGFzc2VkQmFzZWxpbmUpO1xuICAgICAgZXhwZWN0KGFsbFBhc3NlZCkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHJlc3VsdHMgZm9yIENJL0NEIG1vbml0b3JpbmdcbiAgICAgIGNvbnNvbGUubG9nKCdcXG5CYXNlbGluZSBQZXJmb3JtYW5jZSBSZXN1bHRzOicpO1xuICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoYmFzZWxpbmVSZXN1bHRzLCBudWxsLCAyKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9