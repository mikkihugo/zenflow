70a4de59c448eefed6779e4a2f6f43d4
/**
 * File System Test Helper - File System Testing Utilities
 *
 * Comprehensive file system testing support for both mocked and real environments
 */
import { promises as fs } from 'fs';
import { join, dirname, resolve } from 'path';
import { tmpdir } from 'os';
export class RealFileSystemTestHelper {
    tempDirs = [];
    createdFiles = [];
    watchers = [];
    async createTempDir(prefix = 'test') {
        const tempPath = join(tmpdir(), `claude-test-${prefix}-${Date.now()}-${Math.random().toString(36).substring(2)}`);
        await fs.mkdir(tempPath, { recursive: true });
        this.tempDirs.push(tempPath);
        return tempPath;
    }
    async createFile(path, content) {
        const dir = dirname(path);
        await fs.mkdir(dir, { recursive: true });
        await fs.writeFile(path, content, 'utf8');
        this.createdFiles.push(path);
    }
    async createDirectory(path) {
        await fs.mkdir(path, { recursive: true });
        this.tempDirs.push(path);
    }
    async readFile(path) {
        return fs.readFile(path, 'utf8');
    }
    async fileExists(path) {
        try {
            await fs.access(path);
            return true;
        }
        catch {
            return false;
        }
    }
    async deleteFile(path) {
        try {
            await fs.unlink(path);
            const index = this.createdFiles.indexOf(path);
            if (index > -1) {
                this.createdFiles.splice(index, 1);
            }
        }
        catch (error) {
            // File might not exist
        }
    }
    async deleteDirectory(path) {
        try {
            await fs.rm(path, { recursive: true, force: true });
            const index = this.tempDirs.indexOf(path);
            if (index > -1) {
                this.tempDirs.splice(index, 1);
            }
        }
        catch (error) {
            // Directory might not exist
        }
    }
    async listFiles(path) {
        try {
            const entries = await fs.readdir(path, { withFileTypes: true });
            return entries
                .filter(entry => entry.isFile())
                .map(entry => join(path, entry.name));
        }
        catch {
            return [];
        }
    }
    async copyFile(src, dest) {
        const destDir = dirname(dest);
        await fs.mkdir(destDir, { recursive: true });
        await fs.copyFile(src, dest);
        this.createdFiles.push(dest);
    }
    async moveFile(src, dest) {
        const destDir = dirname(dest);
        await fs.mkdir(destDir, { recursive: true });
        await fs.rename(src, dest);
        const srcIndex = this.createdFiles.indexOf(src);
        if (srcIndex > -1) {
            this.createdFiles[srcIndex] = dest;
        }
        else {
            this.createdFiles.push(dest);
        }
    }
    async getFileStats(path) {
        const stats = await fs.stat(path);
        return {
            size: stats.size,
            mtime: stats.mtime,
            ctime: stats.ctime,
            isFile: stats.isFile(),
            isDirectory: stats.isDirectory(),
            mode: stats.mode
        };
    }
    watchFile(path, callback) {
        let watcher = null;
        const startWatching = async () => {
            try {
                const { watch } = await import('chokidar');
                watcher = watch(path);
                watcher.on('all', (event) => callback(event));
            }
            catch {
                // Fallback to basic fs.watch if chokidar not available
                try {
                    watcher = fs.watch(path, (event) => callback(event));
                }
                catch {
                    // File watching not available
                }
            }
        };
        startWatching();
        const stopWatching = () => {
            if (watcher) {
                if (typeof watcher.close === 'function') {
                    watcher.close();
                }
                else if (typeof watcher.unwatch === 'function') {
                    watcher.unwatch(path);
                }
            }
        };
        this.watchers.push(stopWatching);
        return stopWatching;
    }
    async createSymlink(target, link) {
        const linkDir = dirname(link);
        await fs.mkdir(linkDir, { recursive: true });
        await fs.symlink(target, link);
        this.createdFiles.push(link);
    }
    async cleanup() {
        // Stop all watchers
        this.watchers.forEach(stop => {
            try {
                stop();
            }
            catch {
                // Ignore errors when stopping watchers
            }
        });
        this.watchers = [];
        // Clean up created files
        await Promise.allSettled(this.createdFiles.map(file => this.deleteFile(file)));
        this.createdFiles = [];
        // Clean up temp directories
        await Promise.allSettled(this.tempDirs.map(dir => this.deleteDirectory(dir)));
        this.tempDirs = [];
    }
}
export class MockFileSystemTestHelper {
    files = new Map();
    directories = new Set();
    watchers = new Map();
    async createTempDir(prefix = 'test') {
        const tempPath = `/mock/temp/${prefix}-${Date.now()}`;
        this.directories.add(tempPath);
        return tempPath;
    }
    async createFile(path, content) {
        const normalizedPath = this.normalizePath(path);
        this.files.set(normalizedPath, content);
        // Ensure parent directories exist
        const dir = dirname(normalizedPath);
        if (dir !== normalizedPath) {
            this.directories.add(dir);
        }
        this.triggerWatchers(normalizedPath, 'add');
    }
    async createDirectory(path) {
        const normalizedPath = this.normalizePath(path);
        this.directories.add(normalizedPath);
    }
    async readFile(path) {
        const normalizedPath = this.normalizePath(path);
        const content = this.files.get(normalizedPath);
        if (content === undefined) {
            throw new Error(`ENOENT: no such file or directory, open '${path}'`);
        }
        return content;
    }
    async fileExists(path) {
        const normalizedPath = this.normalizePath(path);
        return this.files.has(normalizedPath) || this.directories.has(normalizedPath);
    }
    async deleteFile(path) {
        const normalizedPath = this.normalizePath(path);
        if (this.files.delete(normalizedPath)) {
            this.triggerWatchers(normalizedPath, 'unlink');
        }
    }
    async deleteDirectory(path) {
        const normalizedPath = this.normalizePath(path);
        // Remove the directory
        this.directories.delete(normalizedPath);
        // Remove all files and subdirectories under this path
        const pathPrefix = normalizedPath + '/';
        for (const filePath of this.files.keys()) {
            if (filePath.startsWith(pathPrefix)) {
                this.files.delete(filePath);
            }
        }
        for (const dirPath of this.directories) {
            if (dirPath.startsWith(pathPrefix)) {
                this.directories.delete(dirPath);
            }
        }
    }
    async listFiles(path) {
        const normalizedPath = this.normalizePath(path);
        const pathPrefix = normalizedPath === '/' ? '' : normalizedPath + '/';
        const files = [];
        for (const filePath of this.files.keys()) {
            if (filePath.startsWith(pathPrefix)) {
                const relativePath = filePath.substring(pathPrefix.length);
                if (relativePath && !relativePath.includes('/')) {
                    files.push(filePath);
                }
            }
        }
        return files.sort();
    }
    async copyFile(src, dest) {
        const content = await this.readFile(src);
        await this.createFile(dest, content);
    }
    async moveFile(src, dest) {
        const content = await this.readFile(src);
        await this.createFile(dest, content);
        await this.deleteFile(src);
    }
    async getFileStats(path) {
        const normalizedPath = this.normalizePath(path);
        if (!this.fileExists(normalizedPath)) {
            throw new Error(`ENOENT: no such file or directory, stat '${path}'`);
        }
        const isFile = this.files.has(normalizedPath);
        const isDirectory = this.directories.has(normalizedPath);
        const content = this.files.get(normalizedPath) || '';
        return {
            size: content.length,
            mtime: new Date(),
            ctime: new Date(),
            isFile,
            isDirectory,
            mode: isFile ? 0o644 : 0o755
        };
    }
    watchFile(path, callback) {
        const normalizedPath = this.normalizePath(path);
        if (!this.watchers.has(normalizedPath)) {
            this.watchers.set(normalizedPath, []);
        }
        this.watchers.get(normalizedPath).push(callback);
        return () => {
            const callbacks = this.watchers.get(normalizedPath);
            if (callbacks) {
                const index = callbacks.indexOf(callback);
                if (index > -1) {
                    callbacks.splice(index, 1);
                }
                if (callbacks.length === 0) {
                    this.watchers.delete(normalizedPath);
                }
            }
        };
    }
    async createSymlink(target, link) {
        // For mock filesystem, just create a file with special content
        await this.createFile(link, `__SYMLINK__:${target}`);
    }
    async cleanup() {
        this.files.clear();
        this.directories.clear();
        this.watchers.clear();
    }
    // Mock-specific methods
    /**
     * Get all files in the mock filesystem
     */
    getAllFiles() {
        const result = {};
        for (const [path, content] of this.files.entries()) {
            result[path] = content;
        }
        return result;
    }
    /**
     * Get all directories in the mock filesystem
     */
    getAllDirectories() {
        return Array.from(this.directories).sort();
    }
    /**
     * Simulate file system events
     */
    simulateFileEvent(path, event) {
        this.triggerWatchers(path, event);
    }
    normalizePath(path) {
        return resolve(path).replace(/\\/g, '/');
    }
    triggerWatchers(path, event) {
        const callbacks = this.watchers.get(path);
        if (callbacks) {
            callbacks.forEach(callback => {
                try {
                    callback(event);
                }
                catch (error) {
                    // Ignore callback errors
                }
            });
        }
    }
}
// Factory functions
export function createRealFileSystemHelper() {
    return new RealFileSystemTestHelper();
}
export function createMockFileSystemHelper() {
    return new MockFileSystemTestHelper();
}
// Helper functions for common patterns
export async function createTestProject(helper, projectName, files) {
    const projectDir = await helper.createTempDir(projectName);
    for (const [filePath, content] of Object.entries(files)) {
        const fullPath = join(projectDir, filePath);
        await helper.createFile(fullPath, content);
    }
    return projectDir;
}
export async function createTestWorkspace(helper, workspaceName) {
    const workspaceDir = await helper.createTempDir(workspaceName);
    const srcDir = join(workspaceDir, 'src');
    const testDir = join(workspaceDir, 'tests');
    const configDir = join(workspaceDir, 'config');
    await Promise.all([
        helper.createDirectory(srcDir),
        helper.createDirectory(testDir),
        helper.createDirectory(configDir)
    ]);
    return { workspaceDir, srcDir, testDir, configDir };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaGVscGVycy9maWxlc3lzdGVtLXRlc3QtaGVscGVyLnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsUUFBUSxJQUFJLEVBQUUsRUFBRSxNQUFNLElBQUksQ0FBQztBQUNwQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBWSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDeEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLElBQUksQ0FBQztBQW1CNUIsTUFBTSxPQUFPLHdCQUF3QjtJQUMzQixRQUFRLEdBQWEsRUFBRSxDQUFDO0lBQ3hCLFlBQVksR0FBYSxFQUFFLENBQUM7SUFDNUIsUUFBUSxHQUFzQixFQUFFLENBQUM7SUFFekMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxTQUFpQixNQUFNO1FBQ3pDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FDbkIsTUFBTSxFQUFFLEVBQ1IsZUFBZSxNQUFNLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ2pGLENBQUM7UUFFRixNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDN0IsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBWSxFQUFFLE9BQWU7UUFDNUMsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFCLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FB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QU0sT0FBTyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDNUMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztJQUUvQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7UUFDaEIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUM7UUFDOUIsTUFBTSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUM7UUFDL0IsTUFBTSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUM7S0FDbEMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxDQUFDO0FBQ3RELENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vaGVscGVycy9maWxlc3lzdGVtLXRlc3QtaGVscGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRmlsZSBTeXN0ZW0gVGVzdCBIZWxwZXIgLSBGaWxlIFN5c3RlbSBUZXN0aW5nIFV0aWxpdGllc1xuICogXG4gKiBDb21wcmVoZW5zaXZlIGZpbGUgc3lzdGVtIHRlc3Rpbmcgc3VwcG9ydCBmb3IgYm90aCBtb2NrZWQgYW5kIHJlYWwgZW52aXJvbm1lbnRzXG4gKi9cblxuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBqb2luLCBkaXJuYW1lLCByZWxhdGl2ZSwgcmVzb2x2ZSB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgdG1wZGlyIH0gZnJvbSAnb3MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVTeXN0ZW1UZXN0SGVscGVyIHtcbiAgY3JlYXRlVGVtcERpcihwcmVmaXg/OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz47XG4gIGNyZWF0ZUZpbGUocGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICBjcmVhdGVEaXJlY3RvcnkocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbiAgcmVhZEZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+O1xuICBmaWxlRXhpc3RzKHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj47XG4gIGRlbGV0ZUZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbiAgZGVsZXRlRGlyZWN0b3J5KHBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD47XG4gIGxpc3RGaWxlcyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPjtcbiAgY29weUZpbGUoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD47XG4gIG1vdmVGaWxlKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICBnZXRGaWxlU3RhdHMocGF0aDogc3RyaW5nKTogUHJvbWlzZTxhbnk+O1xuICB3YXRjaEZpbGUocGF0aDogc3RyaW5nLCBjYWxsYmFjazogKGV2ZW50OiBzdHJpbmcpID0+IHZvaWQpOiAoKSA9PiB2b2lkO1xuICBjcmVhdGVTeW1saW5rKHRhcmdldDogc3RyaW5nLCBsaW5rOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICBjbGVhbnVwKCk6IFByb21pc2U8dm9pZD47XG59XG5cbmV4cG9ydCBjbGFzcyBSZWFsRmlsZVN5c3RlbVRlc3RIZWxwZXIgaW1wbGVtZW50cyBGaWxlU3lzdGVtVGVzdEhlbHBlciB7XG4gIHByaXZhdGUgdGVtcERpcnM6IHN0cmluZ1tdID0gW107XG4gIHByaXZhdGUgY3JlYXRlZEZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICBwcml2YXRlIHdhdGNoZXJzOiBBcnJheTwoKSA9PiB2b2lkPiA9IFtdO1xuXG4gIGFzeW5jIGNyZWF0ZVRlbXBEaXIocHJlZml4OiBzdHJpbmcgPSAndGVzdCcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHRlbXBQYXRoID0gam9pbihcbiAgICAgIHRtcGRpcigpLCBcbiAgICAgIGBjbGF1ZGUtdGVzdC0ke3ByZWZpeH0tJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKX1gXG4gICAgKTtcbiAgICBcbiAgICBhd2FpdCBmcy5ta2Rpcih0ZW1wUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgdGhpcy50ZW1wRGlycy5wdXNoKHRlbXBQYXRoKTtcbiAgICByZXR1cm4gdGVtcFBhdGg7XG4gIH1cblxuICBhc3luYyBjcmVhdGVGaWxlKHBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGlyID0gZGlybmFtZShwYXRoKTtcbiAgICBhd2FpdCBmcy5ta2RpcihkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShwYXRoLCBjb250ZW50LCAndXRmOCcpO1xuICAgIHRoaXMuY3JlYXRlZEZpbGVzLnB1c2gocGF0aCk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVEaXJlY3RvcnkocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgZnMubWtkaXIocGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgdGhpcy50ZW1wRGlycy5wdXNoKHBhdGgpO1xuICB9XG5cbiAgYXN5bmMgcmVhZEZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gZnMucmVhZEZpbGUocGF0aCwgJ3V0ZjgnKTtcbiAgfVxuXG4gIGFzeW5jIGZpbGVFeGlzdHMocGF0aDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGZzLmFjY2VzcyhwYXRoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhwYXRoKTtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jcmVhdGVkRmlsZXMuaW5kZXhPZihwYXRoKTtcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgIHRoaXMuY3JlYXRlZEZpbGVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZpbGUgbWlnaHQgbm90IGV4aXN0XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGVsZXRlRGlyZWN0b3J5KHBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBmcy5ybShwYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSwgZm9yY2U6IHRydWUgfSk7XG4gICAgICBjb25zdCBpbmRleCA9IHRoaXMudGVtcERpcnMuaW5kZXhPZihwYXRoKTtcbiAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgIHRoaXMudGVtcERpcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRGlyZWN0b3J5IG1pZ2h0IG5vdCBleGlzdFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxpc3RGaWxlcyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBmcy5yZWFkZGlyKHBhdGgsIHsgd2l0aEZpbGVUeXBlczogdHJ1ZSB9KTtcbiAgICAgIHJldHVybiBlbnRyaWVzXG4gICAgICAgIC5maWx0ZXIoZW50cnkgPT4gZW50cnkuaXNGaWxlKCkpXG4gICAgICAgIC5tYXAoZW50cnkgPT4gam9pbihwYXRoLCBlbnRyeS5uYW1lKSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY29weUZpbGUoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRlc3REaXIgPSBkaXJuYW1lKGRlc3QpO1xuICAgIGF3YWl0IGZzLm1rZGlyKGRlc3REaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGF3YWl0IGZzLmNvcHlGaWxlKHNyYywgZGVzdCk7XG4gICAgdGhpcy5jcmVhdGVkRmlsZXMucHVzaChkZXN0KTtcbiAgfVxuXG4gIGFzeW5jIG1vdmVGaWxlKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBkZXN0RGlyID0gZGlybmFtZShkZXN0KTtcbiAgICBhd2FpdCBmcy5ta2RpcihkZXN0RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICBhd2FpdCBmcy5yZW5hbWUoc3JjLCBkZXN0KTtcbiAgICBcbiAgICBjb25zdCBzcmNJbmRleCA9IHRoaXMuY3JlYXRlZEZpbGVzLmluZGV4T2Yoc3JjKTtcbiAgICBpZiAoc3JjSW5kZXggPiAtMSkge1xuICAgICAgdGhpcy5jcmVhdGVkRmlsZXNbc3JjSW5kZXhdID0gZGVzdDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jcmVhdGVkRmlsZXMucHVzaChkZXN0KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRGaWxlU3RhdHMocGF0aDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGZzLnN0YXQocGF0aCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpemU6IHN0YXRzLnNpemUsXG4gICAgICBtdGltZTogc3RhdHMubXRpbWUsXG4gICAgICBjdGltZTogc3RhdHMuY3RpbWUsXG4gICAgICBpc0ZpbGU6IHN0YXRzLmlzRmlsZSgpLFxuICAgICAgaXNEaXJlY3Rvcnk6IHN0YXRzLmlzRGlyZWN0b3J5KCksXG4gICAgICBtb2RlOiBzdGF0cy5tb2RlXG4gICAgfTtcbiAgfVxuXG4gIHdhdGNoRmlsZShwYXRoOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXZlbnQ6IHN0cmluZykgPT4gdm9pZCk6ICgpID0+IHZvaWQge1xuICAgIGxldCB3YXRjaGVyOiBhbnkgPSBudWxsO1xuICAgIFxuICAgIGNvbnN0IHN0YXJ0V2F0Y2hpbmcgPSBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHdhdGNoIH0gPSBhd2FpdCBpbXBvcnQoJ2Nob2tpZGFyJyk7XG4gICAgICAgIHdhdGNoZXIgPSB3YXRjaChwYXRoKTtcbiAgICAgICAgd2F0Y2hlci5vbignYWxsJywgKGV2ZW50OiBzdHJpbmcpID0+IGNhbGxiYWNrKGV2ZW50KSk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gRmFsbGJhY2sgdG8gYmFzaWMgZnMud2F0Y2ggaWYgY2hva2lkYXIgbm90IGF2YWlsYWJsZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIHdhdGNoZXIgPSBmcy53YXRjaChwYXRoLCAoZXZlbnQpID0+IGNhbGxiYWNrKGV2ZW50KSk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIC8vIEZpbGUgd2F0Y2hpbmcgbm90IGF2YWlsYWJsZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIHN0YXJ0V2F0Y2hpbmcoKTtcblxuICAgIGNvbnN0IHN0b3BXYXRjaGluZyA9ICgpID0+IHtcbiAgICAgIGlmICh3YXRjaGVyKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygd2F0Y2hlci5jbG9zZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHdhdGNoZXIuY2xvc2UoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygd2F0Y2hlci51bndhdGNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgd2F0Y2hlci51bndhdGNoKHBhdGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMud2F0Y2hlcnMucHVzaChzdG9wV2F0Y2hpbmcpO1xuICAgIHJldHVybiBzdG9wV2F0Y2hpbmc7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTeW1saW5rKHRhcmdldDogc3RyaW5nLCBsaW5rOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBsaW5rRGlyID0gZGlybmFtZShsaW5rKTtcbiAgICBhd2FpdCBmcy5ta2RpcihsaW5rRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICBhd2FpdCBmcy5zeW1saW5rKHRhcmdldCwgbGluayk7XG4gICAgdGhpcy5jcmVhdGVkRmlsZXMucHVzaChsaW5rKTtcbiAgfVxuXG4gIGFzeW5jIGNsZWFudXAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gU3RvcCBhbGwgd2F0Y2hlcnNcbiAgICB0aGlzLndhdGNoZXJzLmZvckVhY2goc3RvcCA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBzdG9wKCk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gSWdub3JlIGVycm9ycyB3aGVuIHN0b3BwaW5nIHdhdGNoZXJzXG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy53YXRjaGVycyA9IFtdO1xuXG4gICAgLy8gQ2xlYW4gdXAgY3JlYXRlZCBmaWxlc1xuICAgIGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChcbiAgICAgIHRoaXMuY3JlYXRlZEZpbGVzLm1hcChmaWxlID0+IHRoaXMuZGVsZXRlRmlsZShmaWxlKSlcbiAgICApO1xuICAgIHRoaXMuY3JlYXRlZEZpbGVzID0gW107XG5cbiAgICAvLyBDbGVhbiB1cCB0ZW1wIGRpcmVjdG9yaWVzXG4gICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFxuICAgICAgdGhpcy50ZW1wRGlycy5tYXAoZGlyID0+IHRoaXMuZGVsZXRlRGlyZWN0b3J5KGRpcikpXG4gICAgKTtcbiAgICB0aGlzLnRlbXBEaXJzID0gW107XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE1vY2tGaWxlU3lzdGVtVGVzdEhlbHBlciBpbXBsZW1lbnRzIEZpbGVTeXN0ZW1UZXN0SGVscGVyIHtcbiAgcHJpdmF0ZSBmaWxlcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4gIHByaXZhdGUgZGlyZWN0b3JpZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgcHJpdmF0ZSB3YXRjaGVycyA9IG5ldyBNYXA8c3RyaW5nLCBBcnJheTwoZXZlbnQ6IHN0cmluZykgPT4gdm9pZD4+KCk7XG5cbiAgYXN5bmMgY3JlYXRlVGVtcERpcihwcmVmaXg6IHN0cmluZyA9ICd0ZXN0Jyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgdGVtcFBhdGggPSBgL21vY2svdGVtcC8ke3ByZWZpeH0tJHtEYXRlLm5vdygpfWA7XG4gICAgdGhpcy5kaXJlY3Rvcmllcy5hZGQodGVtcFBhdGgpO1xuICAgIHJldHVybiB0ZW1wUGF0aDtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUZpbGUocGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICB0aGlzLmZpbGVzLnNldChub3JtYWxpemVkUGF0aCwgY29udGVudCk7XG4gICAgXG4gICAgLy8gRW5zdXJlIHBhcmVudCBkaXJlY3RvcmllcyBleGlzdFxuICAgIGNvbnN0IGRpciA9IGRpcm5hbWUobm9ybWFsaXplZFBhdGgpO1xuICAgIGlmIChkaXIgIT09IG5vcm1hbGl6ZWRQYXRoKSB7XG4gICAgICB0aGlzLmRpcmVjdG9yaWVzLmFkZChkaXIpO1xuICAgIH1cblxuICAgIHRoaXMudHJpZ2dlcldhdGNoZXJzKG5vcm1hbGl6ZWRQYXRoLCAnYWRkJyk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVEaXJlY3RvcnkocGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSB0aGlzLm5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgdGhpcy5kaXJlY3Rvcmllcy5hZGQobm9ybWFsaXplZFBhdGgpO1xuICB9XG5cbiAgYXN5bmMgcmVhZEZpbGUocGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICBjb25zdCBjb250ZW50ID0gdGhpcy5maWxlcy5nZXQobm9ybWFsaXplZFBhdGgpO1xuICAgIFxuICAgIGlmIChjb250ZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRU5PRU5UOiBubyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5LCBvcGVuICcke3BhdGh9J2ApO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gY29udGVudDtcbiAgfVxuXG4gIGFzeW5jIGZpbGVFeGlzdHMocGF0aDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSB0aGlzLm5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgcmV0dXJuIHRoaXMuZmlsZXMuaGFzKG5vcm1hbGl6ZWRQYXRoKSB8fCB0aGlzLmRpcmVjdG9yaWVzLmhhcyhub3JtYWxpemVkUGF0aCk7XG4gIH1cblxuICBhc3luYyBkZWxldGVGaWxlKHBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKHBhdGgpO1xuICAgIGlmICh0aGlzLmZpbGVzLmRlbGV0ZShub3JtYWxpemVkUGF0aCkpIHtcbiAgICAgIHRoaXMudHJpZ2dlcldhdGNoZXJzKG5vcm1hbGl6ZWRQYXRoLCAndW5saW5rJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGVsZXRlRGlyZWN0b3J5KHBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKHBhdGgpO1xuICAgIFxuICAgIC8vIFJlbW92ZSB0aGUgZGlyZWN0b3J5XG4gICAgdGhpcy5kaXJlY3Rvcmllcy5kZWxldGUobm9ybWFsaXplZFBhdGgpO1xuICAgIFxuICAgIC8vIFJlbW92ZSBhbGwgZmlsZXMgYW5kIHN1YmRpcmVjdG9yaWVzIHVuZGVyIHRoaXMgcGF0aFxuICAgIGNvbnN0IHBhdGhQcmVmaXggPSBub3JtYWxpemVkUGF0aCArICcvJztcbiAgICBcbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIHRoaXMuZmlsZXMua2V5cygpKSB7XG4gICAgICBpZiAoZmlsZVBhdGguc3RhcnRzV2l0aChwYXRoUHJlZml4KSkge1xuICAgICAgICB0aGlzLmZpbGVzLmRlbGV0ZShmaWxlUGF0aCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGZvciAoY29uc3QgZGlyUGF0aCBvZiB0aGlzLmRpcmVjdG9yaWVzKSB7XG4gICAgICBpZiAoZGlyUGF0aC5zdGFydHNXaXRoKHBhdGhQcmVmaXgpKSB7XG4gICAgICAgIHRoaXMuZGlyZWN0b3JpZXMuZGVsZXRlKGRpclBhdGgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxpc3RGaWxlcyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSB0aGlzLm5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgY29uc3QgcGF0aFByZWZpeCA9IG5vcm1hbGl6ZWRQYXRoID09PSAnLycgPyAnJyA6IG5vcm1hbGl6ZWRQYXRoICsgJy8nO1xuICAgIGNvbnN0IGZpbGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgdGhpcy5maWxlcy5rZXlzKCkpIHtcbiAgICAgIGlmIChmaWxlUGF0aC5zdGFydHNXaXRoKHBhdGhQcmVmaXgpKSB7XG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IGZpbGVQYXRoLnN1YnN0cmluZyhwYXRoUHJlZml4Lmxlbmd0aCk7XG4gICAgICAgIGlmIChyZWxhdGl2ZVBhdGggJiYgIXJlbGF0aXZlUGF0aC5pbmNsdWRlcygnLycpKSB7XG4gICAgICAgICAgZmlsZXMucHVzaChmaWxlUGF0aCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZpbGVzLnNvcnQoKTtcbiAgfVxuXG4gIGFzeW5jIGNvcHlGaWxlKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5yZWFkRmlsZShzcmMpO1xuICAgIGF3YWl0IHRoaXMuY3JlYXRlRmlsZShkZXN0LCBjb250ZW50KTtcbiAgfVxuXG4gIGFzeW5jIG1vdmVGaWxlKHNyYzogc3RyaW5nLCBkZXN0OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5yZWFkRmlsZShzcmMpO1xuICAgIGF3YWl0IHRoaXMuY3JlYXRlRmlsZShkZXN0LCBjb250ZW50KTtcbiAgICBhd2FpdCB0aGlzLmRlbGV0ZUZpbGUoc3JjKTtcbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVTdGF0cyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoID0gdGhpcy5ub3JtYWxpemVQYXRoKHBhdGgpO1xuICAgIFxuICAgIGlmICghdGhpcy5maWxlRXhpc3RzKG5vcm1hbGl6ZWRQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFTk9FTlQ6IG5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnksIHN0YXQgJyR7cGF0aH0nYCk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGlzRmlsZSA9IHRoaXMuZmlsZXMuaGFzKG5vcm1hbGl6ZWRQYXRoKTtcbiAgICBjb25zdCBpc0RpcmVjdG9yeSA9IHRoaXMuZGlyZWN0b3JpZXMuaGFzKG5vcm1hbGl6ZWRQYXRoKTtcbiAgICBjb25zdCBjb250ZW50ID0gdGhpcy5maWxlcy5nZXQobm9ybWFsaXplZFBhdGgpIHx8ICcnO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBzaXplOiBjb250ZW50Lmxlbmd0aCxcbiAgICAgIG10aW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgY3RpbWU6IG5ldyBEYXRlKCksXG4gICAgICBpc0ZpbGUsXG4gICAgICBpc0RpcmVjdG9yeSxcbiAgICAgIG1vZGU6IGlzRmlsZSA/IDBvNjQ0IDogMG83NTVcbiAgICB9O1xuICB9XG5cbiAgd2F0Y2hGaWxlKHBhdGg6IHN0cmluZywgY2FsbGJhY2s6IChldmVudDogc3RyaW5nKSA9PiB2b2lkKTogKCkgPT4gdm9pZCB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSB0aGlzLm5vcm1hbGl6ZVBhdGgocGF0aCk7XG4gICAgXG4gICAgaWYgKCF0aGlzLndhdGNoZXJzLmhhcyhub3JtYWxpemVkUGF0aCkpIHtcbiAgICAgIHRoaXMud2F0Y2hlcnMuc2V0KG5vcm1hbGl6ZWRQYXRoLCBbXSk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMud2F0Y2hlcnMuZ2V0KG5vcm1hbGl6ZWRQYXRoKSEucHVzaChjYWxsYmFjayk7XG4gICAgXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMud2F0Y2hlcnMuZ2V0KG5vcm1hbGl6ZWRQYXRoKTtcbiAgICAgIGlmIChjYWxsYmFja3MpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayk7XG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICAgICAgY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChjYWxsYmFja3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy53YXRjaGVycy5kZWxldGUobm9ybWFsaXplZFBhdGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVN5bWxpbmsodGFyZ2V0OiBzdHJpbmcsIGxpbms6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIEZvciBtb2NrIGZpbGVzeXN0ZW0sIGp1c3QgY3JlYXRlIGEgZmlsZSB3aXRoIHNwZWNpYWwgY29udGVudFxuICAgIGF3YWl0IHRoaXMuY3JlYXRlRmlsZShsaW5rLCBgX19TWU1MSU5LX186JHt0YXJnZXR9YCk7XG4gIH1cblxuICBhc3luYyBjbGVhbnVwKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuZmlsZXMuY2xlYXIoKTtcbiAgICB0aGlzLmRpcmVjdG9yaWVzLmNsZWFyKCk7XG4gICAgdGhpcy53YXRjaGVycy5jbGVhcigpO1xuICB9XG5cbiAgLy8gTW9jay1zcGVjaWZpYyBtZXRob2RzXG4gIFxuICAvKipcbiAgICogR2V0IGFsbCBmaWxlcyBpbiB0aGUgbW9jayBmaWxlc3lzdGVtXG4gICAqL1xuICBnZXRBbGxGaWxlcygpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICBjb25zdCByZXN1bHQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtwYXRoLCBjb250ZW50XSBvZiB0aGlzLmZpbGVzLmVudHJpZXMoKSkge1xuICAgICAgcmVzdWx0W3BhdGhdID0gY29udGVudDtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGRpcmVjdG9yaWVzIGluIHRoZSBtb2NrIGZpbGVzeXN0ZW1cbiAgICovXG4gIGdldEFsbERpcmVjdG9yaWVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmRpcmVjdG9yaWVzKS5zb3J0KCk7XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGUgZmlsZSBzeXN0ZW0gZXZlbnRzXG4gICAqL1xuICBzaW11bGF0ZUZpbGVFdmVudChwYXRoOiBzdHJpbmcsIGV2ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLnRyaWdnZXJXYXRjaGVycyhwYXRoLCBldmVudCk7XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZVBhdGgocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gcmVzb2x2ZShwYXRoKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XG4gIH1cblxuICBwcml2YXRlIHRyaWdnZXJXYXRjaGVycyhwYXRoOiBzdHJpbmcsIGV2ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBjYWxsYmFja3MgPSB0aGlzLndhdGNoZXJzLmdldChwYXRoKTtcbiAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICBjYWxsYmFja3MuZm9yRWFjaChjYWxsYmFjayA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY2FsbGJhY2soZXZlbnQpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIC8vIElnbm9yZSBjYWxsYmFjayBlcnJvcnNcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbi8vIEZhY3RvcnkgZnVuY3Rpb25zXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVhbEZpbGVTeXN0ZW1IZWxwZXIoKTogRmlsZVN5c3RlbVRlc3RIZWxwZXIge1xuICByZXR1cm4gbmV3IFJlYWxGaWxlU3lzdGVtVGVzdEhlbHBlcigpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja0ZpbGVTeXN0ZW1IZWxwZXIoKTogRmlsZVN5c3RlbVRlc3RIZWxwZXIge1xuICByZXR1cm4gbmV3IE1vY2tGaWxlU3lzdGVtVGVzdEhlbHBlcigpO1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zIGZvciBjb21tb24gcGF0dGVybnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVUZXN0UHJvamVjdChcbiAgaGVscGVyOiBGaWxlU3lzdGVtVGVzdEhlbHBlcixcbiAgcHJvamVjdE5hbWU6IHN0cmluZyxcbiAgZmlsZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHByb2plY3REaXIgPSBhd2FpdCBoZWxwZXIuY3JlYXRlVGVtcERpcihwcm9qZWN0TmFtZSk7XG4gIFxuICBmb3IgKGNvbnN0IFtmaWxlUGF0aCwgY29udGVudF0gb2YgT2JqZWN0LmVudHJpZXMoZmlsZXMpKSB7XG4gICAgY29uc3QgZnVsbFBhdGggPSBqb2luKHByb2plY3REaXIsIGZpbGVQYXRoKTtcbiAgICBhd2FpdCBoZWxwZXIuY3JlYXRlRmlsZShmdWxsUGF0aCwgY29udGVudCk7XG4gIH1cbiAgXG4gIHJldHVybiBwcm9qZWN0RGlyO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGVzdFdvcmtzcGFjZShcbiAgaGVscGVyOiBGaWxlU3lzdGVtVGVzdEhlbHBlcixcbiAgd29ya3NwYWNlTmFtZTogc3RyaW5nXG4pOiBQcm9taXNlPHtcbiAgd29ya3NwYWNlRGlyOiBzdHJpbmc7XG4gIHNyY0Rpcjogc3RyaW5nO1xuICB0ZXN0RGlyOiBzdHJpbmc7XG4gIGNvbmZpZ0Rpcjogc3RyaW5nO1xufT4ge1xuICBjb25zdCB3b3Jrc3BhY2VEaXIgPSBhd2FpdCBoZWxwZXIuY3JlYXRlVGVtcERpcih3b3Jrc3BhY2VOYW1lKTtcbiAgY29uc3Qgc3JjRGlyID0gam9pbih3b3Jrc3BhY2VEaXIsICdzcmMnKTtcbiAgY29uc3QgdGVzdERpciA9IGpvaW4od29ya3NwYWNlRGlyLCAndGVzdHMnKTtcbiAgY29uc3QgY29uZmlnRGlyID0gam9pbih3b3Jrc3BhY2VEaXIsICdjb25maWcnKTtcbiAgXG4gIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBoZWxwZXIuY3JlYXRlRGlyZWN0b3J5KHNyY0RpciksXG4gICAgaGVscGVyLmNyZWF0ZURpcmVjdG9yeSh0ZXN0RGlyKSxcbiAgICBoZWxwZXIuY3JlYXRlRGlyZWN0b3J5KGNvbmZpZ0RpcilcbiAgXSk7XG4gIFxuICByZXR1cm4geyB3b3Jrc3BhY2VEaXIsIHNyY0RpciwgdGVzdERpciwgY29uZmlnRGlyIH07XG59Il0sInZlcnNpb24iOjN9