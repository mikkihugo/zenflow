300189a86fd189e19d186366e284b34f
/**
 * Claude-Zen TDD London School Architecture Tests
 *
 * System Identity: Claude-Zen v2.0.0-alpha.73
 * Neural Framework: ruv-FANN (should be renamed to ruv-FANN-zen)
 * Architecture: Enhanced multi-Queen AI platform with Hive Mind
 *
 * TDD London School Approach:
 * 1. Outside-in development from user stories
 * 2. Mock-driven contracts for Queen coordination
 * 3. Behavior verification for Hive Mind interactions
 * 4. Neural integration testing with ruv-FANN-zen
 */
import { jest, describe, it, expect, beforeEach, afterEach } from '@jest/globals';
// === CLAUDE-ZEN ARCHITECTURE MOCKS ===
// Mock Claude-Zen Hive Mind - The central coordination system
const mockHiveMind = {
    initialize: jest.fn(),
    spawnQueen: jest.fn(),
    coordinateQueens: jest.fn(),
    processTask: jest.fn(),
    getQueenStatus: jest.fn(),
};
// Mock Queen Agents - Specialized AI agents
const mockQueens = {
    architectQueen: {
        analyze: jest.fn(),
        design: jest.fn(),
        coordinate: jest.fn(),
    },
    codeQueen: {
        generate: jest.fn(),
        refactor: jest.fn(),
        optimize: jest.fn(),
    },
    debugQueen: {
        diagnose: jest.fn(),
        fix: jest.fn(),
        validate: jest.fn(),
    },
};
// Mock ruv-FANN Neural Integration (should be ruv-FANN-zen)
const mockNeuralFramework = {
    initializeNetwork: jest.fn(),
    trainModel: jest.fn(),
    predict: jest.fn(),
    optimizeWeights: jest.fn(),
};
// Mock Web API Layer - REST endpoints for Claude-Zen
const mockClaudeZenApi = {
    startServer: jest.fn(),
    registerQueenEndpoints: jest.fn(),
    handleTaskRequest: jest.fn(),
    streamResults: jest.fn(),
};
// Mock MCP Server - Model Context Protocol integration
const mockMcpServer = {
    initialize: jest.fn(),
    registerTools: jest.fn(),
    handleToolCall: jest.fn(),
    bridgeToQueens: jest.fn(),
};
// Mock WebSocket Manager - Real-time Queen coordination
const mockWebSocketManager = {
    createQueenChannels: jest.fn(),
    broadcastQueenStatus: jest.fn(),
    handleQueenCommunication: jest.fn(),
    streamTaskProgress: jest.fn(),
};
describe('Claude-Zen TDD London School Architecture', () => {
    describe('ðŸ§  Acceptance Tests - Claude-Zen User Stories', () => {
        describe('User Story: Multi-Queen Task Processing', () => {
            it('should coordinate multiple Queens to solve complex development tasks', async () => {
                // Arrange - Mock the entire Queen coordination workflow
                mockHiveMind.initialize.mockResolvedValue(undefined);
                mockHiveMind.spawnQueen.mockResolvedValue('queen-1');
                mockHiveMind.coordinateQueens.mockResolvedValue({ success: true });
                const complexTask = {
                    type: 'full-stack-development',
                    requirements: ['architecture', 'implementation', 'testing'],
                    priority: 'high'
                };
                // Act - Simulate Claude-Zen processing a complex task
                await mockHiveMind.initialize({
                    queens: ['architect', 'code', 'debug'],
                    neuralFramework: true
                });
                const architectQueenId = await mockHiveMind.spawnQueen('architect', {});
                const codeQueenId = await mockHiveMind.spawnQueen('code', {});
                const debugQueenId = await mockHiveMind.spawnQueen('debug', {});
                const result = await mockHiveMind.coordinateQueens(complexTask);
                // Assert - Verify Claude-Zen orchestration contracts
                expect(mockHiveMind.initialize).toHaveBeenCalledWith({
                    queens: ['architect', 'code', 'debug'],
                    neuralFramework: true
                });
                expect(mockHiveMind.spawnQueen).toHaveBeenCalledTimes(3);
                expect(mockHiveMind.coordinateQueens).toHaveBeenCalledWith(complexTask);
                expect(result.success).toBe(true);
            });
        });
        describe('User Story: Neural-Enhanced Decision Making', () => {
            it('should integrate ruv-FANN-zen for intelligent Queen decisions', async () => {
                // Arrange - Mock neural framework integration
                mockNeuralFramework.initializeNetwork.mockResolvedValue(undefined);
                mockNeuralFramework.predict.mockResolvedValue({
                    recommendation: 'use-pattern-X',
                    confidence: 0.92
                });
                const decisionContext = {
                    codebase: 'typescript-monorepo',
                    pattern: 'dependency-injection',
                    complexity: 'high'
                };
                // Act - Simulate neural-enhanced Queen decision
                await mockNeuralFramework.initializeNetwork('decision-transformer');
                const prediction = await mockNeuralFramework.predict(decisionContext);
                // Use prediction in Queen coordination
                mockQueens.architectQueen.design.mockResolvedValue({
                    pattern: prediction.recommendation,
                    confidence: prediction.confidence
                });
                const designResult = await mockQueens.architectQueen.design(decisionContext);
                // Assert - Verify neural integration contract
                expect(mockNeuralFramework.initializeNetwork).toHaveBeenCalledWith('decision-transformer');
                expect(mockNeuralFramework.predict).toHaveBeenCalledWith(decisionContext);
                expect(designResult.pattern).toBe('use-pattern-X');
                expect(designResult.confidence).toBe(0.92);
            });
        });
        describe('User Story: Real-time Development Workflow', () => {
            it('should provide real-time updates through WebSocket integration', async () => {
                // Arrange - Mock real-time coordination
                mockWebSocketManager.createQueenChannels.mockResolvedValue(undefined);
                mockWebSocketManager.broadcastQueenStatus.mockImplementation(() => { });
                mockWebSocketManager.streamTaskProgress.mockImplementation(() => { });
                const taskProgress = {
                    taskId: 'task-123',
                    queens: ['architect', 'code'],
                    progress: {
                        architect: { stage: 'design', completion: 0.8 },
                        code: { stage: 'implementation', completion: 0.4 }
                    }
                };
                // Act - Simulate real-time workflow
                await mockWebSocketManager.createQueenChannels(['architect', 'code']);
                mockWebSocketManager.broadcastQueenStatus(taskProgress.progress);
                mockWebSocketManager.streamTaskProgress(taskProgress);
                // Assert - Verify real-time communication contracts
                expect(mockWebSocketManager.createQueenChannels).toHaveBeenCalledWith(['architect', 'code']);
                expect(mockWebSocketManager.broadcastQueenStatus).toHaveBeenCalledWith(taskProgress.progress);
                expect(mockWebSocketManager.streamTaskProgress).toHaveBeenCalledWith(taskProgress);
            });
        });
    });
    describe('ðŸ”— Contract Verification - Claude-Zen Component Integration', () => {
        describe('Hive Mind â†” Queen Coordination', () => {
            it('should verify proper Queen lifecycle management', async () => {
                // Arrange - Mock Queen lifecycle
                mockHiveMind.spawnQueen.mockResolvedValue('queen-arch-001');
                mockQueens.architectQueen.coordinate.mockResolvedValue(undefined);
                mockHiveMind.getQueenStatus.mockResolvedValue([
                    { id: 'queen-arch-001', type: 'architect', status: 'active' }
                ]);
                // Act - Test Queen lifecycle
                const queenId = await mockHiveMind.spawnQueen('architect', {
                    specialization: 'microservices',
                    experience: 'senior'
                });
                await mockQueens.architectQueen.coordinate(['queen-code-001']);
                const status = await mockHiveMind.getQueenStatus();
                // Assert - Verify lifecycle contracts
                expect(mockHiveMind.spawnQueen).toHaveBeenCalledWith('architect', {
                    specialization: 'microservices',
                    experience: 'senior'
                });
                expect(mockQueens.architectQueen.coordinate).toHaveBeenCalledWith(['queen-code-001']);
                expect(status).toContainEqual({
                    id: 'queen-arch-001',
                    type: 'architect',
                    status: 'active'
                });
            });
        });
        describe('Web API â†” MCP Server Bridge', () => {
            it('should bridge REST API requests to MCP tool calls', async () => {
                // Arrange - Mock API to MCP bridge
                const apiRequest = {
                    endpoint: '/api/queens/architect/analyze',
                    payload: { codebase: 'react-app', task: 'refactor' }
                };
                const mcpToolCall = {
                    method: 'tools/call',
                    params: {
                        name: 'architect-analyze',
                        arguments: apiRequest.payload
                    }
                };
                mockClaudeZenApi.handleTaskRequest.mockResolvedValue({
                    status: 'processing',
                    queenId: 'arch-001'
                });
                mockMcpServer.handleToolCall.mockResolvedValue({
                    result: { analysis: 'component-extraction-recommended' }
                });
                // Act - Test API to MCP bridge
                const apiResponse = await mockClaudeZenApi.handleTaskRequest(apiRequest);
                const mcpResponse = await mockMcpServer.handleToolCall(mcpToolCall);
                // Assert - Verify bridging contract
                expect(mockClaudeZenApi.handleTaskRequest).toHaveBeenCalledWith(apiRequest);
                expect(mockMcpServer.handleToolCall).toHaveBeenCalledWith(mcpToolCall);
                expect(apiResponse.status).toBe('processing');
                expect(mcpResponse.result.analysis).toBe('component-extraction-recommended');
            });
        });
    });
    describe('ðŸ—ï¸ London School Patterns - Claude-Zen Style', () => {
        it('should demonstrate Queen collaboration through interaction testing', () => {
            // London School: Test HOW Queens collaborate, not WHAT they contain
            const mockTaskCoordinator = {
                assignTask: jest.fn(),
                trackProgress: jest.fn(),
                synthesizeResults: jest.fn()
            };
            const claudeZenOrchestrator = {
                processComplexTask: async (task) => {
                    mockTaskCoordinator.assignTask('architect', task.designPhase);
                    mockTaskCoordinator.assignTask('code', task.implementationPhase);
                    mockTaskCoordinator.trackProgress('all');
                    return mockTaskCoordinator.synthesizeResults();
                }
            };
            // Act - Test the orchestration conversation
            const complexTask = {
                designPhase: { type: 'architecture', scope: 'full-system' },
                implementationPhase: { type: 'coding', language: 'typescript' }
            };
            mockTaskCoordinator.synthesizeResults.mockReturnValue({ success: true });
            // Execute the orchestration
            claudeZenOrchestrator.processComplexTask(complexTask);
            // Assert - Verify the orchestration conversation
            expect(mockTaskCoordinator.assignTask).toHaveBeenCalledWith('architect', complexTask.designPhase);
            expect(mockTaskCoordinator.assignTask).toHaveBeenCalledWith('code', complexTask.implementationPhase);
            expect(mockTaskCoordinator.trackProgress).toHaveBeenCalledWith('all');
            expect(mockTaskCoordinator.synthesizeResults).toHaveBeenCalled();
        });
        it('should use mocks to drive Claude-Zen interface discovery', () => {
            // London School: Mocks help discover optimal Queen interfaces
            const mockQueenRegistry = {
                register: jest.fn(),
                lookup: jest.fn(),
                invoke: jest.fn()
            };
            const mockCapabilityMatcher = {
                findBestQueen: jest.fn(),
                assessCompatibility: jest.fn()
            };
            // This test drives the design of dynamic Queen discovery
            const dynamicQueenSystem = {
                handleUnknownTask: async (task) => {
                    const bestQueen = mockCapabilityMatcher.findBestQueen(task);
                    const compatibility = mockCapabilityMatcher.assessCompatibility(bestQueen, task);
                    if (compatibility > 0.8) {
                        return mockQueenRegistry.invoke(bestQueen, task);
                    }
                    throw new Error('No suitable Queen found');
                }
            };
            // The test defines the contract through mock expectations
            mockCapabilityMatcher.findBestQueen.mockReturnValue('specialized-queen-v2');
            mockCapabilityMatcher.assessCompatibility.mockReturnValue(0.95);
            mockQueenRegistry.invoke.mockResolvedValue({ result: 'task-completed' });
            // Verify the interface exists and behaves correctly
            expect(typeof dynamicQueenSystem.handleUnknownTask).toBe('function');
            expect(mockCapabilityMatcher.findBestQueen).toBeDefined();
            expect(mockQueenRegistry.invoke).toBeDefined();
        });
    });
    // Clean test isolation - London School principle
    beforeEach(() => {
        jest.clearAllMocks();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
});
// === RECOMMENDATIONS ===
/*
1. RENAME: ruv-FANN â†’ ruv-FANN-zen (reflects extensive Claude-Zen modifications)
2. ARCHITECTURE: Claude-Zen v2.0.0-alpha.73 with enhanced Hive Mind
3. NEURAL INTEGRATION: ruv-FANN-zen provides the neural intelligence layer
4. QUEEN COORDINATION: Multi-agent system with specialized AI Queens
5. TDD APPROACH: London School mock-driven development for all components
*/ 
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vY2xhdWRlLXplbi10ZGQtYXJjaGl0ZWN0dXJlLnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7OztHQVlHO0FBRUgsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWxGLHdDQUF3QztBQUV4Qyw4REFBOEQ7QUFDOUQsTUFBTSxZQUFZLEdBQUc7SUFDbkIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDckIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDckIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUMzQixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN0QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUMxQixDQUFDO0FBRUYsNENBQTRDO0FBQzVDLE1BQU0sVUFBVSxHQUFHO0lBQ2pCLGNBQWMsRUFBRTtRQUNkLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3RCO0lBQ0QsU0FBUyxFQUFFO1FBQ1QsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbkIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbkIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDcEI7SUFDRCxVQUFVLEVBQUU7UUFDVixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNuQixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3BCO0NBQ0YsQ0FBQztBQUVGLDREQUE0RDtBQUM1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Q0FBQzthQUNGLENBQUM7WUFFRiwwREFBMEQ7WUFDMUQscUJBQXFCLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQzVFLHFCQUFxQixDQUFDLG1CQUFtQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoRSxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsRUFBRSxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1lBRXpFLG9EQUFvRDtZQUNwRCxNQUFNLENBQUMsT0FBTyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNyRSxNQUFNLENBQUMscUJBQXFCLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDMUQsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2pELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxpREFBaUQ7SUFDakQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILDBCQUEwQjtBQUMxQjs7Ozs7O0VBTUUiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vY2xhdWRlLXplbi10ZGQtYXJjaGl0ZWN0dXJlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDbGF1ZGUtWmVuIFRERCBMb25kb24gU2Nob29sIEFyY2hpdGVjdHVyZSBUZXN0c1xuICogXG4gKiBTeXN0ZW0gSWRlbnRpdHk6IENsYXVkZS1aZW4gdjIuMC4wLWFscGhhLjczXG4gKiBOZXVyYWwgRnJhbWV3b3JrOiBydXYtRkFOTiAoc2hvdWxkIGJlIHJlbmFtZWQgdG8gcnV2LUZBTk4temVuKVxuICogQXJjaGl0ZWN0dXJlOiBFbmhhbmNlZCBtdWx0aS1RdWVlbiBBSSBwbGF0Zm9ybSB3aXRoIEhpdmUgTWluZFxuICogXG4gKiBUREQgTG9uZG9uIFNjaG9vbCBBcHByb2FjaDpcbiAqIDEuIE91dHNpZGUtaW4gZGV2ZWxvcG1lbnQgZnJvbSB1c2VyIHN0b3JpZXNcbiAqIDIuIE1vY2stZHJpdmVuIGNvbnRyYWN0cyBmb3IgUXVlZW4gY29vcmRpbmF0aW9uXG4gKiAzLiBCZWhhdmlvciB2ZXJpZmljYXRpb24gZm9yIEhpdmUgTWluZCBpbnRlcmFjdGlvbnNcbiAqIDQuIE5ldXJhbCBpbnRlZ3JhdGlvbiB0ZXN0aW5nIHdpdGggcnV2LUZBTk4temVuXG4gKi9cblxuaW1wb3J0IHsgamVzdCwgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG4vLyA9PT0gQ0xBVURFLVpFTiBBUkNISVRFQ1RVUkUgTU9DS1MgPT09XG5cbi8vIE1vY2sgQ2xhdWRlLVplbiBIaXZlIE1pbmQgLSBUaGUgY2VudHJhbCBjb29yZGluYXRpb24gc3lzdGVtXG5jb25zdCBtb2NrSGl2ZU1pbmQgPSB7XG4gIGluaXRpYWxpemU6IGplc3QuZm4oKSxcbiAgc3Bhd25RdWVlbjogamVzdC5mbigpLFxuICBjb29yZGluYXRlUXVlZW5zOiBqZXN0LmZuKCksXG4gIHByb2Nlc3NUYXNrOiBqZXN0LmZuKCksXG4gIGdldFF1ZWVuU3RhdHVzOiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIFF1ZWVuIEFnZW50cyAtIFNwZWNpYWxpemVkIEFJIGFnZW50c1xuY29uc3QgbW9ja1F1ZWVucyA9IHtcbiAgYXJjaGl0ZWN0UXVlZW46IHtcbiAgICBhbmFseXplOiBqZXN0LmZuKCksXG4gICAgZGVzaWduOiBqZXN0LmZuKCksXG4gICAgY29vcmRpbmF0ZTogamVzdC5mbigpLFxuICB9LFxuICBjb2RlUXVlZW46IHtcbiAgICBnZW5lcmF0ZTogamVzdC5mbigpLFxuICAgIHJlZmFjdG9yOiBqZXN0LmZuKCksXG4gICAgb3B0aW1pemU6IGplc3QuZm4oKSxcbiAgfSxcbiAgZGVidWdRdWVlbjoge1xuICAgIGRpYWdub3NlOiBqZXN0LmZuKCksXG4gICAgZml4OiBqZXN0LmZuKCksXG4gICAgdmFsaWRhdGU6IGplc3QuZm4oKSxcbiAgfSxcbn07XG5cbi8vIE1vY2sgcnV2LUZBTk4gTmV1cmFsIEludGVncmF0aW9uIChzaG91bGQgYmUgcnV2LUZBTk4temVuKVxuY29uc3QgbW9ja05ldXJhbEZyYW1ld29yayA9IHtcbiAgaW5pdGlhbGl6ZU5ldHdvcms6IGplc3QuZm4oKSxcbiAgdHJhaW5Nb2RlbDogamVzdC5mbigpLFxuICBwcmVkaWN0OiBqZXN0LmZuKCksXG4gIG9wdGltaXplV2VpZ2h0czogamVzdC5mbigpLFxufTtcblxuLy8gTW9jayBXZWIgQVBJIExheWVyIC0gUkVTVCBlbmRwb2ludHMgZm9yIENsYXVkZS1aZW5cbmNvbnN0IG1vY2tDbGF1ZGVaZW5BcGkgPSB7XG4gIHN0YXJ0U2VydmVyOiBqZXN0LmZuKCksXG4gIHJlZ2lzdGVyUXVlZW5FbmRwb2ludHM6IGplc3QuZm4oKSxcbiAgaGFuZGxlVGFza1JlcXVlc3Q6IGplc3QuZm4oKSxcbiAgc3RyZWFtUmVzdWx0czogamVzdC5mbigpLFxufTtcblxuLy8gTW9jayBNQ1AgU2VydmVyIC0gTW9kZWwgQ29udGV4dCBQcm90b2NvbCBpbnRlZ3JhdGlvblxuY29uc3QgbW9ja01jcFNlcnZlciA9IHtcbiAgaW5pdGlhbGl6ZTogamVzdC5mbigpLFxuICByZWdpc3RlclRvb2xzOiBqZXN0LmZuKCksXG4gIGhhbmRsZVRvb2xDYWxsOiBqZXN0LmZuKCksXG4gIGJyaWRnZVRvUXVlZW5zOiBqZXN0LmZuKCksXG59O1xuXG4vLyBNb2NrIFdlYlNvY2tldCBNYW5hZ2VyIC0gUmVhbC10aW1lIFF1ZWVuIGNvb3JkaW5hdGlvblxuY29uc3QgbW9ja1dlYlNvY2tldE1hbmFnZXIgPSB7XG4gIGNyZWF0ZVF1ZWVuQ2hhbm5lbHM6IGplc3QuZm4oKSxcbiAgYnJvYWRjYXN0UXVlZW5TdGF0dXM6IGplc3QuZm4oKSxcbiAgaGFuZGxlUXVlZW5Db21tdW5pY2F0aW9uOiBqZXN0LmZuKCksXG4gIHN0cmVhbVRhc2tQcm9ncmVzczogamVzdC5mbigpLFxufTtcblxuLy8gPT09IENPTlRSQUNUIElOVEVSRkFDRVMgPT09XG5cbmludGVyZmFjZSBIaXZlTWluZENvbnRyYWN0IHtcbiAgaW5pdGlhbGl6ZShjb25maWc6IHsgcXVlZW5zOiBzdHJpbmdbXSwgbmV1cmFsRnJhbWV3b3JrOiBib29sZWFuIH0pOiBQcm9taXNlPHZvaWQ+O1xuICBzcGF3blF1ZWVuKHR5cGU6IHN0cmluZywgY29uZmlnOiBhbnkpOiBQcm9taXNlPHN0cmluZz47XG4gIGNvb3JkaW5hdGVRdWVlbnModGFzazogYW55KTogUHJvbWlzZTxhbnk+O1xuICBwcm9jZXNzVGFzayh0YXNrOiBhbnkpOiBQcm9taXNlPGFueT47XG4gIGdldFF1ZWVuU3RhdHVzKCk6IFByb21pc2U8QXJyYXk8eyBpZDogc3RyaW5nOyB0eXBlOiBzdHJpbmc7IHN0YXR1czogc3RyaW5nIH0+Pjtcbn1cblxuaW50ZXJmYWNlIFF1ZWVuQ29udHJhY3Qge1xuICBhbmFseXplKGlucHV0OiBhbnkpOiBQcm9taXNlPGFueT47XG4gIGV4ZWN1dGUodGFzazogYW55KTogUHJvbWlzZTxhbnk+O1xuICBjb29yZGluYXRlKG90aGVyUXVlZW5zOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD47XG4gIHJlcG9ydFN0YXR1cygpOiBQcm9taXNlPHsgc3RhdHVzOiBzdHJpbmc7IHByb2dyZXNzOiBudW1iZXIgfT47XG59XG5cbmludGVyZmFjZSBOZXVyYWxGcmFtZXdvcmtDb250cmFjdCB7XG4gIGluaXRpYWxpemVOZXR3b3JrKGFyY2hpdGVjdHVyZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbiAgdHJhaW5Nb2RlbChkYXRhOiBhbnkpOiBQcm9taXNlPHsgYWNjdXJhY3k6IG51bWJlcjsgbG9zczogbnVtYmVyIH0+O1xuICBwcmVkaWN0KGlucHV0OiBhbnkpOiBQcm9taXNlPGFueT47XG4gIG9wdGltaXplV2VpZ2h0cygpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5kZXNjcmliZSgnQ2xhdWRlLVplbiBUREQgTG9uZG9uIFNjaG9vbCBBcmNoaXRlY3R1cmUnLCAoKSA9PiB7XG4gIFxuICBkZXNjcmliZSgn8J+noCBBY2NlcHRhbmNlIFRlc3RzIC0gQ2xhdWRlLVplbiBVc2VyIFN0b3JpZXMnLCAoKSA9PiB7XG4gICAgXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IE11bHRpLVF1ZWVuIFRhc2sgUHJvY2Vzc2luZycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY29vcmRpbmF0ZSBtdWx0aXBsZSBRdWVlbnMgdG8gc29sdmUgY29tcGxleCBkZXZlbG9wbWVudCB0YXNrcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgdGhlIGVudGlyZSBRdWVlbiBjb29yZGluYXRpb24gd29ya2Zsb3dcbiAgICAgICAgbW9ja0hpdmVNaW5kLmluaXRpYWxpemUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgICAgbW9ja0hpdmVNaW5kLnNwYXduUXVlZW4ubW9ja1Jlc29sdmVkVmFsdWUoJ3F1ZWVuLTEnKTtcbiAgICAgICAgbW9ja0hpdmVNaW5kLmNvb3JkaW5hdGVRdWVlbnMubW9ja1Jlc29sdmVkVmFsdWUoeyBzdWNjZXNzOiB0cnVlIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgY29tcGxleFRhc2sgPSB7XG4gICAgICAgICAgdHlwZTogJ2Z1bGwtc3RhY2stZGV2ZWxvcG1lbnQnLFxuICAgICAgICAgIHJlcXVpcmVtZW50czogWydhcmNoaXRlY3R1cmUnLCAnaW1wbGVtZW50YXRpb24nLCAndGVzdGluZyddLFxuICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFjdCAtIFNpbXVsYXRlIENsYXVkZS1aZW4gcHJvY2Vzc2luZyBhIGNvbXBsZXggdGFza1xuICAgICAgICBhd2FpdCBtb2NrSGl2ZU1pbmQuaW5pdGlhbGl6ZSh7IFxuICAgICAgICAgIHF1ZWVuczogWydhcmNoaXRlY3QnLCAnY29kZScsICdkZWJ1ZyddLCBcbiAgICAgICAgICBuZXVyYWxGcmFtZXdvcms6IHRydWUgXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgYXJjaGl0ZWN0UXVlZW5JZCA9IGF3YWl0IG1vY2tIaXZlTWluZC5zcGF3blF1ZWVuKCdhcmNoaXRlY3QnLCB7fSk7XG4gICAgICAgIGNvbnN0IGNvZGVRdWVlbklkID0gYXdhaXQgbW9ja0hpdmVNaW5kLnNwYXduUXVlZW4oJ2NvZGUnLCB7fSk7XG4gICAgICAgIGNvbnN0IGRlYnVnUXVlZW5JZCA9IGF3YWl0IG1vY2tIaXZlTWluZC5zcGF3blF1ZWVuKCdkZWJ1ZycsIHt9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tIaXZlTWluZC5jb29yZGluYXRlUXVlZW5zKGNvbXBsZXhUYXNrKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSBDbGF1ZGUtWmVuIG9yY2hlc3RyYXRpb24gY29udHJhY3RzXG4gICAgICAgIGV4cGVjdChtb2NrSGl2ZU1pbmQuaW5pdGlhbGl6ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBcbiAgICAgICAgICBxdWVlbnM6IFsnYXJjaGl0ZWN0JywgJ2NvZGUnLCAnZGVidWcnXSwgXG4gICAgICAgICAgbmV1cmFsRnJhbWV3b3JrOiB0cnVlIFxuICAgICAgICB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tIaXZlTWluZC5zcGF3blF1ZWVuKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG4gICAgICAgIGV4cGVjdChtb2NrSGl2ZU1pbmQuY29vcmRpbmF0ZVF1ZWVucykudG9IYXZlQmVlbkNhbGxlZFdpdGgoY29tcGxleFRhc2spO1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdVc2VyIFN0b3J5OiBOZXVyYWwtRW5oYW5jZWQgRGVjaXNpb24gTWFraW5nJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBpbnRlZ3JhdGUgcnV2LUZBTk4temVuIGZvciBpbnRlbGxpZ2VudCBRdWVlbiBkZWNpc2lvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2UgLSBNb2NrIG5ldXJhbCBmcmFtZXdvcmsgaW50ZWdyYXRpb25cbiAgICAgICAgbW9ja05ldXJhbEZyYW1ld29yay5pbml0aWFsaXplTmV0d29yay5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgICBtb2NrTmV1cmFsRnJhbWV3b3JrLnByZWRpY3QubW9ja1Jlc29sdmVkVmFsdWUoeyBcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbjogJ3VzZS1wYXR0ZXJuLVgnLCBcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjkyIFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRlY2lzaW9uQ29udGV4dCA9IHtcbiAgICAgICAgICBjb2RlYmFzZTogJ3R5cGVzY3JpcHQtbW9ub3JlcG8nLFxuICAgICAgICAgIHBhdHRlcm46ICdkZXBlbmRlbmN5LWluamVjdGlvbicsXG4gICAgICAgICAgY29tcGxleGl0eTogJ2hpZ2gnXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBBY3QgLSBTaW11bGF0ZSBuZXVyYWwtZW5oYW5jZWQgUXVlZW4gZGVjaXNpb25cbiAgICAgICAgYXdhaXQgbW9ja05ldXJhbEZyYW1ld29yay5pbml0aWFsaXplTmV0d29yaygnZGVjaXNpb24tdHJhbnNmb3JtZXInKTtcbiAgICAgICAgY29uc3QgcHJlZGljdGlvbiA9IGF3YWl0IG1vY2tOZXVyYWxGcmFtZXdvcmsucHJlZGljdChkZWNpc2lvbkNvbnRleHQpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXNlIHByZWRpY3Rpb24gaW4gUXVlZW4gY29vcmRpbmF0aW9uXG4gICAgICAgIG1vY2tRdWVlbnMuYXJjaGl0ZWN0UXVlZW4uZGVzaWduLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICBwYXR0ZXJuOiBwcmVkaWN0aW9uLnJlY29tbWVuZGF0aW9uLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IHByZWRpY3Rpb24uY29uZmlkZW5jZVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRlc2lnblJlc3VsdCA9IGF3YWl0IG1vY2tRdWVlbnMuYXJjaGl0ZWN0UXVlZW4uZGVzaWduKGRlY2lzaW9uQ29udGV4dCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgbmV1cmFsIGludGVncmF0aW9uIGNvbnRyYWN0XG4gICAgICAgIGV4cGVjdChtb2NrTmV1cmFsRnJhbWV3b3JrLmluaXRpYWxpemVOZXR3b3JrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZGVjaXNpb24tdHJhbnNmb3JtZXInKTtcbiAgICAgICAgZXhwZWN0KG1vY2tOZXVyYWxGcmFtZXdvcmsucHJlZGljdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZGVjaXNpb25Db250ZXh0KTtcbiAgICAgICAgZXhwZWN0KGRlc2lnblJlc3VsdC5wYXR0ZXJuKS50b0JlKCd1c2UtcGF0dGVybi1YJyk7XG4gICAgICAgIGV4cGVjdChkZXNpZ25SZXN1bHQuY29uZmlkZW5jZSkudG9CZSgwLjkyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IFJlYWwtdGltZSBEZXZlbG9wbWVudCBXb3JrZmxvdycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvdmlkZSByZWFsLXRpbWUgdXBkYXRlcyB0aHJvdWdoIFdlYlNvY2tldCBpbnRlZ3JhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgcmVhbC10aW1lIGNvb3JkaW5hdGlvblxuICAgICAgICBtb2NrV2ViU29ja2V0TWFuYWdlci5jcmVhdGVRdWVlbkNoYW5uZWxzLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tXZWJTb2NrZXRNYW5hZ2VyLmJyb2FkY2FzdFF1ZWVuU3RhdHVzLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgICAgIG1vY2tXZWJTb2NrZXRNYW5hZ2VyLnN0cmVhbVRhc2tQcm9ncmVzcy5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdGFza1Byb2dyZXNzID0ge1xuICAgICAgICAgIHRhc2tJZDogJ3Rhc2stMTIzJyxcbiAgICAgICAgICBxdWVlbnM6IFsnYXJjaGl0ZWN0JywgJ2NvZGUnXSxcbiAgICAgICAgICBwcm9ncmVzczoge1xuICAgICAgICAgICAgYXJjaGl0ZWN0OiB7IHN0YWdlOiAnZGVzaWduJywgY29tcGxldGlvbjogMC44IH0sXG4gICAgICAgICAgICBjb2RlOiB7IHN0YWdlOiAnaW1wbGVtZW50YXRpb24nLCBjb21wbGV0aW9uOiAwLjQgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFjdCAtIFNpbXVsYXRlIHJlYWwtdGltZSB3b3JrZmxvd1xuICAgICAgICBhd2FpdCBtb2NrV2ViU29ja2V0TWFuYWdlci5jcmVhdGVRdWVlbkNoYW5uZWxzKFsnYXJjaGl0ZWN0JywgJ2NvZGUnXSk7XG4gICAgICAgIG1vY2tXZWJTb2NrZXRNYW5hZ2VyLmJyb2FkY2FzdFF1ZWVuU3RhdHVzKHRhc2tQcm9ncmVzcy5wcm9ncmVzcyk7XG4gICAgICAgIG1vY2tXZWJTb2NrZXRNYW5hZ2VyLnN0cmVhbVRhc2tQcm9ncmVzcyh0YXNrUHJvZ3Jlc3MpO1xuICAgICAgICBcbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IHJlYWwtdGltZSBjb21tdW5pY2F0aW9uIGNvbnRyYWN0c1xuICAgICAgICBleHBlY3QobW9ja1dlYlNvY2tldE1hbmFnZXIuY3JlYXRlUXVlZW5DaGFubmVscykudG9IYXZlQmVlbkNhbGxlZFdpdGgoWydhcmNoaXRlY3QnLCAnY29kZSddKTtcbiAgICAgICAgZXhwZWN0KG1vY2tXZWJTb2NrZXRNYW5hZ2VyLmJyb2FkY2FzdFF1ZWVuU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0YXNrUHJvZ3Jlc3MucHJvZ3Jlc3MpO1xuICAgICAgICBleHBlY3QobW9ja1dlYlNvY2tldE1hbmFnZXIuc3RyZWFtVGFza1Byb2dyZXNzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0YXNrUHJvZ3Jlc3MpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfwn5SXIENvbnRyYWN0IFZlcmlmaWNhdGlvbiAtIENsYXVkZS1aZW4gQ29tcG9uZW50IEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIFxuICAgIGRlc2NyaWJlKCdIaXZlIE1pbmQg4oaUIFF1ZWVuIENvb3JkaW5hdGlvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgdmVyaWZ5IHByb3BlciBRdWVlbiBsaWZlY3ljbGUgbWFuYWdlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgUXVlZW4gbGlmZWN5Y2xlXG4gICAgICAgIG1vY2tIaXZlTWluZC5zcGF3blF1ZWVuLm1vY2tSZXNvbHZlZFZhbHVlKCdxdWVlbi1hcmNoLTAwMScpO1xuICAgICAgICBtb2NrUXVlZW5zLmFyY2hpdGVjdFF1ZWVuLmNvb3JkaW5hdGUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICAgICAgbW9ja0hpdmVNaW5kLmdldFF1ZWVuU3RhdHVzLm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgICB7IGlkOiAncXVlZW4tYXJjaC0wMDEnLCB0eXBlOiAnYXJjaGl0ZWN0Jywgc3RhdHVzOiAnYWN0aXZlJyB9XG4gICAgICAgIF0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0IC0gVGVzdCBRdWVlbiBsaWZlY3ljbGVcbiAgICAgICAgY29uc3QgcXVlZW5JZCA9IGF3YWl0IG1vY2tIaXZlTWluZC5zcGF3blF1ZWVuKCdhcmNoaXRlY3QnLCB7XG4gICAgICAgICAgc3BlY2lhbGl6YXRpb246ICdtaWNyb3NlcnZpY2VzJyxcbiAgICAgICAgICBleHBlcmllbmNlOiAnc2VuaW9yJ1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IG1vY2tRdWVlbnMuYXJjaGl0ZWN0UXVlZW4uY29vcmRpbmF0ZShbJ3F1ZWVuLWNvZGUtMDAxJ10pO1xuICAgICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCBtb2NrSGl2ZU1pbmQuZ2V0UXVlZW5TdGF0dXMoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSBsaWZlY3ljbGUgY29udHJhY3RzXG4gICAgICAgIGV4cGVjdChtb2NrSGl2ZU1pbmQuc3Bhd25RdWVlbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FyY2hpdGVjdCcsIHtcbiAgICAgICAgICBzcGVjaWFsaXphdGlvbjogJ21pY3Jvc2VydmljZXMnLFxuICAgICAgICAgIGV4cGVyaWVuY2U6ICdzZW5pb3InXG4gICAgICAgIH0pO1xuICAgICAgICBleHBlY3QobW9ja1F1ZWVucy5hcmNoaXRlY3RRdWVlbi5jb29yZGluYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbJ3F1ZWVuLWNvZGUtMDAxJ10pO1xuICAgICAgICBleHBlY3Qoc3RhdHVzKS50b0NvbnRhaW5FcXVhbCh7XG4gICAgICAgICAgaWQ6ICdxdWVlbi1hcmNoLTAwMScsXG4gICAgICAgICAgdHlwZTogJ2FyY2hpdGVjdCcsIFxuICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZSdcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdXZWIgQVBJIOKGlCBNQ1AgU2VydmVyIEJyaWRnZScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYnJpZGdlIFJFU1QgQVBJIHJlcXVlc3RzIHRvIE1DUCB0b29sIGNhbGxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBBUEkgdG8gTUNQIGJyaWRnZVxuICAgICAgICBjb25zdCBhcGlSZXF1ZXN0ID0ge1xuICAgICAgICAgIGVuZHBvaW50OiAnL2FwaS9xdWVlbnMvYXJjaGl0ZWN0L2FuYWx5emUnLFxuICAgICAgICAgIHBheWxvYWQ6IHsgY29kZWJhc2U6ICdyZWFjdC1hcHAnLCB0YXNrOiAncmVmYWN0b3InIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IG1jcFRvb2xDYWxsID0ge1xuICAgICAgICAgIG1ldGhvZDogJ3Rvb2xzL2NhbGwnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgbmFtZTogJ2FyY2hpdGVjdC1hbmFseXplJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czogYXBpUmVxdWVzdC5wYXlsb2FkXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgbW9ja0NsYXVkZVplbkFwaS5oYW5kbGVUYXNrUmVxdWVzdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgc3RhdHVzOiAncHJvY2Vzc2luZycsXG4gICAgICAgICAgcXVlZW5JZDogJ2FyY2gtMDAxJ1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIG1vY2tNY3BTZXJ2ZXIuaGFuZGxlVG9vbENhbGwubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIHJlc3VsdDogeyBhbmFseXNpczogJ2NvbXBvbmVudC1leHRyYWN0aW9uLXJlY29tbWVuZGVkJyB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQWN0IC0gVGVzdCBBUEkgdG8gTUNQIGJyaWRnZVxuICAgICAgICBjb25zdCBhcGlSZXNwb25zZSA9IGF3YWl0IG1vY2tDbGF1ZGVaZW5BcGkuaGFuZGxlVGFza1JlcXVlc3QoYXBpUmVxdWVzdCk7XG4gICAgICAgIGNvbnN0IG1jcFJlc3BvbnNlID0gYXdhaXQgbW9ja01jcFNlcnZlci5oYW5kbGVUb29sQ2FsbChtY3BUb29sQ2FsbCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgYnJpZGdpbmcgY29udHJhY3RcbiAgICAgICAgZXhwZWN0KG1vY2tDbGF1ZGVaZW5BcGkuaGFuZGxlVGFza1JlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGFwaVJlcXVlc3QpO1xuICAgICAgICBleHBlY3QobW9ja01jcFNlcnZlci5oYW5kbGVUb29sQ2FsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgobWNwVG9vbENhbGwpO1xuICAgICAgICBleHBlY3QoYXBpUmVzcG9uc2Uuc3RhdHVzKS50b0JlKCdwcm9jZXNzaW5nJyk7XG4gICAgICAgIGV4cGVjdChtY3BSZXNwb25zZS5yZXN1bHQuYW5hbHlzaXMpLnRvQmUoJ2NvbXBvbmVudC1leHRyYWN0aW9uLXJlY29tbWVuZGVkJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ/Cfj5fvuI8gTG9uZG9uIFNjaG9vbCBQYXR0ZXJucyAtIENsYXVkZS1aZW4gU3R5bGUnLCAoKSA9PiB7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBkZW1vbnN0cmF0ZSBRdWVlbiBjb2xsYWJvcmF0aW9uIHRocm91Z2ggaW50ZXJhY3Rpb24gdGVzdGluZycsICgpID0+IHtcbiAgICAgIC8vIExvbmRvbiBTY2hvb2w6IFRlc3QgSE9XIFF1ZWVucyBjb2xsYWJvcmF0ZSwgbm90IFdIQVQgdGhleSBjb250YWluXG4gICAgICBjb25zdCBtb2NrVGFza0Nvb3JkaW5hdG9yID0ge1xuICAgICAgICBhc3NpZ25UYXNrOiBqZXN0LmZuKCksXG4gICAgICAgIHRyYWNrUHJvZ3Jlc3M6IGplc3QuZm4oKSxcbiAgICAgICAgc3ludGhlc2l6ZVJlc3VsdHM6IGplc3QuZm4oKVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xhdWRlWmVuT3JjaGVzdHJhdG9yID0ge1xuICAgICAgICBwcm9jZXNzQ29tcGxleFRhc2s6IGFzeW5jICh0YXNrOiBhbnkpID0+IHtcbiAgICAgICAgICBtb2NrVGFza0Nvb3JkaW5hdG9yLmFzc2lnblRhc2soJ2FyY2hpdGVjdCcsIHRhc2suZGVzaWduUGhhc2UpO1xuICAgICAgICAgIG1vY2tUYXNrQ29vcmRpbmF0b3IuYXNzaWduVGFzaygnY29kZScsIHRhc2suaW1wbGVtZW50YXRpb25QaGFzZSk7XG4gICAgICAgICAgbW9ja1Rhc2tDb29yZGluYXRvci50cmFja1Byb2dyZXNzKCdhbGwnKTtcbiAgICAgICAgICByZXR1cm4gbW9ja1Rhc2tDb29yZGluYXRvci5zeW50aGVzaXplUmVzdWx0cygpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBBY3QgLSBUZXN0IHRoZSBvcmNoZXN0cmF0aW9uIGNvbnZlcnNhdGlvblxuICAgICAgY29uc3QgY29tcGxleFRhc2sgPSB7XG4gICAgICAgIGRlc2lnblBoYXNlOiB7IHR5cGU6ICdhcmNoaXRlY3R1cmUnLCBzY29wZTogJ2Z1bGwtc3lzdGVtJyB9LFxuICAgICAgICBpbXBsZW1lbnRhdGlvblBoYXNlOiB7IHR5cGU6ICdjb2RpbmcnLCBsYW5ndWFnZTogJ3R5cGVzY3JpcHQnIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tUYXNrQ29vcmRpbmF0b3Iuc3ludGhlc2l6ZVJlc3VsdHMubW9ja1JldHVyblZhbHVlKHsgc3VjY2VzczogdHJ1ZSB9KTtcbiAgICAgIFxuICAgICAgLy8gRXhlY3V0ZSB0aGUgb3JjaGVzdHJhdGlvblxuICAgICAgY2xhdWRlWmVuT3JjaGVzdHJhdG9yLnByb2Nlc3NDb21wbGV4VGFzayhjb21wbGV4VGFzayk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSB0aGUgb3JjaGVzdHJhdGlvbiBjb252ZXJzYXRpb25cbiAgICAgIGV4cGVjdChtb2NrVGFza0Nvb3JkaW5hdG9yLmFzc2lnblRhc2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdhcmNoaXRlY3QnLCBjb21wbGV4VGFzay5kZXNpZ25QaGFzZSk7XG4gICAgICBleHBlY3QobW9ja1Rhc2tDb29yZGluYXRvci5hc3NpZ25UYXNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnY29kZScsIGNvbXBsZXhUYXNrLmltcGxlbWVudGF0aW9uUGhhc2UpO1xuICAgICAgZXhwZWN0KG1vY2tUYXNrQ29vcmRpbmF0b3IudHJhY2tQcm9ncmVzcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2FsbCcpO1xuICAgICAgZXhwZWN0KG1vY2tUYXNrQ29vcmRpbmF0b3Iuc3ludGhlc2l6ZVJlc3VsdHMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIG1vY2tzIHRvIGRyaXZlIENsYXVkZS1aZW4gaW50ZXJmYWNlIGRpc2NvdmVyeScsICgpID0+IHtcbiAgICAgIC8vIExvbmRvbiBTY2hvb2w6IE1vY2tzIGhlbHAgZGlzY292ZXIgb3B0aW1hbCBRdWVlbiBpbnRlcmZhY2VzXG4gICAgICBjb25zdCBtb2NrUXVlZW5SZWdpc3RyeSA9IHtcbiAgICAgICAgcmVnaXN0ZXI6IGplc3QuZm4oKSxcbiAgICAgICAgbG9va3VwOiBqZXN0LmZuKCksXG4gICAgICAgIGludm9rZTogamVzdC5mbigpXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCBtb2NrQ2FwYWJpbGl0eU1hdGNoZXIgPSB7XG4gICAgICAgIGZpbmRCZXN0UXVlZW46IGplc3QuZm4oKSxcbiAgICAgICAgYXNzZXNzQ29tcGF0aWJpbGl0eTogamVzdC5mbigpXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBUaGlzIHRlc3QgZHJpdmVzIHRoZSBkZXNpZ24gb2YgZHluYW1pYyBRdWVlbiBkaXNjb3ZlcnlcbiAgICAgIGNvbnN0IGR5bmFtaWNRdWVlblN5c3RlbSA9IHtcbiAgICAgICAgaGFuZGxlVW5rbm93blRhc2s6IGFzeW5jICh0YXNrOiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zdCBiZXN0UXVlZW4gPSBtb2NrQ2FwYWJpbGl0eU1hdGNoZXIuZmluZEJlc3RRdWVlbih0YXNrKTtcbiAgICAgICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gbW9ja0NhcGFiaWxpdHlNYXRjaGVyLmFzc2Vzc0NvbXBhdGliaWxpdHkoYmVzdFF1ZWVuLCB0YXNrKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoY29tcGF0aWJpbGl0eSA+IDAuOCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vY2tRdWVlblJlZ2lzdHJ5Lmludm9rZShiZXN0UXVlZW4sIHRhc2spO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHN1aXRhYmxlIFF1ZWVuIGZvdW5kJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIC8vIFRoZSB0ZXN0IGRlZmluZXMgdGhlIGNvbnRyYWN0IHRocm91Z2ggbW9jayBleHBlY3RhdGlvbnNcbiAgICAgIG1vY2tDYXBhYmlsaXR5TWF0Y2hlci5maW5kQmVzdFF1ZWVuLm1vY2tSZXR1cm5WYWx1ZSgnc3BlY2lhbGl6ZWQtcXVlZW4tdjInKTtcbiAgICAgIG1vY2tDYXBhYmlsaXR5TWF0Y2hlci5hc3Nlc3NDb21wYXRpYmlsaXR5Lm1vY2tSZXR1cm5WYWx1ZSgwLjk1KTtcbiAgICAgIG1vY2tRdWVlblJlZ2lzdHJ5Lmludm9rZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJlc3VsdDogJ3Rhc2stY29tcGxldGVkJyB9KTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IHRoZSBpbnRlcmZhY2UgZXhpc3RzIGFuZCBiZWhhdmVzIGNvcnJlY3RseVxuICAgICAgZXhwZWN0KHR5cGVvZiBkeW5hbWljUXVlZW5TeXN0ZW0uaGFuZGxlVW5rbm93blRhc2spLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QobW9ja0NhcGFiaWxpdHlNYXRjaGVyLmZpbmRCZXN0UXVlZW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja1F1ZWVuUmVnaXN0cnkuaW52b2tlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBDbGVhbiB0ZXN0IGlzb2xhdGlvbiAtIExvbmRvbiBTY2hvb2wgcHJpbmNpcGxlXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcbiAgXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG59KTtcblxuLy8gPT09IFJFQ09NTUVOREFUSU9OUyA9PT1cbi8qXG4xLiBSRU5BTUU6IHJ1di1GQU5OIOKGkiBydXYtRkFOTi16ZW4gKHJlZmxlY3RzIGV4dGVuc2l2ZSBDbGF1ZGUtWmVuIG1vZGlmaWNhdGlvbnMpXG4yLiBBUkNISVRFQ1RVUkU6IENsYXVkZS1aZW4gdjIuMC4wLWFscGhhLjczIHdpdGggZW5oYW5jZWQgSGl2ZSBNaW5kXG4zLiBORVVSQUwgSU5URUdSQVRJT046IHJ1di1GQU5OLXplbiBwcm92aWRlcyB0aGUgbmV1cmFsIGludGVsbGlnZW5jZSBsYXllclxuNC4gUVVFRU4gQ09PUkRJTkFUSU9OOiBNdWx0aS1hZ2VudCBzeXN0ZW0gd2l0aCBzcGVjaWFsaXplZCBBSSBRdWVlbnNcbjUuIFRERCBBUFBST0FDSDogTG9uZG9uIFNjaG9vbCBtb2NrLWRyaXZlbiBkZXZlbG9wbWVudCBmb3IgYWxsIGNvbXBvbmVudHNcbiovIl0sInZlcnNpb24iOjN9