befe26c9a036d2bca85db4e89157d2f7
/**
 * CLI Commands Integration Tests - TDD London School
 *
 * Tests the integration and interaction between different CLI command
 * components using mocks and focusing on behavior verification rather
 * than implementation details.
 */
import { jest } from '@jest/globals';
import { EventEmitter } from 'events';
// Mock implementation for integration testing
class MockCLICommandSystem extends EventEmitter {
    registry;
    parser;
    formatter;
    errorHandler;
    mockExecute;
    initialized = false;
    constructor(registry, parser, formatter, errorHandler, mockExecute) {
        super();
        this.registry = registry;
        this.parser = parser;
        this.formatter = formatter;
        this.errorHandler = errorHandler;
        this.mockExecute = mockExecute || jest.fn();
    }
    async initialize() {
        if (this.initialized)
            return;
        this.emit('initializing');
        // Initialize all components
        if ('initialize' in this.registry) {
            await this.registry.initialize();
        }
        this.initialized = true;
        this.emit('initialized');
    }
    async execute(input) {
        if (!this.initialized) {
            throw new Error('CLI system not initialized');
        }
        this.emit('execute-start', input);
        try {
            const result = await this.mockExecute(input);
            this.emit('execute-complete', result);
            return result;
        }
        catch (error) {
            this.emit('execute-error', error);
            throw error;
        }
    }
    async dispose() {
        this.emit('disposing');
        if ('dispose' in this.registry) {
            await this.registry.dispose();
        }
        this.removeAllListeners();
        this.initialized = false;
        this.emit('disposed');
    }
    // Test helpers
    isInitialized() {
        return this.initialized;
    }
    setExecuteFunction(fn) {
        this.mockExecute = fn;
    }
}
describe('CLI Commands Integration - TDD London', () => {
    let mockRegistry;
    let mockParser;
    let mockFormatter;
    let mockErrorHandler;
    let cliSystem;
    let mockExecute;
    beforeEach(() => {
        // Create mock components
        mockRegistry = {
            register: jest.fn(),
            unregister: jest.fn(),
            get: jest.fn(),
            has: jest.fn(),
            list: jest.fn(),
            findByCategory: jest.fn(),
            execute: jest.fn(),
            initialize: jest.fn(),
            dispose: jest.fn()
        };
        mockParser = {
            parse: jest.fn()
        };
        mockFormatter = {
            format: jest.fn()
        };
        mockErrorHandler = {
            handle: jest.fn()
        };
        mockExecute = jest.fn();
        // Create integrated system
        cliSystem = new MockCLICommandSystem(mockRegistry, mockParser, mockFormatter, mockErrorHandler, mockExecute);
    });
    afterEach(async () => {
        await cliSystem.dispose();
    });
    describe('system initialization behavior', () => {
        it('should initialize all components in correct order', async () => {
            // Arrange
            const initializeHandler = jest.fn();
            cliSystem.on('initializing', initializeHandler);
            cliSystem.on('initialized', initializeHandler);
            // Act
            await cliSystem.initialize();
            // Assert - verify initialization sequence
            expect(mockRegistry.initialize).toHaveBeenCalled();
            expect(initializeHandler).toHaveBeenCalledTimes(2);
            expect(cliSystem.isInitialized()).toBe(true);
        });
        it('should not reinitialize if already initialized', async () => {
            // Arrange
            await cliSystem.initialize();
            mockRegistry.initialize.mockClear();
            // Act
            await cliSystem.initialize();
            // Assert - verify no double initialization
            expect(mockRegistry.initialize).not.toHaveBeenCalled();
        });
        it('should emit initialization events', async () => {
            // Arrange
            const eventHandler = jest.fn();
            cliSystem.on('initializing', eventHandler);
            cliSystem.on('initialized', eventHandler);
            // Act
            await cliSystem.initialize();
            // Assert - verify event emissions
            expect(eventHandler).toHaveBeenCalledWith();
            expect(eventHandler).toHaveBeenCalledTimes(2);
        });
    });
    describe('command execution flow behavior', () => {
        beforeEach(async () => {
            await cliSystem.initialize();
        });
        it('should execute complete command flow with successful result', async () => {
            // Arrange
            const input = ['status', '--format', 'json'];
            const parseResult = {
                command: 'status',
                args: [],
                flags: { format: 'json' }
            };
            const commandResult = {
                success: true,
                exitCode: 0,
                message: 'Status retrieved',
                data: { active: true }
            };
            const formattedOutput = '{"active": true}';
            mockParser.parse.mockReturnValue(parseResult);
            mockRegistry.execute.mockResolvedValue(commandResult);
            mockFormatter.format.mockReturnValue(formattedOutput);
            const expectedResult = {
                success: true,
                exitCode: 0,
                output: formattedOutput
            };
            mockExecute.mockResolvedValue(expectedResult);
            // Act
            const result = await cliSystem.execute(input);
            // Assert - verify complete execution flow
            expect(mockExecute).toHaveBeenCalledWith(input);
            expect(result).toEqual(expectedResult);
        });
        it('should handle command execution errors through error handler', async () => {
            // Arrange
            const input = ['invalid-command'];
            const error = new Error('Command not found');
            const errorResult = {
                handled: true,
                exitCode: 127,
                message: 'Command not found'
            };
            mockExecute.mockRejectedValue(error);
            mockErrorHandler.handle.mockResolvedValue(errorResult);
            // Act & Assert
            await expect(cliSystem.execute(input)).rejects.toThrow('Command not found');
        });
        it('should emit execution events', async () => {
            // Arrange
            const eventHandler = jest.fn();
            cliSystem.on('execute-start', eventHandler);
            cliSystem.on('execute-complete', eventHandler);
            const input = ['test'];
            const expectedResult = {
                success: true,
                exitCode: 0
            };
            mockExecute.mockResolvedValue(expectedResult);
            // Act
            await cliSystem.execute(input);
            // Assert - verify event emissions
            expect(eventHandler).toHaveBeenCalledWith(input);
            expect(eventHandler).toHaveBeenCalledWith(expectedResult);
        });
        it('should throw error if system not initialized', async () => {
            // Arrange
            const uninitializedSystem = new MockCLICommandSystem(mockRegistry, mockParser, mockFormatter, mockErrorHandler);
            // Act & Assert
            await expect(uninitializedSystem.execute(['test']))
                .rejects.toThrow('CLI system not initialized');
        });
    });
    describe('component interaction behavior', () => {
        beforeEach(async () => {
            await cliSystem.initialize();
        });
        it('should coordinate between parser and registry', async () => {
            // Arrange
            const input = ['deploy', 'app', '--env', 'prod'];
            const parseResult = {
                command: 'deploy',
                args: ['app'],
                flags: { env: 'prod' }
            };
            const context = {
                args: ['app'],
                flags: { env: 'prod' },
                input,
                pkg: { name: 'cli', version: '1.0.0' },
                cwd: '/test',
                env: {},
                debug: false,
                verbose: false
            };
            const commandResult = {
                success: true,
                exitCode: 0,
                message: 'Deployed successfully'
            };
            mockParser.parse.mockReturnValue(parseResult);
            mockRegistry.execute.mockResolvedValue(commandResult);
            const executionResult = {
                success: true,
                exitCode: 0,
                output: 'Deployed successfully'
            };
            mockExecute.mockImplementation(async (inputArgs) => {
                // Simulate the real execution flow
                const parsed = mockParser.parse(inputArgs);
                if (parsed.command) {
                    const result = await mockRegistry.execute(parsed.command, context);
                    return {
                        success: result.success,
                        exitCode: result.exitCode,
                        output: result.message
                    };
                }
                return { success: false, exitCode: 1 };
            });
            // Act
            const result = await cliSystem.execute(input);
            // Assert - verify component coordination
            expect(mockParser.parse).toHaveBeenCalledWith(input);
            expect(mockRegistry.execute).toHaveBeenCalledWith('deploy', context);
            expect(result.success).toBe(true);
        });
        it('should format output using formatter when command succeeds', async () => {
            // Arrange
            const input = ['status'];
            const commandData = { agents: 3, active: true };
            const formattedOutput = 'Agents: 3, Active: true';
            mockExecute.mockImplementation(async () => {
                const formatted = mockFormatter.format(commandData, { format: 'table' });
                return {
                    success: true,
                    exitCode: 0,
                    output: formatted
                };
            });
            mockFormatter.format.mockReturnValue(formattedOutput);
            // Act
            const result = await cliSystem.execute(input);
            // Assert - verify formatter usage
            expect(mockFormatter.format).toHaveBeenCalledWith(commandData, { format: 'table' });
            expect(result.output).toBe(formattedOutput);
        });
        it('should use error handler when command fails', async () => {
            // Arrange
            const input = ['failing-command'];
            const error = new Error('Command execution failed');
            const errorResult = {
                handled: true,
                exitCode: 1,
                message: 'Execution failed gracefully'
            };
            mockExecute.mockImplementation(async () => {
                throw error;
            });
            mockErrorHandler.handle.mockResolvedValue(errorResult);
            // Act
            try {
                await cliSystem.execute(input);
            }
            catch (thrownError) {
                // Expected to throw, but error handler should have been called
            }
            // Assert - verify error handler usage
            // Note: The actual integration would handle the error and not re-throw
            // This test verifies the component interaction pattern
            expect(mockExecute).toHaveBeenCalledWith(input);
        });
    });
    describe('command registration integration behavior', () => {
        it('should register command and make it available for execution', async () => {
            // Arrange
            const commandConfig = {
                name: 'test-command',
                description: 'Test command',
                category: 'core'
            };
            const commandMetadata = {
                config: commandConfig,
                handler: jest.fn().mockResolvedValue({
                    success: true,
                    exitCode: 0,
                    message: 'Test executed'
                }),
                registeredAt: new Date(),
                available: true
            };
            await cliSystem.initialize();
            // Act
            cliSystem.registry.register(commandMetadata);
            // Assert - verify registration
            expect(mockRegistry.register).toHaveBeenCalledWith(commandMetadata);
        });
        it('should find and execute registered commands by category', async () => {
            // Arrange
            const coreCommands = [
                { config: { name: 'status', category: 'core' } },
                { config: { name: 'init', category: 'core' } }
            ];
            mockRegistry.findByCategory.mockReturnValue(coreCommands);
            await cliSystem.initialize();
            // Act
            const commands = cliSystem.registry.findByCategory('core');
            // Assert - verify category-based discovery
            expect(mockRegistry.findByCategory).toHaveBeenCalledWith('core');
            expect(commands).toEqual(coreCommands);
        });
    });
    describe('help and documentation behavior', () => {
        beforeEach(async () => {
            await cliSystem.initialize();
        });
        it('should provide help for registered commands', async () => {
            // Arrange
            const commands = [
                {
                    config: {
                        name: 'status',
                        description: 'Show system status',
                        usage: 'cli status [options]',
                        examples: ['cli status', 'cli status --format json']
                    }
                },
                {
                    config: {
                        name: 'deploy',
                        description: 'Deploy application',
                        usage: 'cli deploy <target>',
                        examples: ['cli deploy app']
                    }
                }
            ];
            mockRegistry.list.mockReturnValue(commands);
            const helpOutput = commands.map(cmd => `${cmd.config.name}: ${cmd.config.description}`).join('\n');
            mockFormatter.format.mockReturnValue(helpOutput);
            // Act
            const result = mockFormatter.format(commands, { format: 'help' });
            // Assert - verify help generation
            expect(result).toContain('status: Show system status');
            expect(result).toContain('deploy: Deploy application');
        });
    });
    describe('lifecycle and cleanup behavior', () => {
        it('should dispose all components in correct order', async () => {
            // Arrange
            const disposeHandler = jest.fn();
            cliSystem.on('disposing', disposeHandler);
            cliSystem.on('disposed', disposeHandler);
            await cliSystem.initialize();
            // Act
            await cliSystem.dispose();
            // Assert - verify disposal sequence
            expect(mockRegistry.dispose).toHaveBeenCalled();
            expect(disposeHandler).toHaveBeenCalledTimes(2);
            expect(cliSystem.isInitialized()).toBe(false);
        });
        it('should remove all event listeners on disposal', async () => {
            // Arrange
            const eventHandler = jest.fn();
            cliSystem.on('test-event', eventHandler);
            await cliSystem.initialize();
            expect(cliSystem.listenerCount('test-event')).toBe(1);
            // Act
            await cliSystem.dispose();
            // Assert - verify cleanup
            expect(cliSystem.listenerCount('test-event')).toBe(0);
        });
    });
    describe('error propagation behavior', () => {
        beforeEach(async () => {
            await cliSystem.initialize();
        });
        it('should emit error events during execution failures', async () => {
            // Arrange
            const errorHandler = jest.fn();
            cliSystem.on('execute-error', errorHandler);
            const input = ['error-command'];
            const error = new Error('Execution error');
            mockExecute.mockRejectedValue(error);
            // Act
            try {
                await cliSystem.execute(input);
            }
            catch (e) {
                // Expected to throw
            }
            // Assert - verify error event emission
            expect(errorHandler).toHaveBeenCalledWith(error);
        });
        it('should handle initialization errors gracefully', async () => {
            // Arrange
            const initError = new Error('Initialization failed');
            mockRegistry.initialize.mockRejectedValue(initError);
            const errorSystem = new MockCLICommandSystem(mockRegistry, mockParser, mockFormatter, mockErrorHandler);
            // Act & Assert
            await expect(errorSystem.initialize()).rejects.toThrow('Initialization failed');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vdW5pdC9sb25kb24vY2xpLWNvbW1hbmRzL2luZGV4LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBcUR0Qyw4Q0FBOEM7QUFDOUMsTUFBTSxvQkFBcUIsU0FBUSxZQUFZO0lBQ3RDLFFBQVEsQ0FBa0I7SUFDMUIsTUFBTSxDQUFpQjtJQUN2QixTQUFTLENBQWtCO0lBQzNCLFlBQVksQ0FBZTtJQUUxQixXQUFXLENBQVk7SUFDdkIsV0FBVyxHQUFHLEtBQUssQ0FBQztJQUU1QixZQUNFLFFBQXlCLEVBQ3pCLE1BQXNCLEVBQ3RCLFNBQTBCLEVBQzFCLFlBQTBCLEVBQzFCLFdBQXVCO1FBRXZCLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzlDLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVTtRQUNkLElBQUksSUFBSSxDQUFDLFdBQVc7WUFBRSxPQUFPO1FBRTdCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFMUIsNEJBQTRCO1FBQzVCLElBQUksWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNsQyxNQUFPLElBQUksQ0FBQyxRQUFnQixDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzVDLENBQUM7UUFFRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUks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Q0FBQyxDQUFDO1lBRXJELE1BQU0sV0FBVyxHQUFHLElBQUksb0JBQW9CLENBQzFDLFlBQVksRUFDWixVQUFVLEVBQ1YsYUFBYSxFQUNiLGdCQUFnQixDQUNqQixDQUFDO1lBRUYsZUFBZTtZQUNmLE1BQU0sTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vdW5pdC9sb25kb24vY2xpLWNvbW1hbmRzL2luZGV4LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDTEkgQ29tbWFuZHMgSW50ZWdyYXRpb24gVGVzdHMgLSBUREQgTG9uZG9uIFNjaG9vbFxuICogXG4gKiBUZXN0cyB0aGUgaW50ZWdyYXRpb24gYW5kIGludGVyYWN0aW9uIGJldHdlZW4gZGlmZmVyZW50IENMSSBjb21tYW5kXG4gKiBjb21wb25lbnRzIHVzaW5nIG1vY2tzIGFuZCBmb2N1c2luZyBvbiBiZWhhdmlvciB2ZXJpZmljYXRpb24gcmF0aGVyXG4gKiB0aGFuIGltcGxlbWVudGF0aW9uIGRldGFpbHMuXG4gKi9cblxuaW1wb3J0IHsgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcblxuLy8gSW1wb3J0IHRoZSBjb21wb25lbnRzIHdlJ3JlIHRlc3RpbmdcbmltcG9ydCB0eXBlIHsgXG4gIENvbW1hbmRSZWdpc3RyeSxcbiAgQ29tbWFuZE1ldGFkYXRhLFxuICBDb21tYW5kQ29udGV4dCxcbiAgQ29tbWFuZFJlc3VsdCxcbiAgQ29tbWFuZENvbmZpZ1xufSBmcm9tICcuLi8uLi8uLi8uLi9jbGkvdHlwZXMvaW5kZXguanMnO1xuXG4vLyBNb2NrIHRoZSBmdWxsIENMSSBjb21tYW5kIHN5c3RlbSBpbnRlZ3JhdGlvblxuaW50ZXJmYWNlIENMSUNvbW1hbmRTeXN0ZW0ge1xuICByZWdpc3RyeTogQ29tbWFuZFJlZ2lzdHJ5O1xuICBwYXJzZXI6IEFyZ3VtZW50UGFyc2VyO1xuICBmb3JtYXR0ZXI6IE91dHB1dEZvcm1hdHRlcjtcbiAgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXI7XG4gIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPjtcbiAgZXhlY3V0ZShpbnB1dDogc3RyaW5nW10pOiBQcm9taXNlPEV4ZWN1dGlvblJlc3VsdD47XG4gIGRpc3Bvc2UoKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuaW50ZXJmYWNlIEFyZ3VtZW50UGFyc2VyIHtcbiAgcGFyc2UoYXJnczogc3RyaW5nW10pOiBQYXJzZVJlc3VsdDtcbn1cblxuaW50ZXJmYWNlIE91dHB1dEZvcm1hdHRlciB7XG4gIGZvcm1hdChkYXRhOiB1bmtub3duLCBvcHRpb25zPzogYW55KTogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgRXJyb3JIYW5kbGVyIHtcbiAgaGFuZGxlKGVycm9yOiBFcnJvciwgY29udGV4dD86IGFueSk6IFByb21pc2U8RXJyb3JSZXN1bHQ+O1xufVxuXG5pbnRlcmZhY2UgUGFyc2VSZXN1bHQge1xuICBjb21tYW5kOiBzdHJpbmcgfCBudWxsO1xuICBhcmdzOiBzdHJpbmdbXTtcbiAgZmxhZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG5pbnRlcmZhY2UgRXJyb3JSZXN1bHQge1xuICBoYW5kbGVkOiBib29sZWFuO1xuICBleGl0Q29kZTogbnVtYmVyO1xuICBtZXNzYWdlOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBFeGVjdXRpb25SZXN1bHQge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBleGl0Q29kZTogbnVtYmVyO1xuICBvdXRwdXQ/OiBzdHJpbmc7XG4gIGVycm9yPzogc3RyaW5nO1xufVxuXG4vLyBNb2NrIGltcGxlbWVudGF0aW9uIGZvciBpbnRlZ3JhdGlvbiB0ZXN0aW5nXG5jbGFzcyBNb2NrQ0xJQ29tbWFuZFN5c3RlbSBleHRlbmRzIEV2ZW50RW1pdHRlciBpbXBsZW1lbnRzIENMSUNvbW1hbmRTeXN0ZW0ge1xuICBwdWJsaWMgcmVnaXN0cnk6IENvbW1hbmRSZWdpc3RyeTtcbiAgcHVibGljIHBhcnNlcjogQXJndW1lbnRQYXJzZXI7XG4gIHB1YmxpYyBmb3JtYXR0ZXI6IE91dHB1dEZvcm1hdHRlcjtcbiAgcHVibGljIGVycm9ySGFuZGxlcjogRXJyb3JIYW5kbGVyO1xuICBcbiAgcHJpdmF0ZSBtb2NrRXhlY3V0ZTogamVzdC5Nb2NrO1xuICBwcml2YXRlIGluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcmVnaXN0cnk6IENvbW1hbmRSZWdpc3RyeSxcbiAgICBwYXJzZXI6IEFyZ3VtZW50UGFyc2VyLFxuICAgIGZvcm1hdHRlcjogT3V0cHV0Rm9ybWF0dGVyLFxuICAgIGVycm9ySGFuZGxlcjogRXJyb3JIYW5kbGVyLFxuICAgIG1vY2tFeGVjdXRlPzogamVzdC5Nb2NrXG4gICkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5yZWdpc3RyeSA9IHJlZ2lzdHJ5O1xuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xuICAgIHRoaXMuZm9ybWF0dGVyID0gZm9ybWF0dGVyO1xuICAgIHRoaXMuZXJyb3JIYW5kbGVyID0gZXJyb3JIYW5kbGVyO1xuICAgIHRoaXMubW9ja0V4ZWN1dGUgPSBtb2NrRXhlY3V0ZSB8fCBqZXN0LmZuKCk7XG4gIH1cblxuICBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSByZXR1cm47XG4gICAgXG4gICAgdGhpcy5lbWl0KCdpbml0aWFsaXppbmcnKTtcbiAgICBcbiAgICAvLyBJbml0aWFsaXplIGFsbCBjb21wb25lbnRzXG4gICAgaWYgKCdpbml0aWFsaXplJyBpbiB0aGlzLnJlZ2lzdHJ5KSB7XG4gICAgICBhd2FpdCAodGhpcy5yZWdpc3RyeSBhcyBhbnkpLmluaXRpYWxpemUoKTtcbiAgICB9XG4gICAgXG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgdGhpcy5lbWl0KCdpbml0aWFsaXplZCcpO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZShpbnB1dDogc3RyaW5nW10pOiBQcm9taXNlPEV4ZWN1dGlvblJlc3VsdD4ge1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDTEkgc3lzdGVtIG5vdCBpbml0aWFsaXplZCcpO1xuICAgIH1cblxuICAgIHRoaXMuZW1pdCgnZXhlY3V0ZS1zdGFydCcsIGlucHV0KTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tb2NrRXhlY3V0ZShpbnB1dCk7XG4gICAgICB0aGlzLmVtaXQoJ2V4ZWN1dGUtY29tcGxldGUnLCByZXN1bHQpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5lbWl0KCdleGVjdXRlLWVycm9yJywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZGlzcG9zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmVtaXQoJ2Rpc3Bvc2luZycpO1xuICAgIFxuICAgIGlmICgnZGlzcG9zZScgaW4gdGhpcy5yZWdpc3RyeSkge1xuICAgICAgYXdhaXQgKHRoaXMucmVnaXN0cnkgYXMgYW55KS5kaXNwb3NlKCk7XG4gICAgfVxuICAgIFxuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIHRoaXMuZW1pdCgnZGlzcG9zZWQnKTtcbiAgfVxuXG4gIC8vIFRlc3QgaGVscGVyc1xuICBpc0luaXRpYWxpemVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmluaXRpYWxpemVkO1xuICB9XG5cbiAgc2V0RXhlY3V0ZUZ1bmN0aW9uKGZuOiBqZXN0Lk1vY2spOiB2b2lkIHtcbiAgICB0aGlzLm1vY2tFeGVjdXRlID0gZm47XG4gIH1cbn1cblxuZGVzY3JpYmUoJ0NMSSBDb21tYW5kcyBJbnRlZ3JhdGlvbiAtIFRERCBMb25kb24nLCAoKSA9PiB7XG4gIGxldCBtb2NrUmVnaXN0cnk6IGplc3QuTW9ja2VkPENvbW1hbmRSZWdpc3RyeT47XG4gIGxldCBtb2NrUGFyc2VyOiBqZXN0Lk1vY2tlZDxBcmd1bWVudFBhcnNlcj47XG4gIGxldCBtb2NrRm9ybWF0dGVyOiBqZXN0Lk1vY2tlZDxPdXRwdXRGb3JtYXR0ZXI+O1xuICBsZXQgbW9ja0Vycm9ySGFuZGxlcjogamVzdC5Nb2NrZWQ8RXJyb3JIYW5kbGVyPjtcbiAgbGV0IGNsaVN5c3RlbTogTW9ja0NMSUNvbW1hbmRTeXN0ZW07XG4gIGxldCBtb2NrRXhlY3V0ZTogamVzdC5Nb2NrO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIENyZWF0ZSBtb2NrIGNvbXBvbmVudHNcbiAgICBtb2NrUmVnaXN0cnkgPSB7XG4gICAgICByZWdpc3RlcjogamVzdC5mbigpLFxuICAgICAgdW5yZWdpc3RlcjogamVzdC5mbigpLFxuICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICBoYXM6IGplc3QuZm4oKSxcbiAgICAgIGxpc3Q6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRCeUNhdGVnb3J5OiBqZXN0LmZuKCksXG4gICAgICBleGVjdXRlOiBqZXN0LmZuKCksXG4gICAgICBpbml0aWFsaXplOiBqZXN0LmZuKCksXG4gICAgICBkaXNwb3NlOiBqZXN0LmZuKClcbiAgICB9IGFzIGFueTtcblxuICAgIG1vY2tQYXJzZXIgPSB7XG4gICAgICBwYXJzZTogamVzdC5mbigpXG4gICAgfTtcblxuICAgIG1vY2tGb3JtYXR0ZXIgPSB7XG4gICAgICBmb3JtYXQ6IGplc3QuZm4oKVxuICAgIH07XG5cbiAgICBtb2NrRXJyb3JIYW5kbGVyID0ge1xuICAgICAgaGFuZGxlOiBqZXN0LmZuKClcbiAgICB9O1xuXG4gICAgbW9ja0V4ZWN1dGUgPSBqZXN0LmZuKCk7XG5cbiAgICAvLyBDcmVhdGUgaW50ZWdyYXRlZCBzeXN0ZW1cbiAgICBjbGlTeXN0ZW0gPSBuZXcgTW9ja0NMSUNvbW1hbmRTeXN0ZW0oXG4gICAgICBtb2NrUmVnaXN0cnksXG4gICAgICBtb2NrUGFyc2VyLFxuICAgICAgbW9ja0Zvcm1hdHRlcixcbiAgICAgIG1vY2tFcnJvckhhbmRsZXIsXG4gICAgICBtb2NrRXhlY3V0ZVxuICAgICk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgY2xpU3lzdGVtLmRpc3Bvc2UoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N5c3RlbSBpbml0aWFsaXphdGlvbiBiZWhhdmlvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgYWxsIGNvbXBvbmVudHMgaW4gY29ycmVjdCBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGluaXRpYWxpemVIYW5kbGVyID0gamVzdC5mbigpO1xuICAgICAgY2xpU3lzdGVtLm9uKCdpbml0aWFsaXppbmcnLCBpbml0aWFsaXplSGFuZGxlcik7XG4gICAgICBjbGlTeXN0ZW0ub24oJ2luaXRpYWxpemVkJywgaW5pdGlhbGl6ZUhhbmRsZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNsaVN5c3RlbS5pbml0aWFsaXplKCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBpbml0aWFsaXphdGlvbiBzZXF1ZW5jZVxuICAgICAgZXhwZWN0KG1vY2tSZWdpc3RyeS5pbml0aWFsaXplKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoaW5pdGlhbGl6ZUhhbmRsZXIpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChjbGlTeXN0ZW0uaXNJbml0aWFsaXplZCgpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmVpbml0aWFsaXplIGlmIGFscmVhZHkgaW5pdGlhbGl6ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uaW5pdGlhbGl6ZSgpO1xuICAgICAgbW9ja1JlZ2lzdHJ5LmluaXRpYWxpemUubW9ja0NsZWFyKCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgY2xpU3lzdGVtLmluaXRpYWxpemUoKTtcblxuICAgICAgLy8gQXNzZXJ0IC0gdmVyaWZ5IG5vIGRvdWJsZSBpbml0aWFsaXphdGlvblxuICAgICAgZXhwZWN0KG1vY2tSZWdpc3RyeS5pbml0aWFsaXplKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IGluaXRpYWxpemF0aW9uIGV2ZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNsaVN5c3RlbS5vbignaW5pdGlhbGl6aW5nJywgZXZlbnRIYW5kbGVyKTtcbiAgICAgIGNsaVN5c3RlbS5vbignaW5pdGlhbGl6ZWQnLCBldmVudEhhbmRsZXIpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNsaVN5c3RlbS5pbml0aWFsaXplKCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBldmVudCBlbWlzc2lvbnNcbiAgICAgIGV4cGVjdChldmVudEhhbmRsZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCk7XG4gICAgICBleHBlY3QoZXZlbnRIYW5kbGVyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb21tYW5kIGV4ZWN1dGlvbiBmbG93IGJlaGF2aW9yJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY2xpU3lzdGVtLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBjb21wbGV0ZSBjb21tYW5kIGZsb3cgd2l0aCBzdWNjZXNzZnVsIHJlc3VsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGlucHV0ID0gWydzdGF0dXMnLCAnLS1mb3JtYXQnLCAnanNvbiddO1xuICAgICAgY29uc3QgcGFyc2VSZXN1bHQ6IFBhcnNlUmVzdWx0ID0ge1xuICAgICAgICBjb21tYW5kOiAnc3RhdHVzJyxcbiAgICAgICAgYXJnczogW10sXG4gICAgICAgIGZsYWdzOiB7IGZvcm1hdDogJ2pzb24nIH1cbiAgICAgIH07XG4gICAgICBjb25zdCBjb21tYW5kUmVzdWx0OiBDb21tYW5kUmVzdWx0ID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBleGl0Q29kZTogMCxcbiAgICAgICAgbWVzc2FnZTogJ1N0YXR1cyByZXRyaWV2ZWQnLFxuICAgICAgICBkYXRhOiB7IGFjdGl2ZTogdHJ1ZSB9XG4gICAgICB9O1xuICAgICAgY29uc3QgZm9ybWF0dGVkT3V0cHV0ID0gJ3tcImFjdGl2ZVwiOiB0cnVlfSc7XG5cbiAgICAgIG1vY2tQYXJzZXIucGFyc2UubW9ja1JldHVyblZhbHVlKHBhcnNlUmVzdWx0KTtcbiAgICAgIG1vY2tSZWdpc3RyeS5leGVjdXRlLm1vY2tSZXNvbHZlZFZhbHVlKGNvbW1hbmRSZXN1bHQpO1xuICAgICAgbW9ja0Zvcm1hdHRlci5mb3JtYXQubW9ja1JldHVyblZhbHVlKGZvcm1hdHRlZE91dHB1dCk7XG5cbiAgICAgIGNvbnN0IGV4cGVjdGVkUmVzdWx0OiBFeGVjdXRpb25SZXN1bHQgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGV4aXRDb2RlOiAwLFxuICAgICAgICBvdXRwdXQ6IGZvcm1hdHRlZE91dHB1dFxuICAgICAgfTtcblxuICAgICAgbW9ja0V4ZWN1dGUubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRSZXN1bHQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaVN5c3RlbS5leGVjdXRlKGlucHV0KTtcblxuICAgICAgLy8gQXNzZXJ0IC0gdmVyaWZ5IGNvbXBsZXRlIGV4ZWN1dGlvbiBmbG93XG4gICAgICBleHBlY3QobW9ja0V4ZWN1dGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGlucHV0KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoZXhwZWN0ZWRSZXN1bHQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tbWFuZCBleGVjdXRpb24gZXJyb3JzIHRocm91Z2ggZXJyb3IgaGFuZGxlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGlucHV0ID0gWydpbnZhbGlkLWNvbW1hbmQnXTtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDb21tYW5kIG5vdCBmb3VuZCcpO1xuICAgICAgY29uc3QgZXJyb3JSZXN1bHQ6IEVycm9yUmVzdWx0ID0ge1xuICAgICAgICBoYW5kbGVkOiB0cnVlLFxuICAgICAgICBleGl0Q29kZTogMTI3LFxuICAgICAgICBtZXNzYWdlOiAnQ29tbWFuZCBub3QgZm91bmQnXG4gICAgICB9O1xuXG4gICAgICBtb2NrRXhlY3V0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG4gICAgICBtb2NrRXJyb3JIYW5kbGVyLmhhbmRsZS5tb2NrUmVzb2x2ZWRWYWx1ZShlcnJvclJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGNsaVN5c3RlbS5leGVjdXRlKGlucHV0KSkucmVqZWN0cy50b1Rocm93KCdDb21tYW5kIG5vdCBmb3VuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IGV4ZWN1dGlvbiBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBldmVudEhhbmRsZXIgPSBqZXN0LmZuKCk7XG4gICAgICBjbGlTeXN0ZW0ub24oJ2V4ZWN1dGUtc3RhcnQnLCBldmVudEhhbmRsZXIpO1xuICAgICAgY2xpU3lzdGVtLm9uKCdleGVjdXRlLWNvbXBsZXRlJywgZXZlbnRIYW5kbGVyKTtcblxuICAgICAgY29uc3QgaW5wdXQgPSBbJ3Rlc3QnXTtcbiAgICAgIGNvbnN0IGV4cGVjdGVkUmVzdWx0OiBFeGVjdXRpb25SZXN1bHQgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGV4aXRDb2RlOiAwXG4gICAgICB9O1xuXG4gICAgICBtb2NrRXhlY3V0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShleHBlY3RlZFJlc3VsdCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgY2xpU3lzdGVtLmV4ZWN1dGUoaW5wdXQpO1xuXG4gICAgICAvLyBBc3NlcnQgLSB2ZXJpZnkgZXZlbnQgZW1pc3Npb25zXG4gICAgICBleHBlY3QoZXZlbnRIYW5kbGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpbnB1dCk7XG4gICAgICBleHBlY3QoZXZlbnRIYW5kbGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3RlZFJlc3VsdCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIHN5c3RlbSBub3QgaW5pdGlhbGl6ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCB1bmluaXRpYWxpemVkU3lzdGVtID0gbmV3IE1vY2tDTElDb21tYW5kU3lzdGVtKFxuICAgICAgICBtb2NrUmVnaXN0cnksXG4gICAgICAgIG1vY2tQYXJzZXIsXG4gICAgICAgIG1vY2tGb3JtYXR0ZXIsXG4gICAgICAgIG1vY2tFcnJvckhhbmRsZXJcbiAgICAgICk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KHVuaW5pdGlhbGl6ZWRTeXN0ZW0uZXhlY3V0ZShbJ3Rlc3QnXSkpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0NMSSBzeXN0ZW0gbm90IGluaXRpYWxpemVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb21wb25lbnQgaW50ZXJhY3Rpb24gYmVoYXZpb3InLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb29yZGluYXRlIGJldHdlZW4gcGFyc2VyIGFuZCByZWdpc3RyeScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGlucHV0ID0gWydkZXBsb3knLCAnYXBwJywgJy0tZW52JywgJ3Byb2QnXTtcbiAgICAgIGNvbnN0IHBhcnNlUmVzdWx0OiBQYXJzZVJlc3VsdCA9IHtcbiAgICAgICAgY29tbWFuZDogJ2RlcGxveScsXG4gICAgICAgIGFyZ3M6IFsnYXBwJ10sXG4gICAgICAgIGZsYWdzOiB7IGVudjogJ3Byb2QnIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRleHQ6IENvbW1hbmRDb250ZXh0ID0ge1xuICAgICAgICBhcmdzOiBbJ2FwcCddLFxuICAgICAgICBmbGFnczogeyBlbnY6ICdwcm9kJyB9LFxuICAgICAgICBpbnB1dCxcbiAgICAgICAgcGtnOiB7IG5hbWU6ICdjbGknLCB2ZXJzaW9uOiAnMS4wLjAnIH0sXG4gICAgICAgIGN3ZDogJy90ZXN0JyxcbiAgICAgICAgZW52OiB7fSxcbiAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICB2ZXJib3NlOiBmYWxzZVxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29tbWFuZFJlc3VsdDogQ29tbWFuZFJlc3VsdCA9IHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZXhpdENvZGU6IDAsXG4gICAgICAgIG1lc3NhZ2U6ICdEZXBsb3llZCBzdWNjZXNzZnVsbHknXG4gICAgICB9O1xuXG4gICAgICBtb2NrUGFyc2VyLnBhcnNlLm1vY2tSZXR1cm5WYWx1ZShwYXJzZVJlc3VsdCk7XG4gICAgICBtb2NrUmVnaXN0cnkuZXhlY3V0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShjb21tYW5kUmVzdWx0KTtcblxuICAgICAgY29uc3QgZXhlY3V0aW9uUmVzdWx0OiBFeGVjdXRpb25SZXN1bHQgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGV4aXRDb2RlOiAwLFxuICAgICAgICBvdXRwdXQ6ICdEZXBsb3llZCBzdWNjZXNzZnVsbHknXG4gICAgICB9O1xuXG4gICAgICBtb2NrRXhlY3V0ZS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGlucHV0QXJncykgPT4ge1xuICAgICAgICAvLyBTaW11bGF0ZSB0aGUgcmVhbCBleGVjdXRpb24gZmxvd1xuICAgICAgICBjb25zdCBwYXJzZWQgPSBtb2NrUGFyc2VyLnBhcnNlKGlucHV0QXJncyk7XG4gICAgICAgIGlmIChwYXJzZWQuY29tbWFuZCkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tSZWdpc3RyeS5leGVjdXRlKHBhcnNlZC5jb21tYW5kLCBjb250ZXh0KTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogcmVzdWx0LnN1Y2Nlc3MsXG4gICAgICAgICAgICBleGl0Q29kZTogcmVzdWx0LmV4aXRDb2RlLFxuICAgICAgICAgICAgb3V0cHV0OiByZXN1bHQubWVzc2FnZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGV4aXRDb2RlOiAxIH07XG4gICAgICB9KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGlTeXN0ZW0uZXhlY3V0ZShpbnB1dCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBjb21wb25lbnQgY29vcmRpbmF0aW9uXG4gICAgICBleHBlY3QobW9ja1BhcnNlci5wYXJzZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoaW5wdXQpO1xuICAgICAgZXhwZWN0KG1vY2tSZWdpc3RyeS5leGVjdXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZGVwbG95JywgY29udGV4dCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZvcm1hdCBvdXRwdXQgdXNpbmcgZm9ybWF0dGVyIHdoZW4gY29tbWFuZCBzdWNjZWVkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGlucHV0ID0gWydzdGF0dXMnXTtcbiAgICAgIGNvbnN0IGNvbW1hbmREYXRhID0geyBhZ2VudHM6IDMsIGFjdGl2ZTogdHJ1ZSB9O1xuICAgICAgY29uc3QgZm9ybWF0dGVkT3V0cHV0ID0gJ0FnZW50czogMywgQWN0aXZlOiB0cnVlJztcblxuICAgICAgbW9ja0V4ZWN1dGUubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkID0gbW9ja0Zvcm1hdHRlci5mb3JtYXQoY29tbWFuZERhdGEsIHsgZm9ybWF0OiAndGFibGUnIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgZXhpdENvZGU6IDAsXG4gICAgICAgICAgb3V0cHV0OiBmb3JtYXR0ZWRcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrRm9ybWF0dGVyLmZvcm1hdC5tb2NrUmV0dXJuVmFsdWUoZm9ybWF0dGVkT3V0cHV0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGlTeXN0ZW0uZXhlY3V0ZShpbnB1dCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBmb3JtYXR0ZXIgdXNhZ2VcbiAgICAgIGV4cGVjdChtb2NrRm9ybWF0dGVyLmZvcm1hdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY29tbWFuZERhdGEsIHsgZm9ybWF0OiAndGFibGUnIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vdXRwdXQpLnRvQmUoZm9ybWF0dGVkT3V0cHV0KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGVycm9yIGhhbmRsZXIgd2hlbiBjb21tYW5kIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW5wdXQgPSBbJ2ZhaWxpbmctY29tbWFuZCddO1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0NvbW1hbmQgZXhlY3V0aW9uIGZhaWxlZCcpO1xuICAgICAgY29uc3QgZXJyb3JSZXN1bHQ6IEVycm9yUmVzdWx0ID0ge1xuICAgICAgICBoYW5kbGVkOiB0cnVlLFxuICAgICAgICBleGl0Q29kZTogMSxcbiAgICAgICAgbWVzc2FnZTogJ0V4ZWN1dGlvbiBmYWlsZWQgZ3JhY2VmdWxseSdcbiAgICAgIH07XG5cbiAgICAgIG1vY2tFeGVjdXRlLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2tFcnJvckhhbmRsZXIuaGFuZGxlLm1vY2tSZXNvbHZlZFZhbHVlKGVycm9yUmVzdWx0KTtcblxuICAgICAgLy8gQWN0XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBjbGlTeXN0ZW0uZXhlY3V0ZShpbnB1dCk7XG4gICAgICB9IGNhdGNoICh0aHJvd25FcnJvcikge1xuICAgICAgICAvLyBFeHBlY3RlZCB0byB0aHJvdywgYnV0IGVycm9yIGhhbmRsZXIgc2hvdWxkIGhhdmUgYmVlbiBjYWxsZWRcbiAgICAgIH1cblxuICAgICAgLy8gQXNzZXJ0IC0gdmVyaWZ5IGVycm9yIGhhbmRsZXIgdXNhZ2VcbiAgICAgIC8vIE5vdGU6IFRoZSBhY3R1YWwgaW50ZWdyYXRpb24gd291bGQgaGFuZGxlIHRoZSBlcnJvciBhbmQgbm90IHJlLXRocm93XG4gICAgICAvLyBUaGlzIHRlc3QgdmVyaWZpZXMgdGhlIGNvbXBvbmVudCBpbnRlcmFjdGlvbiBwYXR0ZXJuXG4gICAgICBleHBlY3QobW9ja0V4ZWN1dGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGlucHV0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NvbW1hbmQgcmVnaXN0cmF0aW9uIGludGVncmF0aW9uIGJlaGF2aW9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgY29tbWFuZCBhbmQgbWFrZSBpdCBhdmFpbGFibGUgZm9yIGV4ZWN1dGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNvbW1hbmRDb25maWc6IENvbW1hbmRDb25maWcgPSB7XG4gICAgICAgIG5hbWU6ICd0ZXN0LWNvbW1hbmQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgY29tbWFuZCcsXG4gICAgICAgIGNhdGVnb3J5OiAnY29yZSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbW1hbmRNZXRhZGF0YTogQ29tbWFuZE1ldGFkYXRhID0ge1xuICAgICAgICBjb25maWc6IGNvbW1hbmRDb25maWcsXG4gICAgICAgIGhhbmRsZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBleGl0Q29kZTogMCxcbiAgICAgICAgICBtZXNzYWdlOiAnVGVzdCBleGVjdXRlZCdcbiAgICAgICAgfSksXG4gICAgICAgIHJlZ2lzdGVyZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgYXZhaWxhYmxlOiB0cnVlXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNsaVN5c3RlbS5yZWdpc3RyeS5yZWdpc3Rlcihjb21tYW5kTWV0YWRhdGEpO1xuXG4gICAgICAvLyBBc3NlcnQgLSB2ZXJpZnkgcmVnaXN0cmF0aW9uXG4gICAgICBleHBlY3QobW9ja1JlZ2lzdHJ5LnJlZ2lzdGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjb21tYW5kTWV0YWRhdGEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIGFuZCBleGVjdXRlIHJlZ2lzdGVyZWQgY29tbWFuZHMgYnkgY2F0ZWdvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjb3JlQ29tbWFuZHMgPSBbXG4gICAgICAgIHsgY29uZmlnOiB7IG5hbWU6ICdzdGF0dXMnLCBjYXRlZ29yeTogJ2NvcmUnIH0gfSxcbiAgICAgICAgeyBjb25maWc6IHsgbmFtZTogJ2luaXQnLCBjYXRlZ29yeTogJ2NvcmUnIH0gfVxuICAgICAgXTtcblxuICAgICAgbW9ja1JlZ2lzdHJ5LmZpbmRCeUNhdGVnb3J5Lm1vY2tSZXR1cm5WYWx1ZShjb3JlQ29tbWFuZHMgYXMgQ29tbWFuZE1ldGFkYXRhW10pO1xuXG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IGNvbW1hbmRzID0gY2xpU3lzdGVtLnJlZ2lzdHJ5LmZpbmRCeUNhdGVnb3J5KCdjb3JlJyk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBjYXRlZ29yeS1iYXNlZCBkaXNjb3ZlcnlcbiAgICAgIGV4cGVjdChtb2NrUmVnaXN0cnkuZmluZEJ5Q2F0ZWdvcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb3JlJyk7XG4gICAgICBleHBlY3QoY29tbWFuZHMpLnRvRXF1YWwoY29yZUNvbW1hbmRzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlbHAgYW5kIGRvY3VtZW50YXRpb24gYmVoYXZpb3InLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGhlbHAgZm9yIHJlZ2lzdGVyZWQgY29tbWFuZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjb21tYW5kcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgbmFtZTogJ3N0YXR1cycsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Nob3cgc3lzdGVtIHN0YXR1cycsXG4gICAgICAgICAgICB1c2FnZTogJ2NsaSBzdGF0dXMgW29wdGlvbnNdJyxcbiAgICAgICAgICAgIGV4YW1wbGVzOiBbJ2NsaSBzdGF0dXMnLCAnY2xpIHN0YXR1cyAtLWZvcm1hdCBqc29uJ11cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIG5hbWU6ICdkZXBsb3knLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZXBsb3kgYXBwbGljYXRpb24nLFxuICAgICAgICAgICAgdXNhZ2U6ICdjbGkgZGVwbG95IDx0YXJnZXQ+JyxcbiAgICAgICAgICAgIGV4YW1wbGVzOiBbJ2NsaSBkZXBsb3kgYXBwJ11cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF07XG5cbiAgICAgIG1vY2tSZWdpc3RyeS5saXN0Lm1vY2tSZXR1cm5WYWx1ZShjb21tYW5kcyBhcyBDb21tYW5kTWV0YWRhdGFbXSk7XG5cbiAgICAgIGNvbnN0IGhlbHBPdXRwdXQgPSBjb21tYW5kcy5tYXAoY21kID0+IFxuICAgICAgICBgJHtjbWQuY29uZmlnLm5hbWV9OiAke2NtZC5jb25maWcuZGVzY3JpcHRpb259YFxuICAgICAgKS5qb2luKCdcXG4nKTtcblxuICAgICAgbW9ja0Zvcm1hdHRlci5mb3JtYXQubW9ja1JldHVyblZhbHVlKGhlbHBPdXRwdXQpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1vY2tGb3JtYXR0ZXIuZm9ybWF0KGNvbW1hbmRzLCB7IGZvcm1hdDogJ2hlbHAnIH0pO1xuXG4gICAgICAvLyBBc3NlcnQgLSB2ZXJpZnkgaGVscCBnZW5lcmF0aW9uXG4gICAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ3N0YXR1czogU2hvdyBzeXN0ZW0gc3RhdHVzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2RlcGxveTogRGVwbG95IGFwcGxpY2F0aW9uJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsaWZlY3ljbGUgYW5kIGNsZWFudXAgYmVoYXZpb3InLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkaXNwb3NlIGFsbCBjb21wb25lbnRzIGluIGNvcnJlY3Qgb3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkaXNwb3NlSGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNsaVN5c3RlbS5vbignZGlzcG9zaW5nJywgZGlzcG9zZUhhbmRsZXIpO1xuICAgICAgY2xpU3lzdGVtLm9uKCdkaXNwb3NlZCcsIGRpc3Bvc2VIYW5kbGVyKTtcblxuICAgICAgYXdhaXQgY2xpU3lzdGVtLmluaXRpYWxpemUoKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBjbGlTeXN0ZW0uZGlzcG9zZSgpO1xuXG4gICAgICAvLyBBc3NlcnQgLSB2ZXJpZnkgZGlzcG9zYWwgc2VxdWVuY2VcbiAgICAgIGV4cGVjdChtb2NrUmVnaXN0cnkuZGlzcG9zZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KGRpc3Bvc2VIYW5kbGVyKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICBleHBlY3QoY2xpU3lzdGVtLmlzSW5pdGlhbGl6ZWQoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBhbGwgZXZlbnQgbGlzdGVuZXJzIG9uIGRpc3Bvc2FsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZXZlbnRIYW5kbGVyID0gamVzdC5mbigpO1xuICAgICAgY2xpU3lzdGVtLm9uKCd0ZXN0LWV2ZW50JywgZXZlbnRIYW5kbGVyKTtcblxuICAgICAgYXdhaXQgY2xpU3lzdGVtLmluaXRpYWxpemUoKTtcbiAgICAgIGV4cGVjdChjbGlTeXN0ZW0ubGlzdGVuZXJDb3VudCgndGVzdC1ldmVudCcpKS50b0JlKDEpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IGNsaVN5c3RlbS5kaXNwb3NlKCk7XG5cbiAgICAgIC8vIEFzc2VydCAtIHZlcmlmeSBjbGVhbnVwXG4gICAgICBleHBlY3QoY2xpU3lzdGVtLmxpc3RlbmVyQ291bnQoJ3Rlc3QtZXZlbnQnKSkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vycm9yIHByb3BhZ2F0aW9uIGJlaGF2aW9yJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY2xpU3lzdGVtLmluaXRpYWxpemUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBlcnJvciBldmVudHMgZHVyaW5nIGV4ZWN1dGlvbiBmYWlsdXJlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGVycm9ySGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNsaVN5c3RlbS5vbignZXhlY3V0ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgIGNvbnN0IGlucHV0ID0gWydlcnJvci1jb21tYW5kJ107XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRXhlY3V0aW9uIGVycm9yJyk7XG4gICAgICBtb2NrRXhlY3V0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgY2xpU3lzdGVtLmV4ZWN1dGUoaW5wdXQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBFeHBlY3RlZCB0byB0aHJvd1xuICAgICAgfVxuXG4gICAgICAvLyBBc3NlcnQgLSB2ZXJpZnkgZXJyb3IgZXZlbnQgZW1pc3Npb25cbiAgICAgIGV4cGVjdChlcnJvckhhbmRsZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGVycm9yKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGluaXRpYWxpemF0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW5pdEVycm9yID0gbmV3IEVycm9yKCdJbml0aWFsaXphdGlvbiBmYWlsZWQnKTtcbiAgICAgIG1vY2tSZWdpc3RyeS5pbml0aWFsaXplLm1vY2tSZWplY3RlZFZhbHVlKGluaXRFcnJvcik7XG5cbiAgICAgIGNvbnN0IGVycm9yU3lzdGVtID0gbmV3IE1vY2tDTElDb21tYW5kU3lzdGVtKFxuICAgICAgICBtb2NrUmVnaXN0cnksXG4gICAgICAgIG1vY2tQYXJzZXIsXG4gICAgICAgIG1vY2tGb3JtYXR0ZXIsXG4gICAgICAgIG1vY2tFcnJvckhhbmRsZXJcbiAgICAgICk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGVycm9yU3lzdGVtLmluaXRpYWxpemUoKSkucmVqZWN0cy50b1Rocm93KCdJbml0aWFsaXphdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=