98c0af2095e5abb76314cfe4eb4a9567
/**
 * MCP Streaming Support - TDD London Style
 *
 * Tests streaming capabilities using London School principles:
 * - Mock streaming infrastructure and data flow
 * - Test streaming protocol compliance and backpressure
 * - Verify stream lifecycle management and error handling
 * - Focus on streaming interactions and contracts
 */
import { jest, describe, it, expect, beforeEach, afterEach } from '@jest/globals';
// === MOCK DEPENDENCIES (London School Contract Definition) ===
const mockStreamManager = {
    createStream: jest.fn(),
    closeStream: jest.fn(),
    writeToStream: jest.fn(),
    readFromStream: jest.fn(),
    getStreamState: jest.fn(),
    handleBackpressure: jest.fn()
};
const mockBufferManager = {
    allocateBuffer: jest.fn(),
    releaseBuffer: jest.fn(),
    getBufferUsage: jest.fn(),
    flushBuffer: jest.fn(),
    resizeBuffer: jest.fn()
};
const mockFlowController = {
    checkBackpressure: jest.fn(),
    pauseStream: jest.fn(),
    resumeStream: jest.fn(),
    adjustBufferSize: jest.fn(),
    getFlowMetrics: jest.fn()
};
const mockLogger = {
    debug: jest.fn(),
    info: jest.fn(),
    warn: jest.fn(),
    error: jest.fn()
};
const mockMetricsCollector = {
    recordStreamCreated: jest.fn(),
    recordStreamClosed: jest.fn(),
    recordDataTransfer: jest.fn(),
    recordBackpressureEvent: jest.fn(),
    recordStreamError: jest.fn()
};
const mockEventEmitter = {
    emit: jest.fn(),
    on: jest.fn(),
    off: jest.fn(),
    once: jest.fn()
};
// === MOCK IMPLEMENTATION ===
class MockMCPStreamingHandler {
    streamManager;
    bufferManager;
    flowController;
    logger;
    metrics;
    eventEmitter;
    activeSessions = new Map();
    constructor(streamManager = mockStreamManager, bufferManager = mockBufferManager, flowController = mockFlowController, logger = mockLogger, metrics = mockMetricsCollector, eventEmitter = mockEventEmitter) {
        this.streamManager = streamManager;
        this.bufferManager = bufferManager;
        this.flowController = flowController;
        this.logger = logger;
        this.metrics = metrics;
        this.eventEmitter = eventEmitter;
    }
    async createStreamingSession(request, context) {
        const streamId = `stream-${Date.now()}-${Math.random().toString(36).substr(2, 8)}`;
        this.logger.info('Creating streaming session', {
            streamId,
            method: request.method,
            sessionId: context.sessionId
        });
        const session = {
            id: streamId,
            requestId: request.id,
            method: request.method,
            state: 'active',
            created: new Date(),
            lastActivity: new Date(),
            bytesTransferred: 0,
            bufferSize: 64 * 1024, // 64KB default
            maxBufferSize: 1024 * 1024 // 1MB max
        };
        // Initialize stream infrastructure
        const streamCreated = this.streamManager.createStream(streamId, {
            bufferSize: session.bufferSize,
            maxBufferSize: session.maxBufferSize
        });
        if (streamCreated) {
            this.activeSessions.set(streamId, session);
            this.metrics.recordStreamCreated(streamId, request.method);
            this.eventEmitter.emit('stream:created', { streamId, session });
            // Setup stream event handlers
            this.setupStreamEventHandlers(streamId);
        }
        return session;
    }
    async handleStreamingRequest(request, context) {
        this.logger.debug('Handling streaming request', {
            method: request.method,
            id: request.id
        });
        switch (request.method) {
            case 'stream/start':
                return this.handleStreamStart(request, context);
            case 'stream/data':
                return this.handleStreamData(request.params.streamId, request.params.data);
            case 'stream/end':
                return this.handleStreamEnd(request, context);
            default:
                throw new Error(`Unsupported streaming method: ${request.method}`);
        }
    }
    async closeStreamingSession(streamId) {
        this.logger.info('Closing streaming session', { streamId });
        const session = this.activeSessions.get(streamId);
        if (!session) {
            this.logger.warn('Attempt to close non-existent stream', { streamId });
            return;
        }
        // Close stream infrastructure
        this.streamManager.closeStream(streamId);
        this.bufferManager.releaseBuffer(streamId);
        // Update session state
        session.state = 'closed';
        this.activeSessions.delete(streamId);
        this.metrics.recordStreamClosed(streamId, session.bytesTransferred);
        this.eventEmitter.emit('stream:closed', { streamId, session });
    }
    async handleStreamData(streamId, data) {
        const session = this.activeSessions.get(streamId);
        if (!session) {
            throw new Error(`Stream not found: ${streamId}`);
        }
        this.logger.debug('Processing stream data', {
            streamId,
            sequence: data.sequence,
            isLast: data.isLast
        });
        // Check backpressure
        const backpressureCheck = this.flowController.checkBackpressure(streamId);
        if (backpressureCheck.shouldPause) {
            await this.handleBackpressure(streamId, backpressureCheck.bufferUsage);
        }
        // Write data to stream
        const bytesWritten = this.streamManager.writeToStream(streamId, data);
        session.bytesTransferred += bytesWritten;
        session.lastActivity = new Date();
        this.metrics.recordDataTransfer(streamId, bytesWritten);
        // Handle end of stream
        if (data.isLast) {
            await this.endStream(streamId, {
                totalChunks: data.sequence + 1,
                totalBytes: session.bytesTransferred,
                duration: Date.now() - session.created.getTime(),
                errors: 0
            });
        }
    }
    async startStream(params) {
        const streamId = `protocol-stream-${Date.now()}`;
        this.logger.info('Starting protocol stream', {
            streamId,
            method: params.method
        });
        const bufferSize = params.bufferSize || 64 * 1024;
        const buffer = this.bufferManager.allocateBuffer(streamId, bufferSize);
        if (buffer) {
            this.eventEmitter.emit('stream:protocol-started', { streamId, params });
            return {
                streamId,
                bufferSize,
                readyForData: true
            };
        }
        throw new Error('Failed to allocate stream buffer');
    }
    async streamChunk(streamId, chunk) {
        this.logger.debug('Processing stream chunk', {
            streamId,
            sequence: chunk.sequence,
            isLast: chunk.isLast
        });
        // Validate chunk sequence
        if (chunk.sequence < 0) {
            throw new Error(`Invalid chunk sequence: ${chunk.sequence}`);
        }
        // Process chunk data
        const processed = this.streamManager.writeToStream(streamId, {
            id: streamId,
            sequence: chunk.sequence,
            data: chunk.data,
            isLast: chunk.isLast,
            timestamp: new Date()
        });
        if (!processed) {
            throw new Error(`Failed to process chunk ${chunk.sequence} for stream ${streamId}`);
        }
        this.eventEmitter.emit('stream:chunk-processed', { streamId, chunk });
    }
    async endStream(streamId, summary) {
        this.logger.info('Ending stream', { streamId, summary });
        const session = this.activeSessions.get(streamId);
        if (session) {
            session.state = 'closed';
        }
        this.streamManager.closeStream(streamId);
        this.bufferManager.releaseBuffer(streamId);
        if (summary) {
            this.metrics.recordDataTransfer(streamId, summary.totalBytes);
        }
        this.eventEmitter.emit('stream:ended', { streamId, summary });
    }
    async handleStreamError(streamId, error) {
        this.logger.error('Stream error occurred', {
            streamId,
            error: error.message
        });
        const session = this.activeSessions.get(streamId);
        if (session) {
            session.state = 'error';
        }
        this.metrics.recordStreamError(streamId, error.message);
        this.eventEmitter.emit('stream:error', { streamId, error });
        // Cleanup resources
        await this.closeStreamingSession(streamId);
    }
    async handleStreamStart(request, context) {
        const session = await this.createStreamingSession(request, context);
        return {
            jsonrpc: '2.0',
            id: request.id,
            result: {
                streamId: session.id,
                bufferSize: session.bufferSize,
                maxBufferSize: session.maxBufferSize,
                state: session.state
            }
        };
    }
    async handleStreamEnd(request, context) {
        const { streamId } = request.params;
        await this.closeStreamingSession(streamId);
        return {
            jsonrpc: '2.0',
            id: request.id,
            result: {
                streamId,
                closed: true
            }
        };
    }
    async handleBackpressure(streamId, bufferUsage) {
        this.logger.warn('Backpressure detected', { streamId, bufferUsage });
        const backpressureEvent = {
            streamId,
            bufferUsage,
            threshold: 0.8, // 80% threshold
            action: 'pause'
        };
        this.metrics.recordBackpressureEvent(streamId, bufferUsage);
        this.flowController.pauseStream(streamId);
        // Try to resize buffer if possible
        const session = this.activeSessions.get(streamId);
        if (session && session.bufferSize < session.maxBufferSize) {
            const newSize = Math.min(session.bufferSize * 2, session.maxBufferSize);
            this.bufferManager.resizeBuffer(streamId, newSize);
            session.bufferSize = newSize;
            backpressureEvent.action = 'resize';
        }
        this.eventEmitter.emit('stream:backpressure', backpressureEvent);
    }
    setupStreamEventHandlers(streamId) {
        // Setup event handlers for stream lifecycle
        this.eventEmitter.on(`stream:${streamId}:data`, (data) => {
            this.handleStreamData(streamId, data);
        });
        this.eventEmitter.on(`stream:${streamId}:error`, (error) => {
            this.handleStreamError(streamId, error);
        });
        this.eventEmitter.on(`stream:${streamId}:close`, () => {
            this.closeStreamingSession(streamId);
        });
    }
}
describe('MCP Streaming Support - London TDD', () => {
    describe('🎯 Acceptance Tests - Stream Creation', () => {
        describe('User Story: Create Streaming Session', () => {
            it('should create streaming session with proper initialization', async () => {
                // Arrange - Mock successful stream creation
                mockStreamManager.createStream.mockReturnValue(true);
                mockBufferManager.allocateBuffer.mockReturnValue(true);
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                const streamRequest = {
                    jsonrpc: '2.0',
                    id: 'stream-create-1',
                    method: 'stream/start',
                    params: {
                        bufferSize: 128 * 1024, // 128KB
                        maxChunks: 1000
                    }
                };
                const context = {
                    sessionId: 'session-stream',
                    logger: mockLogger
                };
                // Act - Create streaming session
                const session = await streamingHandler.createStreamingSession(streamRequest, context);
                // Assert - Verify stream creation conversation
                expect(mockLogger.info).toHaveBeenCalledWith('Creating streaming session', expect.objectContaining({
                    streamId: session.id,
                    method: 'stream/start',
                    sessionId: 'session-stream'
                }));
                expect(mockStreamManager.createStream).toHaveBeenCalledWith(session.id, expect.objectContaining({
                    bufferSize: expect.any(Number),
                    maxBufferSize: expect.any(Number)
                }));
                expect(mockMetricsCollector.recordStreamCreated).toHaveBeenCalledWith(session.id, 'stream/start');
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:created', {
                    streamId: session.id,
                    session
                });
                expect(session.id).toBeDefined();
                expect(session.state).toBe('active');
                expect(session.method).toBe('stream/start');
                expect(session.bytesTransferred).toBe(0);
            });
            it('should handle stream creation failure gracefully', async () => {
                // Arrange - Mock stream creation failure
                mockStreamManager.createStream.mockReturnValue(false);
                const streamingHandler = new MockMCPStreamingHandler();
                const failedStreamRequest = {
                    jsonrpc: '2.0',
                    id: 'stream-fail-1',
                    method: 'stream/start',
                    params: { bufferSize: 1024 }
                };
                const context = {
                    sessionId: 'session-fail',
                    logger: mockLogger
                };
                // Act - Attempt to create failing stream
                const session = await streamingHandler.createStreamingSession(failedStreamRequest, context);
                // Assert - Verify failure handling
                expect(mockStreamManager.createStream).toHaveBeenCalled();
                expect(mockMetricsCollector.recordStreamCreated).not.toHaveBeenCalled();
                // Session should still be created but not active in the infrastructure
                expect(session.id).toBeDefined();
            });
        });
        describe('User Story: Handle Stream Start Protocol', () => {
            it('should process stream/start requests correctly', async () => {
                // Arrange - Mock stream start protocol
                mockStreamManager.createStream.mockReturnValue(true);
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                const streamStartRequest = {
                    jsonrpc: '2.0',
                    id: 'protocol-start-1',
                    method: 'stream/start',
                    params: {
                        method: 'data/export',
                        bufferSize: 256 * 1024,
                        compression: true
                    }
                };
                const context = {
                    sessionId: 'session-protocol',
                    logger: mockLogger
                };
                // Act - Handle stream start request
                const response = await streamingHandler.handleStreamingRequest(streamStartRequest, context);
                // Assert - Verify stream start protocol handling
                expect(mockLogger.debug).toHaveBeenCalledWith('Handling streaming request', { method: 'stream/start', id: 'protocol-start-1' });
                expect(response.jsonrpc).toBe('2.0');
                expect(response.id).toBe('protocol-start-1');
                expect(response.result).toBeDefined();
                expect(response.result.streamId).toBeDefined();
                expect(response.result.state).toBe('active');
            });
        });
    });
    describe('🌊 Acceptance Tests - Data Streaming', () => {
        describe('User Story: Stream Data Chunks', () => {
            it('should process data chunks in sequence', async () => {
                // Arrange - Mock data chunk processing
                mockStreamManager.writeToStream.mockReturnValue(1024); // 1KB written
                mockFlowController.checkBackpressure.mockReturnValue({ shouldPause: false });
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                // First create a session
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'chunk-test',
                    method: 'data/stream',
                    params: {}
                }, { sessionId: 'session-chunks', logger: mockLogger });
                const chunkData = {
                    id: session.id,
                    sequence: 1,
                    data: { content: 'test data chunk', size: 1024 },
                    isLast: false,
                    timestamp: new Date()
                };
                // Act - Process data chunk
                await streamingHandler.handleStreamData(session.id, chunkData);
                // Assert - Verify chunk processing
                expect(mockLogger.debug).toHaveBeenCalledWith('Processing stream data', {
                    streamId: session.id,
                    sequence: 1,
                    isLast: false
                });
                expect(mockFlowController.checkBackpressure).toHaveBeenCalledWith(session.id);
                expect(mockStreamManager.writeToStream).toHaveBeenCalledWith(session.id, chunkData);
                expect(mockMetricsCollector.recordDataTransfer).toHaveBeenCalledWith(session.id, 1024);
            });
            it('should handle last chunk and end stream', async () => {
                // Arrange - Mock last chunk processing
                mockStreamManager.writeToStream.mockReturnValue(512);
                mockFlowController.checkBackpressure.mockReturnValue({ shouldPause: false });
                mockStreamManager.closeStream.mockReturnValue(undefined);
                mockBufferManager.releaseBuffer.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                // Create session
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'last-chunk-test',
                    method: 'data/stream',
                    params: {}
                }, { sessionId: 'session-last', logger: mockLogger });
                const lastChunkData = {
                    id: session.id,
                    sequence: 5,
                    data: { content: 'final chunk', size: 512 },
                    isLast: true,
                    timestamp: new Date()
                };
                // Act - Process last chunk
                await streamingHandler.handleStreamData(session.id, lastChunkData);
                // Assert - Verify last chunk handling and stream end
                expect(mockStreamManager.writeToStream).toHaveBeenCalledWith(session.id, lastChunkData);
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:ended', {
                    streamId: session.id,
                    summary: expect.objectContaining({
                        totalChunks: 6, // sequence 5 + 1
                        totalBytes: expect.any(Number),
                        duration: expect.any(Number),
                        errors: 0
                    })
                });
            });
        });
        describe('User Story: Handle Protocol Stream Chunks', () => {
            it('should process protocol stream chunks correctly', async () => {
                // Arrange - Mock protocol chunk processing
                mockBufferManager.allocateBuffer.mockReturnValue(true);
                mockStreamManager.writeToStream.mockReturnValue(true);
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                // Start protocol stream
                const streamResponse = await streamingHandler.startStream({
                    method: 'analysis/stream',
                    bufferSize: 64 * 1024,
                    compression: false
                });
                const chunk = {
                    sequence: 1,
                    data: { analysis: 'code quality check', results: [1, 2, 3] },
                    checksum: 'abc123',
                    isLast: false
                };
                // Act - Process protocol chunk
                await streamingHandler.streamChunk(streamResponse.streamId, chunk);
                // Assert - Verify protocol chunk processing
                expect(mockLogger.debug).toHaveBeenCalledWith('Processing stream chunk', {
                    streamId: streamResponse.streamId,
                    sequence: 1,
                    isLast: false
                });
                expect(mockStreamManager.writeToStream).toHaveBeenCalledWith(streamResponse.streamId, expect.objectContaining({
                    id: streamResponse.streamId,
                    sequence: 1,
                    data: chunk.data,
                    isLast: false
                }));
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:chunk-processed', {
                    streamId: streamResponse.streamId,
                    chunk
                });
            });
            it('should validate chunk sequence numbers', async () => {
                // Arrange - Mock invalid chunk sequence
                const streamingHandler = new MockMCPStreamingHandler();
                const streamResponse = await streamingHandler.startStream({
                    method: 'validation/stream'
                });
                const invalidChunk = {
                    sequence: -1, // Invalid sequence
                    data: { test: 'data' },
                    isLast: false
                };
                // Act & Assert - Should throw error for invalid sequence
                await expect(streamingHandler.streamChunk(streamResponse.streamId, invalidChunk)).rejects.toThrow('Invalid chunk sequence: -1');
            });
        });
    });
    describe('🚰 Acceptance Tests - Backpressure Management', () => {
        describe('User Story: Handle Buffer Backpressure', () => {
            it('should detect and handle backpressure events', async () => {
                // Arrange - Mock backpressure scenario
                mockStreamManager.createStream.mockReturnValue(true);
                mockFlowController.checkBackpressure.mockReturnValue({
                    shouldPause: true,
                    bufferUsage: 0.85 // 85% buffer usage
                });
                mockFlowController.pauseStream.mockReturnValue(undefined);
                mockBufferManager.resizeBuffer.mockReturnValue(true);
                const streamingHandler = new MockMCPStreamingHandler();
                // Create session
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'backpressure-test',
                    method: 'heavy/stream',
                    params: {}
                }, { sessionId: 'session-backpressure', logger: mockLogger });
                const heavyData = {
                    id: session.id,
                    sequence: 1,
                    data: { heavyPayload: 'x'.repeat(50000) }, // Large payload
                    isLast: false,
                    timestamp: new Date()
                };
                // Act - Process data that triggers backpressure
                await streamingHandler.handleStreamData(session.id, heavyData);
                // Assert - Verify backpressure handling
                expect(mockFlowController.checkBackpressure).toHaveBeenCalledWith(session.id);
                expect(mockLogger.warn).toHaveBeenCalledWith('Backpressure detected', { streamId: session.id, bufferUsage: 0.85 });
                expect(mockMetricsCollector.recordBackpressureEvent).toHaveBeenCalledWith(session.id, 0.85);
                expect(mockFlowController.pauseStream).toHaveBeenCalledWith(session.id);
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:backpressure', expect.objectContaining({
                    streamId: session.id,
                    bufferUsage: 0.85,
                    action: expect.any(String)
                }));
            });
            it('should resize buffers when possible during backpressure', async () => {
                // Arrange - Mock buffer resize scenario
                mockStreamManager.createStream.mockReturnValue(true);
                mockFlowController.checkBackpressure.mockReturnValue({
                    shouldPause: true,
                    bufferUsage: 0.9
                });
                mockBufferManager.resizeBuffer.mockReturnValue(true);
                const streamingHandler = new MockMCPStreamingHandler();
                // Create session with room for buffer growth
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'resize-test',
                    method: 'expandable/stream',
                    params: {}
                }, { sessionId: 'session-resize', logger: mockLogger });
                // Simulate buffer resize opportunity
                const originalBufferSize = session.bufferSize;
                const data = {
                    id: session.id,
                    sequence: 1,
                    data: { largeData: 'test'.repeat(20000) },
                    isLast: false,
                    timestamp: new Date()
                };
                // Act - Trigger backpressure with resize capability
                await streamingHandler.handleStreamData(session.id, data);
                // Assert - Verify buffer resize
                expect(mockBufferManager.resizeBuffer).toHaveBeenCalledWith(session.id, originalBufferSize * 2 // Should double buffer size
                );
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:backpressure', expect.objectContaining({
                    action: 'resize'
                }));
            });
        });
    });
    describe('🔚 Acceptance Tests - Stream Lifecycle', () => {
        describe('User Story: Close Streaming Sessions', () => {
            it('should close streams and cleanup resources', async () => {
                // Arrange - Mock stream closure
                mockStreamManager.createStream.mockReturnValue(true);
                mockStreamManager.closeStream.mockReturnValue(undefined);
                mockBufferManager.releaseBuffer.mockReturnValue(undefined);
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                // Create session to close
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'close-test',
                    method: 'closeable/stream',
                    params: {}
                }, { sessionId: 'session-close', logger: mockLogger });
                // Act - Close streaming session
                await streamingHandler.closeStreamingSession(session.id);
                // Assert - Verify stream closure conversation
                expect(mockLogger.info).toHaveBeenCalledWith('Closing streaming session', { streamId: session.id });
                expect(mockStreamManager.closeStream).toHaveBeenCalledWith(session.id);
                expect(mockBufferManager.releaseBuffer).toHaveBeenCalledWith(session.id);
                expect(mockMetricsCollector.recordStreamClosed).toHaveBeenCalledWith(session.id, expect.any(Number) // bytes transferred
                );
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:closed', {
                    streamId: session.id,
                    session: expect.objectContaining({ state: 'closed' })
                });
            });
            it('should handle closure of non-existent streams gracefully', async () => {
                // Arrange - Mock non-existent stream closure
                const streamingHandler = new MockMCPStreamingHandler();
                const nonExistentStreamId = 'non-existent-stream';
                // Act - Attempt to close non-existent stream
                await streamingHandler.closeStreamingSession(nonExistentStreamId);
                // Assert - Verify graceful handling
                expect(mockLogger.warn).toHaveBeenCalledWith('Attempt to close non-existent stream', { streamId: nonExistentStreamId });
                expect(mockStreamManager.closeStream).not.toHaveBeenCalled();
            });
        });
        describe('User Story: Handle Stream Errors', () => {
            it('should handle stream errors and cleanup resources', async () => {
                // Arrange - Mock stream error scenario
                mockStreamManager.createStream.mockReturnValue(true);
                mockStreamManager.closeStream.mockReturnValue(undefined);
                mockBufferManager.releaseBuffer.mockReturnValue(undefined);
                mockEventEmitter.emit.mockReturnValue(undefined);
                const streamingHandler = new MockMCPStreamingHandler();
                // Create session
                const session = await streamingHandler.createStreamingSession({
                    jsonrpc: '2.0',
                    id: 'error-test',
                    method: 'error/stream',
                    params: {}
                }, { sessionId: 'session-error', logger: mockLogger });
                const streamError = new Error('Stream processing failed');
                // Act - Handle stream error
                await streamingHandler.handleStreamError(session.id, streamError);
                // Assert - Verify error handling conversation
                expect(mockLogger.error).toHaveBeenCalledWith('Stream error occurred', {
                    streamId: session.id,
                    error: 'Stream processing failed'
                });
                expect(mockMetricsCollector.recordStreamError).toHaveBeenCalledWith(session.id, 'Stream processing failed');
                expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:error', {
                    streamId: session.id,
                    error: streamError
                });
                // Should also cleanup resources
                expect(mockStreamManager.closeStream).toHaveBeenCalledWith(session.id);
                expect(mockBufferManager.releaseBuffer).toHaveBeenCalledWith(session.id);
            });
        });
    });
    describe('🧪 London School Patterns - Streaming Workflow', () => {
        it('should demonstrate complete streaming lifecycle', async () => {
            // Arrange - Mock complete streaming workflow
            mockStreamManager.createStream.mockReturnValue(true);
            mockStreamManager.writeToStream.mockReturnValue(2048);
            mockFlowController.checkBackpressure.mockReturnValue({ shouldPause: false });
            mockStreamManager.closeStream.mockReturnValue(undefined);
            mockBufferManager.releaseBuffer.mockReturnValue(undefined);
            const streamingHandler = new MockMCPStreamingHandler();
            const context = {
                sessionId: 'workflow-session',
                logger: mockLogger
            };
            // Act - Complete streaming workflow
            // 1. Create stream
            const session = await streamingHandler.createStreamingSession({
                jsonrpc: '2.0',
                id: 'workflow-stream',
                method: 'complete/workflow',
                params: { bufferSize: 32768 }
            }, context);
            // 2. Stream multiple chunks
            for (let i = 0; i < 3; i++) {
                await streamingHandler.handleStreamData(session.id, {
                    id: session.id,
                    sequence: i,
                    data: { chunk: i, content: `data-${i}` },
                    isLast: i === 2,
                    timestamp: new Date()
                });
            }
            // Assert - Verify complete workflow conversation (London School focus)
            expect(mockLogger.info).toHaveBeenCalledWith('Creating streaming session', expect.objectContaining({
                streamId: session.id,
                method: 'complete/workflow'
            }));
            expect(mockStreamManager.createStream).toHaveBeenCalledTimes(1);
            expect(mockMetricsCollector.recordStreamCreated).toHaveBeenCalledTimes(1);
            expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:created', expect.any(Object));
            // Verify chunk processing
            expect(mockLogger.debug).toHaveBeenCalledTimes(3); // One per chunk
            expect(mockStreamManager.writeToStream).toHaveBeenCalledTimes(3);
            expect(mockMetricsCollector.recordDataTransfer).toHaveBeenCalledTimes(4); // 3 chunks + 1 summary
            // Verify stream end
            expect(mockEventEmitter.emit).toHaveBeenCalledWith('stream:ended', expect.objectContaining({
                streamId: session.id,
                summary: expect.objectContaining({
                    totalChunks: 3,
                    totalBytes: expect.any(Number)
                })
            }));
        });
    });
    // Clean test isolation - London School principle
    beforeEach(() => {
        jest.clearAllMocks();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9fX3Rlc3RzX18vdW5pdC9sb25kb24vbWNwLXByb3RvY29sL3N0cmVhbWluZy1zdXBwb3J0LnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0dBUUc7QUFFSCxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFRbEYsZ0VBQWdFO0FBRWhFLE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdkIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDekIsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDekIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUM5QixDQUFDO0FBRUYsTUFBTSxpQkFBaUIsR0FBRztJQUN4QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN6QixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN4QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN6QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN0QixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN4QixDQUFDO0FBRUYsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzVCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3RCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3ZCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDM0IsY0FBYyxFQUFFLElBQUksQ0FB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QUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyx1QkFBdUI7WUFFakcsb0JBQW9CO1lBQ3BCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQy9ELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxFQUFFO2dCQUNwQixPQUFPLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO29CQUMvQixXQUFXLEVBQUUsQ0FBQztvQkFDZCxVQUFVLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7aUJBQy9CLENBQUM7YUFDSCxDQUFDLENBQ0gsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxpREFBaUQ7SUFDakQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9taHVnby9jb2RlL2NsYXVkZS1jb2RlLWZsb3cvc3JjL19fdGVzdHNfXy91bml0L2xvbmRvbi9tY3AtcHJvdG9jb2wvc3RyZWFtaW5nLXN1cHBvcnQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBTdHJlYW1pbmcgU3VwcG9ydCAtIFRERCBMb25kb24gU3R5bGVcbiAqIFxuICogVGVzdHMgc3RyZWFtaW5nIGNhcGFiaWxpdGllcyB1c2luZyBMb25kb24gU2Nob29sIHByaW5jaXBsZXM6XG4gKiAtIE1vY2sgc3RyZWFtaW5nIGluZnJhc3RydWN0dXJlIGFuZCBkYXRhIGZsb3dcbiAqIC0gVGVzdCBzdHJlYW1pbmcgcHJvdG9jb2wgY29tcGxpYW5jZSBhbmQgYmFja3ByZXNzdXJlXG4gKiAtIFZlcmlmeSBzdHJlYW0gbGlmZWN5Y2xlIG1hbmFnZW1lbnQgYW5kIGVycm9yIGhhbmRsaW5nXG4gKiAtIEZvY3VzIG9uIHN0cmVhbWluZyBpbnRlcmFjdGlvbnMgYW5kIGNvbnRyYWN0c1xuICovXG5cbmltcG9ydCB7IGplc3QsIGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB0eXBlIHtcbiAgTUNQUmVxdWVzdCxcbiAgTUNQUmVzcG9uc2UsXG4gIE1DUE5vdGlmaWNhdGlvbixcbiAgTUNQQ29udGV4dFxufSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcyc7XG5cbi8vID09PSBNT0NLIERFUEVOREVOQ0lFUyAoTG9uZG9uIFNjaG9vbCBDb250cmFjdCBEZWZpbml0aW9uKSA9PT1cblxuY29uc3QgbW9ja1N0cmVhbU1hbmFnZXIgPSB7XG4gIGNyZWF0ZVN0cmVhbTogamVzdC5mbigpLFxuICBjbG9zZVN0cmVhbTogamVzdC5mbigpLFxuICB3cml0ZVRvU3RyZWFtOiBqZXN0LmZuKCksXG4gIHJlYWRGcm9tU3RyZWFtOiBqZXN0LmZuKCksXG4gIGdldFN0cmVhbVN0YXRlOiBqZXN0LmZuKCksXG4gIGhhbmRsZUJhY2twcmVzc3VyZTogamVzdC5mbigpXG59O1xuXG5jb25zdCBtb2NrQnVmZmVyTWFuYWdlciA9IHtcbiAgYWxsb2NhdGVCdWZmZXI6IGplc3QuZm4oKSxcbiAgcmVsZWFzZUJ1ZmZlcjogamVzdC5mbigpLFxuICBnZXRCdWZmZXJVc2FnZTogamVzdC5mbigpLFxuICBmbHVzaEJ1ZmZlcjogamVzdC5mbigpLFxuICByZXNpemVCdWZmZXI6IGplc3QuZm4oKVxufTtcblxuY29uc3QgbW9ja0Zsb3dDb250cm9sbGVyID0ge1xuICBjaGVja0JhY2twcmVzc3VyZTogamVzdC5mbigpLFxuICBwYXVzZVN0cmVhbTogamVzdC5mbigpLFxuICByZXN1bWVTdHJlYW06IGplc3QuZm4oKSxcbiAgYWRqdXN0QnVmZmVyU2l6ZTogamVzdC5mbigpLFxuICBnZXRGbG93TWV0cmljczogamVzdC5mbigpXG59O1xuXG5jb25zdCBtb2NrTG9nZ2VyID0ge1xuICBkZWJ1ZzogamVzdC5mbigpLFxuICBpbmZvOiBqZXN0LmZuKCksXG4gIHdhcm46IGplc3QuZm4oKSxcbiAgZXJyb3I6IGplc3QuZm4oKVxufTtcblxuY29uc3QgbW9ja01ldHJpY3NDb2xsZWN0b3IgPSB7XG4gIHJlY29yZFN0cmVhbUNyZWF0ZWQ6IGplc3QuZm4oKSxcbiAgcmVjb3JkU3RyZWFtQ2xvc2VkOiBqZXN0LmZuKCksXG4gIHJlY29yZERhdGFUcmFuc2ZlcjogamVzdC5mbigpLFxuICByZWNvcmRCYWNrcHJlc3N1cmVFdmVudDogamVzdC5mbigpLFxuICByZWNvcmRTdHJlYW1FcnJvcjogamVzdC5mbigpXG59O1xuXG5jb25zdCBtb2NrRXZlbnRFbWl0dGVyID0ge1xuICBlbWl0OiBqZXN0LmZuKCksXG4gIG9uOiBqZXN0LmZuKCksXG4gIG9mZjogamVzdC5mbigpLFxuICBvbmNlOiBqZXN0LmZuKClcbn07XG5cbi8vID09PSBDT05UUkFDVCBJTlRFUkZBQ0VTID09PVxuXG5pbnRlcmZhY2UgU3RyZWFtaW5nQ29udHJhY3Qge1xuICBjcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHJlcXVlc3Q6IE1DUFJlcXVlc3QsIGNvbnRleHQ6IE1DUENvbnRleHQpOiBQcm9taXNlPFN0cmVhbVNlc3Npb24+O1xuICBoYW5kbGVTdHJlYW1pbmdSZXF1ZXN0KHJlcXVlc3Q6IE1DUFJlcXVlc3QsIGNvbnRleHQ6IE1DUENvbnRleHQpOiBQcm9taXNlPE1DUFJlc3BvbnNlPjtcbiAgY2xvc2VTdHJlYW1pbmdTZXNzaW9uKHN0cmVhbUlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICBoYW5kbGVTdHJlYW1EYXRhKHN0cmVhbUlkOiBzdHJpbmcsIGRhdGE6IFN0cmVhbURhdGEpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5pbnRlcmZhY2UgU3RyZWFtU2Vzc2lvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHJlcXVlc3RJZDogc3RyaW5nIHwgbnVtYmVyO1xuICBtZXRob2Q6IHN0cmluZztcbiAgc3RhdGU6ICdhY3RpdmUnIHwgJ3BhdXNlZCcgfCAnY2xvc2VkJyB8ICdlcnJvcic7XG4gIGNyZWF0ZWQ6IERhdGU7XG4gIGxhc3RBY3Rpdml0eTogRGF0ZTtcbiAgYnl0ZXNUcmFuc2ZlcnJlZDogbnVtYmVyO1xuICBidWZmZXJTaXplOiBudW1iZXI7XG4gIG1heEJ1ZmZlclNpemU6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFN0cmVhbURhdGEge1xuICBpZDogc3RyaW5nO1xuICBzZXF1ZW5jZTogbnVtYmVyO1xuICBkYXRhOiB1bmtub3duO1xuICBpc0xhc3Q6IGJvb2xlYW47XG4gIHRpbWVzdGFtcDogRGF0ZTtcbn1cblxuaW50ZXJmYWNlIEJhY2twcmVzc3VyZUV2ZW50IHtcbiAgc3RyZWFtSWQ6IHN0cmluZztcbiAgYnVmZmVyVXNhZ2U6IG51bWJlcjtcbiAgdGhyZXNob2xkOiBudW1iZXI7XG4gIGFjdGlvbjogJ3BhdXNlJyB8ICdyZXN1bWUnIHwgJ3Jlc2l6ZSc7XG59XG5cbmludGVyZmFjZSBTdHJlYW1pbmdQcm90b2NvbENvbnRyYWN0IHtcbiAgc3RhcnRTdHJlYW0ocGFyYW1zOiBTdHJlYW1TdGFydFBhcmFtcyk6IFByb21pc2U8U3RyZWFtUmVzcG9uc2U+O1xuICBzdHJlYW1DaHVuayhzdHJlYW1JZDogc3RyaW5nLCBjaHVuazogU3RyZWFtQ2h1bmspOiBQcm9taXNlPHZvaWQ+O1xuICBlbmRTdHJlYW0oc3RyZWFtSWQ6IHN0cmluZywgc3VtbWFyeT86IFN0cmVhbVN1bW1hcnkpOiBQcm9taXNlPHZvaWQ+O1xuICBoYW5kbGVTdHJlYW1FcnJvcihzdHJlYW1JZDogc3RyaW5nLCBlcnJvcjogRXJyb3IpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG5pbnRlcmZhY2UgU3RyZWFtU3RhcnRQYXJhbXMge1xuICBtZXRob2Q6IHN0cmluZztcbiAgYnVmZmVyU2l6ZT86IG51bWJlcjtcbiAgbWF4Q2h1bmtzPzogbnVtYmVyO1xuICBjb21wcmVzc2lvbj86IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBTdHJlYW1SZXNwb25zZSB7XG4gIHN0cmVhbUlkOiBzdHJpbmc7XG4gIGJ1ZmZlclNpemU6IG51bWJlcjtcbiAgcmVhZHlGb3JEYXRhOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgU3RyZWFtQ2h1bmsge1xuICBzZXF1ZW5jZTogbnVtYmVyO1xuICBkYXRhOiB1bmtub3duO1xuICBjaGVja3N1bT86IHN0cmluZztcbiAgaXNMYXN0OiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgU3RyZWFtU3VtbWFyeSB7XG4gIHRvdGFsQ2h1bmtzOiBudW1iZXI7XG4gIHRvdGFsQnl0ZXM6IG51bWJlcjtcbiAgZHVyYXRpb246IG51bWJlcjtcbiAgZXJyb3JzOiBudW1iZXI7XG59XG5cbi8vID09PSBNT0NLIElNUExFTUVOVEFUSU9OID09PVxuXG5jbGFzcyBNb2NrTUNQU3RyZWFtaW5nSGFuZGxlciBpbXBsZW1lbnRzIFN0cmVhbWluZ0NvbnRyYWN0LCBTdHJlYW1pbmdQcm90b2NvbENvbnRyYWN0IHtcbiAgcHJpdmF0ZSBhY3RpdmVTZXNzaW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBTdHJlYW1TZXNzaW9uPigpO1xuICBcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBzdHJlYW1NYW5hZ2VyID0gbW9ja1N0cmVhbU1hbmFnZXIsXG4gICAgcHJpdmF0ZSBidWZmZXJNYW5hZ2VyID0gbW9ja0J1ZmZlck1hbmFnZXIsXG4gICAgcHJpdmF0ZSBmbG93Q29udHJvbGxlciA9IG1vY2tGbG93Q29udHJvbGxlcixcbiAgICBwcml2YXRlIGxvZ2dlciA9IG1vY2tMb2dnZXIsXG4gICAgcHJpdmF0ZSBtZXRyaWNzID0gbW9ja01ldHJpY3NDb2xsZWN0b3IsXG4gICAgcHJpdmF0ZSBldmVudEVtaXR0ZXIgPSBtb2NrRXZlbnRFbWl0dGVyXG4gICkge31cblxuICBhc3luYyBjcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHJlcXVlc3Q6IE1DUFJlcXVlc3QsIGNvbnRleHQ6IE1DUENvbnRleHQpOiBQcm9taXNlPFN0cmVhbVNlc3Npb24+IHtcbiAgICBjb25zdCBzdHJlYW1JZCA9IGBzdHJlYW0tJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA4KX1gO1xuICAgIFxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ0NyZWF0aW5nIHN0cmVhbWluZyBzZXNzaW9uJywgeyBcbiAgICAgIHN0cmVhbUlkLCBcbiAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICBzZXNzaW9uSWQ6IGNvbnRleHQuc2Vzc2lvbklkIFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2Vzc2lvbjogU3RyZWFtU2Vzc2lvbiA9IHtcbiAgICAgIGlkOiBzdHJlYW1JZCxcbiAgICAgIHJlcXVlc3RJZDogcmVxdWVzdC5pZCxcbiAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsXG4gICAgICBzdGF0ZTogJ2FjdGl2ZScsXG4gICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLFxuICAgICAgbGFzdEFjdGl2aXR5OiBuZXcgRGF0ZSgpLFxuICAgICAgYnl0ZXNUcmFuc2ZlcnJlZDogMCxcbiAgICAgIGJ1ZmZlclNpemU6IDY0ICogMTAyNCwgLy8gNjRLQiBkZWZhdWx0XG4gICAgICBtYXhCdWZmZXJTaXplOiAxMDI0ICogMTAyNCAvLyAxTUIgbWF4XG4gICAgfTtcblxuICAgIC8vIEluaXRpYWxpemUgc3RyZWFtIGluZnJhc3RydWN0dXJlXG4gICAgY29uc3Qgc3RyZWFtQ3JlYXRlZCA9IHRoaXMuc3RyZWFtTWFuYWdlci5jcmVhdGVTdHJlYW0oc3RyZWFtSWQsIHtcbiAgICAgIGJ1ZmZlclNpemU6IHNlc3Npb24uYnVmZmVyU2l6ZSxcbiAgICAgIG1heEJ1ZmZlclNpemU6IHNlc3Npb24ubWF4QnVmZmVyU2l6ZVxuICAgIH0pO1xuXG4gICAgaWYgKHN0cmVhbUNyZWF0ZWQpIHtcbiAgICAgIHRoaXMuYWN0aXZlU2Vzc2lvbnMuc2V0KHN0cmVhbUlkLCBzZXNzaW9uKTtcbiAgICAgIHRoaXMubWV0cmljcy5yZWNvcmRTdHJlYW1DcmVhdGVkKHN0cmVhbUlkLCByZXF1ZXN0Lm1ldGhvZCk7XG4gICAgICB0aGlzLmV2ZW50RW1pdHRlci5lbWl0KCdzdHJlYW06Y3JlYXRlZCcsIHsgc3RyZWFtSWQsIHNlc3Npb24gfSk7XG4gICAgICBcbiAgICAgIC8vIFNldHVwIHN0cmVhbSBldmVudCBoYW5kbGVyc1xuICAgICAgdGhpcy5zZXR1cFN0cmVhbUV2ZW50SGFuZGxlcnMoc3RyZWFtSWQpO1xuICAgIH1cblxuICAgIHJldHVybiBzZXNzaW9uO1xuICB9XG5cbiAgYXN5bmMgaGFuZGxlU3RyZWFtaW5nUmVxdWVzdChyZXF1ZXN0OiBNQ1BSZXF1ZXN0LCBjb250ZXh0OiBNQ1BDb250ZXh0KTogUHJvbWlzZTxNQ1BSZXNwb25zZT4ge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdIYW5kbGluZyBzdHJlYW1pbmcgcmVxdWVzdCcsIHsgXG4gICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgaWQ6IHJlcXVlc3QuaWQgXG4gICAgfSk7XG5cbiAgICBzd2l0Y2ggKHJlcXVlc3QubWV0aG9kKSB7XG4gICAgICBjYXNlICdzdHJlYW0vc3RhcnQnOlxuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVTdHJlYW1TdGFydChyZXF1ZXN0LCBjb250ZXh0KTtcbiAgICAgIGNhc2UgJ3N0cmVhbS9kYXRhJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlU3RyZWFtRGF0YShyZXF1ZXN0LnBhcmFtcy5zdHJlYW1JZCwgcmVxdWVzdC5wYXJhbXMuZGF0YSk7XG4gICAgICBjYXNlICdzdHJlYW0vZW5kJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlU3RyZWFtRW5kKHJlcXVlc3QsIGNvbnRleHQpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBzdHJlYW1pbmcgbWV0aG9kOiAke3JlcXVlc3QubWV0aG9kfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNsb3NlU3RyZWFtaW5nU2Vzc2lvbihzdHJlYW1JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5sb2dnZXIuaW5mbygnQ2xvc2luZyBzdHJlYW1pbmcgc2Vzc2lvbicsIHsgc3RyZWFtSWQgfSk7XG5cbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5hY3RpdmVTZXNzaW9ucy5nZXQoc3RyZWFtSWQpO1xuICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignQXR0ZW1wdCB0byBjbG9zZSBub24tZXhpc3RlbnQgc3RyZWFtJywgeyBzdHJlYW1JZCB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDbG9zZSBzdHJlYW0gaW5mcmFzdHJ1Y3R1cmVcbiAgICB0aGlzLnN0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0oc3RyZWFtSWQpO1xuICAgIHRoaXMuYnVmZmVyTWFuYWdlci5yZWxlYXNlQnVmZmVyKHN0cmVhbUlkKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgc2Vzc2lvbiBzdGF0ZVxuICAgIHNlc3Npb24uc3RhdGUgPSAnY2xvc2VkJztcbiAgICB0aGlzLmFjdGl2ZVNlc3Npb25zLmRlbGV0ZShzdHJlYW1JZCk7XG4gICAgXG4gICAgdGhpcy5tZXRyaWNzLnJlY29yZFN0cmVhbUNsb3NlZChzdHJlYW1JZCwgc2Vzc2lvbi5ieXRlc1RyYW5zZmVycmVkKTtcbiAgICB0aGlzLmV2ZW50RW1pdHRlci5lbWl0KCdzdHJlYW06Y2xvc2VkJywgeyBzdHJlYW1JZCwgc2Vzc2lvbiB9KTtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZVN0cmVhbURhdGEoc3RyZWFtSWQ6IHN0cmluZywgZGF0YTogU3RyZWFtRGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLmFjdGl2ZVNlc3Npb25zLmdldChzdHJlYW1JZCk7XG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFN0cmVhbSBub3QgZm91bmQ6ICR7c3RyZWFtSWR9YCk7XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ1Byb2Nlc3Npbmcgc3RyZWFtIGRhdGEnLCB7IFxuICAgICAgc3RyZWFtSWQsIFxuICAgICAgc2VxdWVuY2U6IGRhdGEuc2VxdWVuY2UsXG4gICAgICBpc0xhc3Q6IGRhdGEuaXNMYXN0IFxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgYmFja3ByZXNzdXJlXG4gICAgY29uc3QgYmFja3ByZXNzdXJlQ2hlY2sgPSB0aGlzLmZsb3dDb250cm9sbGVyLmNoZWNrQmFja3ByZXNzdXJlKHN0cmVhbUlkKTtcbiAgICBpZiAoYmFja3ByZXNzdXJlQ2hlY2suc2hvdWxkUGF1c2UpIHtcbiAgICAgIGF3YWl0IHRoaXMuaGFuZGxlQmFja3ByZXNzdXJlKHN0cmVhbUlkLCBiYWNrcHJlc3N1cmVDaGVjay5idWZmZXJVc2FnZSk7XG4gICAgfVxuXG4gICAgLy8gV3JpdGUgZGF0YSB0byBzdHJlYW1cbiAgICBjb25zdCBieXRlc1dyaXR0ZW4gPSB0aGlzLnN0cmVhbU1hbmFnZXIud3JpdGVUb1N0cmVhbShzdHJlYW1JZCwgZGF0YSk7XG4gICAgc2Vzc2lvbi5ieXRlc1RyYW5zZmVycmVkICs9IGJ5dGVzV3JpdHRlbjtcbiAgICBzZXNzaW9uLmxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKCk7XG5cbiAgICB0aGlzLm1ldHJpY3MucmVjb3JkRGF0YVRyYW5zZmVyKHN0cmVhbUlkLCBieXRlc1dyaXR0ZW4pO1xuXG4gICAgLy8gSGFuZGxlIGVuZCBvZiBzdHJlYW1cbiAgICBpZiAoZGF0YS5pc0xhc3QpIHtcbiAgICAgIGF3YWl0IHRoaXMuZW5kU3RyZWFtKHN0cmVhbUlkLCB7XG4gICAgICAgIHRvdGFsQ2h1bmtzOiBkYXRhLnNlcXVlbmNlICsgMSxcbiAgICAgICAgdG90YWxCeXRlczogc2Vzc2lvbi5ieXRlc1RyYW5zZmVycmVkLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHNlc3Npb24uY3JlYXRlZC5nZXRUaW1lKCksXG4gICAgICAgIGVycm9yczogMFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RhcnRTdHJlYW0ocGFyYW1zOiBTdHJlYW1TdGFydFBhcmFtcyk6IFByb21pc2U8U3RyZWFtUmVzcG9uc2U+IHtcbiAgICBjb25zdCBzdHJlYW1JZCA9IGBwcm90b2NvbC1zdHJlYW0tJHtEYXRlLm5vdygpfWA7XG4gICAgXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnU3RhcnRpbmcgcHJvdG9jb2wgc3RyZWFtJywgeyBcbiAgICAgIHN0cmVhbUlkLCBcbiAgICAgIG1ldGhvZDogcGFyYW1zLm1ldGhvZCBcbiAgICB9KTtcblxuICAgIGNvbnN0IGJ1ZmZlclNpemUgPSBwYXJhbXMuYnVmZmVyU2l6ZSB8fCA2NCAqIDEwMjQ7XG4gICAgY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXJNYW5hZ2VyLmFsbG9jYXRlQnVmZmVyKHN0cmVhbUlkLCBidWZmZXJTaXplKTtcbiAgICBcbiAgICBpZiAoYnVmZmVyKSB7XG4gICAgICB0aGlzLmV2ZW50RW1pdHRlci5lbWl0KCdzdHJlYW06cHJvdG9jb2wtc3RhcnRlZCcsIHsgc3RyZWFtSWQsIHBhcmFtcyB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0cmVhbUlkLFxuICAgICAgICBidWZmZXJTaXplLFxuICAgICAgICByZWFkeUZvckRhdGE6IHRydWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gYWxsb2NhdGUgc3RyZWFtIGJ1ZmZlcicpO1xuICB9XG5cbiAgYXN5bmMgc3RyZWFtQ2h1bmsoc3RyZWFtSWQ6IHN0cmluZywgY2h1bms6IFN0cmVhbUNodW5rKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ1Byb2Nlc3Npbmcgc3RyZWFtIGNodW5rJywgeyBcbiAgICAgIHN0cmVhbUlkLCBcbiAgICAgIHNlcXVlbmNlOiBjaHVuay5zZXF1ZW5jZSxcbiAgICAgIGlzTGFzdDogY2h1bmsuaXNMYXN0IFxuICAgIH0pO1xuXG4gICAgLy8gVmFsaWRhdGUgY2h1bmsgc2VxdWVuY2VcbiAgICBpZiAoY2h1bmsuc2VxdWVuY2UgPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2h1bmsgc2VxdWVuY2U6ICR7Y2h1bmsuc2VxdWVuY2V9YCk7XG4gICAgfVxuXG4gICAgLy8gUHJvY2VzcyBjaHVuayBkYXRhXG4gICAgY29uc3QgcHJvY2Vzc2VkID0gdGhpcy5zdHJlYW1NYW5hZ2VyLndyaXRlVG9TdHJlYW0oc3RyZWFtSWQsIHtcbiAgICAgIGlkOiBzdHJlYW1JZCxcbiAgICAgIHNlcXVlbmNlOiBjaHVuay5zZXF1ZW5jZSxcbiAgICAgIGRhdGE6IGNodW5rLmRhdGEsXG4gICAgICBpc0xhc3Q6IGNodW5rLmlzTGFzdCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgIH0pO1xuXG4gICAgaWYgKCFwcm9jZXNzZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHByb2Nlc3MgY2h1bmsgJHtjaHVuay5zZXF1ZW5jZX0gZm9yIHN0cmVhbSAke3N0cmVhbUlkfWApO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQoJ3N0cmVhbTpjaHVuay1wcm9jZXNzZWQnLCB7IHN0cmVhbUlkLCBjaHVuayB9KTtcbiAgfVxuXG4gIGFzeW5jIGVuZFN0cmVhbShzdHJlYW1JZDogc3RyaW5nLCBzdW1tYXJ5PzogU3RyZWFtU3VtbWFyeSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMubG9nZ2VyLmluZm8oJ0VuZGluZyBzdHJlYW0nLCB7IHN0cmVhbUlkLCBzdW1tYXJ5IH0pO1xuXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuYWN0aXZlU2Vzc2lvbnMuZ2V0KHN0cmVhbUlkKTtcbiAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgc2Vzc2lvbi5zdGF0ZSA9ICdjbG9zZWQnO1xuICAgIH1cblxuICAgIHRoaXMuc3RyZWFtTWFuYWdlci5jbG9zZVN0cmVhbShzdHJlYW1JZCk7XG4gICAgdGhpcy5idWZmZXJNYW5hZ2VyLnJlbGVhc2VCdWZmZXIoc3RyZWFtSWQpO1xuICAgIFxuICAgIGlmIChzdW1tYXJ5KSB7XG4gICAgICB0aGlzLm1ldHJpY3MucmVjb3JkRGF0YVRyYW5zZmVyKHN0cmVhbUlkLCBzdW1tYXJ5LnRvdGFsQnl0ZXMpO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLmVtaXQoJ3N0cmVhbTplbmRlZCcsIHsgc3RyZWFtSWQsIHN1bW1hcnkgfSk7XG4gIH1cblxuICBhc3luYyBoYW5kbGVTdHJlYW1FcnJvcihzdHJlYW1JZDogc3RyaW5nLCBlcnJvcjogRXJyb3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmxvZ2dlci5lcnJvcignU3RyZWFtIGVycm9yIG9jY3VycmVkJywgeyBcbiAgICAgIHN0cmVhbUlkLCBcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlIFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuYWN0aXZlU2Vzc2lvbnMuZ2V0KHN0cmVhbUlkKTtcbiAgICBpZiAoc2Vzc2lvbikge1xuICAgICAgc2Vzc2lvbi5zdGF0ZSA9ICdlcnJvcic7XG4gICAgfVxuXG4gICAgdGhpcy5tZXRyaWNzLnJlY29yZFN0cmVhbUVycm9yKHN0cmVhbUlkLCBlcnJvci5tZXNzYWdlKTtcbiAgICB0aGlzLmV2ZW50RW1pdHRlci5lbWl0KCdzdHJlYW06ZXJyb3InLCB7IHN0cmVhbUlkLCBlcnJvciB9KTtcblxuICAgIC8vIENsZWFudXAgcmVzb3VyY2VzXG4gICAgYXdhaXQgdGhpcy5jbG9zZVN0cmVhbWluZ1Nlc3Npb24oc3RyZWFtSWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVTdHJlYW1TdGFydChyZXF1ZXN0OiBNQ1BSZXF1ZXN0LCBjb250ZXh0OiBNQ1BDb250ZXh0KTogUHJvbWlzZTxNQ1BSZXNwb25zZT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB0aGlzLmNyZWF0ZVN0cmVhbWluZ1Nlc3Npb24ocmVxdWVzdCwgY29udGV4dCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgaWQ6IHJlcXVlc3QuaWQsXG4gICAgICByZXN1bHQ6IHtcbiAgICAgICAgc3RyZWFtSWQ6IHNlc3Npb24uaWQsXG4gICAgICAgIGJ1ZmZlclNpemU6IHNlc3Npb24uYnVmZmVyU2l6ZSxcbiAgICAgICAgbWF4QnVmZmVyU2l6ZTogc2Vzc2lvbi5tYXhCdWZmZXJTaXplLFxuICAgICAgICBzdGF0ZTogc2Vzc2lvbi5zdGF0ZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGhhbmRsZVN0cmVhbUVuZChyZXF1ZXN0OiBNQ1BSZXF1ZXN0LCBjb250ZXh0OiBNQ1BDb250ZXh0KTogUHJvbWlzZTxNQ1BSZXNwb25zZT4ge1xuICAgIGNvbnN0IHsgc3RyZWFtSWQgfSA9IHJlcXVlc3QucGFyYW1zO1xuICAgIGF3YWl0IHRoaXMuY2xvc2VTdHJlYW1pbmdTZXNzaW9uKHN0cmVhbUlkKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICBpZDogcmVxdWVzdC5pZCxcbiAgICAgIHJlc3VsdDogeyBcbiAgICAgICAgc3RyZWFtSWQsIFxuICAgICAgICBjbG9zZWQ6IHRydWUgXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaGFuZGxlQmFja3ByZXNzdXJlKHN0cmVhbUlkOiBzdHJpbmcsIGJ1ZmZlclVzYWdlOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmxvZ2dlci53YXJuKCdCYWNrcHJlc3N1cmUgZGV0ZWN0ZWQnLCB7IHN0cmVhbUlkLCBidWZmZXJVc2FnZSB9KTtcblxuICAgIGNvbnN0IGJhY2twcmVzc3VyZUV2ZW50OiBCYWNrcHJlc3N1cmVFdmVudCA9IHtcbiAgICAgIHN0cmVhbUlkLFxuICAgICAgYnVmZmVyVXNhZ2UsXG4gICAgICB0aHJlc2hvbGQ6IDAuOCwgLy8gODAlIHRocmVzaG9sZFxuICAgICAgYWN0aW9uOiAncGF1c2UnXG4gICAgfTtcblxuICAgIHRoaXMubWV0cmljcy5yZWNvcmRCYWNrcHJlc3N1cmVFdmVudChzdHJlYW1JZCwgYnVmZmVyVXNhZ2UpO1xuICAgIHRoaXMuZmxvd0NvbnRyb2xsZXIucGF1c2VTdHJlYW0oc3RyZWFtSWQpO1xuICAgIFxuICAgIC8vIFRyeSB0byByZXNpemUgYnVmZmVyIGlmIHBvc3NpYmxlXG4gICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuYWN0aXZlU2Vzc2lvbnMuZ2V0KHN0cmVhbUlkKTtcbiAgICBpZiAoc2Vzc2lvbiAmJiBzZXNzaW9uLmJ1ZmZlclNpemUgPCBzZXNzaW9uLm1heEJ1ZmZlclNpemUpIHtcbiAgICAgIGNvbnN0IG5ld1NpemUgPSBNYXRoLm1pbihzZXNzaW9uLmJ1ZmZlclNpemUgKiAyLCBzZXNzaW9uLm1heEJ1ZmZlclNpemUpO1xuICAgICAgdGhpcy5idWZmZXJNYW5hZ2VyLnJlc2l6ZUJ1ZmZlcihzdHJlYW1JZCwgbmV3U2l6ZSk7XG4gICAgICBzZXNzaW9uLmJ1ZmZlclNpemUgPSBuZXdTaXplO1xuICAgICAgYmFja3ByZXNzdXJlRXZlbnQuYWN0aW9uID0gJ3Jlc2l6ZSc7XG4gICAgfVxuXG4gICAgdGhpcy5ldmVudEVtaXR0ZXIuZW1pdCgnc3RyZWFtOmJhY2twcmVzc3VyZScsIGJhY2twcmVzc3VyZUV2ZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBTdHJlYW1FdmVudEhhbmRsZXJzKHN0cmVhbUlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBTZXR1cCBldmVudCBoYW5kbGVycyBmb3Igc3RyZWFtIGxpZmVjeWNsZVxuICAgIHRoaXMuZXZlbnRFbWl0dGVyLm9uKGBzdHJlYW06JHtzdHJlYW1JZH06ZGF0YWAsIChkYXRhKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZVN0cmVhbURhdGEoc3RyZWFtSWQsIGRhdGEpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5ldmVudEVtaXR0ZXIub24oYHN0cmVhbToke3N0cmVhbUlkfTplcnJvcmAsIChlcnJvcikgPT4ge1xuICAgICAgdGhpcy5oYW5kbGVTdHJlYW1FcnJvcihzdHJlYW1JZCwgZXJyb3IpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5ldmVudEVtaXR0ZXIub24oYHN0cmVhbToke3N0cmVhbUlkfTpjbG9zZWAsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VTdHJlYW1pbmdTZXNzaW9uKHN0cmVhbUlkKTtcbiAgICB9KTtcbiAgfVxufVxuXG5kZXNjcmliZSgnTUNQIFN0cmVhbWluZyBTdXBwb3J0IC0gTG9uZG9uIFRERCcsICgpID0+IHtcbiAgXG4gIGRlc2NyaWJlKCfwn46vIEFjY2VwdGFuY2UgVGVzdHMgLSBTdHJlYW0gQ3JlYXRpb24nLCAoKSA9PiB7XG4gICAgXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IENyZWF0ZSBTdHJlYW1pbmcgU2Vzc2lvbicsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIHN0cmVhbWluZyBzZXNzaW9uIHdpdGggcHJvcGVyIGluaXRpYWxpemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBzdWNjZXNzZnVsIHN0cmVhbSBjcmVhdGlvblxuICAgICAgICBtb2NrU3RyZWFtTWFuYWdlci5jcmVhdGVTdHJlYW0ubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgICBtb2NrQnVmZmVyTWFuYWdlci5hbGxvY2F0ZUJ1ZmZlci5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICAgIG1vY2tFdmVudEVtaXR0ZXIuZW1pdC5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgICBjb25zdCBzdHJlYW1pbmdIYW5kbGVyID0gbmV3IE1vY2tNQ1BTdHJlYW1pbmdIYW5kbGVyKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzdHJlYW1SZXF1ZXN0OiBNQ1BSZXF1ZXN0ID0ge1xuICAgICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICAgIGlkOiAnc3RyZWFtLWNyZWF0ZS0xJyxcbiAgICAgICAgICBtZXRob2Q6ICdzdHJlYW0vc3RhcnQnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgYnVmZmVyU2l6ZTogMTI4ICogMTAyNCwgLy8gMTI4S0JcbiAgICAgICAgICAgIG1heENodW5rczogMTAwMFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjb250ZXh0OiBNQ1BDb250ZXh0ID0ge1xuICAgICAgICAgIHNlc3Npb25JZDogJ3Nlc3Npb24tc3RyZWFtJyxcbiAgICAgICAgICBsb2dnZXI6IG1vY2tMb2dnZXJcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBY3QgLSBDcmVhdGUgc3RyZWFtaW5nIHNlc3Npb25cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuY3JlYXRlU3RyZWFtaW5nU2Vzc2lvbihzdHJlYW1SZXF1ZXN0LCBjb250ZXh0KTtcblxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgc3RyZWFtIGNyZWF0aW9uIGNvbnZlcnNhdGlvblxuICAgICAgICBleHBlY3QobW9ja0xvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICAnQ3JlYXRpbmcgc3RyZWFtaW5nIHNlc3Npb24nLFxuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHN0cmVhbUlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgICAgbWV0aG9kOiAnc3RyZWFtL3N0YXJ0JyxcbiAgICAgICAgICAgIHNlc3Npb25JZDogJ3Nlc3Npb24tc3RyZWFtJ1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrU3RyZWFtTWFuYWdlci5jcmVhdGVTdHJlYW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHNlc3Npb24uaWQsXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgYnVmZmVyU2l6ZTogZXhwZWN0LmFueShOdW1iZXIpLFxuICAgICAgICAgICAgbWF4QnVmZmVyU2l6ZTogZXhwZWN0LmFueShOdW1iZXIpXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tNZXRyaWNzQ29sbGVjdG9yLnJlY29yZFN0cmVhbUNyZWF0ZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHNlc3Npb24uaWQsXG4gICAgICAgICAgJ3N0cmVhbS9zdGFydCdcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFdmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0cmVhbTpjcmVhdGVkJywge1xuICAgICAgICAgIHN0cmVhbUlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIHNlc3Npb25cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3Qoc2Vzc2lvbi5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHNlc3Npb24uc3RhdGUpLnRvQmUoJ2FjdGl2ZScpO1xuICAgICAgICBleHBlY3Qoc2Vzc2lvbi5tZXRob2QpLnRvQmUoJ3N0cmVhbS9zdGFydCcpO1xuICAgICAgICBleHBlY3Qoc2Vzc2lvbi5ieXRlc1RyYW5zZmVycmVkKS50b0JlKDApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0cmVhbSBjcmVhdGlvbiBmYWlsdXJlIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEFycmFuZ2UgLSBNb2NrIHN0cmVhbSBjcmVhdGlvbiBmYWlsdXJlXG4gICAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLmNyZWF0ZVN0cmVhbS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuXG4gICAgICAgIGNvbnN0IHN0cmVhbWluZ0hhbmRsZXIgPSBuZXcgTW9ja01DUFN0cmVhbWluZ0hhbmRsZXIoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGZhaWxlZFN0cmVhbVJlcXVlc3Q6IE1DUFJlcXVlc3QgPSB7XG4gICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgaWQ6ICdzdHJlYW0tZmFpbC0xJyxcbiAgICAgICAgICBtZXRob2Q6ICdzdHJlYW0vc3RhcnQnLFxuICAgICAgICAgIHBhcmFtczogeyBidWZmZXJTaXplOiAxMDI0IH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBjb250ZXh0OiBNQ1BDb250ZXh0ID0ge1xuICAgICAgICAgIHNlc3Npb25JZDogJ3Nlc3Npb24tZmFpbCcsXG4gICAgICAgICAgbG9nZ2VyOiBtb2NrTG9nZ2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWN0IC0gQXR0ZW1wdCB0byBjcmVhdGUgZmFpbGluZyBzdHJlYW1cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuY3JlYXRlU3RyZWFtaW5nU2Vzc2lvbihmYWlsZWRTdHJlYW1SZXF1ZXN0LCBjb250ZXh0KTtcblxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgZmFpbHVyZSBoYW5kbGluZ1xuICAgICAgICBleHBlY3QobW9ja1N0cmVhbU1hbmFnZXIuY3JlYXRlU3RyZWFtKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrTWV0cmljc0NvbGxlY3Rvci5yZWNvcmRTdHJlYW1DcmVhdGVkKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAvLyBTZXNzaW9uIHNob3VsZCBzdGlsbCBiZSBjcmVhdGVkIGJ1dCBub3QgYWN0aXZlIGluIHRoZSBpbmZyYXN0cnVjdHVyZVxuICAgICAgICBleHBlY3Qoc2Vzc2lvbi5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IEhhbmRsZSBTdHJlYW0gU3RhcnQgUHJvdG9jb2wnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHByb2Nlc3Mgc3RyZWFtL3N0YXJ0IHJlcXVlc3RzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgc3RyZWFtIHN0YXJ0IHByb3RvY29sXG4gICAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLmNyZWF0ZVN0cmVhbS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICAgIG1vY2tFdmVudEVtaXR0ZXIuZW1pdC5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgICBjb25zdCBzdHJlYW1pbmdIYW5kbGVyID0gbmV3IE1vY2tNQ1BTdHJlYW1pbmdIYW5kbGVyKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzdHJlYW1TdGFydFJlcXVlc3Q6IE1DUFJlcXVlc3QgPSB7XG4gICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgaWQ6ICdwcm90b2NvbC1zdGFydC0xJyxcbiAgICAgICAgICBtZXRob2Q6ICdzdHJlYW0vc3RhcnQnLFxuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgbWV0aG9kOiAnZGF0YS9leHBvcnQnLFxuICAgICAgICAgICAgYnVmZmVyU2l6ZTogMjU2ICogMTAyNCxcbiAgICAgICAgICAgIGNvbXByZXNzaW9uOiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGNvbnRleHQ6IE1DUENvbnRleHQgPSB7XG4gICAgICAgICAgc2Vzc2lvbklkOiAnc2Vzc2lvbi1wcm90b2NvbCcsXG4gICAgICAgICAgbG9nZ2VyOiBtb2NrTG9nZ2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWN0IC0gSGFuZGxlIHN0cmVhbSBzdGFydCByZXF1ZXN0XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5oYW5kbGVTdHJlYW1pbmdSZXF1ZXN0KHN0cmVhbVN0YXJ0UmVxdWVzdCwgY29udGV4dCk7XG5cbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IHN0cmVhbSBzdGFydCBwcm90b2NvbCBoYW5kbGluZ1xuICAgICAgICBleHBlY3QobW9ja0xvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ0hhbmRsaW5nIHN0cmVhbWluZyByZXF1ZXN0JyxcbiAgICAgICAgICB7IG1ldGhvZDogJ3N0cmVhbS9zdGFydCcsIGlkOiAncHJvdG9jb2wtc3RhcnQtMScgfVxuICAgICAgICApO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuanNvbnJwYykudG9CZSgnMi4wJyk7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5pZCkudG9CZSgncHJvdG9jb2wtc3RhcnQtMScpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UucmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UucmVzdWx0LnN0cmVhbUlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UucmVzdWx0LnN0YXRlKS50b0JlKCdhY3RpdmUnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn8J+MiiBBY2NlcHRhbmNlIFRlc3RzIC0gRGF0YSBTdHJlYW1pbmcnLCAoKSA9PiB7XG4gICAgXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IFN0cmVhbSBEYXRhIENodW5rcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvY2VzcyBkYXRhIGNodW5rcyBpbiBzZXF1ZW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgZGF0YSBjaHVuayBwcm9jZXNzaW5nXG4gICAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLndyaXRlVG9TdHJlYW0ubW9ja1JldHVyblZhbHVlKDEwMjQpOyAvLyAxS0Igd3JpdHRlblxuICAgICAgICBtb2NrRmxvd0NvbnRyb2xsZXIuY2hlY2tCYWNrcHJlc3N1cmUubW9ja1JldHVyblZhbHVlKHsgc2hvdWxkUGF1c2U6IGZhbHNlIH0pO1xuICAgICAgICBtb2NrRXZlbnRFbWl0dGVyLmVtaXQubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgICAgY29uc3Qgc3RyZWFtaW5nSGFuZGxlciA9IG5ldyBNb2NrTUNQU3RyZWFtaW5nSGFuZGxlcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gRmlyc3QgY3JlYXRlIGEgc2Vzc2lvblxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5jcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHtcbiAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICBpZDogJ2NodW5rLXRlc3QnLFxuICAgICAgICAgIG1ldGhvZDogJ2RhdGEvc3RyZWFtJyxcbiAgICAgICAgICBwYXJhbXM6IHt9XG4gICAgICAgIH0sIHsgc2Vzc2lvbklkOiAnc2Vzc2lvbi1jaHVua3MnLCBsb2dnZXI6IG1vY2tMb2dnZXIgfSk7XG5cbiAgICAgICAgY29uc3QgY2h1bmtEYXRhOiBTdHJlYW1EYXRhID0ge1xuICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIHNlcXVlbmNlOiAxLFxuICAgICAgICAgIGRhdGE6IHsgY29udGVudDogJ3Rlc3QgZGF0YSBjaHVuaycsIHNpemU6IDEwMjQgfSxcbiAgICAgICAgICBpc0xhc3Q6IGZhbHNlLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFjdCAtIFByb2Nlc3MgZGF0YSBjaHVua1xuICAgICAgICBhd2FpdCBzdHJlYW1pbmdIYW5kbGVyLmhhbmRsZVN0cmVhbURhdGEoc2Vzc2lvbi5pZCwgY2h1bmtEYXRhKTtcblxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgY2h1bmsgcHJvY2Vzc2luZ1xuICAgICAgICBleHBlY3QobW9ja0xvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1Byb2Nlc3Npbmcgc3RyZWFtIGRhdGEnLFxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBzdHJlYW1JZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgICAgIHNlcXVlbmNlOiAxLFxuICAgICAgICAgICAgaXNMYXN0OiBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tGbG93Q29udHJvbGxlci5jaGVja0JhY2twcmVzc3VyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCk7XG4gICAgICAgIGV4cGVjdChtb2NrU3RyZWFtTWFuYWdlci53cml0ZVRvU3RyZWFtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzZXNzaW9uLmlkLCBjaHVua0RhdGEpO1xuICAgICAgICBleHBlY3QobW9ja01ldHJpY3NDb2xsZWN0b3IucmVjb3JkRGF0YVRyYW5zZmVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzZXNzaW9uLmlkLCAxMDI0KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGhhbmRsZSBsYXN0IGNodW5rIGFuZCBlbmQgc3RyZWFtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBsYXN0IGNodW5rIHByb2Nlc3NpbmdcbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIud3JpdGVUb1N0cmVhbS5tb2NrUmV0dXJuVmFsdWUoNTEyKTtcbiAgICAgICAgbW9ja0Zsb3dDb250cm9sbGVyLmNoZWNrQmFja3ByZXNzdXJlLm1vY2tSZXR1cm5WYWx1ZSh7IHNob3VsZFBhdXNlOiBmYWxzZSB9KTtcbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0ubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tCdWZmZXJNYW5hZ2VyLnJlbGVhc2VCdWZmZXIubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgICAgY29uc3Qgc3RyZWFtaW5nSGFuZGxlciA9IG5ldyBNb2NrTUNQU3RyZWFtaW5nSGFuZGxlcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIHNlc3Npb25cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuY3JlYXRlU3RyZWFtaW5nU2Vzc2lvbih7XG4gICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgaWQ6ICdsYXN0LWNodW5rLXRlc3QnLFxuICAgICAgICAgIG1ldGhvZDogJ2RhdGEvc3RyZWFtJyxcbiAgICAgICAgICBwYXJhbXM6IHt9XG4gICAgICAgIH0sIHsgc2Vzc2lvbklkOiAnc2Vzc2lvbi1sYXN0JywgbG9nZ2VyOiBtb2NrTG9nZ2VyIH0pO1xuXG4gICAgICAgIGNvbnN0IGxhc3RDaHVua0RhdGE6IFN0cmVhbURhdGEgPSB7XG4gICAgICAgICAgaWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgc2VxdWVuY2U6IDUsXG4gICAgICAgICAgZGF0YTogeyBjb250ZW50OiAnZmluYWwgY2h1bmsnLCBzaXplOiA1MTIgfSxcbiAgICAgICAgICBpc0xhc3Q6IHRydWUsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWN0IC0gUHJvY2VzcyBsYXN0IGNodW5rXG4gICAgICAgIGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuaGFuZGxlU3RyZWFtRGF0YShzZXNzaW9uLmlkLCBsYXN0Q2h1bmtEYXRhKTtcblxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgbGFzdCBjaHVuayBoYW5kbGluZyBhbmQgc3RyZWFtIGVuZFxuICAgICAgICBleHBlY3QobW9ja1N0cmVhbU1hbmFnZXIud3JpdGVUb1N0cmVhbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCwgbGFzdENodW5rRGF0YSk7XG4gICAgICAgIGV4cGVjdChtb2NrRXZlbnRFbWl0dGVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdHJlYW06ZW5kZWQnLCB7XG4gICAgICAgICAgc3RyZWFtSWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgc3VtbWFyeTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdG90YWxDaHVua3M6IDYsIC8vIHNlcXVlbmNlIDUgKyAxXG4gICAgICAgICAgICB0b3RhbEJ5dGVzOiBleHBlY3QuYW55KE51bWJlciksXG4gICAgICAgICAgICBkdXJhdGlvbjogZXhwZWN0LmFueShOdW1iZXIpLFxuICAgICAgICAgICAgZXJyb3JzOiAwXG4gICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdVc2VyIFN0b3J5OiBIYW5kbGUgUHJvdG9jb2wgU3RyZWFtIENodW5rcycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgcHJvY2VzcyBwcm90b2NvbCBzdHJlYW0gY2h1bmtzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgcHJvdG9jb2wgY2h1bmsgcHJvY2Vzc2luZ1xuICAgICAgICBtb2NrQnVmZmVyTWFuYWdlci5hbGxvY2F0ZUJ1ZmZlci5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLndyaXRlVG9TdHJlYW0ubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgICBtb2NrRXZlbnRFbWl0dGVyLmVtaXQubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgICAgY29uc3Qgc3RyZWFtaW5nSGFuZGxlciA9IG5ldyBNb2NrTUNQU3RyZWFtaW5nSGFuZGxlcigpO1xuICAgICAgICBcbiAgICAgICAgLy8gU3RhcnQgcHJvdG9jb2wgc3RyZWFtXG4gICAgICAgIGNvbnN0IHN0cmVhbVJlc3BvbnNlID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5zdGFydFN0cmVhbSh7XG4gICAgICAgICAgbWV0aG9kOiAnYW5hbHlzaXMvc3RyZWFtJyxcbiAgICAgICAgICBidWZmZXJTaXplOiA2NCAqIDEwMjQsXG4gICAgICAgICAgY29tcHJlc3Npb246IGZhbHNlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNodW5rOiBTdHJlYW1DaHVuayA9IHtcbiAgICAgICAgICBzZXF1ZW5jZTogMSxcbiAgICAgICAgICBkYXRhOiB7IGFuYWx5c2lzOiAnY29kZSBxdWFsaXR5IGNoZWNrJywgcmVzdWx0czogWzEsIDIsIDNdIH0sXG4gICAgICAgICAgY2hlY2tzdW06ICdhYmMxMjMnLFxuICAgICAgICAgIGlzTGFzdDogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBBY3QgLSBQcm9jZXNzIHByb3RvY29sIGNodW5rXG4gICAgICAgIGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuc3RyZWFtQ2h1bmsoc3RyZWFtUmVzcG9uc2Uuc3RyZWFtSWQsIGNodW5rKTtcblxuICAgICAgICAvLyBBc3NlcnQgLSBWZXJpZnkgcHJvdG9jb2wgY2h1bmsgcHJvY2Vzc2luZ1xuICAgICAgICBleHBlY3QobW9ja0xvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1Byb2Nlc3Npbmcgc3RyZWFtIGNodW5rJyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdHJlYW1JZDogc3RyZWFtUmVzcG9uc2Uuc3RyZWFtSWQsXG4gICAgICAgICAgICBzZXF1ZW5jZTogMSxcbiAgICAgICAgICAgIGlzTGFzdDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrU3RyZWFtTWFuYWdlci53cml0ZVRvU3RyZWFtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBzdHJlYW1SZXNwb25zZS5zdHJlYW1JZCxcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBpZDogc3RyZWFtUmVzcG9uc2Uuc3RyZWFtSWQsXG4gICAgICAgICAgICBzZXF1ZW5jZTogMSxcbiAgICAgICAgICAgIGRhdGE6IGNodW5rLmRhdGEsXG4gICAgICAgICAgICBpc0xhc3Q6IGZhbHNlXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFdmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0cmVhbTpjaHVuay1wcm9jZXNzZWQnLCB7XG4gICAgICAgICAgc3RyZWFtSWQ6IHN0cmVhbVJlc3BvbnNlLnN0cmVhbUlkLFxuICAgICAgICAgIGNodW5rXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY2h1bmsgc2VxdWVuY2UgbnVtYmVycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgaW52YWxpZCBjaHVuayBzZXF1ZW5jZVxuICAgICAgICBjb25zdCBzdHJlYW1pbmdIYW5kbGVyID0gbmV3IE1vY2tNQ1BTdHJlYW1pbmdIYW5kbGVyKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzdHJlYW1SZXNwb25zZSA9IGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuc3RhcnRTdHJlYW0oe1xuICAgICAgICAgIG1ldGhvZDogJ3ZhbGlkYXRpb24vc3RyZWFtJ1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBpbnZhbGlkQ2h1bms6IFN0cmVhbUNodW5rID0ge1xuICAgICAgICAgIHNlcXVlbmNlOiAtMSwgLy8gSW52YWxpZCBzZXF1ZW5jZVxuICAgICAgICAgIGRhdGE6IHsgdGVzdDogJ2RhdGEnIH0sXG4gICAgICAgICAgaXNMYXN0OiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFjdCAmIEFzc2VydCAtIFNob3VsZCB0aHJvdyBlcnJvciBmb3IgaW52YWxpZCBzZXF1ZW5jZVxuICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgc3RyZWFtaW5nSGFuZGxlci5zdHJlYW1DaHVuayhzdHJlYW1SZXNwb25zZS5zdHJlYW1JZCwgaW52YWxpZENodW5rKVxuICAgICAgICApLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCBjaHVuayBzZXF1ZW5jZTogLTEnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn8J+asCBBY2NlcHRhbmNlIFRlc3RzIC0gQmFja3ByZXNzdXJlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgXG4gICAgZGVzY3JpYmUoJ1VzZXIgU3Rvcnk6IEhhbmRsZSBCdWZmZXIgQmFja3ByZXNzdXJlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBkZXRlY3QgYW5kIGhhbmRsZSBiYWNrcHJlc3N1cmUgZXZlbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBiYWNrcHJlc3N1cmUgc2NlbmFyaW9cbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY3JlYXRlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgICAgbW9ja0Zsb3dDb250cm9sbGVyLmNoZWNrQmFja3ByZXNzdXJlLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc2hvdWxkUGF1c2U6IHRydWUsXG4gICAgICAgICAgYnVmZmVyVXNhZ2U6IDAuODUgLy8gODUlIGJ1ZmZlciB1c2FnZVxuICAgICAgICB9KTtcbiAgICAgICAgbW9ja0Zsb3dDb250cm9sbGVyLnBhdXNlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgICBtb2NrQnVmZmVyTWFuYWdlci5yZXNpemVCdWZmZXIubW9ja1JldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICAgIGNvbnN0IHN0cmVhbWluZ0hhbmRsZXIgPSBuZXcgTW9ja01DUFN0cmVhbWluZ0hhbmRsZXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBzZXNzaW9uXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBzdHJlYW1pbmdIYW5kbGVyLmNyZWF0ZVN0cmVhbWluZ1Nlc3Npb24oe1xuICAgICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICAgIGlkOiAnYmFja3ByZXNzdXJlLXRlc3QnLFxuICAgICAgICAgIG1ldGhvZDogJ2hlYXZ5L3N0cmVhbScsXG4gICAgICAgICAgcGFyYW1zOiB7fVxuICAgICAgICB9LCB7IHNlc3Npb25JZDogJ3Nlc3Npb24tYmFja3ByZXNzdXJlJywgbG9nZ2VyOiBtb2NrTG9nZ2VyIH0pO1xuXG4gICAgICAgIGNvbnN0IGhlYXZ5RGF0YTogU3RyZWFtRGF0YSA9IHtcbiAgICAgICAgICBpZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgICBzZXF1ZW5jZTogMSxcbiAgICAgICAgICBkYXRhOiB7IGhlYXZ5UGF5bG9hZDogJ3gnLnJlcGVhdCg1MDAwMCkgfSwgLy8gTGFyZ2UgcGF5bG9hZFxuICAgICAgICAgIGlzTGFzdDogZmFsc2UsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWN0IC0gUHJvY2VzcyBkYXRhIHRoYXQgdHJpZ2dlcnMgYmFja3ByZXNzdXJlXG4gICAgICAgIGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuaGFuZGxlU3RyZWFtRGF0YShzZXNzaW9uLmlkLCBoZWF2eURhdGEpO1xuXG4gICAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSBiYWNrcHJlc3N1cmUgaGFuZGxpbmdcbiAgICAgICAgZXhwZWN0KG1vY2tGbG93Q29udHJvbGxlci5jaGVja0JhY2twcmVzc3VyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCk7XG4gICAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdCYWNrcHJlc3N1cmUgZGV0ZWN0ZWQnLFxuICAgICAgICAgIHsgc3RyZWFtSWQ6IHNlc3Npb24uaWQsIGJ1ZmZlclVzYWdlOiAwLjg1IH1cbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tNZXRyaWNzQ29sbGVjdG9yLnJlY29yZEJhY2twcmVzc3VyZUV2ZW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgICBzZXNzaW9uLmlkLFxuICAgICAgICAgIDAuODVcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tGbG93Q29udHJvbGxlci5wYXVzZVN0cmVhbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCk7XG4gICAgICAgIGV4cGVjdChtb2NrRXZlbnRFbWl0dGVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdHJlYW06YmFja3ByZXNzdXJlJywgXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgc3RyZWFtSWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgICBidWZmZXJVc2FnZTogMC44NSxcbiAgICAgICAgICAgIGFjdGlvbjogZXhwZWN0LmFueShTdHJpbmcpXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJlc2l6ZSBidWZmZXJzIHdoZW4gcG9zc2libGUgZHVyaW5nIGJhY2twcmVzc3VyZScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgYnVmZmVyIHJlc2l6ZSBzY2VuYXJpb1xuICAgICAgICBtb2NrU3RyZWFtTWFuYWdlci5jcmVhdGVTdHJlYW0ubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgICBtb2NrRmxvd0NvbnRyb2xsZXIuY2hlY2tCYWNrcHJlc3N1cmUubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBzaG91bGRQYXVzZTogdHJ1ZSxcbiAgICAgICAgICBidWZmZXJVc2FnZTogMC45XG4gICAgICAgIH0pO1xuICAgICAgICBtb2NrQnVmZmVyTWFuYWdlci5yZXNpemVCdWZmZXIubW9ja1JldHVyblZhbHVlKHRydWUpO1xuXG4gICAgICAgIGNvbnN0IHN0cmVhbWluZ0hhbmRsZXIgPSBuZXcgTW9ja01DUFN0cmVhbWluZ0hhbmRsZXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBzZXNzaW9uIHdpdGggcm9vbSBmb3IgYnVmZmVyIGdyb3d0aFxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5jcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHtcbiAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICBpZDogJ3Jlc2l6ZS10ZXN0JyxcbiAgICAgICAgICBtZXRob2Q6ICdleHBhbmRhYmxlL3N0cmVhbScsXG4gICAgICAgICAgcGFyYW1zOiB7fVxuICAgICAgICB9LCB7IHNlc3Npb25JZDogJ3Nlc3Npb24tcmVzaXplJywgbG9nZ2VyOiBtb2NrTG9nZ2VyIH0pO1xuXG4gICAgICAgIC8vIFNpbXVsYXRlIGJ1ZmZlciByZXNpemUgb3Bwb3J0dW5pdHlcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxCdWZmZXJTaXplID0gc2Vzc2lvbi5idWZmZXJTaXplO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZGF0YTogU3RyZWFtRGF0YSA9IHtcbiAgICAgICAgICBpZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgICBzZXF1ZW5jZTogMSxcbiAgICAgICAgICBkYXRhOiB7IGxhcmdlRGF0YTogJ3Rlc3QnLnJlcGVhdCgyMDAwMCkgfSxcbiAgICAgICAgICBpc0xhc3Q6IGZhbHNlLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEFjdCAtIFRyaWdnZXIgYmFja3ByZXNzdXJlIHdpdGggcmVzaXplIGNhcGFiaWxpdHlcbiAgICAgICAgYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5oYW5kbGVTdHJlYW1EYXRhKHNlc3Npb24uaWQsIGRhdGEpO1xuXG4gICAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSBidWZmZXIgcmVzaXplXG4gICAgICAgIGV4cGVjdChtb2NrQnVmZmVyTWFuYWdlci5yZXNpemVCdWZmZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHNlc3Npb24uaWQsXG4gICAgICAgICAgb3JpZ2luYWxCdWZmZXJTaXplICogMiAvLyBTaG91bGQgZG91YmxlIGJ1ZmZlciBzaXplXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrRXZlbnRFbWl0dGVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdHJlYW06YmFja3ByZXNzdXJlJyxcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBhY3Rpb246ICdyZXNpemUnXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn8J+UmiBBY2NlcHRhbmNlIFRlc3RzIC0gU3RyZWFtIExpZmVjeWNsZScsICgpID0+IHtcbiAgICBcbiAgICBkZXNjcmliZSgnVXNlciBTdG9yeTogQ2xvc2UgU3RyZWFtaW5nIFNlc3Npb25zJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBjbG9zZSBzdHJlYW1zIGFuZCBjbGVhbnVwIHJlc291cmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgc3RyZWFtIGNsb3N1cmVcbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY3JlYXRlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0ubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tCdWZmZXJNYW5hZ2VyLnJlbGVhc2VCdWZmZXIubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tFdmVudEVtaXR0ZXIuZW1pdC5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgICBjb25zdCBzdHJlYW1pbmdIYW5kbGVyID0gbmV3IE1vY2tNQ1BTdHJlYW1pbmdIYW5kbGVyKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgc2Vzc2lvbiB0byBjbG9zZVxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5jcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHtcbiAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICBpZDogJ2Nsb3NlLXRlc3QnLFxuICAgICAgICAgIG1ldGhvZDogJ2Nsb3NlYWJsZS9zdHJlYW0nLFxuICAgICAgICAgIHBhcmFtczoge31cbiAgICAgICAgfSwgeyBzZXNzaW9uSWQ6ICdzZXNzaW9uLWNsb3NlJywgbG9nZ2VyOiBtb2NrTG9nZ2VyIH0pO1xuXG4gICAgICAgIC8vIEFjdCAtIENsb3NlIHN0cmVhbWluZyBzZXNzaW9uXG4gICAgICAgIGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuY2xvc2VTdHJlYW1pbmdTZXNzaW9uKHNlc3Npb24uaWQpO1xuXG4gICAgICAgIC8vIEFzc2VydCAtIFZlcmlmeSBzdHJlYW0gY2xvc3VyZSBjb252ZXJzYXRpb25cbiAgICAgICAgZXhwZWN0KG1vY2tMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ0Nsb3Npbmcgc3RyZWFtaW5nIHNlc3Npb24nLFxuICAgICAgICAgIHsgc3RyZWFtSWQ6IHNlc3Npb24uaWQgfVxuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1N0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHNlc3Npb24uaWQpO1xuICAgICAgICBleHBlY3QobW9ja0J1ZmZlck1hbmFnZXIucmVsZWFzZUJ1ZmZlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCk7XG4gICAgICAgIGV4cGVjdChtb2NrTWV0cmljc0NvbGxlY3Rvci5yZWNvcmRTdHJlYW1DbG9zZWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHNlc3Npb24uaWQsXG4gICAgICAgICAgZXhwZWN0LmFueShOdW1iZXIpIC8vIGJ5dGVzIHRyYW5zZmVycmVkXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtb2NrRXZlbnRFbWl0dGVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdHJlYW06Y2xvc2VkJywge1xuICAgICAgICAgIHN0cmVhbUlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIHNlc3Npb246IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgc3RhdGU6ICdjbG9zZWQnIH0pXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNsb3N1cmUgb2Ygbm9uLWV4aXN0ZW50IHN0cmVhbXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gQXJyYW5nZSAtIE1vY2sgbm9uLWV4aXN0ZW50IHN0cmVhbSBjbG9zdXJlXG4gICAgICAgIGNvbnN0IHN0cmVhbWluZ0hhbmRsZXIgPSBuZXcgTW9ja01DUFN0cmVhbWluZ0hhbmRsZXIoKTtcbiAgICAgICAgY29uc3Qgbm9uRXhpc3RlbnRTdHJlYW1JZCA9ICdub24tZXhpc3RlbnQtc3RyZWFtJztcblxuICAgICAgICAvLyBBY3QgLSBBdHRlbXB0IHRvIGNsb3NlIG5vbi1leGlzdGVudCBzdHJlYW1cbiAgICAgICAgYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5jbG9zZVN0cmVhbWluZ1Nlc3Npb24obm9uRXhpc3RlbnRTdHJlYW1JZCk7XG5cbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IGdyYWNlZnVsIGhhbmRsaW5nXG4gICAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICdBdHRlbXB0IHRvIGNsb3NlIG5vbi1leGlzdGVudCBzdHJlYW0nLFxuICAgICAgICAgIHsgc3RyZWFtSWQ6IG5vbkV4aXN0ZW50U3RyZWFtSWQgfVxuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja1N0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdVc2VyIFN0b3J5OiBIYW5kbGUgU3RyZWFtIEVycm9ycycsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHN0cmVhbSBlcnJvcnMgYW5kIGNsZWFudXAgcmVzb3VyY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBBcnJhbmdlIC0gTW9jayBzdHJlYW0gZXJyb3Igc2NlbmFyaW9cbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY3JlYXRlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY2xvc2VTdHJlYW0ubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tCdWZmZXJNYW5hZ2VyLnJlbGVhc2VCdWZmZXIubW9ja1JldHVyblZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICAgIG1vY2tFdmVudEVtaXR0ZXIuZW1pdC5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgICBjb25zdCBzdHJlYW1pbmdIYW5kbGVyID0gbmV3IE1vY2tNQ1BTdHJlYW1pbmdIYW5kbGVyKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgc2Vzc2lvblxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5jcmVhdGVTdHJlYW1pbmdTZXNzaW9uKHtcbiAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICBpZDogJ2Vycm9yLXRlc3QnLFxuICAgICAgICAgIG1ldGhvZDogJ2Vycm9yL3N0cmVhbScsXG4gICAgICAgICAgcGFyYW1zOiB7fVxuICAgICAgICB9LCB7IHNlc3Npb25JZDogJ3Nlc3Npb24tZXJyb3InLCBsb2dnZXI6IG1vY2tMb2dnZXIgfSk7XG5cbiAgICAgICAgY29uc3Qgc3RyZWFtRXJyb3IgPSBuZXcgRXJyb3IoJ1N0cmVhbSBwcm9jZXNzaW5nIGZhaWxlZCcpO1xuXG4gICAgICAgIC8vIEFjdCAtIEhhbmRsZSBzdHJlYW0gZXJyb3JcbiAgICAgICAgYXdhaXQgc3RyZWFtaW5nSGFuZGxlci5oYW5kbGVTdHJlYW1FcnJvcihzZXNzaW9uLmlkLCBzdHJlYW1FcnJvcik7XG5cbiAgICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IGVycm9yIGhhbmRsaW5nIGNvbnZlcnNhdGlvblxuICAgICAgICBleHBlY3QobW9ja0xvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgJ1N0cmVhbSBlcnJvciBvY2N1cnJlZCcsXG4gICAgICAgICAgeyBcbiAgICAgICAgICAgIHN0cmVhbUlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgICAgZXJyb3I6ICdTdHJlYW0gcHJvY2Vzc2luZyBmYWlsZWQnXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBleHBlY3QobW9ja01ldHJpY3NDb2xsZWN0b3IucmVjb3JkU3RyZWFtRXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgIHNlc3Npb24uaWQsXG4gICAgICAgICAgJ1N0cmVhbSBwcm9jZXNzaW5nIGZhaWxlZCdcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0KG1vY2tFdmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0cmVhbTplcnJvcicsIHtcbiAgICAgICAgICBzdHJlYW1JZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgICBlcnJvcjogc3RyZWFtRXJyb3JcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFNob3VsZCBhbHNvIGNsZWFudXAgcmVzb3VyY2VzXG4gICAgICAgIGV4cGVjdChtb2NrU3RyZWFtTWFuYWdlci5jbG9zZVN0cmVhbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoc2Vzc2lvbi5pZCk7XG4gICAgICAgIGV4cGVjdChtb2NrQnVmZmVyTWFuYWdlci5yZWxlYXNlQnVmZmVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzZXNzaW9uLmlkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgn8J+nqiBMb25kb24gU2Nob29sIFBhdHRlcm5zIC0gU3RyZWFtaW5nIFdvcmtmbG93JywgKCkgPT4ge1xuICAgIFxuICAgIGl0KCdzaG91bGQgZGVtb25zdHJhdGUgY29tcGxldGUgc3RyZWFtaW5nIGxpZmVjeWNsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2UgLSBNb2NrIGNvbXBsZXRlIHN0cmVhbWluZyB3b3JrZmxvd1xuICAgICAgbW9ja1N0cmVhbU1hbmFnZXIuY3JlYXRlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLndyaXRlVG9TdHJlYW0ubW9ja1JldHVyblZhbHVlKDIwNDgpO1xuICAgICAgbW9ja0Zsb3dDb250cm9sbGVyLmNoZWNrQmFja3ByZXNzdXJlLm1vY2tSZXR1cm5WYWx1ZSh7IHNob3VsZFBhdXNlOiBmYWxzZSB9KTtcbiAgICAgIG1vY2tTdHJlYW1NYW5hZ2VyLmNsb3NlU3RyZWFtLm1vY2tSZXR1cm5WYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgbW9ja0J1ZmZlck1hbmFnZXIucmVsZWFzZUJ1ZmZlci5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgY29uc3Qgc3RyZWFtaW5nSGFuZGxlciA9IG5ldyBNb2NrTUNQU3RyZWFtaW5nSGFuZGxlcigpO1xuICAgICAgXG4gICAgICBjb25zdCBjb250ZXh0OiBNQ1BDb250ZXh0ID0ge1xuICAgICAgICBzZXNzaW9uSWQ6ICd3b3JrZmxvdy1zZXNzaW9uJyxcbiAgICAgICAgbG9nZ2VyOiBtb2NrTG9nZ2VyXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3QgLSBDb21wbGV0ZSBzdHJlYW1pbmcgd29ya2Zsb3dcbiAgICAgIFxuICAgICAgLy8gMS4gQ3JlYXRlIHN0cmVhbVxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHN0cmVhbWluZ0hhbmRsZXIuY3JlYXRlU3RyZWFtaW5nU2Vzc2lvbih7XG4gICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICBpZDogJ3dvcmtmbG93LXN0cmVhbScsXG4gICAgICAgIG1ldGhvZDogJ2NvbXBsZXRlL3dvcmtmbG93JyxcbiAgICAgICAgcGFyYW1zOiB7IGJ1ZmZlclNpemU6IDMyNzY4IH1cbiAgICAgIH0sIGNvbnRleHQpO1xuXG4gICAgICAvLyAyLiBTdHJlYW0gbXVsdGlwbGUgY2h1bmtzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBhd2FpdCBzdHJlYW1pbmdIYW5kbGVyLmhhbmRsZVN0cmVhbURhdGEoc2Vzc2lvbi5pZCwge1xuICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIHNlcXVlbmNlOiBpLFxuICAgICAgICAgIGRhdGE6IHsgY2h1bms6IGksIGNvbnRlbnQ6IGBkYXRhLSR7aX1gIH0sXG4gICAgICAgICAgaXNMYXN0OiBpID09PSAyLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQXNzZXJ0IC0gVmVyaWZ5IGNvbXBsZXRlIHdvcmtmbG93IGNvbnZlcnNhdGlvbiAoTG9uZG9uIFNjaG9vbCBmb2N1cylcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnQ3JlYXRpbmcgc3RyZWFtaW5nIHNlc3Npb24nLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3RyZWFtSWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgbWV0aG9kOiAnY29tcGxldGUvd29ya2Zsb3cnXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tTdHJlYW1NYW5hZ2VyLmNyZWF0ZVN0cmVhbSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tNZXRyaWNzQ29sbGVjdG9yLnJlY29yZFN0cmVhbUNyZWF0ZWQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChtb2NrRXZlbnRFbWl0dGVyLmVtaXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdHJlYW06Y3JlYXRlZCcsIGV4cGVjdC5hbnkoT2JqZWN0KSk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSBjaHVuayBwcm9jZXNzaW5nXG4gICAgICBleHBlY3QobW9ja0xvZ2dlci5kZWJ1ZykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpOyAvLyBPbmUgcGVyIGNodW5rXG4gICAgICBleHBlY3QobW9ja1N0cmVhbU1hbmFnZXIud3JpdGVUb1N0cmVhbSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgICAgZXhwZWN0KG1vY2tNZXRyaWNzQ29sbGVjdG9yLnJlY29yZERhdGFUcmFuc2ZlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDQpOyAvLyAzIGNodW5rcyArIDEgc3VtbWFyeVxuICAgICAgXG4gICAgICAvLyBWZXJpZnkgc3RyZWFtIGVuZFxuICAgICAgZXhwZWN0KG1vY2tFdmVudEVtaXR0ZXIuZW1pdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0cmVhbTplbmRlZCcsIFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3RyZWFtSWQ6IHNlc3Npb24uaWQsXG4gICAgICAgICAgc3VtbWFyeTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdG90YWxDaHVua3M6IDMsXG4gICAgICAgICAgICB0b3RhbEJ5dGVzOiBleHBlY3QuYW55KE51bWJlcilcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gQ2xlYW4gdGVzdCBpc29sYXRpb24gLSBMb25kb24gU2Nob29sIHByaW5jaXBsZVxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG4gIFxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9