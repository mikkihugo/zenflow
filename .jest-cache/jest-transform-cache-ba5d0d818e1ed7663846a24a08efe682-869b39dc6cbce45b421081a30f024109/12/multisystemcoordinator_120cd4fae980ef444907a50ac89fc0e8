68c02e9d71456fbf28eb493afba0d3bb
/* istanbul ignore next */
function cov_8kre50h3s() {
  var path = "/home/mhugo/code/claude-code-flow/src/integration/multi-system-coordinator.ts";
  var hash = "529e7f18468193f3414987c7ffee93c4b499ae5f";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/mhugo/code/claude-code-flow/src/integration/multi-system-coordinator.ts",
    statementMap: {},
    fnMap: {},
    branchMap: {},
    s: {},
    f: {},
    b: {},
    inputSourceMap: {
      file: "/home/mhugo/code/claude-code-flow/src/integration/multi-system-coordinator.ts",
      mappings: ";AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iBAsdiB",
      names: [],
      sources: ["/home/mhugo/code/claude-code-flow/src/integration/multi-system-coordinator.ts"],
      sourcesContent: ["\n/** Multi-System Coordinator - Advanced Integration Layer;\n/** ORCHESTRATES LANCEDB, KUZU, AND VISIONARY SOFTWARE INTELLIGENCE SYSTEMS;\n/** Provides unified interface and cross-system intelligence;\n\nimport { EventEmitter  } from 'node:events';\nimport { existsSync  } from 'node:fs';\nimport { mkdir  } from 'node:fs';\nimport path from 'node:path';\nimport KuzuAdvancedInterface from '../database/kuzu-advanced-interface.js';\nimport LanceDBInterface from '../database/lancedb-interface.js';\nimport { VisionarySoftwareIntelligenceProcessor  } from '../visionary/software-intelligence-processor.js';\n\nexport class MultiSystemCoordinator extends EventEmitter {\n  constructor(_config = {}) {\n    super();\n;\n    this.config = {\n      // System configurations from external configlancedb = = false,enableMemorySharing = = false,enableIntelligentRouting = = false,\n\n      // Performance settingsbatchSize = null;\n    this.kuzu = null;\n    this.vision = null;\n;\n    // Coordination state\n    this.isInitialized = false;\n    this.activeOperations = new Map();\n    this.crossSystemCache = new Map();\n    this.sharedMemory = new Map();\n;\n    // Analytics and metrics\n    this.analytics = {totalOperations = new Map();\n    this.setupIntegrationPatterns();\n  //   }\n\n/** Initialize all three systems with coordination;\n\n  async initialize() { \n    console.warn(' Initializing Multi-System Coordinator...');\n;\n    try ;\n      // Initialize systems in parallel\n// // await Promise.all([;/g)\n        this.initializeLanceDB(),;\n        this.initializeKuzu(),;\n        this.initializeVision();\n      ]);\n\n      // Setup cross-system integrations\n// // await this.setupCrossSystemIntegrations();\n      // Initialize shared memory\n// // await this.initializeSharedMemory();\n      // Setup analytics\n// // await this.initializeAnalytics();\n      this.isInitialized = true;\n      console.warn(' Multi-System Coordinator initialized successfully');\n;\n      this.emit('initialized', {systems = new LanceDBInterface(this.config.lancedb);\n// // await this.lancedb.initialize();\n    console.warn(' LanceDB initialized');\n  //   }\n\n/** Initialize Kuzu system;\n\n  async initializeKuzu() ;\n    console.warn(' Initializing Kuzu Advanced Interface...');\n;\n    // Ensure database directory exists\n    if(!existsSync(this.config.kuzu.dbPath)) {\n// // await mkdir(this.config.kuzu.dbPath, {recursive = new KuzuAdvancedInterface(this.config.kuzu);\n// // await this.kuzu.initializeAdvanced();\n    console.warn(' Kuzu Advanced Interface initialized');\n  //   }\n\n/** Initialize Vision system;\n\n  async initializeVision() ;\n    console.warn(' Initializing Visionary Software Intelligence...');\n;\n    // Ensure output directory exists\n    if(!existsSync(this.config.vision.outputDir)) {\n// // await mkdir(this.config.vision.outputDir, {recursive = new VisionarySoftwareIntelligenceProcessor(this.config.vision);\n// // await this.vision.initialize();\n    console.warn(' Visionary Software Intelligence initialized');\n  //   }\n\n/** Setup cross-system integrations;\n\n  async setupCrossSystemIntegrations() ;\n    console.warn(' Setting up cross-system integrations...');\n;\n    // LanceDB  Kuzu integration\n// // await this.setupVectorGraphIntegration();\n    // Vision  LanceDB integration\n// // await this.setupVisionVectorIntegration();\n    // Vision  Kuzu integration\n// // await this.setupVisionGraphIntegration();\n    // Three-way integration patterns\n// // await this.setupTripleSystemIntegration();\n    console.warn(' Cross-system integrations configured');\n;\n/** Setup Vector-Graph integration patterns;\n\n  async setupVectorGraphIntegration() ;\n    // Pattern => {\n      if(!this.lancedb  ?? !this.kuzu) return;\n    // ; // LINT: unreachable code removed\n      try {\n        // Convert graph query to embedding\n// const __queryEmbedding = awaitthis.textToEmbedding(graphQuery);\n\n        // Store query pattern with results\n// // await this.lancedb.insertDocuments([{\n          id => {)\n      if(!this._lancedb) return null;\n    // ; // LINT: unreachable code removed\n      try {\n// const _queryEmbedding = awaitthis.textToEmbedding(query);\n// const _similar = awaitthis.lancedb.semanticSearch(_queryEmbedding, {table = 'kuzu'\",\"\n          limit => {)\n      if(!this._lancedb) return;\n    // ; // LINT: unreachable code removed\n      try {\n        // Extract components for vectorization\n        const _components = Object.entries(generatedCode.files  ?? {});\n  for(const [fileName, fileContent] of components) {\n// const __codeEmbedding = awaitthis.textToEmbedding(fileContent); \n// // await this.lancedb.insertCodeSnippets([{\n            id => {)\n      if(!this._lancedb) return null; // ; // LINT: unreachable code removed\n      try {\n// const _codeEmbedding = awaitthis.textToEmbedding(codeSnippet) {;\n// const _similar = awaitthis.lancedb.semanticSearch(_codeEmbedding, {\n          table => {)\n      if(!this._kuzu) return;\n    // ; // LINT: unreachable code removed\n      try {\n        // Insert components as nodes\n// // await this.kuzu.insertRelationships(relationships);\n        console.warn(' Components modeled in graph');\n      } catch(error) {\n        console.warn(' Components-to-graph integration warning => {')\n      const _analysis = {vision = === 'image') {\n          analysis.vision = // await this.vision.processImage(input.path, {framework = input.text ?? input.code;/g)\n          analysis.vectors = // await this.lancedb.semanticSearch(searchText, {table = // await this.kuzu.findServiceDependencies(input.entityName);\n        //         }\n\n        // Generate cross-system insights\n        analysis.insights = // await this.generateCrossSystemInsights(analysis);\n\n        // return analysis;\n    //   // LINT: unreachable code removed} catch(error) {\n        console.warn(' Comprehensive analysis warning = {}) {'\n  if(!this._config._enableIntelligentRouting) {\n      throw new Error('Intelligent routing is disabled');\n    //     }\n\n    const _startTime = Date.now();\n    const _operationId = `op_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    try {\n      console.warn(` Routingoperation = // await this.routeSemanticSearch(input, options);`\n          break;\n        case 'code-generation':;\n          result = // await this.routeCodeGeneration(input, options);\n          break;\n        case 'graph-analysis':;\n          result = // await this.routeGraphAnalysis(input, options);\n          break;\n        case 'similarity-analysis':;\n          result = // await this.routeSimilarityAnalysis(input, options);\n          break;\n        case 'comprehensive-analysis':;\n          result = // await this.routeComprehensiveAnalysis(input, options);\n          break;default = Date.now() - startTime;\n      this.activeOperations.set(operationId, {)\n..this.activeOperations.get(operationId),status = Date.now() - startTime;\n\n      // Update operation status\n      this.activeOperations.set(operationId, {)\n..this.activeOperations.get(operationId),status = 'auto', limit = 10 } = input;\n    const _results = {systemsUsed = type;\n  if(searchType === 'auto') {\n      searchType = this.detectSearchType(query);\n    //     }\n\n    // Route to appropriate table/system\n  switch(searchType) {\n      case 'code':;\n        results.data = // await this.lancedb.semanticSearch(query, {table = // await this.lancedb.semanticSearch(query, {table = 'kuzu'\",\"\n          limit,;\n..options;))\n        });\n        results.systemsUsed.push('kuzu');\n        break;\n      case 'decision':;\n        results.data = // await this.lancedb.semanticSearch(query, {table = // await this.lancedb.semanticSearch(query, {\n          table = {systemsUsed = // await this.vision.processImage(input.imagePath, {framework = = false,optimizeCode = = false;/g)))\n      });\n\n      // Store in vector database for future similarity search\n  if(results.data.success && this.config.enableMemorySharing) {\n// // await this.runIntegrationPattern('code-to-vector', results.data, {/g)\n          framework = {systemsUsed = // await this.runIntegrationPattern('find-similar-queries', input.query);\n  if(similarQueries && similarQueries.length > 0) {\n        results.similarQueries = similarQueries;\n        results.systemsUsed.push('lancedb');\n      //       }\n    //     }\n\n    // Execute graph analysis\n  switch(input.analysisType) {\n      case 'traversal':;\n        results.data = // await this.kuzu.advancedTraversal({startNode = // await this.kuzu.computeCentrality({algorithm = // await this.kuzu.detectCommunities({algorithm = // await this.kuzu.patternMatching(input.pattern, options);\n        break;default = // await this.kuzu.executeQuery(input.query, options);\n    //     }\n\n    // Store query pattern for future similarity search\n  if(this.config.enableMemorySharing && results.data) {\n// // await this.runIntegrationPattern('graph-to-vector', input.query, results.data);\n      results.systemsUsed.push('lancedb');\n    //     }\n\n    // return results;\n    //   // LINT: unreachable code removed}\n\n/** Route comprehensive analysis operations;\n\n  async routeComprehensiveAnalysis(input, options) { \n    const _results = systemsUsed = await this.runIntegrationPattern('comprehensive-analysis', input);\n;\n    // return results;\n    //   // LINT: unreachable code removed}\n\n/** Cross-system analytics and insights;\n\n  async generateCrossSystemAnalytics() { \n    if(!this.config.enableCrossSystemAnalytics) \n      // return { error = {systems = await this.lancedb?.getStats();\n    // analytics.systems.kuzu = await this.kuzu?.getAdvancedStats(); // LINT: unreachable code removed\n      analytics.systems.vision = // await this.vision?.getAnalytics();\n\n      // Integration analytics\n      analytics.integration = {\n        patterns_executed = {total_operations = // await this.generateSystemInsights(analytics);\n\n      // return analytics;\n    // ; // LINT: unreachable code removed\n    } catch(error) {\n      console.error(' Cross-system analyticserror = [];'\n;\n    // Performance insights/g)\n  if(analytics.performance?.total_operations > 100) {\n      const _avgTime = Object.values(analytics.performance.system_usage);\nreduce((sum, system) => sum + system.avgTime, 0) / 3;\n  if(avgTime > 1000) {\n        insights.push({ type = analytics.integration.cache_hit_rate;)\n  if(efficiency < 0.5) {\n        insights.push({type = Object.values(analytics.performance?.system_usage  ?? {  });\n  if(systemUsages.length > 0) {\n      const _maxUsage = Math.max(...systemUsages.map(s => s.queries + s.inserts + s.processes));\n      const _minUsage = Math.min(...systemUsages.map(s => s.queries + s.inserts + s.processes));\n  if(maxUsage > minUsage * 3) {\n        insights.push({ type = Array.from(this.crossSystemCache.entries());\n      const _toRemove = entries.slice(0, Math.floor(this.config.cacheSize * 0.2));\n;\n      toRemove.forEach(([key]) => {\n        this.crossSystemCache.delete(key);\n        });\n\n      console.warn(` Cachecleaned = this.integrationPatterns.get(patternName);`;\n  if(!pattern) {\n      console.warn(` Integration pattern notfound = // await pattern(...args);`\n      this.analytics.crossSystemOperations++;\n      // return result;\n    //   // LINT: unreachable code removed} catch(error) {\n      console.warn(` Integration pattern error($, { patternName }):`, error.message);\n      // return null;\n    //   // LINT: unreachable code removed}\n  //   }\n\n  async textToEmbedding(text) { \n    // Simplified embedding generation(in production, use actual embedding model)\n    const _hash = this.simpleHash(text);\n    // return Array(this.config.lancedb.vectorDim).fill(0).map((_, _i) => ;\n    // Math.sin(hash + i) * Math.cos(hash * i); // LINT: unreachable code removed\n    );\n  //   }\n\n  simpleHash(str) ;\n    const _hash = 0;\n  for(let i = 0; i < str.length; i++) {\n      const _char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32bit integer\n    //     }\n    // return hash;\n    //   // LINT: unreachable code removed}\n  detectLanguage(fileName) {\n    const _ext = path.extname(fileName).toLowerCase();\n    const _langMap = {\n      '.js': 'javascript',\n      '.jsx': 'javascript',\n      '.ts': 'typescript',\n      '.tsx': 'typescript',\n      '.py': 'python',\n      '.java': 'java',\n      '.cpp': 'cpp',\n      '.c': 'c',\n      '.go': 'go',\n      '.rs': 'rust',\n      '.php': 'php',\n      '.rb': 'ruby',\n      '.cs': 'csharp',\n      '.html': 'html',\n      '.css': 'css',\n      '.scss': 'scss',\n      '.vue': 'vue';\n    };\n    // return langMap[ext]  ?? 'unknown';\n    //   // LINT: unreachable code removed}\n\n  detectSearchType(query) ;\n    if(/function|class|import|export|const|let|var/.test(query)) {\n      return 'code';\n    //   // LINT: unreachable code removed}\n    if(/MATCH|RETURN|WHERE|CREATE|DELETE/.test(query.toUpperCase())) {\n      return 'graph-query';\n    //   // LINT: unreachable code removed}\n    if(/decision|choose|recommend|suggest/.test(query.toLowerCase())) {\n      // return 'decision';\n    //   // LINT: unreachable code removed}\n    // return 'document';\n    // ; // LINT: unreachable code removed\n  analyzeComponentRelationships(components) {\n    // Simplified relationship analysis\n    const _relationships = [];\n  for(let i = 0; i < components.length; i++) {\n  for(let j = i + 1; j < components.length; j++) {\n        const _comp1 = components[i];\n        const _comp2 = components[j];\n;\n        // Check for containment relationship\n        if(this.isContained(comp1.bounds, comp2.bounds)) {\n          relationships.push({from = bounds2.x &&;\n           bounds1.y >= bounds2.y &&;);\n           (bounds1.x + bounds1.width) <= (bounds2.x + bounds2.width) &&;\n           (bounds1.y + bounds1.height) <= (bounds2.y + bounds2.height);\n  //   }\n  areAdjacent(bounds1, bounds2) {\n    const _threshold = 10; // pixels\n\n    // Check horizontal adjacency\n    const _horizontallyAligned = Math.abs(bounds1.y - bounds2.y) < threshold;\n    const _horizontallyAdjacent = ;\n      Math.abs((bounds1.x + bounds1.width) - bounds2.x) < threshold ?? Math.abs((bounds2.x + bounds2.width) - bounds1.x) < threshold;\n;\n    // Check vertical adjacency\n    const _verticallyAligned = Math.abs(bounds1.x - bounds2.x) < threshold;\n    const _verticallyAdjacent = ;\n      Math.abs((bounds1.y + bounds1.height) - bounds2.y) < threshold ?? Math.abs((bounds2.y + bounds2.height) - bounds1.y) < threshold;\n;\n    // return(horizontallyAligned && horizontallyAdjacent)  ?? (verticallyAligned && verticallyAdjacent);\n    //   // LINT: unreachable code removed}\n\n  updateAnalytics(operation, executionTime, success) ;\n    this.analytics.totalOperations++;\n;\n    // Update system-specific analytics\n    if(operation.includes('lancedb')  ?? operation.includes('vector')) {\n      this.analytics.systemUsage.lancedb.queries++;\n      this.analytics.systemUsage.lancedb.avgTime = ;\n        (this.analytics.systemUsage.lancedb.avgTime + executionTime) / 2;\n    //     }\n\n    if(operation.includes('kuzu')  ?? operation.includes('graph')) {\n      this.analytics.systemUsage.kuzu.queries++;\n      this.analytics.systemUsage.kuzu.avgTime = ;\n        (this.analytics.systemUsage.kuzu.avgTime + executionTime) / 2;\n    //     }\n\n    if(operation.includes('vision')  ?? operation.includes('code-generation')) {\n      this.analytics.systemUsage.vision.processes++;\n      this.analytics.systemUsage.vision.avgTime = ;\n        (this.analytics.systemUsage.vision.avgTime + executionTime) / 2;\n  if(success) {\n        this.analytics.systemUsage.vision.successRate = ;\n          (this.analytics.systemUsage.vision.successRate + 1) / 2;\n      //       }\n    //     }\n  sanitizeForLogging(obj) {\n    if(typeof obj !== 'object'  ?? obj === null) return obj;\n    // ; // LINT: unreachable code removed\n    const _sanitized = {};\n    Object.keys(obj).forEach(key => {)\n      if(key.toLowerCase().includes('buffer')  ?? key.toLowerCase().includes('embedding')) {\n        sanitized[key] = '[BINARY_DATA]';\n      } else if(typeof obj[key] === 'string' && obj[key].length > 200) {\n        sanitized[key] = `${obj[key].substring(0, 200)}...`;\n      } else {\n        sanitized[key] = obj[key];\n      //       }\n    });\n\n    // return sanitized;\n    //   // LINT: unreachable code removed}\n\n  async initializeAnalytics() ;\n    if(!this.config.enableCrossSystemAnalytics) return;\n    // ; // LINT: unreachable code removed\n    // Set up periodic analytics collection\n    setInterval(async() => {\n      try {\n// const __analytics = awaitthis.generateCrossSystemAnalytics();\n        // In production, this would be sent to monitoring system\n        console.warn(' Cross-system analytics updated');\n      } catch(_error) {\n        console.warn(' Analytics update failed');\n      }\n      this.manageCrossSystemCache();\n    }, 300000); // Every 5 minutes\n\n    console.warn(' Analytics system initialized');\n  //   }\n\n/** Get comprehensive system status;\n\n  async getSystemStatus() { }\n    // return \n      coordinator: {\n        initialized: this.isInitialized,;\n    // activeOperations: this.activeOperations.size, // LINT: unreachable code removed\n        cacheSize: this.crossSystemCache.size,;\n        sharedMemorySize: this.sharedMemory.size;,;\n        lancedb: this.lancedb ? // await this.lancedb.getStats() ,\n        kuzu: this.kuzu ? // await this.kuzu.getAdvancedStats() ,\n        vision: this.vision ? // await this.vision.getAnalytics() ;,\n      analytics: this.analytics,;\n      integrationPatterns: Array.from(this.integrationPatterns.keys());\n    };\n\n/** Cleanup and shutdown;\n\n  async close() ;\n    console.warn(' Closing Multi-System Coordinator...');\n;\n    try {\n      // Close all systems in parallel\n// // await Promise.all([;/g)\n        this.lancedb?.close(),;\n        this.kuzu?.close(),;\n        this.vision?.close();\n      ]);\n\n      // Clear caches and memory\n      this.crossSystemCache.clear();\n      this.sharedMemory.clear();\n      this.activeOperations.clear();\n;\n      console.warn(' Multi-System Coordinator closed');\n;\n    } catch(error) {\n      console.error(` Error closing coordinator);`;\n      throw error;\n    //     }\n// }\n\n// export default MultiSystemCoordinator;\n\n}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}})))))))))))))))))))))))))))\n\n/* End of file */"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "529e7f18468193f3414987c7ffee93c4b499ae5f"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_8kre50h3s = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_8kre50h3s();
export {};
/** Multi-System Coordinator - Advanced Integration Layer;
/** ORCHESTRATES LANCEDB, KUZU, AND VISIONARY SOFTWARE INTELLIGENCE SYSTEMS;
/** Provides unified interface and cross-system intelligence;

import { EventEmitter  } from 'node:events';
import { existsSync  } from 'node:fs';
import { mkdir  } from 'node:fs';
import path from 'node:path';
import KuzuAdvancedInterface from '../database/kuzu-advanced-interface.js';
import LanceDBInterface from '../database/lancedb-interface.js';
import { VisionarySoftwareIntelligenceProcessor  } from '../visionary/software-intelligence-processor.js';

export class MultiSystemCoordinator extends EventEmitter {
  constructor(_config = {}) {
    super();
;
    this.config = {
      // System configurations from external configlancedb = = false,enableMemorySharing = = false,enableIntelligentRouting = = false,

      // Performance settingsbatchSize = null;
    this.kuzu = null;
    this.vision = null;
;
    // Coordination state
    this.isInitialized = false;
    this.activeOperations = new Map();
    this.crossSystemCache = new Map();
    this.sharedMemory = new Map();
;
    // Analytics and metrics
    this.analytics = {totalOperations = new Map();
    this.setupIntegrationPatterns();
  //   }

/** Initialize all three systems with coordination;

  async initialize() {
    console.warn(' Initializing Multi-System Coordinator...');
;
    try ;
      // Initialize systems in parallel
// // await Promise.all([;/g)
        this.initializeLanceDB(),;
        this.initializeKuzu(),;
        this.initializeVision();
      ]);

      // Setup cross-system integrations
// // await this.setupCrossSystemIntegrations();
      // Initialize shared memory
// // await this.initializeSharedMemory();
      // Setup analytics
// // await this.initializeAnalytics();
      this.isInitialized = true;
      console.warn(' Multi-System Coordinator initialized successfully');
;
      this.emit('initialized', {systems = new LanceDBInterface(this.config.lancedb);
// // await this.lancedb.initialize();
    console.warn(' LanceDB initialized');
  //   }

/** Initialize Kuzu system;

  async initializeKuzu() ;
    console.warn(' Initializing Kuzu Advanced Interface...');
;
    // Ensure database directory exists
    if(!existsSync(this.config.kuzu.dbPath)) {
// // await mkdir(this.config.kuzu.dbPath, {recursive = new KuzuAdvancedInterface(this.config.kuzu);
// // await this.kuzu.initializeAdvanced();
    console.warn(' Kuzu Advanced Interface initialized');
  //   }

/** Initialize Vision system;

  async initializeVision() ;
    console.warn(' Initializing Visionary Software Intelligence...');
;
    // Ensure output directory exists
    if(!existsSync(this.config.vision.outputDir)) {
// // await mkdir(this.config.vision.outputDir, {recursive = new VisionarySoftwareIntelligenceProcessor(this.config.vision);
// // await this.vision.initialize();
    console.warn(' Visionary Software Intelligence initialized');
  //   }

/** Setup cross-system integrations;

  async setupCrossSystemIntegrations() ;
    console.warn(' Setting up cross-system integrations...');
;
    // LanceDB  Kuzu integration
// // await this.setupVectorGraphIntegration();
    // Vision  LanceDB integration
// // await this.setupVisionVectorIntegration();
    // Vision  Kuzu integration
// // await this.setupVisionGraphIntegration();
    // Three-way integration patterns
// // await this.setupTripleSystemIntegration();
    console.warn(' Cross-system integrations configured');
;
/** Setup Vector-Graph integration patterns;

  async setupVectorGraphIntegration() ;
    // Pattern => {
      if(!this.lancedb  ?? !this.kuzu) return;
    // ; // LINT: unreachable code removed
      try {
        // Convert graph query to embedding
// const __queryEmbedding = awaitthis.textToEmbedding(graphQuery);

        // Store query pattern with results
// // await this.lancedb.insertDocuments([{
          id => {)
      if(!this._lancedb) return null;
    // ; // LINT: unreachable code removed
      try {
// const _queryEmbedding = awaitthis.textToEmbedding(query);
// const _similar = awaitthis.lancedb.semanticSearch(_queryEmbedding, {table = 'kuzu'","
          limit => {)
      if(!this._lancedb) return;
    // ; // LINT: unreachable code removed
      try {
        // Extract components for vectorization
        const _components = Object.entries(generatedCode.files  ?? {});
  for(const [fileName, fileContent] of components) {
// const __codeEmbedding = awaitthis.textToEmbedding(fileContent);
// // await this.lancedb.insertCodeSnippets([{
            id => {)
      if(!this._lancedb) return null; // ; // LINT: unreachable code removed
      try {
// const _codeEmbedding = awaitthis.textToEmbedding(codeSnippet) {;
// const _similar = awaitthis.lancedb.semanticSearch(_codeEmbedding, {
          table => {)
      if(!this._kuzu) return;
    // ; // LINT: unreachable code removed
      try {
        // Insert components as nodes
// // await this.kuzu.insertRelationships(relationships);
        console.warn(' Components modeled in graph');
      } catch(error) {
        console.warn(' Components-to-graph integration warning => {')
      const _analysis = {vision = === 'image') {
          analysis.vision = // await this.vision.processImage(input.path, {framework = input.text ?? input.code;/g)
          analysis.vectors = // await this.lancedb.semanticSearch(searchText, {table = // await this.kuzu.findServiceDependencies(input.entityName);
        //         }

        // Generate cross-system insights
        analysis.insights = // await this.generateCrossSystemInsights(analysis);

        // return analysis;
    //   // LINT: unreachable code removed} catch(error) {
        console.warn(' Comprehensive analysis warning = {}) {'
  if(!this._config._enableIntelligentRouting) {
      throw new Error('Intelligent routing is disabled');
    //     }

    const _startTime = Date.now();
    const _operationId = `op_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

    try {
      console.warn(` Routingoperation = // await this.routeSemanticSearch(input, options);`
          break;
        case 'code-generation':;
          result = // await this.routeCodeGeneration(input, options);
          break;
        case 'graph-analysis':;
          result = // await this.routeGraphAnalysis(input, options);
          break;
        case 'similarity-analysis':;
          result = // await this.routeSimilarityAnalysis(input, options);
          break;
        case 'comprehensive-analysis':;
          result = // await this.routeComprehensiveAnalysis(input, options);
          break;default = Date.now() - startTime;
      this.activeOperations.set(operationId, {)
..this.activeOperations.get(operationId),status = Date.now() - startTime;

      // Update operation status
      this.activeOperations.set(operationId, {)
..this.activeOperations.get(operationId),status = 'auto', limit = 10 } = input;
    const _results = {systemsUsed = type;
  if(searchType === 'auto') {
      searchType = this.detectSearchType(query);
    //     }

    // Route to appropriate table/system
  switch(searchType) {
      case 'code':;
        results.data = // await this.lancedb.semanticSearch(query, {table = // await this.lancedb.semanticSearch(query, {table = 'kuzu'","
          limit,;
..options;))
        });
        results.systemsUsed.push('kuzu');
        break;
      case 'decision':;
        results.data = // await this.lancedb.semanticSearch(query, {table = // await this.lancedb.semanticSearch(query, {
          table = {systemsUsed = // await this.vision.processImage(input.imagePath, {framework = = false,optimizeCode = = false;/g)))
      });

      // Store in vector database for future similarity search
  if(results.data.success && this.config.enableMemorySharing) {
// // await this.runIntegrationPattern('code-to-vector', results.data, {/g)
          framework = {systemsUsed = // await this.runIntegrationPattern('find-similar-queries', input.query);
  if(similarQueries && similarQueries.length > 0) {
        results.similarQueries = similarQueries;
        results.systemsUsed.push('lancedb');
      //       }
    //     }

    // Execute graph analysis
  switch(input.analysisType) {
      case 'traversal':;
        results.data = // await this.kuzu.advancedTraversal({startNode = // await this.kuzu.computeCentrality({algorithm = // await this.kuzu.detectCommunities({algorithm = // await this.kuzu.patternMatching(input.pattern, options);
        break;default = // await this.kuzu.executeQuery(input.query, options);
    //     }

    // Store query pattern for future similarity search
  if(this.config.enableMemorySharing && results.data) {
// // await this.runIntegrationPattern('graph-to-vector', input.query, results.data);
      results.systemsUsed.push('lancedb');
    //     }

    // return results;
    //   // LINT: unreachable code removed}

/** Route comprehensive analysis operations;

  async routeComprehensiveAnalysis(input, options) {
    const _results = systemsUsed = await this.runIntegrationPattern('comprehensive-analysis', input);
;
    // return results;
    //   // LINT: unreachable code removed}

/** Cross-system analytics and insights;

  async generateCrossSystemAnalytics() {
    if(!this.config.enableCrossSystemAnalytics)
      // return { error = {systems = await this.lancedb?.getStats();
    // analytics.systems.kuzu = await this.kuzu?.getAdvancedStats(); // LINT: unreachable code removed
      analytics.systems.vision = // await this.vision?.getAnalytics();

      // Integration analytics
      analytics.integration = {
        patterns_executed = {total_operations = // await this.generateSystemInsights(analytics);

      // return analytics;
    // ; // LINT: unreachable code removed
    } catch(error) {
      console.error(' Cross-system analyticserror = [];'
;
    // Performance insights/g)
  if(analytics.performance?.total_operations > 100) {
      const _avgTime = Object.values(analytics.performance.system_usage);
reduce((sum, system) => sum + system.avgTime, 0) / 3;
  if(avgTime > 1000) {
        insights.push({ type = analytics.integration.cache_hit_rate;)
  if(efficiency < 0.5) {
        insights.push({type = Object.values(analytics.performance?.system_usage  ?? {  });
  if(systemUsages.length > 0) {
      const _maxUsage = Math.max(...systemUsages.map(s => s.queries + s.inserts + s.processes));
      const _minUsage = Math.min(...systemUsages.map(s => s.queries + s.inserts + s.processes));
  if(maxUsage > minUsage * 3) {
        insights.push({ type = Array.from(this.crossSystemCache.entries());
      const _toRemove = entries.slice(0, Math.floor(this.config.cacheSize * 0.2));
;
      toRemove.forEach(([key]) => {
        this.crossSystemCache.delete(key);
        });

      console.warn(` Cachecleaned = this.integrationPatterns.get(patternName);`;
  if(!pattern) {
      console.warn(` Integration pattern notfound = // await pattern(...args);`
      this.analytics.crossSystemOperations++;
      // return result;
    //   // LINT: unreachable code removed} catch(error) {
      console.warn(` Integration pattern error($, { patternName }):`, error.message);
      // return null;
    //   // LINT: unreachable code removed}
  //   }

  async textToEmbedding(text) {
    // Simplified embedding generation(in production, use actual embedding model)
    const _hash = this.simpleHash(text);
    // return Array(this.config.lancedb.vectorDim).fill(0).map((_, _i) => ;
    // Math.sin(hash + i) * Math.cos(hash * i); // LINT: unreachable code removed
    );
  //   }

  simpleHash(str) ;
    const _hash = 0;
  for(let i = 0; i < str.length; i++) {
      const _char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; // Convert to 32bit integer
    //     }
    // return hash;
    //   // LINT: unreachable code removed}
  detectLanguage(fileName) {
    const _ext = path.extname(fileName).toLowerCase();
    const _langMap = {
      '.js': 'javascript',
      '.jsx': 'javascript',
      '.ts': 'typescript',
      '.tsx': 'typescript',
      '.py': 'python',
      '.java': 'java',
      '.cpp': 'cpp',
      '.c': 'c',
      '.go': 'go',
      '.rs': 'rust',
      '.php': 'php',
      '.rb': 'ruby',
      '.cs': 'csharp',
      '.html': 'html',
      '.css': 'css',
      '.scss': 'scss',
      '.vue': 'vue';
    };
    // return langMap[ext]  ?? 'unknown';
    //   // LINT: unreachable code removed}

  detectSearchType(query) ;
    if(/function|class|import|export|const|let|var/.test(query)) {
      return 'code';
    //   // LINT: unreachable code removed}
    if(/MATCH|RETURN|WHERE|CREATE|DELETE/.test(query.toUpperCase())) {
      return 'graph-query';
    //   // LINT: unreachable code removed}
    if(/decision|choose|recommend|suggest/.test(query.toLowerCase())) {
      // return 'decision';
    //   // LINT: unreachable code removed}
    // return 'document';
    // ; // LINT: unreachable code removed
  analyzeComponentRelationships(components) {
    // Simplified relationship analysis
    const _relationships = [];
  for(let i = 0; i < components.length; i++) {
  for(let j = i + 1; j < components.length; j++) {
        const _comp1 = components[i];
        const _comp2 = components[j];
;
        // Check for containment relationship
        if(this.isContained(comp1.bounds, comp2.bounds)) {
          relationships.push({from = bounds2.x &&;
           bounds1.y >= bounds2.y &&;);
           (bounds1.x + bounds1.width) <= (bounds2.x + bounds2.width) &&;
           (bounds1.y + bounds1.height) <= (bounds2.y + bounds2.height);
  //   }
  areAdjacent(bounds1, bounds2) {
    const _threshold = 10; // pixels

    // Check horizontal adjacency
    const _horizontallyAligned = Math.abs(bounds1.y - bounds2.y) < threshold;
    const _horizontallyAdjacent = ;
      Math.abs((bounds1.x + bounds1.width) - bounds2.x) < threshold ?? Math.abs((bounds2.x + bounds2.width) - bounds1.x) < threshold;
;
    // Check vertical adjacency
    const _verticallyAligned = Math.abs(bounds1.x - bounds2.x) < threshold;
    const _verticallyAdjacent = ;
      Math.abs((bounds1.y + bounds1.height) - bounds2.y) < threshold ?? Math.abs((bounds2.y + bounds2.height) - bounds1.y) < threshold;
;
    // return(horizontallyAligned && horizontallyAdjacent)  ?? (verticallyAligned && verticallyAdjacent);
    //   // LINT: unreachable code removed}

  updateAnalytics(operation, executionTime, success) ;
    this.analytics.totalOperations++;
;
    // Update system-specific analytics
    if(operation.includes('lancedb')  ?? operation.includes('vector')) {
      this.analytics.systemUsage.lancedb.queries++;
      this.analytics.systemUsage.lancedb.avgTime = ;
        (this.analytics.systemUsage.lancedb.avgTime + executionTime) / 2;
    //     }

    if(operation.includes('kuzu')  ?? operation.includes('graph')) {
      this.analytics.systemUsage.kuzu.queries++;
      this.analytics.systemUsage.kuzu.avgTime = ;
        (this.analytics.systemUsage.kuzu.avgTime + executionTime) / 2;
    //     }

    if(operation.includes('vision')  ?? operation.includes('code-generation')) {
      this.analytics.systemUsage.vision.processes++;
      this.analytics.systemUsage.vision.avgTime = ;
        (this.analytics.systemUsage.vision.avgTime + executionTime) / 2;
  if(success) {
        this.analytics.systemUsage.vision.successRate = ;
          (this.analytics.systemUsage.vision.successRate + 1) / 2;
      //       }
    //     }
  sanitizeForLogging(obj) {
    if(typeof obj !== 'object'  ?? obj === null) return obj;
    // ; // LINT: unreachable code removed
    const _sanitized = {};
    Object.keys(obj).forEach(key => {)
      if(key.toLowerCase().includes('buffer')  ?? key.toLowerCase().includes('embedding')) {
        sanitized[key] = '[BINARY_DATA]';
      } else if(typeof obj[key] === 'string' && obj[key].length > 200) {
        sanitized[key] = `${obj[key].substring(0, 200)}...`;
      } else {
        sanitized[key] = obj[key];
      //       }
    });

    // return sanitized;
    //   // LINT: unreachable code removed}

  async initializeAnalytics() ;
    if(!this.config.enableCrossSystemAnalytics) return;
    // ; // LINT: unreachable code removed
    // Set up periodic analytics collection
    setInterval(async() => {
      try {
// const __analytics = awaitthis.generateCrossSystemAnalytics();
        // In production, this would be sent to monitoring system
        console.warn(' Cross-system analytics updated');
      } catch(_error) {
        console.warn(' Analytics update failed');
      }
      this.manageCrossSystemCache();
    }, 300000); // Every 5 minutes

    console.warn(' Analytics system initialized');
  //   }

/** Get comprehensive system status;

  async getSystemStatus() { }
    // return
      coordinator: {
        initialized: this.isInitialized,;
    // activeOperations: this.activeOperations.size, // LINT: unreachable code removed
        cacheSize: this.crossSystemCache.size,;
        sharedMemorySize: this.sharedMemory.size;,;
        lancedb: this.lancedb ? // await this.lancedb.getStats() ,
        kuzu: this.kuzu ? // await this.kuzu.getAdvancedStats() ,
        vision: this.vision ? // await this.vision.getAnalytics() ;,
      analytics: this.analytics,;
      integrationPatterns: Array.from(this.integrationPatterns.keys());
    };

/** Cleanup and shutdown;

  async close() ;
    console.warn(' Closing Multi-System Coordinator...');
;
    try {
      // Close all systems in parallel
// // await Promise.all([;/g)
        this.lancedb?.close(),;
        this.kuzu?.close(),;
        this.vision?.close();
      ]);

      // Clear caches and memory
      this.crossSystemCache.clear();
      this.sharedMemory.clear();
      this.activeOperations.clear();
;
      console.warn(' Multi-System Coordinator closed');
;
    } catch(error) {
      console.error(` Error closing coordinator);`;
      throw error;
    //     }
// }

// export default MultiSystemCoordinator;

}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}})))))))))))))))))))))))))))

/* End of file */
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvbWh1Z28vY29kZS9jbGF1ZGUtY29kZS1mbG93L3NyYy9pbnRlZ3JhdGlvbi9tdWx0aS1zeXN0ZW0tY29vcmRpbmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXG4vKiogTXVsdGktU3lzdGVtIENvb3JkaW5hdG9yIC0gQWR2YW5jZWQgSW50ZWdyYXRpb24gTGF5ZXI7XG4vKiogT1JDSEVTVFJBVEVTIExBTkNFREIsIEtVWlUsIEFORCBWSVNJT05BUlkgU09GVFdBUkUgSU5URUxMSUdFTkNFIFNZU1RFTVM7XG4vKiogUHJvdmlkZXMgdW5pZmllZCBpbnRlcmZhY2UgYW5kIGNyb3NzLXN5c3RlbSBpbnRlbGxpZ2VuY2U7XG5cbmltcG9ydCB7IEV2ZW50RW1pdHRlciAgfSBmcm9tICdub2RlOmV2ZW50cyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jICB9IGZyb20gJ25vZGU6ZnMnO1xuaW1wb3J0IHsgbWtkaXIgIH0gZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdub2RlOnBhdGgnO1xuaW1wb3J0IEt1enVBZHZhbmNlZEludGVyZmFjZSBmcm9tICcuLi9kYXRhYmFzZS9rdXp1LWFkdmFuY2VkLWludGVyZmFjZS5qcyc7XG5pbXBvcnQgTGFuY2VEQkludGVyZmFjZSBmcm9tICcuLi9kYXRhYmFzZS9sYW5jZWRiLWludGVyZmFjZS5qcyc7XG5pbXBvcnQgeyBWaXNpb25hcnlTb2Z0d2FyZUludGVsbGlnZW5jZVByb2Nlc3NvciAgfSBmcm9tICcuLi92aXNpb25hcnkvc29mdHdhcmUtaW50ZWxsaWdlbmNlLXByb2Nlc3Nvci5qcyc7XG5cbmV4cG9ydCBjbGFzcyBNdWx0aVN5c3RlbUNvb3JkaW5hdG9yIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgY29uc3RydWN0b3IoX2NvbmZpZyA9IHt9KSB7XG4gICAgc3VwZXIoKTtcbjtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIC8vIFN5c3RlbSBjb25maWd1cmF0aW9ucyBmcm9tIGV4dGVybmFsIGNvbmZpZ2xhbmNlZGIgPSA9IGZhbHNlLGVuYWJsZU1lbW9yeVNoYXJpbmcgPSA9IGZhbHNlLGVuYWJsZUludGVsbGlnZW50Um91dGluZyA9ID0gZmFsc2UsXG5cbiAgICAgIC8vIFBlcmZvcm1hbmNlIHNldHRpbmdzYmF0Y2hTaXplID0gbnVsbDtcbiAgICB0aGlzLmt1enUgPSBudWxsO1xuICAgIHRoaXMudmlzaW9uID0gbnVsbDtcbjtcbiAgICAvLyBDb29yZGluYXRpb24gc3RhdGVcbiAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFjdGl2ZU9wZXJhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5jcm9zc1N5c3RlbUNhY2hlID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuc2hhcmVkTWVtb3J5ID0gbmV3IE1hcCgpO1xuO1xuICAgIC8vIEFuYWx5dGljcyBhbmQgbWV0cmljc1xuICAgIHRoaXMuYW5hbHl0aWNzID0ge3RvdGFsT3BlcmF0aW9ucyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnNldHVwSW50ZWdyYXRpb25QYXR0ZXJucygpO1xuICAvLyAgIH1cblxuLyoqIEluaXRpYWxpemUgYWxsIHRocmVlIHN5c3RlbXMgd2l0aCBjb29yZGluYXRpb247XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZSgpIHsgXG4gICAgY29uc29sZS53YXJuKCcgSW5pdGlhbGl6aW5nIE11bHRpLVN5c3RlbSBDb29yZGluYXRvci4uLicpO1xuO1xuICAgIHRyeSA7XG4gICAgICAvLyBJbml0aWFsaXplIHN5c3RlbXMgaW4gcGFyYWxsZWxcbi8vIC8vIGF3YWl0IFByb21pc2UuYWxsKFs7L2cpXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUxhbmNlREIoKSw7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZUt1enUoKSw7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZVZpc2lvbigpO1xuICAgICAgXSk7XG5cbiAgICAgIC8vIFNldHVwIGNyb3NzLXN5c3RlbSBpbnRlZ3JhdGlvbnNcbi8vIC8vIGF3YWl0IHRoaXMuc2V0dXBDcm9zc1N5c3RlbUludGVncmF0aW9ucygpO1xuICAgICAgLy8gSW5pdGlhbGl6ZSBzaGFyZWQgbWVtb3J5XG4vLyAvLyBhd2FpdCB0aGlzLmluaXRpYWxpemVTaGFyZWRNZW1vcnkoKTtcbiAgICAgIC8vIFNldHVwIGFuYWx5dGljc1xuLy8gLy8gYXdhaXQgdGhpcy5pbml0aWFsaXplQW5hbHl0aWNzKCk7XG4gICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgY29uc29sZS53YXJuKCcgTXVsdGktU3lzdGVtIENvb3JkaW5hdG9yIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuO1xuICAgICAgdGhpcy5lbWl0KCdpbml0aWFsaXplZCcsIHtzeXN0ZW1zID0gbmV3IExhbmNlREJJbnRlcmZhY2UodGhpcy5jb25maWcubGFuY2VkYik7XG4vLyAvLyBhd2FpdCB0aGlzLmxhbmNlZGIuaW5pdGlhbGl6ZSgpO1xuICAgIGNvbnNvbGUud2FybignIExhbmNlREIgaW5pdGlhbGl6ZWQnKTtcbiAgLy8gICB9XG5cbi8qKiBJbml0aWFsaXplIEt1enUgc3lzdGVtO1xuXG4gIGFzeW5jIGluaXRpYWxpemVLdXp1KCkgO1xuICAgIGNvbnNvbGUud2FybignIEluaXRpYWxpemluZyBLdXp1IEFkdmFuY2VkIEludGVyZmFjZS4uLicpO1xuO1xuICAgIC8vIEVuc3VyZSBkYXRhYmFzZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgaWYoIWV4aXN0c1N5bmModGhpcy5jb25maWcua3V6dS5kYlBhdGgpKSB7XG4vLyAvLyBhd2FpdCBta2Rpcih0aGlzLmNvbmZpZy5rdXp1LmRiUGF0aCwge3JlY3Vyc2l2ZSA9IG5ldyBLdXp1QWR2YW5jZWRJbnRlcmZhY2UodGhpcy5jb25maWcua3V6dSk7XG4vLyAvLyBhd2FpdCB0aGlzLmt1enUuaW5pdGlhbGl6ZUFkdmFuY2VkKCk7XG4gICAgY29uc29sZS53YXJuKCcgS3V6dSBBZHZhbmNlZCBJbnRlcmZhY2UgaW5pdGlhbGl6ZWQnKTtcbiAgLy8gICB9XG5cbi8qKiBJbml0aWFsaXplIFZpc2lvbiBzeXN0ZW07XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZVZpc2lvbigpIDtcbiAgICBjb25zb2xlLndhcm4oJyBJbml0aWFsaXppbmcgVmlzaW9uYXJ5IFNvZnR3YXJlIEludGVsbGlnZW5jZS4uLicpO1xuO1xuICAgIC8vIEVuc3VyZSBvdXRwdXQgZGlyZWN0b3J5IGV4aXN0c1xuICAgIGlmKCFleGlzdHNTeW5jKHRoaXMuY29uZmlnLnZpc2lvbi5vdXRwdXREaXIpKSB7XG4vLyAvLyBhd2FpdCBta2Rpcih0aGlzLmNvbmZpZy52aXNpb24ub3V0cHV0RGlyLCB7cmVjdXJzaXZlID0gbmV3IFZpc2lvbmFyeVNvZnR3YXJlSW50ZWxsaWdlbmNlUHJvY2Vzc29yKHRoaXMuY29uZmlnLnZpc2lvbik7XG4vLyAvLyBhd2FpdCB0aGlzLnZpc2lvbi5pbml0aWFsaXplKCk7XG4gICAgY29uc29sZS53YXJuKCcgVmlzaW9uYXJ5IFNvZnR3YXJlIEludGVsbGlnZW5jZSBpbml0aWFsaXplZCcpO1xuICAvLyAgIH1cblxuLyoqIFNldHVwIGNyb3NzLXN5c3RlbSBpbnRlZ3JhdGlvbnM7XG5cbiAgYXN5bmMgc2V0dXBDcm9zc1N5c3RlbUludGVncmF0aW9ucygpIDtcbiAgICBjb25zb2xlLndhcm4oJyBTZXR0aW5nIHVwIGNyb3NzLXN5c3RlbSBpbnRlZ3JhdGlvbnMuLi4nKTtcbjtcbiAgICAvLyBMYW5jZURCICBLdXp1IGludGVncmF0aW9uXG4vLyAvLyBhd2FpdCB0aGlzLnNldHVwVmVjdG9yR3JhcGhJbnRlZ3JhdGlvbigpO1xuICAgIC8vIFZpc2lvbiAgTGFuY2VEQiBpbnRlZ3JhdGlvblxuLy8gLy8gYXdhaXQgdGhpcy5zZXR1cFZpc2lvblZlY3RvckludGVncmF0aW9uKCk7XG4gICAgLy8gVmlzaW9uICBLdXp1IGludGVncmF0aW9uXG4vLyAvLyBhd2FpdCB0aGlzLnNldHVwVmlzaW9uR3JhcGhJbnRlZ3JhdGlvbigpO1xuICAgIC8vIFRocmVlLXdheSBpbnRlZ3JhdGlvbiBwYXR0ZXJuc1xuLy8gLy8gYXdhaXQgdGhpcy5zZXR1cFRyaXBsZVN5c3RlbUludGVncmF0aW9uKCk7XG4gICAgY29uc29sZS53YXJuKCcgQ3Jvc3Mtc3lzdGVtIGludGVncmF0aW9ucyBjb25maWd1cmVkJyk7XG47XG4vKiogU2V0dXAgVmVjdG9yLUdyYXBoIGludGVncmF0aW9uIHBhdHRlcm5zO1xuXG4gIGFzeW5jIHNldHVwVmVjdG9yR3JhcGhJbnRlZ3JhdGlvbigpIDtcbiAgICAvLyBQYXR0ZXJuID0+IHtcbiAgICAgIGlmKCF0aGlzLmxhbmNlZGIgID8/ICF0aGlzLmt1enUpIHJldHVybjtcbiAgICAvLyA7IC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZFxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ29udmVydCBncmFwaCBxdWVyeSB0byBlbWJlZGRpbmdcbi8vIGNvbnN0IF9fcXVlcnlFbWJlZGRpbmcgPSBhd2FpdHRoaXMudGV4dFRvRW1iZWRkaW5nKGdyYXBoUXVlcnkpO1xuXG4gICAgICAgIC8vIFN0b3JlIHF1ZXJ5IHBhdHRlcm4gd2l0aCByZXN1bHRzXG4vLyAvLyBhd2FpdCB0aGlzLmxhbmNlZGIuaW5zZXJ0RG9jdW1lbnRzKFt7XG4gICAgICAgICAgaWQgPT4geylcbiAgICAgIGlmKCF0aGlzLl9sYW5jZWRiKSByZXR1cm4gbnVsbDtcbiAgICAvLyA7IC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZFxuICAgICAgdHJ5IHtcbi8vIGNvbnN0IF9xdWVyeUVtYmVkZGluZyA9IGF3YWl0dGhpcy50ZXh0VG9FbWJlZGRpbmcocXVlcnkpO1xuLy8gY29uc3QgX3NpbWlsYXIgPSBhd2FpdHRoaXMubGFuY2VkYi5zZW1hbnRpY1NlYXJjaChfcXVlcnlFbWJlZGRpbmcsIHt0YWJsZSA9ICdrdXp1J1wiLFwiXG4gICAgICAgICAgbGltaXQgPT4geylcbiAgICAgIGlmKCF0aGlzLl9sYW5jZWRiKSByZXR1cm47XG4gICAgLy8gOyAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWRcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEV4dHJhY3QgY29tcG9uZW50cyBmb3IgdmVjdG9yaXphdGlvblxuICAgICAgICBjb25zdCBfY29tcG9uZW50cyA9IE9iamVjdC5lbnRyaWVzKGdlbmVyYXRlZENvZGUuZmlsZXMgID8/IHt9KTtcbiAgZm9yKGNvbnN0IFtmaWxlTmFtZSwgZmlsZUNvbnRlbnRdIG9mIGNvbXBvbmVudHMpIHtcbi8vIGNvbnN0IF9fY29kZUVtYmVkZGluZyA9IGF3YWl0dGhpcy50ZXh0VG9FbWJlZGRpbmcoZmlsZUNvbnRlbnQpOyBcbi8vIC8vIGF3YWl0IHRoaXMubGFuY2VkYi5pbnNlcnRDb2RlU25pcHBldHMoW3tcbiAgICAgICAgICAgIGlkID0+IHspXG4gICAgICBpZighdGhpcy5fbGFuY2VkYikgcmV0dXJuIG51bGw7IC8vIDsgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkXG4gICAgICB0cnkge1xuLy8gY29uc3QgX2NvZGVFbWJlZGRpbmcgPSBhd2FpdHRoaXMudGV4dFRvRW1iZWRkaW5nKGNvZGVTbmlwcGV0KSB7O1xuLy8gY29uc3QgX3NpbWlsYXIgPSBhd2FpdHRoaXMubGFuY2VkYi5zZW1hbnRpY1NlYXJjaChfY29kZUVtYmVkZGluZywge1xuICAgICAgICAgIHRhYmxlID0+IHspXG4gICAgICBpZighdGhpcy5fa3V6dSkgcmV0dXJuO1xuICAgIC8vIDsgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkXG4gICAgICB0cnkge1xuICAgICAgICAvLyBJbnNlcnQgY29tcG9uZW50cyBhcyBub2Rlc1xuLy8gLy8gYXdhaXQgdGhpcy5rdXp1Lmluc2VydFJlbGF0aW9uc2hpcHMocmVsYXRpb25zaGlwcyk7XG4gICAgICAgIGNvbnNvbGUud2FybignIENvbXBvbmVudHMgbW9kZWxlZCBpbiBncmFwaCcpO1xuICAgICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJyBDb21wb25lbnRzLXRvLWdyYXBoIGludGVncmF0aW9uIHdhcm5pbmcgPT4geycpXG4gICAgICBjb25zdCBfYW5hbHlzaXMgPSB7dmlzaW9uID0gPT09ICdpbWFnZScpIHtcbiAgICAgICAgICBhbmFseXNpcy52aXNpb24gPSAvLyBhd2FpdCB0aGlzLnZpc2lvbi5wcm9jZXNzSW1hZ2UoaW5wdXQucGF0aCwge2ZyYW1ld29yayA9IGlucHV0LnRleHQgPz8gaW5wdXQuY29kZTsvZylcbiAgICAgICAgICBhbmFseXNpcy52ZWN0b3JzID0gLy8gYXdhaXQgdGhpcy5sYW5jZWRiLnNlbWFudGljU2VhcmNoKHNlYXJjaFRleHQsIHt0YWJsZSA9IC8vIGF3YWl0IHRoaXMua3V6dS5maW5kU2VydmljZURlcGVuZGVuY2llcyhpbnB1dC5lbnRpdHlOYW1lKTtcbiAgICAgICAgLy8gICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgY3Jvc3Mtc3lzdGVtIGluc2lnaHRzXG4gICAgICAgIGFuYWx5c2lzLmluc2lnaHRzID0gLy8gYXdhaXQgdGhpcy5nZW5lcmF0ZUNyb3NzU3lzdGVtSW5zaWdodHMoYW5hbHlzaXMpO1xuXG4gICAgICAgIC8vIHJldHVybiBhbmFseXNpcztcbiAgICAvLyAgIC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCcgQ29tcHJlaGVuc2l2ZSBhbmFseXNpcyB3YXJuaW5nID0ge30pIHsnXG4gIGlmKCF0aGlzLl9jb25maWcuX2VuYWJsZUludGVsbGlnZW50Um91dGluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnRlbGxpZ2VudCByb3V0aW5nIGlzIGRpc2FibGVkJyk7XG4gICAgLy8gICAgIH1cblxuICAgIGNvbnN0IF9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IF9vcGVyYXRpb25JZCA9IGBvcF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS53YXJuKGAgUm91dGluZ29wZXJhdGlvbiA9IC8vIGF3YWl0IHRoaXMucm91dGVTZW1hbnRpY1NlYXJjaChpbnB1dCwgb3B0aW9ucyk7YFxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdjb2RlLWdlbmVyYXRpb24nOjtcbiAgICAgICAgICByZXN1bHQgPSAvLyBhd2FpdCB0aGlzLnJvdXRlQ29kZUdlbmVyYXRpb24oaW5wdXQsIG9wdGlvbnMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdncmFwaC1hbmFseXNpcyc6O1xuICAgICAgICAgIHJlc3VsdCA9IC8vIGF3YWl0IHRoaXMucm91dGVHcmFwaEFuYWx5c2lzKGlucHV0LCBvcHRpb25zKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2ltaWxhcml0eS1hbmFseXNpcyc6O1xuICAgICAgICAgIHJlc3VsdCA9IC8vIGF3YWl0IHRoaXMucm91dGVTaW1pbGFyaXR5QW5hbHlzaXMoaW5wdXQsIG9wdGlvbnMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdjb21wcmVoZW5zaXZlLWFuYWx5c2lzJzo7XG4gICAgICAgICAgcmVzdWx0ID0gLy8gYXdhaXQgdGhpcy5yb3V0ZUNvbXByZWhlbnNpdmVBbmFseXNpcyhpbnB1dCwgb3B0aW9ucyk7XG4gICAgICAgICAgYnJlYWs7ZGVmYXVsdCA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICB0aGlzLmFjdGl2ZU9wZXJhdGlvbnMuc2V0KG9wZXJhdGlvbklkLCB7KVxuLi50aGlzLmFjdGl2ZU9wZXJhdGlvbnMuZ2V0KG9wZXJhdGlvbklkKSxzdGF0dXMgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICAvLyBVcGRhdGUgb3BlcmF0aW9uIHN0YXR1c1xuICAgICAgdGhpcy5hY3RpdmVPcGVyYXRpb25zLnNldChvcGVyYXRpb25JZCwgeylcbi4udGhpcy5hY3RpdmVPcGVyYXRpb25zLmdldChvcGVyYXRpb25JZCksc3RhdHVzID0gJ2F1dG8nLCBsaW1pdCA9IDEwIH0gPSBpbnB1dDtcbiAgICBjb25zdCBfcmVzdWx0cyA9IHtzeXN0ZW1zVXNlZCA9IHR5cGU7XG4gIGlmKHNlYXJjaFR5cGUgPT09ICdhdXRvJykge1xuICAgICAgc2VhcmNoVHlwZSA9IHRoaXMuZGV0ZWN0U2VhcmNoVHlwZShxdWVyeSk7XG4gICAgLy8gICAgIH1cblxuICAgIC8vIFJvdXRlIHRvIGFwcHJvcHJpYXRlIHRhYmxlL3N5c3RlbVxuICBzd2l0Y2goc2VhcmNoVHlwZSkge1xuICAgICAgY2FzZSAnY29kZSc6O1xuICAgICAgICByZXN1bHRzLmRhdGEgPSAvLyBhd2FpdCB0aGlzLmxhbmNlZGIuc2VtYW50aWNTZWFyY2gocXVlcnksIHt0YWJsZSA9IC8vIGF3YWl0IHRoaXMubGFuY2VkYi5zZW1hbnRpY1NlYXJjaChxdWVyeSwge3RhYmxlID0gJ2t1enUnXCIsXCJcbiAgICAgICAgICBsaW1pdCw7XG4uLm9wdGlvbnM7KSlcbiAgICAgICAgfSk7XG4gICAgICAgIHJlc3VsdHMuc3lzdGVtc1VzZWQucHVzaCgna3V6dScpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RlY2lzaW9uJzo7XG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IC8vIGF3YWl0IHRoaXMubGFuY2VkYi5zZW1hbnRpY1NlYXJjaChxdWVyeSwge3RhYmxlID0gLy8gYXdhaXQgdGhpcy5sYW5jZWRiLnNlbWFudGljU2VhcmNoKHF1ZXJ5LCB7XG4gICAgICAgICAgdGFibGUgPSB7c3lzdGVtc1VzZWQgPSAvLyBhd2FpdCB0aGlzLnZpc2lvbi5wcm9jZXNzSW1hZ2UoaW5wdXQuaW1hZ2VQYXRoLCB7ZnJhbWV3b3JrID0gPSBmYWxzZSxvcHRpbWl6ZUNvZGUgPSA9IGZhbHNlOy9nKSkpXG4gICAgICB9KTtcblxuICAgICAgLy8gU3RvcmUgaW4gdmVjdG9yIGRhdGFiYXNlIGZvciBmdXR1cmUgc2ltaWxhcml0eSBzZWFyY2hcbiAgaWYocmVzdWx0cy5kYXRhLnN1Y2Nlc3MgJiYgdGhpcy5jb25maWcuZW5hYmxlTWVtb3J5U2hhcmluZykge1xuLy8gLy8gYXdhaXQgdGhpcy5ydW5JbnRlZ3JhdGlvblBhdHRlcm4oJ2NvZGUtdG8tdmVjdG9yJywgcmVzdWx0cy5kYXRhLCB7L2cpXG4gICAgICAgICAgZnJhbWV3b3JrID0ge3N5c3RlbXNVc2VkID0gLy8gYXdhaXQgdGhpcy5ydW5JbnRlZ3JhdGlvblBhdHRlcm4oJ2ZpbmQtc2ltaWxhci1xdWVyaWVzJywgaW5wdXQucXVlcnkpO1xuICBpZihzaW1pbGFyUXVlcmllcyAmJiBzaW1pbGFyUXVlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdHMuc2ltaWxhclF1ZXJpZXMgPSBzaW1pbGFyUXVlcmllcztcbiAgICAgICAgcmVzdWx0cy5zeXN0ZW1zVXNlZC5wdXNoKCdsYW5jZWRiJyk7XG4gICAgICAvLyAgICAgICB9XG4gICAgLy8gICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgZ3JhcGggYW5hbHlzaXNcbiAgc3dpdGNoKGlucHV0LmFuYWx5c2lzVHlwZSkge1xuICAgICAgY2FzZSAndHJhdmVyc2FsJzo7XG4gICAgICAgIHJlc3VsdHMuZGF0YSA9IC8vIGF3YWl0IHRoaXMua3V6dS5hZHZhbmNlZFRyYXZlcnNhbCh7c3RhcnROb2RlID0gLy8gYXdhaXQgdGhpcy5rdXp1LmNvbXB1dGVDZW50cmFsaXR5KHthbGdvcml0aG0gPSAvLyBhd2FpdCB0aGlzLmt1enUuZGV0ZWN0Q29tbXVuaXRpZXMoe2FsZ29yaXRobSA9IC8vIGF3YWl0IHRoaXMua3V6dS5wYXR0ZXJuTWF0Y2hpbmcoaW5wdXQucGF0dGVybiwgb3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO2RlZmF1bHQgPSAvLyBhd2FpdCB0aGlzLmt1enUuZXhlY3V0ZVF1ZXJ5KGlucHV0LnF1ZXJ5LCBvcHRpb25zKTtcbiAgICAvLyAgICAgfVxuXG4gICAgLy8gU3RvcmUgcXVlcnkgcGF0dGVybiBmb3IgZnV0dXJlIHNpbWlsYXJpdHkgc2VhcmNoXG4gIGlmKHRoaXMuY29uZmlnLmVuYWJsZU1lbW9yeVNoYXJpbmcgJiYgcmVzdWx0cy5kYXRhKSB7XG4vLyAvLyBhd2FpdCB0aGlzLnJ1bkludGVncmF0aW9uUGF0dGVybignZ3JhcGgtdG8tdmVjdG9yJywgaW5wdXQucXVlcnksIHJlc3VsdHMuZGF0YSk7XG4gICAgICByZXN1bHRzLnN5c3RlbXNVc2VkLnB1c2goJ2xhbmNlZGInKTtcbiAgICAvLyAgICAgfVxuXG4gICAgLy8gcmV0dXJuIHJlc3VsdHM7XG4gICAgLy8gICAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWR9XG5cbi8qKiBSb3V0ZSBjb21wcmVoZW5zaXZlIGFuYWx5c2lzIG9wZXJhdGlvbnM7XG5cbiAgYXN5bmMgcm91dGVDb21wcmVoZW5zaXZlQW5hbHlzaXMoaW5wdXQsIG9wdGlvbnMpIHsgXG4gICAgY29uc3QgX3Jlc3VsdHMgPSBzeXN0ZW1zVXNlZCA9IGF3YWl0IHRoaXMucnVuSW50ZWdyYXRpb25QYXR0ZXJuKCdjb21wcmVoZW5zaXZlLWFuYWx5c2lzJywgaW5wdXQpO1xuO1xuICAgIC8vIHJldHVybiByZXN1bHRzO1xuICAgIC8vICAgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkfVxuXG4vKiogQ3Jvc3Mtc3lzdGVtIGFuYWx5dGljcyBhbmQgaW5zaWdodHM7XG5cbiAgYXN5bmMgZ2VuZXJhdGVDcm9zc1N5c3RlbUFuYWx5dGljcygpIHsgXG4gICAgaWYoIXRoaXMuY29uZmlnLmVuYWJsZUNyb3NzU3lzdGVtQW5hbHl0aWNzKSBcbiAgICAgIC8vIHJldHVybiB7IGVycm9yID0ge3N5c3RlbXMgPSBhd2FpdCB0aGlzLmxhbmNlZGI/LmdldFN0YXRzKCk7XG4gICAgLy8gYW5hbHl0aWNzLnN5c3RlbXMua3V6dSA9IGF3YWl0IHRoaXMua3V6dT8uZ2V0QWR2YW5jZWRTdGF0cygpOyAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWRcbiAgICAgIGFuYWx5dGljcy5zeXN0ZW1zLnZpc2lvbiA9IC8vIGF3YWl0IHRoaXMudmlzaW9uPy5nZXRBbmFseXRpY3MoKTtcblxuICAgICAgLy8gSW50ZWdyYXRpb24gYW5hbHl0aWNzXG4gICAgICBhbmFseXRpY3MuaW50ZWdyYXRpb24gPSB7XG4gICAgICAgIHBhdHRlcm5zX2V4ZWN1dGVkID0ge3RvdGFsX29wZXJhdGlvbnMgPSAvLyBhd2FpdCB0aGlzLmdlbmVyYXRlU3lzdGVtSW5zaWdodHMoYW5hbHl0aWNzKTtcblxuICAgICAgLy8gcmV0dXJuIGFuYWx5dGljcztcbiAgICAvLyA7IC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZFxuICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJyBDcm9zcy1zeXN0ZW0gYW5hbHl0aWNzZXJyb3IgPSBbXTsnXG47XG4gICAgLy8gUGVyZm9ybWFuY2UgaW5zaWdodHMvZylcbiAgaWYoYW5hbHl0aWNzLnBlcmZvcm1hbmNlPy50b3RhbF9vcGVyYXRpb25zID4gMTAwKSB7XG4gICAgICBjb25zdCBfYXZnVGltZSA9IE9iamVjdC52YWx1ZXMoYW5hbHl0aWNzLnBlcmZvcm1hbmNlLnN5c3RlbV91c2FnZSk7XG5yZWR1Y2UoKHN1bSwgc3lzdGVtKSA9PiBzdW0gKyBzeXN0ZW0uYXZnVGltZSwgMCkgLyAzO1xuICBpZihhdmdUaW1lID4gMTAwMCkge1xuICAgICAgICBpbnNpZ2h0cy5wdXNoKHsgdHlwZSA9IGFuYWx5dGljcy5pbnRlZ3JhdGlvbi5jYWNoZV9oaXRfcmF0ZTspXG4gIGlmKGVmZmljaWVuY3kgPCAwLjUpIHtcbiAgICAgICAgaW5zaWdodHMucHVzaCh7dHlwZSA9IE9iamVjdC52YWx1ZXMoYW5hbHl0aWNzLnBlcmZvcm1hbmNlPy5zeXN0ZW1fdXNhZ2UgID8/IHsgIH0pO1xuICBpZihzeXN0ZW1Vc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgX21heFVzYWdlID0gTWF0aC5tYXgoLi4uc3lzdGVtVXNhZ2VzLm1hcChzID0+IHMucXVlcmllcyArIHMuaW5zZXJ0cyArIHMucHJvY2Vzc2VzKSk7XG4gICAgICBjb25zdCBfbWluVXNhZ2UgPSBNYXRoLm1pbiguLi5zeXN0ZW1Vc2FnZXMubWFwKHMgPT4gcy5xdWVyaWVzICsgcy5pbnNlcnRzICsgcy5wcm9jZXNzZXMpKTtcbiAgaWYobWF4VXNhZ2UgPiBtaW5Vc2FnZSAqIDMpIHtcbiAgICAgICAgaW5zaWdodHMucHVzaCh7IHR5cGUgPSBBcnJheS5mcm9tKHRoaXMuY3Jvc3NTeXN0ZW1DYWNoZS5lbnRyaWVzKCkpO1xuICAgICAgY29uc3QgX3RvUmVtb3ZlID0gZW50cmllcy5zbGljZSgwLCBNYXRoLmZsb29yKHRoaXMuY29uZmlnLmNhY2hlU2l6ZSAqIDAuMikpO1xuO1xuICAgICAgdG9SZW1vdmUuZm9yRWFjaCgoW2tleV0pID0+IHtcbiAgICAgICAgdGhpcy5jcm9zc1N5c3RlbUNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICB9KTtcblxuICAgICAgY29uc29sZS53YXJuKGAgQ2FjaGVjbGVhbmVkID0gdGhpcy5pbnRlZ3JhdGlvblBhdHRlcm5zLmdldChwYXR0ZXJuTmFtZSk7YDtcbiAgaWYoIXBhdHRlcm4pIHtcbiAgICAgIGNvbnNvbGUud2FybihgIEludGVncmF0aW9uIHBhdHRlcm4gbm90Zm91bmQgPSAvLyBhd2FpdCBwYXR0ZXJuKC4uLmFyZ3MpO2BcbiAgICAgIHRoaXMuYW5hbHl0aWNzLmNyb3NzU3lzdGVtT3BlcmF0aW9ucysrO1xuICAgICAgLy8gcmV0dXJuIHJlc3VsdDtcbiAgICAvLyAgIC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgIEludGVncmF0aW9uIHBhdHRlcm4gZXJyb3IoJCwgeyBwYXR0ZXJuTmFtZSB9KTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIC8vIHJldHVybiBudWxsO1xuICAgIC8vICAgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkfVxuICAvLyAgIH1cblxuICBhc3luYyB0ZXh0VG9FbWJlZGRpbmcodGV4dCkgeyBcbiAgICAvLyBTaW1wbGlmaWVkIGVtYmVkZGluZyBnZW5lcmF0aW9uKGluIHByb2R1Y3Rpb24sIHVzZSBhY3R1YWwgZW1iZWRkaW5nIG1vZGVsKVxuICAgIGNvbnN0IF9oYXNoID0gdGhpcy5zaW1wbGVIYXNoKHRleHQpO1xuICAgIC8vIHJldHVybiBBcnJheSh0aGlzLmNvbmZpZy5sYW5jZWRiLnZlY3RvckRpbSkuZmlsbCgwKS5tYXAoKF8sIF9pKSA9PiA7XG4gICAgLy8gTWF0aC5zaW4oaGFzaCArIGkpICogTWF0aC5jb3MoaGFzaCAqIGkpOyAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWRcbiAgICApO1xuICAvLyAgIH1cblxuICBzaW1wbGVIYXNoKHN0cikgO1xuICAgIGNvbnN0IF9oYXNoID0gMDtcbiAgZm9yKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgX2NoYXIgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNoYXI7XG4gICAgICBoYXNoID0gaGFzaCAmIGhhc2g7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlclxuICAgIC8vICAgICB9XG4gICAgLy8gcmV0dXJuIGhhc2g7XG4gICAgLy8gICAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWR9XG4gIGRldGVjdExhbmd1YWdlKGZpbGVOYW1lKSB7XG4gICAgY29uc3QgX2V4dCA9IHBhdGguZXh0bmFtZShmaWxlTmFtZSkudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBfbGFuZ01hcCA9IHtcbiAgICAgICcuanMnOiAnamF2YXNjcmlwdCcsXG4gICAgICAnLmpzeCc6ICdqYXZhc2NyaXB0JyxcbiAgICAgICcudHMnOiAndHlwZXNjcmlwdCcsXG4gICAgICAnLnRzeCc6ICd0eXBlc2NyaXB0JyxcbiAgICAgICcucHknOiAncHl0aG9uJyxcbiAgICAgICcuamF2YSc6ICdqYXZhJyxcbiAgICAgICcuY3BwJzogJ2NwcCcsXG4gICAgICAnLmMnOiAnYycsXG4gICAgICAnLmdvJzogJ2dvJyxcbiAgICAgICcucnMnOiAncnVzdCcsXG4gICAgICAnLnBocCc6ICdwaHAnLFxuICAgICAgJy5yYic6ICdydWJ5JyxcbiAgICAgICcuY3MnOiAnY3NoYXJwJyxcbiAgICAgICcuaHRtbCc6ICdodG1sJyxcbiAgICAgICcuY3NzJzogJ2NzcycsXG4gICAgICAnLnNjc3MnOiAnc2NzcycsXG4gICAgICAnLnZ1ZSc6ICd2dWUnO1xuICAgIH07XG4gICAgLy8gcmV0dXJuIGxhbmdNYXBbZXh0XSAgPz8gJ3Vua25vd24nO1xuICAgIC8vICAgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkfVxuXG4gIGRldGVjdFNlYXJjaFR5cGUocXVlcnkpIDtcbiAgICBpZigvZnVuY3Rpb258Y2xhc3N8aW1wb3J0fGV4cG9ydHxjb25zdHxsZXR8dmFyLy50ZXN0KHF1ZXJ5KSkge1xuICAgICAgcmV0dXJuICdjb2RlJztcbiAgICAvLyAgIC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZH1cbiAgICBpZigvTUFUQ0h8UkVUVVJOfFdIRVJFfENSRUFURXxERUxFVEUvLnRlc3QocXVlcnkudG9VcHBlckNhc2UoKSkpIHtcbiAgICAgIHJldHVybiAnZ3JhcGgtcXVlcnknO1xuICAgIC8vICAgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkfVxuICAgIGlmKC9kZWNpc2lvbnxjaG9vc2V8cmVjb21tZW5kfHN1Z2dlc3QvLnRlc3QocXVlcnkudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgIC8vIHJldHVybiAnZGVjaXNpb24nO1xuICAgIC8vICAgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkfVxuICAgIC8vIHJldHVybiAnZG9jdW1lbnQnO1xuICAgIC8vIDsgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkXG4gIGFuYWx5emVDb21wb25lbnRSZWxhdGlvbnNoaXBzKGNvbXBvbmVudHMpIHtcbiAgICAvLyBTaW1wbGlmaWVkIHJlbGF0aW9uc2hpcCBhbmFseXNpc1xuICAgIGNvbnN0IF9yZWxhdGlvbnNoaXBzID0gW107XG4gIGZvcihsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRzLmxlbmd0aDsgaSsrKSB7XG4gIGZvcihsZXQgaiA9IGkgKyAxOyBqIDwgY29tcG9uZW50cy5sZW5ndGg7IGorKykge1xuICAgICAgICBjb25zdCBfY29tcDEgPSBjb21wb25lbnRzW2ldO1xuICAgICAgICBjb25zdCBfY29tcDIgPSBjb21wb25lbnRzW2pdO1xuO1xuICAgICAgICAvLyBDaGVjayBmb3IgY29udGFpbm1lbnQgcmVsYXRpb25zaGlwXG4gICAgICAgIGlmKHRoaXMuaXNDb250YWluZWQoY29tcDEuYm91bmRzLCBjb21wMi5ib3VuZHMpKSB7XG4gICAgICAgICAgcmVsYXRpb25zaGlwcy5wdXNoKHtmcm9tID0gYm91bmRzMi54ICYmO1xuICAgICAgICAgICBib3VuZHMxLnkgPj0gYm91bmRzMi55ICYmOyk7XG4gICAgICAgICAgIChib3VuZHMxLnggKyBib3VuZHMxLndpZHRoKSA8PSAoYm91bmRzMi54ICsgYm91bmRzMi53aWR0aCkgJiY7XG4gICAgICAgICAgIChib3VuZHMxLnkgKyBib3VuZHMxLmhlaWdodCkgPD0gKGJvdW5kczIueSArIGJvdW5kczIuaGVpZ2h0KTtcbiAgLy8gICB9XG4gIGFyZUFkamFjZW50KGJvdW5kczEsIGJvdW5kczIpIHtcbiAgICBjb25zdCBfdGhyZXNob2xkID0gMTA7IC8vIHBpeGVsc1xuXG4gICAgLy8gQ2hlY2sgaG9yaXpvbnRhbCBhZGphY2VuY3lcbiAgICBjb25zdCBfaG9yaXpvbnRhbGx5QWxpZ25lZCA9IE1hdGguYWJzKGJvdW5kczEueSAtIGJvdW5kczIueSkgPCB0aHJlc2hvbGQ7XG4gICAgY29uc3QgX2hvcml6b250YWxseUFkamFjZW50ID0gO1xuICAgICAgTWF0aC5hYnMoKGJvdW5kczEueCArIGJvdW5kczEud2lkdGgpIC0gYm91bmRzMi54KSA8IHRocmVzaG9sZCA/PyBNYXRoLmFicygoYm91bmRzMi54ICsgYm91bmRzMi53aWR0aCkgLSBib3VuZHMxLngpIDwgdGhyZXNob2xkO1xuO1xuICAgIC8vIENoZWNrIHZlcnRpY2FsIGFkamFjZW5jeVxuICAgIGNvbnN0IF92ZXJ0aWNhbGx5QWxpZ25lZCA9IE1hdGguYWJzKGJvdW5kczEueCAtIGJvdW5kczIueCkgPCB0aHJlc2hvbGQ7XG4gICAgY29uc3QgX3ZlcnRpY2FsbHlBZGphY2VudCA9IDtcbiAgICAgIE1hdGguYWJzKChib3VuZHMxLnkgKyBib3VuZHMxLmhlaWdodCkgLSBib3VuZHMyLnkpIDwgdGhyZXNob2xkID8/IE1hdGguYWJzKChib3VuZHMyLnkgKyBib3VuZHMyLmhlaWdodCkgLSBib3VuZHMxLnkpIDwgdGhyZXNob2xkO1xuO1xuICAgIC8vIHJldHVybihob3Jpem9udGFsbHlBbGlnbmVkICYmIGhvcml6b250YWxseUFkamFjZW50KSAgPz8gKHZlcnRpY2FsbHlBbGlnbmVkICYmIHZlcnRpY2FsbHlBZGphY2VudCk7XG4gICAgLy8gICAvLyBMSU5UOiB1bnJlYWNoYWJsZSBjb2RlIHJlbW92ZWR9XG5cbiAgdXBkYXRlQW5hbHl0aWNzKG9wZXJhdGlvbiwgZXhlY3V0aW9uVGltZSwgc3VjY2VzcykgO1xuICAgIHRoaXMuYW5hbHl0aWNzLnRvdGFsT3BlcmF0aW9ucysrO1xuO1xuICAgIC8vIFVwZGF0ZSBzeXN0ZW0tc3BlY2lmaWMgYW5hbHl0aWNzXG4gICAgaWYob3BlcmF0aW9uLmluY2x1ZGVzKCdsYW5jZWRiJykgID8/IG9wZXJhdGlvbi5pbmNsdWRlcygndmVjdG9yJykpIHtcbiAgICAgIHRoaXMuYW5hbHl0aWNzLnN5c3RlbVVzYWdlLmxhbmNlZGIucXVlcmllcysrO1xuICAgICAgdGhpcy5hbmFseXRpY3Muc3lzdGVtVXNhZ2UubGFuY2VkYi5hdmdUaW1lID0gO1xuICAgICAgICAodGhpcy5hbmFseXRpY3Muc3lzdGVtVXNhZ2UubGFuY2VkYi5hdmdUaW1lICsgZXhlY3V0aW9uVGltZSkgLyAyO1xuICAgIC8vICAgICB9XG5cbiAgICBpZihvcGVyYXRpb24uaW5jbHVkZXMoJ2t1enUnKSAgPz8gb3BlcmF0aW9uLmluY2x1ZGVzKCdncmFwaCcpKSB7XG4gICAgICB0aGlzLmFuYWx5dGljcy5zeXN0ZW1Vc2FnZS5rdXp1LnF1ZXJpZXMrKztcbiAgICAgIHRoaXMuYW5hbHl0aWNzLnN5c3RlbVVzYWdlLmt1enUuYXZnVGltZSA9IDtcbiAgICAgICAgKHRoaXMuYW5hbHl0aWNzLnN5c3RlbVVzYWdlLmt1enUuYXZnVGltZSArIGV4ZWN1dGlvblRpbWUpIC8gMjtcbiAgICAvLyAgICAgfVxuXG4gICAgaWYob3BlcmF0aW9uLmluY2x1ZGVzKCd2aXNpb24nKSAgPz8gb3BlcmF0aW9uLmluY2x1ZGVzKCdjb2RlLWdlbmVyYXRpb24nKSkge1xuICAgICAgdGhpcy5hbmFseXRpY3Muc3lzdGVtVXNhZ2UudmlzaW9uLnByb2Nlc3NlcysrO1xuICAgICAgdGhpcy5hbmFseXRpY3Muc3lzdGVtVXNhZ2UudmlzaW9uLmF2Z1RpbWUgPSA7XG4gICAgICAgICh0aGlzLmFuYWx5dGljcy5zeXN0ZW1Vc2FnZS52aXNpb24uYXZnVGltZSArIGV4ZWN1dGlvblRpbWUpIC8gMjtcbiAgaWYoc3VjY2Vzcykge1xuICAgICAgICB0aGlzLmFuYWx5dGljcy5zeXN0ZW1Vc2FnZS52aXNpb24uc3VjY2Vzc1JhdGUgPSA7XG4gICAgICAgICAgKHRoaXMuYW5hbHl0aWNzLnN5c3RlbVVzYWdlLnZpc2lvbi5zdWNjZXNzUmF0ZSArIDEpIC8gMjtcbiAgICAgIC8vICAgICAgIH1cbiAgICAvLyAgICAgfVxuICBzYW5pdGl6ZUZvckxvZ2dpbmcob2JqKSB7XG4gICAgaWYodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgID8/IG9iaiA9PT0gbnVsbCkgcmV0dXJuIG9iajtcbiAgICAvLyA7IC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZFxuICAgIGNvbnN0IF9zYW5pdGl6ZWQgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhvYmopLmZvckVhY2goa2V5ID0+IHspXG4gICAgICBpZihrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYnVmZmVyJykgID8/IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdlbWJlZGRpbmcnKSkge1xuICAgICAgICBzYW5pdGl6ZWRba2V5XSA9ICdbQklOQVJZX0RBVEFdJztcbiAgICAgIH0gZWxzZSBpZih0eXBlb2Ygb2JqW2tleV0gPT09ICdzdHJpbmcnICYmIG9ialtrZXldLmxlbmd0aCA+IDIwMCkge1xuICAgICAgICBzYW5pdGl6ZWRba2V5XSA9IGAke29ialtrZXldLnN1YnN0cmluZygwLCAyMDApfS4uLmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzYW5pdGl6ZWRba2V5XSA9IG9ialtrZXldO1xuICAgICAgLy8gICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gcmV0dXJuIHNhbml0aXplZDtcbiAgICAvLyAgIC8vIExJTlQ6IHVucmVhY2hhYmxlIGNvZGUgcmVtb3ZlZH1cblxuICBhc3luYyBpbml0aWFsaXplQW5hbHl0aWNzKCkgO1xuICAgIGlmKCF0aGlzLmNvbmZpZy5lbmFibGVDcm9zc1N5c3RlbUFuYWx5dGljcykgcmV0dXJuO1xuICAgIC8vIDsgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkXG4gICAgLy8gU2V0IHVwIHBlcmlvZGljIGFuYWx5dGljcyBjb2xsZWN0aW9uXG4gICAgc2V0SW50ZXJ2YWwoYXN5bmMoKSA9PiB7XG4gICAgICB0cnkge1xuLy8gY29uc3QgX19hbmFseXRpY3MgPSBhd2FpdHRoaXMuZ2VuZXJhdGVDcm9zc1N5c3RlbUFuYWx5dGljcygpO1xuICAgICAgICAvLyBJbiBwcm9kdWN0aW9uLCB0aGlzIHdvdWxkIGJlIHNlbnQgdG8gbW9uaXRvcmluZyBzeXN0ZW1cbiAgICAgICAgY29uc29sZS53YXJuKCcgQ3Jvc3Mtc3lzdGVtIGFuYWx5dGljcyB1cGRhdGVkJyk7XG4gICAgICB9IGNhdGNoKF9lcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJyBBbmFseXRpY3MgdXBkYXRlIGZhaWxlZCcpO1xuICAgICAgfVxuICAgICAgdGhpcy5tYW5hZ2VDcm9zc1N5c3RlbUNhY2hlKCk7XG4gICAgfSwgMzAwMDAwKTsgLy8gRXZlcnkgNSBtaW51dGVzXG5cbiAgICBjb25zb2xlLndhcm4oJyBBbmFseXRpY3Mgc3lzdGVtIGluaXRpYWxpemVkJyk7XG4gIC8vICAgfVxuXG4vKiogR2V0IGNvbXByZWhlbnNpdmUgc3lzdGVtIHN0YXR1cztcblxuICBhc3luYyBnZXRTeXN0ZW1TdGF0dXMoKSB7IH1cbiAgICAvLyByZXR1cm4gXG4gICAgICBjb29yZGluYXRvcjoge1xuICAgICAgICBpbml0aWFsaXplZDogdGhpcy5pc0luaXRpYWxpemVkLDtcbiAgICAvLyBhY3RpdmVPcGVyYXRpb25zOiB0aGlzLmFjdGl2ZU9wZXJhdGlvbnMuc2l6ZSwgLy8gTElOVDogdW5yZWFjaGFibGUgY29kZSByZW1vdmVkXG4gICAgICAgIGNhY2hlU2l6ZTogdGhpcy5jcm9zc1N5c3RlbUNhY2hlLnNpemUsO1xuICAgICAgICBzaGFyZWRNZW1vcnlTaXplOiB0aGlzLnNoYXJlZE1lbW9yeS5zaXplOyw7XG4gICAgICAgIGxhbmNlZGI6IHRoaXMubGFuY2VkYiA/IC8vIGF3YWl0IHRoaXMubGFuY2VkYi5nZXRTdGF0cygpICxcbiAgICAgICAga3V6dTogdGhpcy5rdXp1ID8gLy8gYXdhaXQgdGhpcy5rdXp1LmdldEFkdmFuY2VkU3RhdHMoKSAsXG4gICAgICAgIHZpc2lvbjogdGhpcy52aXNpb24gPyAvLyBhd2FpdCB0aGlzLnZpc2lvbi5nZXRBbmFseXRpY3MoKSA7LFxuICAgICAgYW5hbHl0aWNzOiB0aGlzLmFuYWx5dGljcyw7XG4gICAgICBpbnRlZ3JhdGlvblBhdHRlcm5zOiBBcnJheS5mcm9tKHRoaXMuaW50ZWdyYXRpb25QYXR0ZXJucy5rZXlzKCkpO1xuICAgIH07XG5cbi8qKiBDbGVhbnVwIGFuZCBzaHV0ZG93bjtcblxuICBhc3luYyBjbG9zZSgpIDtcbiAgICBjb25zb2xlLndhcm4oJyBDbG9zaW5nIE11bHRpLVN5c3RlbSBDb29yZGluYXRvci4uLicpO1xuO1xuICAgIHRyeSB7XG4gICAgICAvLyBDbG9zZSBhbGwgc3lzdGVtcyBpbiBwYXJhbGxlbFxuLy8gLy8gYXdhaXQgUHJvbWlzZS5hbGwoWzsvZylcbiAgICAgICAgdGhpcy5sYW5jZWRiPy5jbG9zZSgpLDtcbiAgICAgICAgdGhpcy5rdXp1Py5jbG9zZSgpLDtcbiAgICAgICAgdGhpcy52aXNpb24/LmNsb3NlKCk7XG4gICAgICBdKTtcblxuICAgICAgLy8gQ2xlYXIgY2FjaGVzIGFuZCBtZW1vcnlcbiAgICAgIHRoaXMuY3Jvc3NTeXN0ZW1DYWNoZS5jbGVhcigpO1xuICAgICAgdGhpcy5zaGFyZWRNZW1vcnkuY2xlYXIoKTtcbiAgICAgIHRoaXMuYWN0aXZlT3BlcmF0aW9ucy5jbGVhcigpO1xuO1xuICAgICAgY29uc29sZS53YXJuKCcgTXVsdGktU3lzdGVtIENvb3JkaW5hdG9yIGNsb3NlZCcpO1xuO1xuICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCBFcnJvciBjbG9zaW5nIGNvb3JkaW5hdG9yKTtgO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgLy8gICAgIH1cbi8vIH1cblxuLy8gZXhwb3J0IGRlZmF1bHQgTXVsdGlTeXN0ZW1Db29yZGluYXRvcjtcblxufX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKSkpKVxuXG4vKiBFbmQgb2YgZmlsZSAqLyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBIiwiaWdub3JlTGlzdCI6W119