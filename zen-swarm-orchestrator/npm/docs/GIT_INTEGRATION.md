# üîó Git Integration for Agent Completion

ruv-swarm can automatically commit agent work to Git with detailed reports after each successful agent task completion.

## Features

- ‚úÖ **Automatic Git Commits** - Commit after each agent completes successfully
- üìä **Detailed Reports** - Generate markdown reports with metrics and achievements
- üè∑Ô∏è **Semantic Commits** - Well-structured commit messages with agent metadata
- üöÄ **Optional Auto-Push** - Push to GitHub automatically (configurable)
- üìà **Performance Tracking** - Include metrics in commit messages

## Configuration

### 1. Environment Variables

Add these to your `.env` file:

```bash
# Git Integration
RUV_SWARM_AUTO_COMMIT=true          # Enable automatic commits
RUV_SWARM_AUTO_PUSH=false          # Set to true for auto-push
RUV_SWARM_COMMIT_PREFIX=feat        # Commit message prefix
RUV_SWARM_GIT_AUTHOR=ruv-swarm     # Git author name

# Agent Reports
RUV_SWARM_GENERATE_REPORTS=true     # Generate detailed reports
RUV_SWARM_REPORT_DIR=.ruv-swarm/agent-reports
```

### 2. Hook Configuration

The agent-complete hook is automatically configured in `.claude/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "^Task$",
        "condition": "${tool.result.success}",
        "hooks": [{
          "type": "command",
          "command": "npx ruv-swarm hook agent-complete --agent '${tool.params.description}' --commit-to-git true --generate-report true"
        }]
      }
    ]
  }
}
```

## How It Works

### 1. Agent Completion Detection
When a Task tool completes successfully, the hook triggers automatically.

### 2. Report Generation
A detailed markdown report is created including:
- Agent name and timestamp
- Task description
- Output summary
- Performance metrics
- Files modified
- Coordination activity
- Learnings and patterns

### 3. Git Commit
The system automatically:
- Stages all changes (`git add -A`)
- Creates a semantic commit message
- Includes agent co-authorship
- References the detailed report

### 4. Example Commit Message

```
feat(backend-developer): Complete agent task

Agent: Backend Developer
Timestamp: 2025-01-07T10:30:00Z

## Task Summary
Implement REST API with authentication...

## Achievements
- Created Express server with JWT auth
- Set up SQLite database with models
- Added rate limiting and security
- Implemented health checks
- Created comprehensive error handling

## Metrics
- Operations: 45
- Files: 12
- Efficiency: excellent

## Report
Detailed report: .ruv-swarm/agent-reports/backend-developer-1751382687918.md

ü§ñ Generated by ruv-swarm agent coordination
Co-Authored-By: Backend Developer <agent@ruv-swarm.ai>
```

## Manual Usage

You can also manually trigger agent completion:

```bash
npx ruv-swarm hook agent-complete \
  --agent "Custom Agent" \
  --prompt "Build feature X" \
  --output "Successfully created..." \
  --commit-to-git true \
  --generate-report true \
  --push-to-github false
```

## Report Structure

Reports are saved to `.ruv-swarm/agent-reports/` with the format:
- `{agent-name}-{timestamp}.md`

Each report includes:
1. **Metadata** - Agent info, timestamp, session ID
2. **Task Description** - Full prompt/instructions
3. **Output Summary** - Key accomplishments
4. **Performance Metrics** - Operations, efficiency, tokens saved
5. **Files Modified** - Complete list with operation types
6. **Coordination Activity** - Memory ops, hooks, neural training
7. **Learnings** - Patterns and improvements

## Best Practices

### 1. Commit Frequency
- One commit per agent completion keeps history clean
- Use `RUV_SWARM_AUTO_COMMIT=false` for manual control

### 2. Push Strategy
- Keep `RUV_SWARM_AUTO_PUSH=false` during development
- Enable for CI/CD pipelines
- Use branch protection rules

### 3. Report Management
- Reports accumulate over time
- Consider archiving old reports
- Use `.gitignore` for report directory if needed

### 4. Commit Messages
- Customize `RUV_SWARM_COMMIT_PREFIX` per project
- Agent names become part of the scope
- Full details in commit body

## Integration with CI/CD

### GitHub Actions Example

```yaml
name: ruv-swarm Agent Tasks

on:
  push:
    branches: [ main ]

jobs:
  agent-tasks:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm install
    
    - name: Configure Git
      run: |
        git config user.name "ruv-swarm[bot]"
        git config user.email "bot@ruv-swarm.ai"
    
    - name: Run Agent Tasks
      env:
        RUV_SWARM_AUTO_COMMIT: true
        RUV_SWARM_AUTO_PUSH: true
      run: |
        npx ruv-swarm task orchestrate \
          --task "Update documentation" \
          --agents 3 \
          --commit-on-complete
```

## Troubleshooting

### No commits created
- Check git is initialized: `git status`
- Verify changes exist: `git status --porcelain`
- Check hook logs: `RUV_SWARM_HOOK_DEBUG=true`

### Push failures
- Ensure authentication is configured
- Check branch permissions
- Verify remote is set: `git remote -v`

### Large reports
- Reports can be excluded from commits with `.gitignore`
- Use summary mode for lighter commits
- Archive old reports periodically

## Security Considerations

1. **Sensitive Data** - Reports may contain code/data
2. **Access Control** - Use branch protection
3. **Bot Accounts** - Consider using bot tokens
4. **Report Privacy** - May want to encrypt sensitive reports

---

The Git integration provides complete traceability of agent work, making it easy to track progress, review changes, and maintain a detailed history of your AI-assisted development workflow.