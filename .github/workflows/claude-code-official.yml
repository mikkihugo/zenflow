name: Claude Code

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, synchronize]

concurrency:
  group: claude-automation
  cancel-in-progress: false

permissions:
  contents: write
  issues: write
  pull-requests: write
  id-token: write

jobs:
  claude:
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'issues' && (github.event.action == 'opened' || 
       (github.event.action == 'labeled' && contains(github.event.issue.labels.*.name, 'claude-code')))) ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request')
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Claude Code Action
        uses: anthropics/claude-code-action@beta
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          custom_instructions: |
            You are Claude Code, an expert AI developer. Follow the project's CLAUDE.md file for guidelines.
            
            When resolving issues:
            1. Analyze the issue requirements thoroughly
            2. Generate real, functional TypeScript/JavaScript implementations
            3. Create proper directory structures and file organization
            4. Implement comprehensive solutions with interfaces, classes, and methods
            5. Add appropriate error handling and logging
            6. Follow existing code patterns and conventions
            
            Always create actual working code solutions, not placeholder files.